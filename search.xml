<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ğŸ”” å¦‚ä½•æ¥å…¥githubç™»å½•</title>
      <link href="/2025/05/27/login-github/"/>
      <url>/2025/05/27/login-github/</url>
      
        <content type="html"><![CDATA[<p>githubç™»å½•é€šè¿‡<strong>OAuth</strong>åè®®æ¥å…¥ç¬¬ä¸‰æ–¹å¹³å°ï¼Œç”¨æˆ·æ— éœ€æ³¨å†Œæ–°è´¦å·ã€‚ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹æ¥å…¥æµç¨‹ã€‚</p><h1 id="åˆ›å»º-GitHub-OAuth-åº”ç”¨"><a href="#åˆ›å»º-GitHub-OAuth-åº”ç”¨" class="headerlink" title="åˆ›å»º GitHub OAuth åº”ç”¨"></a>åˆ›å»º GitHub OAuth åº”ç”¨</h1><p>è®¿é—® <a href="https://github.com/settings/developers">GitHub Developer Settings</a> åˆ›å»ºæ–°åº”ç”¨ã€‚å¡«å†™ <code>Application name</code>ã€<code>Homepage URL</code>ã€<code>Authorization callback URL</code>ã€‚ä¿å­˜ç”Ÿæˆçš„<code>Client ID</code> å’Œ <code>Client Secret</code>ã€‚</p><p>&#x3D;&#x3D;ï¼Client Secret éœ€è¦å¦å¤–è®°å½•ä¸‹æ¥ï¼Œå®ƒåªåœ¨ç”Ÿæˆçš„æ—¶å€™å¯è§ã€‚&#x3D;&#x3D;</p><h1 id="è·³è½¬åˆ°æˆæƒé¡µ"><a href="#è·³è½¬åˆ°æˆæƒé¡µ" class="headerlink" title="è·³è½¬åˆ°æˆæƒé¡µ"></a>è·³è½¬åˆ°æˆæƒé¡µ</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleLogin</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">href</span> = <span class="string">&#x27;https://github.com/login/oauth/authorize?client_id=Ov23li276DdOmpC29BIR&amp;scope=read:user&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­æ˜¯å¦ç™»å½•ï¼Œå¦‚æœæ²¡æœ‰ç™»å½•åˆ™è·³è½¬åˆ° github çš„ç™»å½•æˆæƒé¡µã€‚</p><h1 id="æˆæƒåè¿”å›code"><a href="#æˆæƒåè¿”å›code" class="headerlink" title="æˆæƒåè¿”å›code"></a>æˆæƒåè¿”å›code</h1><p>ç¬¬ä¸€æ­¥å¡«å†™äº†<code>Authorization callback URL</code>ï¼Œæ‰€ä»¥ç”¨æˆ·æˆæƒåä¼šè¿”å›æ­¤é¡µé¢ã€‚åœ¨æ­¤é¡µé¢ä¸­ï¼Œå¯ä»¥ä»urlçš„queryå‚æ•°ä¸­æ‹¿åˆ°<code>code</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const urlParams = new URLSearchParams(window.location.search);</span><br><span class="line">  const code = urlParams.get(&#x27;code&#x27;);</span><br></pre></td></tr></table></figure><h1 id="åç«¯ç”¨codeæ¢å–Access-Token"><a href="#åç«¯ç”¨codeæ¢å–Access-Token" class="headerlink" title="åç«¯ç”¨codeæ¢å–Access Token"></a>åç«¯ç”¨codeæ¢å–Access Token</h1><p>å‰ç«¯å°†ä¸Šä¸€æ­¥çš„<code>code</code>ä¼ é€’ç»™åç«¯ã€‚<br>åç«¯ç”¨æ­¤<code>code</code>è·å–<code>Access Token</code>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; code &#125; = req.<span class="property">query</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> params = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>();</span><br><span class="line">params.<span class="title function_">append</span>(<span class="string">&#x27;client_id&#x27;</span>, process.<span class="property">env</span>.<span class="property">GITHUB_CLIENT_ID</span>);</span><br><span class="line">params.<span class="title function_">append</span>(<span class="string">&#x27;client_secret&#x27;</span>, process.<span class="property">env</span>.<span class="property">GITHUB_CLIENT_SECRET</span>);</span><br><span class="line">params.<span class="title function_">append</span>(<span class="string">&#x27;code&#x27;</span>, code);</span><br><span class="line"><span class="keyword">const</span> tokenRes = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;https://github.com/login/oauth/access_token&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">  <span class="attr">body</span>: params.<span class="title function_">toString</span>(),</span><br><span class="line">  <span class="attr">headers</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  agent,</span><br><span class="line">&#125;).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>());</span><br><span class="line"><span class="keyword">if</span> (tokenRes.<span class="property">error</span> === <span class="string">&#x27;bad_verification_code&#x27;</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> res.<span class="title function_">jsonFail</span>(<span class="string">&#x27;codeæ— æ•ˆ&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> accessToken = tokenRes.<span class="property">access_token</span>;</span><br></pre></td></tr></table></figure><h1 id="ç”¨Access-Tokenè·å–ç”¨æˆ·ä¿¡æ¯"><a href="#ç”¨Access-Tokenè·å–ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="ç”¨Access Tokenè·å–ç”¨æˆ·ä¿¡æ¯"></a>ç”¨Access Tokenè·å–ç”¨æˆ·ä¿¡æ¯</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">const userInfo = await fetch(&#x27;https://api.github.com/user&#x27;, &#123;</span><br><span class="line">  headers: &#123;</span><br><span class="line">    Authorization: `Bearer $&#123;accessToken&#125;`,</span><br><span class="line">    &#x27;User-Agent&#x27;: process.env.APP_NAME,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;).then(res =&gt; res.json());</span><br></pre></td></tr></table></figure><h1 id="å­˜å‚¨ç”¨æˆ·ä¿¡æ¯å¹¶è¿”å›"><a href="#å­˜å‚¨ç”¨æˆ·ä¿¡æ¯å¹¶è¿”å›" class="headerlink" title="å­˜å‚¨ç”¨æˆ·ä¿¡æ¯å¹¶è¿”å›"></a>å­˜å‚¨ç”¨æˆ·ä¿¡æ¯å¹¶è¿”å›</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">let user = await User.findOne(&#123; name: userInfo.login &#125;);</span><br><span class="line">if (!user) &#123;</span><br><span class="line">  user = await User.create(&#123;</span><br><span class="line">    name: userInfo.login,</span><br><span class="line">    avatar: userInfo.avatar_url,</span><br><span class="line">    githubUrl: userInfo.html_url,</span><br><span class="line">    token: accessToken,</span><br><span class="line">    createdAt: Date.now(),</span><br><span class="line">    lastLoginAt: Date.now(),</span><br><span class="line">  &#125;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  user.lastLoginAt = Date.now();</span><br><span class="line">  await user.save();</span><br><span class="line">&#125;</span><br><span class="line">res.jsonSuccess(user);</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ¥å…¥githubç™»å½•çš„æµç¨‹æ€»ç»“å¦‚ä¸‹ï¼š<br>1.åˆ›å»ºGitHub OAuthåº”ç”¨<br>2.ç‚¹å‡»æŒ‰é’®ï¼Œè·³è½¬è‡³GitHubæˆæƒé¡µ<br>3.ç”¨æˆ·ç‚¹å‡»æˆæƒåï¼Œè¿”å›code<br>4.æºå¸¦codeè¯·æ±‚åç«¯ï¼Œåç«¯ç”¨codeæ¢å–Access Tokenï¼Œå¹¶ç”¨Access Tokenè·å–ç”¨æˆ·ä¿¡æ¯<br>5.åç«¯è¿”å›ç”¨æˆ·ä¿¡æ¯</p>]]></content>
      
      
      <categories>
          
          <category> æŒ‡å— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> github </tag>
            
            <tag> ç™»å½• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ’ ä½¿ç”¨ Maplibre å¼€å‘åœ°å›¾</title>
      <link href="/2025/05/25/maplibre-guide/"/>
      <url>/2025/05/25/maplibre-guide/</url>
      
        <content type="html"><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>Maplibre-glæ˜¯ä¸€ä¸ª<strong>å¼€æº</strong>çš„jsåº“ï¼Œç”¨äºåœ¨ç½‘é¡µä¸­åˆ›å»ºé«˜æ€§èƒ½ã€äº¤äº’å¼çš„åœ°å›¾åº”ç”¨ã€‚Maplibre-glæ˜¯<code>Mapbox GL JS</code>çš„å…è´¹æ›¿ä»£å“ï¼Œæä¾›ä¸ Mapbox GL JS ç±»ä¼¼çš„åŠŸèƒ½ï¼ŒåŒæ—¶åšæŒå®Œå…¨å¼€æºã€‚</p><p>ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li>GIS ç³»ç»Ÿï¼šæ„å»ºåœ°ç†ä¿¡æ¯åˆ†æå·¥å…·ã€‚</li><li>æ•°æ®å¯è§†åŒ–ï¼šåœ¨åœ°å›¾ä¸Šå åŠ çƒ­åŠ›å›¾ã€è½¨è¿¹ã€ç‚¹äº‘ç­‰æ•°æ®ã€‚</li><li>å®¤å†…åœ°å›¾ï¼šæ”¯æŒè‡ªå®šä¹‰æ¥¼å±‚å¹³é¢å›¾å’Œå¯¼èˆªã€‚</li><li>ç§»åŠ¨åº”ç”¨ï¼šé€šè¿‡ React Native é›†æˆåˆ°è·¨å¹³å°åº”ç”¨ä¸­ã€‚</li></ul><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20250514231301.png" alt="åœ°å›¾"></p><p>æ ¸å¿ƒç‰¹æ€§ï¼š</p><ol><li><p>çŸ¢é‡åˆ‡ç‰‡ï¼ˆVector Tilesï¼‰æ”¯æŒ<br> ä½¿ç”¨çŸ¢é‡åœ°å›¾æ•°æ®ï¼ˆè€Œéä¼ ç»Ÿæ …æ ¼å›¾å—ï¼‰ï¼Œå…è®¸åŠ¨æ€æ ·å¼è°ƒæ•´å’Œé«˜åˆ†è¾¨ç‡æ¸²æŸ“ã€‚<br> æ”¯æŒ .pbf æ ¼å¼çš„çŸ¢é‡åˆ‡ç‰‡ï¼Œå…¼å®¹å¤šç§æ•°æ®æºï¼ˆå¦‚ OpenStreetMapã€è‡ªå®šä¹‰æ•°æ®ï¼‰ã€‚</p></li><li><p>WebGL åŠ é€Ÿæ¸²æŸ“<br> åŸºäº WebGL æŠ€æœ¯ï¼Œå®ç°é«˜æ€§èƒ½çš„åœ°å›¾æ¸²æŸ“ï¼Œé€‚åˆå¤„ç†å¤æ‚åœ°å›¾æ ·å¼å’Œå¤§è§„æ¨¡æ•°æ®ã€‚</p></li><li><p>åŠ¨æ€æ ·å¼ä¸äº¤äº’<br> é€šè¿‡ JSON æ ¼å¼å®šä¹‰åœ°å›¾æ ·å¼ï¼ˆå¦‚é¢œè‰²ã€å›¾æ ‡ã€æ–‡å­—ç­‰ï¼‰ï¼Œæ”¯æŒå®æ—¶æ›´æ–°ã€‚<br> æ”¯æŒé¼ æ ‡&#x2F;è§¦æ‘¸äº¤äº’ï¼ˆç¼©æ”¾ã€æ‹–æ‹½ã€æ—‹è½¬ã€å€¾æ–œç­‰ï¼‰ã€‚</p></li><li><p>è·¨å¹³å°å…¼å®¹<br> å¯åœ¨æµè§ˆå™¨å’Œç§»åŠ¨ç«¯ï¼ˆé€šè¿‡ React Native ç­‰æ¡†æ¶ï¼‰ä½¿ç”¨ã€‚</p></li><li><p>æ’ä»¶ç”Ÿæ€<br> å…¼å®¹ Mapbox GL JS çš„æ’ä»¶ï¼ˆå¦‚åœ°å›¾æ§ä»¶ã€æ ‡è®°ç‚¹ã€åŠ¨ç”»æ•ˆæœç­‰ï¼‰ã€‚<br> æä¾›é¢å¤–åŠŸèƒ½æ‰©å±•ï¼Œä¾‹å¦‚åœ°ç†ç¼–ç ã€3D åœ°å½¢ç­‰ã€‚</p></li></ol><h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><p>ç¬¬ä¸€æ­¥ï¼Œnpmå®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install maplibre-gl</span><br><span class="line">npm install @types/maplibre-gl --save-dev <span class="comment"># ts</span></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼Œåˆ›å»ºåœ°å›¾å®¹å™¨ï¼Œå¿…é¡»æ˜ç¡®æŒ‡å®šå®½é«˜</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">ref</span>=<span class="string">&quot;mapContainerRef&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 100%; height: 100vh;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ï¼Œæ¸²æŸ“åœ°å›¾</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; ref, onMounted, onUnmounted &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> maplibregl <span class="keyword">from</span> <span class="string">&#x27;maplibre-gl&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;maplibre-gl/dist/maplibre-gl.css&#x27;</span>; <span class="comment">// å¿…é¡»å¼•å…¥æ ·å¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> mapContainer = <span class="title function_">ref</span>(<span class="literal">null</span>); <span class="comment">// åœ°å›¾å®¹å™¨å¼•ç”¨</span></span><br><span class="line"><span class="keyword">let</span> map = <span class="title function_">ref</span>(<span class="literal">null</span>); <span class="comment">// åœ°å›¾å®ä¾‹</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">onMounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ç¡®ä¿å®¹å™¨å·²æ¸²æŸ“</span></span><br><span class="line">  <span class="keyword">if</span> (!mapContainer.<span class="property">value</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–åœ°å›¾</span></span><br><span class="line">  map.<span class="property">value</span> = <span class="keyword">new</span> maplibregl.<span class="title class_">Map</span>(&#123;</span><br><span class="line">    <span class="attr">container</span>: mapContainer.<span class="property">value</span>, <span class="comment">// ç»‘å®šå®¹å™¨</span></span><br><span class="line">    <span class="attr">style</span>: <span class="string">&#x27;https://demotiles.maplibre.org/style.json&#x27;</span>, <span class="comment">// é»˜è®¤åœ°å›¾æ ·å¼</span></span><br><span class="line">    <span class="attr">center</span>: [<span class="number">116.4</span>, <span class="number">39.9</span>], <span class="comment">// åˆå§‹ä¸­å¿ƒç‚¹ï¼ˆç¤ºä¾‹ä¸ºåŒ—äº¬ï¼‰</span></span><br><span class="line">    <span class="attr">zoom</span>: <span class="number">10</span> <span class="comment">// åˆå§‹ç¼©æ”¾çº§åˆ«</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">onUnmounted</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// é”€æ¯åœ°å›¾å®ä¾‹ï¼Œé¿å…å†…å­˜æ³„æ¼</span></span><br><span class="line">  map.<span class="property">value</span> &amp;&amp; map.<span class="property">value</span>.<span class="title function_">remove</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="è‡ªå®šä¹‰åœ°å›¾"><a href="#è‡ªå®šä¹‰åœ°å›¾" class="headerlink" title="è‡ªå®šä¹‰åœ°å›¾"></a>è‡ªå®šä¹‰åœ°å›¾</h1><h2 id="ç“¦ç‰‡å›¾Tile-Map"><a href="#ç“¦ç‰‡å›¾Tile-Map" class="headerlink" title="ç“¦ç‰‡å›¾Tile Map"></a>ç“¦ç‰‡å›¾Tile Map</h2><p>ç¬¬ä¸€æ­¥ï¼Œå°†ä¸€å¼ å¤§å›¾åˆ‡åˆ†ä½ç“¦ç‰‡å›¾ã€‚<br>åœ°å›¾é€šå¸¸éƒ½éå¸¸å¤§ï¼Œæ‰€ä»¥éœ€è¦æŒ‰ç…§è¯¦ç»†ç¨‹åº¦åˆ‡åˆ†æˆä¸åŒç­‰çº§çš„å›¾ç‰‡ï¼Œæ ¹æ®ç¼©æ”¾æƒ…å†µæ˜¾ç¤ºä¸åŒç­‰çº§çš„å›¾ç‰‡ï¼Œåˆ‡åˆ†å‡ºæ¥çš„ä¸€å¼ å¼ å°å›¾å°±æ˜¯ç“¦ç‰‡å›¾ã€‚</p><p>ç“¦ç‰‡å›¾æ•´ä½“å‘ˆç°å‡º<strong>é‡‘å­—å¡”</strong>å½¢å¼ã€‚<br><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20250514231314.png" alt="é‡‘å­—å¡”ç“¦ç‰‡"></p><p>ç“¦ç‰‡å‘½åé€šå¸¸éµå¾ª <code>&#123;z&#125;/&#123;x&#125;/&#123;y&#125;.png</code> æ ¼å¼ï¼Œå…¶ä¸­zè¡¨ç¤ºç¼©æ”¾çº§åˆ«ï¼Œxå’Œyè¡¨ç¤ºç“¦ç‰‡åæ ‡ã€‚åˆ‡å‡ºæ¥çš„ç“¦ç‰‡å›¾ä¹Ÿä»¥z&#x2F;x&#x2F;yçš„å±‚çº§å­˜æ”¾ã€‚<br><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20250514231351.png" alt="ç“¦ç‰‡å›¾ç›®å½•"></p><p>å¦‚ä½•æŠŠä¸åŒç¼–å·çš„ç“¦ç‰‡å›¾æ”¾åˆ°å¯¹åº”ä½ç½®ï¼Œä¸åŒæ ‡å‡†æœ‰ä¸åŒè§„åˆ™ã€‚<br>è°·æ­ŒXYZï¼šzè¡¨ç¤ºç¼©æ”¾å±‚çº§ï¼Œxä»å·¦å¾€å³ï¼Œyä»ä¸Šå¾€ä¸‹ï¼›<br>TMSï¼šzè¡¨ç¤ºç¼©æ”¾å±‚çº§ï¼Œxä»å·¦å¾€å³ï¼Œyä»ä¸‹å¾€ä¸Šï¼›</p><p>ç“¦ç‰‡å›¾çš„ä¸»è¦ç‰¹ç‚¹ï¼š<br>åˆ†å—åŠ è½½ï¼šåœ°å›¾è¢«åˆ‡åˆ†æˆå°å—ï¼ˆé€šå¸¸æ˜¯<strong>256Ã—256</strong>åƒç´ ï¼‰ï¼ŒæŒ‰éœ€åŠ è½½å¯è§†åŒºåŸŸå†…çš„ç“¦ç‰‡ã€‚<br>å¤šçº§ç¼©æ”¾ï¼šæ¯ä¸ªç¼©æ”¾çº§åˆ«({z})éƒ½æœ‰ä¸€å¥—å®Œæ•´çš„ç“¦ç‰‡ï¼Œç¼©æ”¾çº§åˆ«è¶Šé«˜ï¼Œç“¦ç‰‡æ•°é‡è¶Šå¤šï¼Œç»†èŠ‚è¶Šä¸°å¯Œã€‚<br>åæ ‡å®šä½ï¼šæ¯ä¸ªç“¦ç‰‡é€šè¿‡åæ ‡({x},{y})å’Œç¼©æ”¾çº§åˆ«({z})å”¯ä¸€æ ‡è¯†ã€‚<br>æŒ‰éœ€è¯·æ±‚ï¼šåªåŠ è½½è§†å£å†…å¯è§çš„ç“¦ç‰‡ï¼ŒèŠ‚çœå¸¦å®½å’Œæé«˜æ€§èƒ½ã€‚</p><h2 id="åˆ‡åˆ†"><a href="#åˆ‡åˆ†" class="headerlink" title="åˆ‡åˆ†"></a>åˆ‡åˆ†</h2><p>åˆ‡åˆ†æœ‰å¤šç§æ–¹å¼ï¼Œæ¯”å¦‚å›¾å½¢ç•Œé¢MapTilerã€gdal2tiles.pyå‘½ä»¤è¡Œå·¥å…·ã€pythonåº“ç­‰ã€‚<br>å¦‚æœåªæ˜¯ä¸€å¼ æ™®é€šçš„å›¾ç‰‡ï¼Œæ¨è<code>gdal2tiles.py</code>ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œå®‰è£…GDALã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Windows (ä½¿ç”¨ conda)</span></span><br><span class="line">conda install -c conda-forge gdal</span><br><span class="line"></span><br><span class="line"><span class="comment"># æˆ–ä½¿ç”¨ pip</span></span><br><span class="line"><span class="comment"># Microsoft Visual C++ 14.0 or greater is required</span></span><br><span class="line">pip install gdal</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntu/Debian æ¨è</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install gdal-bin python3-gdal</span><br></pre></td></tr></table></figure><p>éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdal2tiles.py --version</span><br></pre></td></tr></table></figure><p>å¦‚æœæç¤ºï¼šThe program â€˜gdal2tiles.pyâ€™ is currently not installed. You can install it by typing: apt install python-gdalï¼Œåˆ™æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get install python-gdal</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼Œç”Ÿæˆtifæ–‡ä»¶</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åæ ‡ç³»ä¸ºWGS84ç»çº¬åº¦ æ™®é€šå›¾ç‰‡æ¨èè¿™ä¸ª</span></span><br><span class="line">gdal_translate -of GTiff -a_ullr 0 [img width] [img height] 0 -a_srs EPSG:4326 input.png output.tif</span><br><span class="line"></span><br><span class="line"><span class="comment"># åæ ‡ç³»ä¸ºwebå¢¨å¡æ‰˜æŠ•å½±</span></span><br><span class="line">gdal_translate -a_ullr -20037508.34 20037508.34 20037508.34 -20037508.34 -a_srs EPSG:3857 input.png output.tif</span><br></pre></td></tr></table></figure><p>EPSGåæ ‡å‚è€ƒç³»ç»Ÿ</p><ul><li><p>EPSG:4326 - WGS84ç»çº¬åº¦<br>å…¨çƒå®šä½ç³»ç»Ÿ(GPS)ä½¿ç”¨çš„åæ ‡ç³»<br>åæ ‡è¡¨ç¤ºä¸ºç»åº¦&#x2F;çº¬åº¦åº¦æ•°<br>é€‚ç”¨äºå…¨çƒèŒƒå›´çš„æ•°æ®<br>éæŠ•å½±åæ ‡ç³»ï¼Œä¸é€‚åˆç›´æ¥æµ‹é‡è·ç¦»æˆ–é¢ç§¯<br>åæ ‡èŒƒå›´ï¼šç»åº¦[-180, 180]ï¼Œçº¬åº¦[-90, 90]<br>åæ ‡å•ä½ï¼šåº¦</p></li><li><p>EPSG:3857 - Webå¢¨å¡æ‰˜æŠ•å½±<br>Google Mapsã€OpenStreetMapç­‰ç½‘ç»œåœ°å›¾ä½¿ç”¨<br>åæ ‡ä»¥ç±³ä¸ºå•ä½è¡¨ç¤º<br>é€‚åˆç½‘é¡µæ˜¾ç¤ºä½†åœ¨æåœ°åŒºåŸŸæœ‰ä¸¥é‡å˜å½¢<br>åæ ‡èŒƒå›´ï¼šxè½´[-20037508.34, 20037508.34]ï¼Œyè½´[-20037508.34, 20037508.34]<br>å¯¹åº”åæ ‡ï¼šç»åº¦[-180ï¼Œ 180]ï¼Œçº¬åº¦[-85.0511, 85.0511]<br>åæ ‡å•ä½ï¼šç±³</p></li></ul><p>ç¬¬ä¸‰æ­¥ï¼Œç”Ÿæˆç“¦ç‰‡å›¾</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdal2tiles.py -p raster -z 0-6  output.tif outputDir</span><br></pre></td></tr></table></figure><p>-p æŒ‡å®šåæ ‡ç³»ç»Ÿ<br>rasterï¼šç®€å•åƒç´ åæ ‡ï¼Œé€‚åˆæ¸¸æˆç³»ç»Ÿï¼›<br>mercatorï¼šé»˜è®¤ï¼Œé€‚åˆç½‘é¡µåœ°å›¾ï¼›<br>geodeticï¼šWGS84</p><p>-z æŒ‡å®šç¼©æ”¾å±‚çº§èŒƒå›´<br>ä¹Ÿå¯ä»¥åªè®¾ç½®ä¸ºä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºç”Ÿæˆè¯¥å±‚çº§å›¾ç‰‡ã€‚</p><h2 id="éƒ¨ç½²åœ°å›¾æœåŠ¡"><a href="#éƒ¨ç½²åœ°å›¾æœåŠ¡" class="headerlink" title="éƒ¨ç½²åœ°å›¾æœåŠ¡"></a>éƒ¨ç½²åœ°å›¾æœåŠ¡</h2><p>ä»¥nodeä¸ºä¾‹ã€‚<br>ç›®å½•ç»“æ„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-images</span><br><span class="line">-app.js</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// app.js</span></span><br><span class="line"><span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; fileURLToPath &#125; <span class="keyword">from</span> <span class="string">&#x27;url&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">3000</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> __filename = <span class="title function_">fileURLToPath</span>(<span class="keyword">import</span>.<span class="property">meta</span>.<span class="property">url</span>);</span><br><span class="line"><span class="keyword">const</span> __dirname = path.<span class="title function_">dirname</span>(__filename);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/images&#x27;</span>, express.<span class="title function_">static</span>(path.<span class="title function_">join</span>(__dirname, <span class="string">&#x27;images&#x27;</span>)));</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`æœåŠ¡å·²å¯åŠ¨ï¼šhttp://localhost:<span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="maplibregl-Map-çš„é…ç½®é¡¹"><a href="#maplibregl-Map-çš„é…ç½®é¡¹" class="headerlink" title="maplibregl.Map()çš„é…ç½®é¡¹"></a>maplibregl.Map()çš„é…ç½®é¡¹</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">map.<span class="property">value</span> = <span class="keyword">new</span> maplibregl.<span class="title class_">Map</span>(&#123;</span><br><span class="line">    <span class="attr">container</span>: mapContainerRef.<span class="property">value</span>,</span><br><span class="line">    <span class="attr">style</span>: &#123;</span><br><span class="line">        <span class="attr">version</span>: <span class="number">8</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;Simple Style&#x27;</span>,</span><br><span class="line">        <span class="attr">sources</span>: &#123;</span><br><span class="line">            <span class="attr">background</span>: &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;raster&#x27;</span>,</span><br><span class="line">                <span class="attr">tiles</span>: [<span class="string">&#x27;/api/&#123;z&#125;/&#123;x&#125;/&#123;y&#125;.png&#x27;</span>],</span><br><span class="line">                <span class="attr">tileSize</span>: <span class="number">256</span>,</span><br><span class="line">                <span class="attr">minzoom</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="attr">maxzoom</span>: <span class="number">6</span>,</span><br><span class="line">                <span class="attr">scheme</span>: <span class="string">&#x27;tms&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">points</span>: &#123;</span><br><span class="line">                <span class="attr">type</span>: <span class="string">&#x27;geojson&#x27;</span>,</span><br><span class="line">                <span class="attr">data</span>: &#123;</span><br><span class="line">                    <span class="attr">type</span>: <span class="string">&#x27;FeatureCollection&#x27;</span>,</span><br><span class="line">                    <span class="attr">features</span>: [</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="attr">type</span>: <span class="string">&#x27;Feature&#x27;</span>,</span><br><span class="line">                            <span class="attr">properties</span>: &#123;<span class="attr">title</span>: <span class="string">&#x27;è¿™æ˜¯ä¸€ä¸ªæ•°æ®ç‚¹&#x27;</span>&#125;,</span><br><span class="line">                            <span class="attr">geometry</span>: &#123;</span><br><span class="line">                                <span class="attr">type</span>: <span class="string">&#x27;Point&#x27;</span>,</span><br><span class="line">                                <span class="attr">coordinates</span>: [<span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    ]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">layers</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">id</span>: <span class="string">&#x27;background-layer&#x27;</span>,</span><br><span class="line">            <span class="attr">type</span>: <span class="string">&#x27;raster&#x27;</span>,</span><br><span class="line">            <span class="attr">source</span>: <span class="string">&#x27;background&#x27;</span>,</span><br><span class="line">            <span class="attr">paint</span>: &#123;</span><br><span class="line">              <span class="string">&#x27;raster-opacity&#x27;</span>: <span class="number">1</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">glyphs</span>: <span class="string">&#x27;https://demotiles.maplibre.org/font/&#123;fontstack&#125;/&#123;range&#125;.pbf&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">zoom</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">renderWorldCopies</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">attributionControl</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><code>container</code>çš„å‚æ•°å¯ä»¥æ˜¯DOMå…ƒç´ ï¼Œæˆ–è€…å…ƒç´ çš„idã€‚è¯¥å…ƒç´ ä¸èƒ½æœ‰å­å…ƒç´ ã€‚<br><code>zoom</code>è¡¨ç¤ºåˆå§‹ç¼©æ”¾çº§åˆ«ï¼Œé»˜è®¤ä¸º0ã€‚<br><code>renderWorldCopies</code>è¡¨ç¤ºåœ¨å·¦å³æ–¹å‘æ˜¯å¦é‡å¤æ¸²æŸ“åœ°å›¾ï¼Œé»˜è®¤ä¸ºtrueã€‚<br><code>attributionControl</code>è¡¨ç¤ºæ˜¯å¦åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºåº“ä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚</p><p><code>style.sources</code>å®šä¹‰èµ„æºï¼ŒåŒ…å«åº•å›¾å’Œæ•°æ®æºï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>addSource</code>æ–¹æ³•æ·»åŠ ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">type: &#x27;raster&#x27; | &#x27;vector&#x27; | &#x27;geojson&#x27; | &#x27;image&#x27; | &#x27;video&#x27; | &#x27;raster-dem&#x27;</span><br></pre></td></tr></table></figure><p>raster ç“¦ç‰‡åœ°å›¾<br>vector çŸ¢é‡åœ°å›¾<br>geojson æ•°æ®ç‚¹åˆ—è¡¨<br>image å•ä¸€å›¾ç‰‡<br>video è§†é¢‘<br>raster-dem ä¸‰ç»´åœ°å›¾</p><p><code>tileSize</code> æ¯å¼ ç“¦ç‰‡çš„å¤§å°ã€‚<br><code>scheme</code> åæ ‡ç³»ç»Ÿï¼Œé»˜è®¤å€¼xyzã€‚GDAL2Tilesé»˜è®¤ä½¿ç”¨TMSåæ ‡ç³»ç»Ÿï¼Œè€Œå¤§å¤šæ•°æŸ¥çœ‹å™¨é»˜è®¤ä½¿ç”¨XYZæ ¼å¼ã€‚</p><p><code>coordinates</code>å®šä¹‰æ•°æ®ç‚¹çš„åæ ‡ï¼Œxè½´å–å€¼èŒƒå›´æ˜¯[-180, 180]ï¼Œyè½´å–å€¼èŒƒå›´æ˜¯[-85.051129, 85.051129]ã€‚yè½´å–å€¼æ¥è‡ªäº<code>arctan(sinh(Ï€)) * (180/Ï€)</code>ï¼Œæ˜¯å¢¨å¡æ‰˜æŠ•å½±åœ¨æ•°å­¦ä¸Šçš„æé™ã€‚<br>ç†è®ºä¸Š GeoJSON å…è®¸ [-90, 90]ï¼Œä½† MapLibre GL é»˜è®¤ä½¿ç”¨ Web Mercator æŠ•å½±ï¼ˆEPSG:3857ï¼‰ï¼Œå…¶çº¬åº¦èŒƒå›´è¢«é™åˆ¶åœ¨ Â±85.0511Â°ã€‚è¶…å‡ºæ­¤èŒƒå›´çš„åæ ‡ä¼šè¢«æˆªæ–­æˆ–å¯¼è‡´æ¸²æŸ“é—®é¢˜ã€‚</p><p><code>style.layers</code>å®šä¹‰å›¾å±‚ï¼Œå¯ä»¥é€šè¿‡<code>addLayer</code>æ–¹æ³•æ·»åŠ ã€‚<br><code>source</code>çš„å€¼å¿…å®šæ˜¯<code>style.sources</code>ä¸­çš„æŸä¸€ä¸ªã€‚<br><code>type</code>çš„å€¼æœ‰ä»¥ä¸‹ç±»å‹ï¼š<br>background åœ°å›¾èƒŒæ™¯é¢œè‰²ã€‚<br>fill å¡«å……å¤šè¾¹å½¢åŒºåŸŸã€‚<br>line çº¿æ¡ã€‚<br>symbol æ–‡æœ¬æ ‡ç­¾å’Œå›¾æ ‡ã€‚<br>raster æ …æ ¼ç“¦ç‰‡å›¾å±‚ã€‚<br>circle åœ†ç‚¹ã€‚<br>fill-extrusion 3Då¤šè¾¹å½¢ã€‚<br>heatmap çƒ­åŠ›å›¾ã€‚<br>hillshade åœ°å½¢é˜´å½±ã€‚<br>sky å¤©ç©ºç›’ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;background&#x27;</span>,</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;background&#x27;</span>,</span><br><span class="line">  <span class="attr">paint</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;background-color&#x27;</span>: <span class="string">&#x27;#f8f4f0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;background-opacity&#x27;</span>: <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;place-labels&#x27;</span>,</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;symbol&#x27;</span>,</span><br><span class="line">  <span class="attr">source</span>: <span class="string">&#x27;mapdata&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;source-layer&#x27;</span>: <span class="string">&#x27;places&#x27;</span>,</span><br><span class="line">  <span class="attr">layout</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;text-field&#x27;</span>: [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;name&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;text-size&#x27;</span>: <span class="number">12</span>,</span><br><span class="line">    <span class="string">&#x27;icon-image&#x27;</span>: <span class="string">&#x27;marker&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;text-offset&#x27;</span>: [<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">id</span>: <span class="string">&#x27;poi-markers&#x27;</span>,</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;circle&#x27;</span>,</span><br><span class="line">  <span class="attr">source</span>: <span class="string">&#x27;points&#x27;</span>,</span><br><span class="line">  <span class="attr">paint</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;circle-radius&#x27;</span>: <span class="number">5</span>,</span><br><span class="line">    <span class="string">&#x27;circle-color&#x27;</span>: <span class="string">&#x27;#3887be&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;circle-stroke-width&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;circle-stroke-color&#x27;</span>: <span class="string">&#x27;#ffffff&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€èˆ¬åæ·»åŠ çš„layeråœ¨ä¸Šå±‚ï¼Œä½†æŸäº›å›¾å±‚æœ‰å†…ç½®çš„ä¼˜å…ˆçº§ï¼Œæ¯”å¦‚çƒ­åŠ›å›¾åœ¨ä¸‹é¢ï¼Œsymbolåœ¨ä¸Šé¢ã€‚<br><code>map.addLayer</code>çš„ç¬¬äºŒä¸ªå‚æ•°ä¸ºbeforeIdï¼ŒæŒ‡è¦æŠŠæ–°å›¾å±‚è®¾ç½®ä¸ºidä¸ºbeforeIdçš„å›¾å±‚çš„ä¸‹é¢ã€‚<br>æ¨èå›¾å±‚é¡ºåºï¼šbackgroundã€rasterã€hillshadeã€heatmapã€fillã€fill-extrusionã€lineã€circleã€symbolã€skyã€‚</p><p><code>glyphs</code> å­—ä½“æ–‡ä»¶ã€‚</p><h1 id="çƒ­åŠ›å›¾"><a href="#çƒ­åŠ›å›¾" class="headerlink" title="çƒ­åŠ›å›¾"></a>çƒ­åŠ›å›¾</h1><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20250514231301.png" alt="çƒ­åŠ›å›¾"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ æ•°æ®</span></span><br><span class="line">map.<span class="property">value</span>.<span class="title function_">addSource</span>(<span class="string">&#x27;points&#x27;</span>, &#123;</span><br><span class="line">    <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;geojson&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;data&#x27;</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;FeatureCollection&#x27;</span>,</span><br><span class="line">        features</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ çƒ­åŠ›å›¾</span></span><br><span class="line">map.<span class="property">value</span>.<span class="title function_">addLayer</span>(</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;heatmap&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;heatmap&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;source&#x27;</span>: <span class="string">&#x27;points&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;maxzoom&#x27;</span>: <span class="number">9</span>,</span><br><span class="line">      <span class="string">&#x27;paint&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;heatmap-weight&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;heatmap-intensity&#x27;</span>: [</span><br><span class="line">          <span class="string">&#x27;interpolate&#x27;</span>,</span><br><span class="line">          [<span class="string">&#x27;linear&#x27;</span>],</span><br><span class="line">          [<span class="string">&#x27;zoom&#x27;</span>],</span><br><span class="line">          <span class="number">0</span>,</span><br><span class="line">          <span class="number">1</span>,</span><br><span class="line">          <span class="number">9</span>,</span><br><span class="line">          <span class="number">3</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;heatmap-color&#x27;</span>: [</span><br><span class="line">          <span class="string">&#x27;interpolate&#x27;</span>,</span><br><span class="line">          [<span class="string">&#x27;linear&#x27;</span>],</span><br><span class="line">          [<span class="string">&#x27;heatmap-density&#x27;</span>],</span><br><span class="line">          <span class="number">0</span>,</span><br><span class="line">          <span class="string">&#x27;rgba(33,102,172,0)&#x27;</span>,</span><br><span class="line">          <span class="number">0.2</span>,</span><br><span class="line">          <span class="string">&#x27;rgb(103,169,207)&#x27;</span>,</span><br><span class="line">          <span class="number">0.4</span>,</span><br><span class="line">          <span class="string">&#x27;rgb(209,229,240)&#x27;</span>,</span><br><span class="line">          <span class="number">0.6</span>,</span><br><span class="line">          <span class="string">&#x27;rgb(253,219,199)&#x27;</span>,</span><br><span class="line">          <span class="number">0.8</span>,</span><br><span class="line">          <span class="string">&#x27;rgb(239,138,98)&#x27;</span>,</span><br><span class="line">          <span class="number">1</span>,</span><br><span class="line">          <span class="string">&#x27;rgb(178,24,43)&#x27;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;heatmap-radius&#x27;</span>: [</span><br><span class="line">          <span class="string">&#x27;interpolate&#x27;</span>,</span><br><span class="line">          [<span class="string">&#x27;linear&#x27;</span>],</span><br><span class="line">          [<span class="string">&#x27;zoom&#x27;</span>],</span><br><span class="line">          <span class="number">0</span>,</span><br><span class="line">          <span class="number">2</span>,</span><br><span class="line">          <span class="number">9</span>,</span><br><span class="line">          <span class="number">20</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;heatmap-opacity&#x27;</span>: [</span><br><span class="line">          <span class="string">&#x27;interpolate&#x27;</span>,</span><br><span class="line">          [<span class="string">&#x27;linear&#x27;</span>],</span><br><span class="line">          [<span class="string">&#x27;zoom&#x27;</span>],</span><br><span class="line">          <span class="number">7</span>,</span><br><span class="line">          <span class="number">1</span>,</span><br><span class="line">          <span class="number">9</span>,</span><br><span class="line">          <span class="number">0</span></span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p><code>heatmap-weight</code>å®šä¹‰æ¯ä¸ªæ•°æ®ç‚¹çš„å½±å“å¼ºåº¦ï¼Œå³å•ä¸ªç‚¹å¯¹æ•´ä½“å¯†åº¦çš„è´¡çŒ®ç¨‹åº¦ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;heatmap-weight&#x27;</span>: <span class="number">0.5</span>  <span class="comment">// æ‰€æœ‰ç‚¹æƒé‡ä¸º0.5</span></span><br><span class="line"><span class="string">&#x27;heatmap-weight&#x27;</span>: [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;importance&#x27;</span>]  <span class="comment">// ä½¿ç”¨æ¯ä¸ªç‚¹çš„importanceå±æ€§</span></span><br><span class="line"><span class="string">&#x27;heatmap-weight&#x27;</span>: [</span><br><span class="line">  <span class="string">&#x27;interpolate&#x27;</span>, [<span class="string">&#x27;linear&#x27;</span>], [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;point_count&#x27;</span>],</span><br><span class="line">  <span class="number">0</span>, <span class="number">0</span>,       <span class="comment">// å½“point_countä¸º0æ—¶ï¼Œæƒé‡ä¸º0</span></span><br><span class="line">  <span class="number">5</span>, <span class="number">0.5</span>,     <span class="comment">// å½“point_countä¸º5æ—¶ï¼Œæƒé‡ä¸º0.5</span></span><br><span class="line">  <span class="number">10</span>, <span class="number">1</span>       <span class="comment">// å½“point_countä¸º10æˆ–æ›´é«˜æ—¶ï¼Œæƒé‡ä¸º1</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><code>heatmap-intensity</code>æ§åˆ¶çƒ­åŠ›å›¾çš„æ•´ä½“å¼ºåº¦ï¼Œå½±å“çƒ­åŠ›å›¾çš„é¥±å’Œåº¦æˆ–äº®åº¦ã€‚å–å€¼é€šå¸¸åœ¨0-3ï¼Œé»˜è®¤ä¸º1ï¼Œé«˜å€¼æ›´äº®ï¼Œé€‚åˆæ•°æ®ç‚¹ç¨€ç–çš„æƒ…å†µï¼Œä½å€¼é€‚åˆæ•°æ®ç‚¹å¯†é›†çš„æƒ…å†µã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;heatmap-intensity&#x27;</span>: <span class="number">3</span></span><br><span class="line"><span class="string">&#x27;heatmap-intensity&#x27;</span>: [</span><br><span class="line">  <span class="string">&#x27;interpolate&#x27;</span>,</span><br><span class="line">  [<span class="string">&#x27;linear&#x27;</span>], <span class="comment">// ä¸­é—´æŒ‰çº¿æ€§æ¯”ä¾‹æ’å€¼</span></span><br><span class="line">  [<span class="string">&#x27;zoom&#x27;</span>],</span><br><span class="line">  <span class="number">0</span>, <span class="number">1</span>, <span class="comment">// ä½ç¼©æ”¾çº§åˆ«ï¼Œä½å¼ºåº¦</span></span><br><span class="line">  <span class="number">9</span>, <span class="number">3</span> <span class="comment">// é«˜ç¼©æ”¾çº§åˆ«ï¼Œé«˜å¼ºåº¦</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p><code>heatmap-radius</code>æ§åˆ¶æ¯ä¸ªæ•°æ®ç‚¹çš„å½±å“åŠå¾„ã€‚<br><code>heatmap-opacity</code>æ§åˆ¶çƒ­åŠ›å›¾çš„é€æ˜åº¦ã€‚<br><code>heatmap-color</code>å®šä¹‰çƒ­åŠ›å›¾çš„é¢œè‰²æ¸å˜ã€‚</p><h1 id="èšç±»"><a href="#èšç±»" class="headerlink" title="èšç±»"></a>èšç±»</h1><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20250514231610.png" alt="èšç±»"></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ æ•°æ®ç‚¹</span></span><br><span class="line">map.<span class="property">value</span>.<span class="title function_">addSource</span>(<span class="string">&#x27;clusteredPoints&#x27;</span>, &#123;</span><br><span class="line">    <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;geojson&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;data&#x27;</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;FeatureCollection&#x27;</span>,</span><br><span class="line">      features</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">cluster</span>: <span class="literal">true</span>, <span class="comment">// æ˜¯å¦å¯ç”¨èšç±»</span></span><br><span class="line">    <span class="attr">clusterRadius</span>: <span class="number">50</span>, <span class="comment">// èšç±»åŠå¾„</span></span><br><span class="line">    <span class="attr">clusterMaxZoom</span>: <span class="number">14</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// èšç±» æ·»åŠ åœ†åœˆï¼ŒæŒ‰èšåˆçš„æ•°æ®ç‚¹çš„æ•°é‡è®¾ç½®ä¸åŒé¢œè‰²</span></span><br><span class="line">map.<span class="property">value</span>.<span class="title function_">addLayer</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;clusters&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;circle&#x27;</span>,</span><br><span class="line">    <span class="attr">source</span>: <span class="string">&#x27;clusteredPoints&#x27;</span>,</span><br><span class="line">    <span class="attr">filter</span>: [<span class="string">&#x27;has&#x27;</span>, <span class="string">&#x27;point_count&#x27;</span>],</span><br><span class="line">    <span class="attr">paint</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;circle-color&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;step&#x27;</span>,</span><br><span class="line">        [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;point_count&#x27;</span>],</span><br><span class="line">        <span class="string">&#x27;#51bbd6&#x27;</span>,</span><br><span class="line">        <span class="number">100</span>,</span><br><span class="line">        <span class="string">&#x27;#f1f075&#x27;</span>,</span><br><span class="line">        <span class="number">750</span>,</span><br><span class="line">        <span class="string">&#x27;#f28cb1&#x27;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="string">&#x27;circle-radius&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;step&#x27;</span>,</span><br><span class="line">        [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;point_count&#x27;</span>],</span><br><span class="line">        <span class="number">20</span>,</span><br><span class="line">        <span class="number">100</span>,</span><br><span class="line">        <span class="number">30</span>,</span><br><span class="line">        <span class="number">750</span>,</span><br><span class="line">        <span class="number">40</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// èšç±» åœ†åœˆä¸Šæ˜¾ç¤ºæ•°æ®ç‚¹çš„ä¸ªæ•°</span></span><br><span class="line">  map.<span class="property">value</span>.<span class="title function_">addLayer</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;cluster-count&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;symbol&#x27;</span>,</span><br><span class="line">    <span class="attr">source</span>: <span class="string">&#x27;clusteredPoints&#x27;</span>,</span><br><span class="line">    <span class="attr">filter</span>: [<span class="string">&#x27;has&#x27;</span>, <span class="string">&#x27;point_count&#x27;</span>],</span><br><span class="line">    <span class="attr">layout</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;text-field&#x27;</span>: <span class="string">&#x27;&#123;point_count_abbreviated&#125;&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;text-size&#x27;</span>: <span class="number">12</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// éèšç±» ç‹¬ç«‹çš„æ•°æ®ç‚¹  ç¼©æ”¾åˆ°æ•°æ®ç‚¹ä¸èƒ½è¢«èšåˆæ—¶ï¼Œå•ç‹¬æ˜¾ç¤ºæ•°æ®ç‚¹</span></span><br><span class="line">  map.<span class="property">value</span>.<span class="title function_">addLayer</span>(&#123;</span><br><span class="line">    <span class="attr">id</span>: <span class="string">&#x27;unclustered-point&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;circle&#x27;</span>,</span><br><span class="line">    <span class="attr">source</span>: <span class="string">&#x27;clusteredPoints&#x27;</span>,</span><br><span class="line">    <span class="attr">filter</span>: [<span class="string">&#x27;!&#x27;</span>, [<span class="string">&#x27;has&#x27;</span>, <span class="string">&#x27;point_count&#x27;</span>]],</span><br><span class="line">    <span class="attr">paint</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;circle-color&#x27;</span>: <span class="string">&#x27;#11b4da&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;circle-radius&#x27;</span>: <span class="number">4</span>,</span><br><span class="line">      <span class="string">&#x27;circle-stroke-width&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="string">&#x27;circle-stroke-color&#x27;</span>: <span class="string">&#x27;#fff&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="ç›‘å¬åœ°å›¾äº‹ä»¶"><a href="#ç›‘å¬åœ°å›¾äº‹ä»¶" class="headerlink" title="ç›‘å¬åœ°å›¾äº‹ä»¶"></a>ç›‘å¬åœ°å›¾äº‹ä»¶</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">map.<span class="property">value</span>.<span class="title function_">on</span>(<span class="string">&#x27;mouseenter&#x27;</span>, <span class="string">&#x27;clusters&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    map.<span class="property">value</span>.<span class="title function_">getCanvas</span>().<span class="property">style</span>.<span class="property">cursor</span> = <span class="string">&#x27;pointer&#x27;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº‹ä»¶ç±»å‹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯äº‹ä»¶ç»‘å®šçš„å›¾å±‚ï¼ˆå¯é€‰ï¼‰ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯äº‹ä»¶å›è°ƒã€‚<br>å¸¸ç”¨çš„äº‹ä»¶ç±»å‹ï¼šmouseenterã€mouseleaveã€clickç­‰ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç‚¹å‡»æ•°æ®ç‚¹ æ˜¾ç¤ºå¼¹çª—ï¼Œå¼¹çª—ä¸­æ˜¾ç¤ºæ•°æ®ç‚¹å‚æ•°ä¿¡æ¯</span></span><br><span class="line">map.<span class="property">value</span>.<span class="title function_">on</span>(<span class="string">&#x27;click&#x27;</span>, <span class="string">&#x27;unclustered-point&#x27;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> coordinates = e.<span class="property">features</span>[<span class="number">0</span>].<span class="property">geometry</span>.<span class="property">coordinates</span>.<span class="title function_">slice</span>();</span><br><span class="line">    <span class="keyword">const</span> properties = e.<span class="property">features</span>[<span class="number">0</span>].<span class="property">properties</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(e.<span class="property">lngLat</span>.<span class="property">lng</span> - coordinates[<span class="number">0</span>]) &gt; <span class="number">180</span>) &#123;</span><br><span class="line">      coordinates[<span class="number">0</span>] += e.<span class="property">lngLat</span>.<span class="property">lng</span> &gt; coordinates[<span class="number">0</span>] ? <span class="number">360</span> : -<span class="number">360</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> maplibregl.<span class="title class_">Popup</span>()</span><br><span class="line">      .<span class="title function_">setLngLat</span>(coordinates)</span><br><span class="line">      .<span class="title function_">setHTML</span>(</span><br><span class="line">        <span class="string">`title: <span class="subst">$&#123;properties.title&#125;</span>&lt;br&gt;description: <span class="subst">$&#123;properties.description&#125;</span>`</span></span><br><span class="line">      )</span><br><span class="line">      .<span class="title function_">addTo</span>(map.<span class="property">value</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="æ•°æ®åˆ‡ç‰‡"><a href="#æ•°æ®åˆ‡ç‰‡" class="headerlink" title="æ•°æ®åˆ‡ç‰‡"></a>æ•°æ®åˆ‡ç‰‡</h1><p>å¦‚æœæ•°æ®é‡å·¨å¤§ï¼Œæ¯”å¦‚äº”åä¸‡ä»¥ä¸Šï¼Œå¿…é¡»è¦å°†æ•°æ®åœ¨æœåŠ¡å™¨è¿›è¡Œåˆ‡ç‰‡ç”ŸæˆçŸ¢é‡ç“¦ç‰‡æ•°æ®ï¼Œä¸ç„¶é¡µé¢å¡é¡¿ã€å´©æºƒã€‚<br>ä»¥nodeä¸ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç”¨<code>geojson-vt</code>å°†<code>geojson</code>æ ¼å¼æ•°æ®è½¬æ¢æˆmvtæ ¼å¼æ•°æ®ï¼Œç„¶åç”¨<code>vt-pbf</code>å‹ç¼©æ•°æ®ã€‚</p><h2 id="æ™®é€šçŸ¢é‡ç“¦ç‰‡"><a href="#æ™®é€šçŸ¢é‡ç“¦ç‰‡" class="headerlink" title="æ™®é€šçŸ¢é‡ç“¦ç‰‡"></a>æ™®é€šçŸ¢é‡ç“¦ç‰‡</h2><p>ç¬¬ä¸€æ­¥ï¼Œå®‰è£…ä¾èµ–ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i geojson-vt vt-pbf</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼Œæ•°æ®å¤„ç†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºç´¢å¼•</span></span><br><span class="line"><span class="keyword">let</span> tileIndex = <span class="literal">null</span>;</span><br><span class="line">tileIndex = <span class="title function_">geojsonvt</span>(geojsonData, &#123;</span><br><span class="line">    <span class="attr">maxZoom</span>: options.<span class="property">maxZoom</span> || <span class="number">14</span>, <span class="comment">// æœ€å¤§ç¼©æ”¾çº§åˆ«</span></span><br><span class="line">    <span class="attr">tolerance</span>: <span class="number">5</span>,          <span class="comment">// å®¹å·®æ›´å¤§ï¼Œå…è®¸æ›´å¤šçš„ç®€åŒ–</span></span><br><span class="line">    <span class="attr">extent</span>: <span class="number">4096</span>, <span class="comment">// ç“¦ç‰‡å¤§å°</span></span><br><span class="line">    <span class="attr">buffer</span>: <span class="number">512</span>,           <span class="comment">// å¢åŠ ç¼“å†²åŒº</span></span><br><span class="line">    <span class="attr">debug</span>: <span class="number">0</span>, <span class="comment">// è°ƒè¯•çº§åˆ«</span></span><br><span class="line">    <span class="attr">lineMetrics</span>: <span class="literal">false</span>, <span class="comment">// ä¸è®¡ç®—çº¿æ€§åº¦é‡</span></span><br><span class="line">    <span class="attr">promoteId</span>: <span class="literal">null</span>, <span class="comment">// å±æ€§æ˜¯å¦æå‡ä¸ºID</span></span><br><span class="line">    <span class="attr">generateId</span>: <span class="literal">true</span>, <span class="comment">// ä¸è‡ªåŠ¨ç”ŸæˆID</span></span><br><span class="line">    <span class="attr">indexMaxZoom</span>: <span class="number">7</span>, <span class="comment">// ç´¢å¼•æœ€å¤§ç¼©æ”¾çº§åˆ«</span></span><br><span class="line">    <span class="attr">indexMaxPoints</span>: <span class="number">500000</span>, <span class="comment">// å¢åŠ ç´¢å¼•ç‚¹æ•°ä¸Šé™</span></span><br><span class="line">    <span class="attr">solidChildren</span>: <span class="literal">false</span>,     <span class="comment">// ç¡®ä¿å­ç“¦ç‰‡æœ‰æ•°æ®</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/tiles/:z/:x/:y.pbf&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// è½¬æ¢</span></span><br><span class="line">    <span class="keyword">const</span> tile = tileIndex.<span class="title function_">getTile</span>(zoom, x, y);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å‹ç¼©</span></span><br><span class="line">    <span class="keyword">const</span> buffer = vtPbf.<span class="title function_">fromGeojsonVt</span>(&#123; <span class="string">&#x27;geojsonLayer&#x27;</span>: tile &#125;);</span><br><span class="line">    <span class="comment">// geojsonLayeræ˜¯ä¸€ä¸ªkeyï¼Œå¯ä»¥è‡ªå®šä¹‰ã€‚</span></span><br><span class="line">    <span class="comment">// geojsonLayeræ˜¯addLayeræ—¶éœ€è¦è®¾ç½®çš„source-layerçš„å€¼ã€‚</span></span><br><span class="line">    <span class="comment">// addLayerä½¿ç”¨geojsonæ ¼å¼çš„æ•°æ®æ—¶åªéœ€è¦è®¾ç½®sourceï¼Œä½¿ç”¨vectoræ ¼å¼æ•°æ®æ—¶è¿˜éœ€è¦è®¾ç½®source-layerã€‚</span></span><br><span class="line">    </span><br><span class="line">    res.<span class="title function_">sendFile</span>(buffer);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ï¼Œä½¿ç”¨</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ source</span></span><br><span class="line">map.<span class="property">value</span>.<span class="title function_">addSource</span>(<span class="string">&#x27;points&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;vector&#x27;</span>,</span><br><span class="line">    <span class="attr">tiles</span>: [<span class="string">&#x27;http://localhost:3000/tiles/&#123;z&#125;/&#123;x&#125;/&#123;y&#125;.pbf&#x27;</span>],</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ·»åŠ layer</span></span><br><span class="line">map.<span class="property">value</span>.<span class="title function_">addLayer</span>(</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;heatmap&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;type&#x27;</span>: <span class="string">&#x27;heatmap&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;source&#x27;</span>: <span class="string">&#x27;points&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;source-layer&#x27;</span>: <span class="string">&#x27;geojsonLayer&#x27;</span>, <span class="comment">// add</span></span><br><span class="line">      <span class="string">&#x27;maxzoom&#x27;</span>: <span class="number">14</span>,</span><br><span class="line">      <span class="string">&#x27;paint&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;heatmap-weight&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="string">&#x27;heatmap-intensity&#x27;</span>: [</span><br><span class="line">          <span class="string">&#x27;interpolate&#x27;</span>,</span><br><span class="line">          [<span class="string">&#x27;linear&#x27;</span>],</span><br><span class="line">          [<span class="string">&#x27;zoom&#x27;</span>],</span><br><span class="line">          <span class="number">0</span>,</span><br><span class="line">          <span class="number">1</span>,</span><br><span class="line">          <span class="number">9</span>,</span><br><span class="line">          <span class="number">2</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;heatmap-color&#x27;</span>: [</span><br><span class="line">          <span class="string">&#x27;interpolate&#x27;</span>,</span><br><span class="line">          [<span class="string">&#x27;linear&#x27;</span>],</span><br><span class="line">          [<span class="string">&#x27;heatmap-density&#x27;</span>],</span><br><span class="line">          <span class="number">0</span>,</span><br><span class="line">          <span class="string">&#x27;rgba(33,102,172,0)&#x27;</span>,</span><br><span class="line">          <span class="number">0.2</span>,</span><br><span class="line">          <span class="string">&#x27;rgb(103,169,207)&#x27;</span>,</span><br><span class="line">          <span class="number">0.4</span>,</span><br><span class="line">          <span class="string">&#x27;rgb(209,229,240)&#x27;</span>,</span><br><span class="line">          <span class="number">0.6</span>,</span><br><span class="line">          <span class="string">&#x27;rgb(253,219,199)&#x27;</span>,</span><br><span class="line">          <span class="number">0.8</span>,</span><br><span class="line">          <span class="string">&#x27;rgb(239,138,98)&#x27;</span>,</span><br><span class="line">          <span class="number">1</span>,</span><br><span class="line">          <span class="string">&#x27;rgb(178,24,43)&#x27;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&#x27;heatmap-radius&#x27;</span>: <span class="number">30</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="èšç±»çŸ¢é‡ç“¦ç‰‡"><a href="#èšç±»çŸ¢é‡ç“¦ç‰‡" class="headerlink" title="èšç±»çŸ¢é‡ç“¦ç‰‡"></a>èšç±»çŸ¢é‡ç“¦ç‰‡</h2><p>å¦‚æœæ•°æ®é‡å·¨å¤§åˆè¦æ˜¾ç¤ºèšç±»ï¼Œåˆ™éœ€è¦åœ¨æœåŠ¡ç«¯èšç±»ã€‚<br>ç¬¬ä¸€æ­¥ï¼Œå®‰è£…ä¾èµ–ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i supercluster</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼Œèšç±»</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">// åˆ›å»ºç´¢å¼•</span><br><span class="line">let clusterIndex = null;</span><br><span class="line"></span><br><span class="line">// ç”Ÿæˆéšæœºç‚¹æ•°æ®</span><br><span class="line">function generateRandomPoints(count = 10000 * 100) &#123;</span><br><span class="line">  const features = [];</span><br><span class="line"></span><br><span class="line">  for (let i = 0; i &lt; count; i++) &#123;</span><br><span class="line">    const lng = Math.random() * 360 - 180; // ç»åº¦èŒƒå›´ï¼š-180åˆ°180</span><br><span class="line">    const lat = Math.random() * 170 - 85; // çº¬åº¦èŒƒå›´ï¼š-85åˆ°85</span><br><span class="line"></span><br><span class="line">    features.push(&#123;</span><br><span class="line">      type: &#x27;Feature&#x27;,</span><br><span class="line">      properties: &#123;</span><br><span class="line">        id: i,</span><br><span class="line">        name: `ç‚¹ä½ $&#123;i&#125;`,</span><br><span class="line">        pos: `$&#123;lng&#125;,$&#123;lat&#125;`</span><br><span class="line">      &#125;,</span><br><span class="line">      geometry: &#123;</span><br><span class="line">        type: &#x27;Point&#x27;,</span><br><span class="line">        coordinates: [lng, lat]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // !!! here</span><br><span class="line">  clusterIndex = new Supercluster(&#123;</span><br><span class="line">    radius: 50,         // èšåˆåƒç´ åŠå¾„</span><br><span class="line">    maxZoom: 18,        // æœ€å¤§èšåˆå±‚çº§</span><br><span class="line">    minZoom: 0,         // æœ€å°èšåˆå±‚çº§</span><br><span class="line">    map: props =&gt; (&#123;</span><br><span class="line">      count: props.count || 1 // ä¿ç•™åŸå§‹è®¡æ•°</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  clusterIndex.load(features);</span><br><span class="line"></span><br><span class="line">  const geojson = &#123;</span><br><span class="line">    type: &#x27;FeatureCollection&#x27;,</span><br><span class="line">    features</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  return geojson;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ï¼Œå¤„ç†æ•°æ®</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/tiles/:z/:x/:y.pbf&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> clusters = clusterIndex.<span class="title function_">getClusters</span>([-<span class="number">180</span>, -<span class="number">90</span>, <span class="number">180</span>, <span class="number">90</span>], z)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> tile = <span class="title function_">geojsonvt</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;FeatureCollection&#x27;</span>,</span><br><span class="line">        <span class="attr">features</span>: clusters</span><br><span class="line">    &#125;).<span class="title function_">getTile</span>(z, x, y)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> buffer = vtPbf.<span class="title function_">fromGeojsonVt</span>(&#123; <span class="string">&#x27;geojsonLayer&#x27;</span>: tile &#125;);</span><br><span class="line">    </span><br><span class="line">    res.<span class="title function_">sendFile</span>(buffer);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•ä¸æ™®é€šåˆ‡ç‰‡ç›¸åŒã€‚</p><h1 id="æ€§èƒ½ä¼˜åŒ–"><a href="#æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="æ€§èƒ½ä¼˜åŒ–"></a>æ€§èƒ½ä¼˜åŒ–</h1><p>æ–¹æ³•1ï¼šgeojsonæ ¼å¼æ•°æ®å¯ä»¥å‹ç¼©jsonã€‚<br>æ–¹æ³•2ï¼šæ ¹æ®ç¼©æ”¾æ˜¾ç¤ºä¸åŒlayerï¼Œä½ç¼©æ”¾ç­‰çº§åªæ˜¾ç¤ºçƒ­åŠ›å›¾ï¼Œé«˜ç¼©æ”¾ç­‰çº§åªæ˜¾ç¤ºèšç±»åœ†åœˆã€‚<br>æ–¹æ³•3ï¼šå¯ç”¨webgl2ï¼Œéœ€è¦åˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒã€‚</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://maplibre.chendx.com/">mapbox-gl ä¸­æ–‡æ–‡æ¡£</a><br><a href="https://maplibre.org/maplibre-gl-js/docs/">maplibre-gl å®˜æ–¹æ–‡æ¡£</a><br><a href="https://github.com/mapbox/geojson-vt">geojson-vtæ’ä»¶</a><br><a href="https://github.com/mapbox/vt-pbf">vt-pbfæ’ä»¶</a></p>]]></content>
      
      
      <categories>
          
          <category> æŒ‡å— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Maplibre </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ€ç”¨æµå¼å†™å…¥å¤„ç†å¤§æ–‡ä»¶ä¸‹è½½</title>
      <link href="/2025/04/21/download-big-file/"/>
      <url>/2025/04/21/download-big-file/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>æµå¼å†™å…¥ç›´æ¥å°†æ•°æ®æµå†™å…¥ç”¨æˆ·ç£ç›˜ï¼Œé¿å…ä¼ ç»Ÿæ–¹æ³•(å¦‚<code>Blob</code>æˆ–<code>URL.createObjectURL</code>)å› å†…å­˜é™åˆ¶å¯¼è‡´çš„å¤§æ–‡ä»¶ä¸‹è½½é—®é¢˜ã€‚<br><code>StreamSaver.js</code>åº“ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿçš„ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Streams_API">Streams API</a>ï¼Œé€å—å†™å…¥æ•°æ®åˆ°ç£ç›˜ã€‚é€šè¿‡ <code>Service Worker</code> å’Œä¸­é—´äºº(<code>MITM</code>)æŠ€æœ¯ï¼Œæ¨¡æ‹ŸæœåŠ¡å™¨å“åº”ï¼Œç»•è¿‡æµè§ˆå™¨å¯¹ä¸‹è½½æ–‡ä»¶å¤§å°çš„é™åˆ¶ã€‚è€Œä¸”ï¼Œä¸éœ€è¦æœåŠ¡ç«¯åšä»»ä½•ä¿®æ”¹ã€‚</p><h1 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h1><p><a href="https://github.com/jimmywarting/StreamSaver.js">StreamSaveræ–‡æ¡£</a>  </p><p>å®‰è£…ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i streamsaver</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; createWriteStream &#125; <span class="keyword">from</span> <span class="string">&#x27;streamsaver&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fileStream = <span class="title function_">createWriteStream</span>(<span class="string">&#x27;download.json&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> writer = fileStream.<span class="title function_">getWriter</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">download</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> contentLength = response.<span class="property">headers</span>.<span class="title function_">get</span>(<span class="string">&#x27;content-length&#x27;</span>);</span><br><span class="line">    <span class="keyword">let</span> receivedBytes = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> reader = response.<span class="property">body</span>.<span class="title function_">getReader</span>();</span><br><span class="line">    <span class="comment">// åˆ†å—å¤„ç†</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; done, value &#125; = <span class="keyword">await</span> reader.<span class="title function_">read</span>();</span><br><span class="line">         <span class="keyword">if</span> (done) <span class="keyword">break</span>;</span><br><span class="line">          </span><br><span class="line">        <span class="comment">// å†™å…¥æ–‡ä»¶æµ</span></span><br><span class="line">        <span class="keyword">await</span> writer.<span class="title function_">write</span>(value);</span><br><span class="line">          </span><br><span class="line">        <span class="comment">// æ›´æ–°è¿›åº¦ï¼ˆå¦‚æœæœ‰å†…å®¹é•¿åº¦ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (contentLength) &#123;</span><br><span class="line">            receivedBytes += value.<span class="property">length</span>;</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> writer.<span class="title function_">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><ol><li>ç”¨æˆ·ç‚¹å‡»ä¸‹è½½æŒ‰é’®ï¼›</li><li>åŠ¨æ€åˆ›å»ºä¸€ä¸ªéšè—çš„iframeï¼ŒåŠ è½½MITMè„šæœ¬ï¼›</li><li>MITMè„šæœ¬åœ¨iframeä¸­æ³¨å†ŒService Workerï¼Œå¹¶å£°æ˜å…¶ä½œç”¨åŸŸï¼›</li><li>ä¸»é¡µé¢å’Œiframeé€šè¿‡postMessageé€šä¿¡ï¼Œä¼ é€’æ•°æ®å¿«ï¼›</li><li>Service Workeræ¥æ”¶æ•°æ®ï¼Œé€šè¿‡æµå¼APIå†™å…¥æœ¬åœ°æ–‡ä»¶ï¼›</li></ol><p>æµè§ˆå™¨è¦æ±‚æ–‡ä»¶ä¸‹è½½å¿…é¡»ç”±ç”¨æˆ·ä¸»åŠ¨è§¦å‘ï¼Œå¦‚ç‚¹å‡»äº‹ä»¶ã€‚iframeçš„åˆ›å»ºå’ŒMITMè„šæœ¬çš„åŠ è½½ä¼šåœ¨ç”¨æˆ·ç‚¹å‡»äº‹ä»¶çš„åŒæ­¥ä¸Šä¸‹æ–‡ä¸­å®Œæˆã€‚è¿™æ ·ï¼Œåç»­é€šè¿‡iframeè§¦å‘çš„ä¸‹è½½æ“ä½œä»ç„¶è¢«è§†ä¸ºç”¨æˆ·æ‰‹åŠ¿çš„å»¶ç»­ï¼Œé¿å…è¢«æµè§ˆå™¨é˜»æ­¢ã€‚<br>æµè§ˆå™¨é»˜è®¤ç¦æ­¢è„šæœ¬ç›´æ¥æ“ä½œæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œä¸”ä¸‹è½½æ“ä½œé€šå¸¸éœ€è¦ä¸å½“å‰é¡µé¢åŒæºã€‚è¯¥iframeçš„æºè¢«è®¾ç½®ä¸ºä¸€ä¸ªç‹¬ç«‹çš„ã€ä¸ä¸»é¡µé¢ä¸åŒçš„è™šæ‹ŸURLï¼Œä»è€Œåˆ›å»ºä¸€ä¸ªâ€œéš”ç¦»çš„ä¸Šä¸‹æ–‡â€ã€‚è¿™ä¸ªéš”ç¦»çš„ä¸Šä¸‹æ–‡å¯ä»¥ç»•è¿‡ä¸»é¡µé¢çš„ä¸€äº›å®‰å…¨ç­–ç•¥ï¼Œå…è®¸ç›´æ¥ä¸Service Workeré€šä¿¡å¹¶è§¦å‘ä¸‹è½½ã€‚<br>Service Workeréœ€è¦æ³¨å†Œåœ¨ç‰¹å®šçš„ä½œç”¨åŸŸä¸‹ï¼Œä¸”é€šå¸¸éœ€è¦ä¸é¡µé¢åŒæºã€‚iframeä¸­åŠ è½½çš„MIMTè„šæœ¬ä¼šåŠ¨æ€æ³¨å†Œä¸€ä¸ªService Workerï¼Œå¹¶æ§åˆ¶å…¶ä½œç”¨åŸŸã€‚é€šè¿‡å°†Service Workeréš”ç¦»åœ¨iframeä¸­ï¼Œå¯ä»¥é¿å…ä¸ä¸»åº”ç”¨çš„Service Workerå†²çªï¼ŒåŒæ—¶ç¡®ä¿ä¸‹è½½é€»è¾‘çš„ç‹¬ç«‹æ€§ã€‚<br>ä¸»é¡µé¢é€šè¿‡postMessageå‘iframeå‘é€æ•°æ®åº“ï¼Œiframeä¸­çš„MIMTè„šæœ¬å°†æ•°æ®è½¬å‘ç»™Service Workerï¼ŒService Workerå°†æ•°æ®æµå¼å†™å…¥ç£ç›˜ã€‚</p><h1 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h1><p>å› ä¸ºé€šè¿‡iframeå¤„ç†ä¸‹è½½é€»è¾‘ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦ä½¿ç”¨<code>https</code>ï¼Œå¦åˆ™ä¼šæœ‰ä¸å®‰å…¨æ··åˆå†…å®¹é™åˆ¶ã€‚<br>å¦‚æœä¸æ˜¯<code>https</code>ï¼Œåˆ™ <code>StreamSaver</code> ä¼šæ”¹ç”¨<code>popup</code>ï¼Œä¸‹è½½æ—¶é¡µé¢å·¦ä¸Šè§’ä¼šæœ‰å°å¼¹çª—é—ªç°ã€‚</p><h1 id="æ›´å¥½çš„æ–¹æ³•"><a href="#æ›´å¥½çš„æ–¹æ³•" class="headerlink" title="æ›´å¥½çš„æ–¹æ³•"></a>æ›´å¥½çš„æ–¹æ³•</h1><p>å¦‚æœä¸è€ƒè™‘æµè§ˆå™¨å…¼å®¹æ€§ï¼Œå¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(...);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> reader = response.<span class="property">body</span>?.<span class="title function_">getReader</span>();</span><br><span class="line">    <span class="keyword">const</span> chunks = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123; done, value &#125; = <span class="keyword">await</span> reader!.<span class="title function_">read</span>();</span><br><span class="line">      <span class="keyword">if</span> (done) <span class="keyword">break</span>;</span><br><span class="line">      chunks.<span class="title function_">push</span>(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>(chunks);</span><br><span class="line">    <span class="keyword">const</span> link = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line">    link.<span class="property">href</span> = <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(blob);</span><br><span class="line">    link.<span class="property">download</span> = <span class="string">&#x27;download.zip&#x27;</span>;</span><br><span class="line">    link.<span class="title function_">click</span>();</span><br><span class="line">    <span class="variable constant_">URL</span>.<span class="title function_">revokeObjectURL</span>(link.<span class="property">href</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="title class_">ElMessage</span>.<span class="title function_">error</span>(<span class="string">&#x27;å¯¼å‡ºå¤±è´¥&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p><code>streamsaver</code>æœ€å¥½åœ¨httpsç¯å¢ƒä¸­ä½¿ç”¨ï¼Œ<code>getReader</code>å¯èƒ½ä¸å…¼å®¹æ—§æµè§ˆå™¨ã€‚<br><code>streamsaver</code>å…ˆé€‰æ‹©ä¿å­˜ä½ç½®å†ä¸‹è½½ï¼Œ<code>getReader</code>å…ˆä¸‹è½½å†é€‰æ‹©ä¿å­˜ä½ç½®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> http </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŒç«¯æ‹¾è¯åŠ©æ‰‹</title>
      <link href="/2025/03/08/word-grabber/"/>
      <url>/2025/03/08/word-grabber/</url>
      
        <content type="html"><![CDATA[<h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>è¿™æ˜¯ä¸€ä¸ªå¸®åŠ©ç”¨æˆ·åœ¨æ—¥å¸¸ä¸­å­¦ä¹ å•è¯çš„è½¯ä»¶ï¼ŒåŒ…å«æµè§ˆå™¨æ’ä»¶å’Œå¾®ä¿¡å°ç¨‹åºã€‚</p><p>ä½¿ç”¨æµç¨‹ï¼š<br>1.å®‰è£…æµè§ˆå™¨æ’ä»¶ï¼›<br>2.å¾®ä¿¡æ‰«ç ç™»å½•å°ç¨‹åºï¼›<br>3.åœ¨ç½‘é¡µä¸­é€‰ä¸­å•è¯ï¼Œå³å¯è·å–ç¿»è¯‘ç»“æœï¼Œå¯ä»¥æ”¶è—æˆ–å–æ¶ˆæ”¶è—è¯¥å•è¯ï¼›<br>4.åœ¨å¾®ä¿¡å°ç¨‹åºä¸­å¤ä¹ å•è¯ï¼›</p><p>æµè§ˆå™¨æ’ä»¶ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/%E6%8D%95%E8%8E%B7.PNG" alt="æ”¶è—">    </p><p>å¾®ä¿¡å°ç¨‹åºï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20250308231025.png" alt="å°ç¨‹åº"></p><h1 id="å¼€å‘æµè§ˆå™¨æ’ä»¶æ³¨æ„äº‹é¡¹"><a href="#å¼€å‘æµè§ˆå™¨æ’ä»¶æ³¨æ„äº‹é¡¹" class="headerlink" title="å¼€å‘æµè§ˆå™¨æ’ä»¶æ³¨æ„äº‹é¡¹"></a>å¼€å‘æµè§ˆå™¨æ’ä»¶æ³¨æ„äº‹é¡¹</h1><h2 id="content-jsä¸background-jsçš„åŒºåˆ«"><a href="#content-jsä¸background-jsçš„åŒºåˆ«" class="headerlink" title="content.jsä¸background.jsçš„åŒºåˆ«"></a>content.jsä¸background.jsçš„åŒºåˆ«</h2><p>content.jsï¼š</p><ul><li>ç›´æ¥ä¸ç½‘é¡µå†…å®¹äº¤äº’ï¼Œå¯ä»¥ä¿®æ”¹ç½‘é¡µç»“æ„ã€ç›‘å¬ç”¨æˆ·ç‚¹å‡»äº‹ä»¶ç­‰ï¼›</li><li>æ— æ³•è®¿é—®é¡µé¢çš„jså˜é‡æˆ–å‡½æ•°ï¼Œè¯·æ±‚å—åŒæºç­–ç•¥é™åˆ¶ï¼›</li><li>ä»…èƒ½è°ƒç”¨éƒ¨åˆ†Chrome APIï¼Œå¦‚chrome.runtime.sendMessageã€chrome.storageï¼›</li><li>æ— æ³•ç›´æ¥è®¿é—®chrome.tabsæˆ–chrome.windowsç­‰æ¶‰åŠæµè§ˆå™¨å…¨å±€æ“ä½œçš„API</li></ul><p>background.jsï¼š</p><ul><li>ä½œä¸ºå…¨å±€åå°æœåŠ¡ï¼Œè´Ÿè´£å¤„ç†è·¨åŸŸè¯·æ±‚ã€è°ƒç”¨é«˜æƒé™APIï¼ˆé€šçŸ¥æ¨é€ã€æµè§ˆå™¨æ ‡ç­¾ç®¡ç†ç­‰ï¼‰ï¼›</li><li>ç”Ÿå‘½å‘¨æœŸä¸æµè§ˆå™¨åŒæ­¥ï¼Œæ”¯æŒè·¨åŸŸè®¿é—®ï¼›</li><li>å¯è°ƒç”¨æ‰€æœ‰Chrome APIï¼›</li></ul><h2 id="æ¶ˆæ¯ä¼ é€’"><a href="#æ¶ˆæ¯ä¼ é€’" class="headerlink" title="æ¶ˆæ¯ä¼ é€’"></a>æ¶ˆæ¯ä¼ é€’</h2><p>content -&gt; background</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// content scriptå‘é€æ¶ˆæ¯</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="title function_">sendMessage</span>(&#123; <span class="attr">action</span>: <span class="string">&quot;fetchData&quot;</span> &#125;, <span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;æ”¶åˆ°åå°å“åº”:&quot;</span>, response);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// background scriptç›‘å¬</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onMessage</span>.<span class="title function_">addListener</span>(<span class="function">(<span class="params">request, sender, sendResponse</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (request.<span class="property">action</span> === <span class="string">&quot;fetchData&quot;</span>) &#123;</span><br><span class="line">    <span class="title function_">sendResponse</span>(&#123; <span class="attr">data</span>: <span class="string">&quot;æ¥è‡ªåå°çš„æ•°æ®&quot;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>background -&gt; content<br>éœ€é€šè¿‡chrome.tabs.sendMessageæŒ‡å®šç›®æ ‡æ ‡ç­¾é¡µ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chrome.tabs.query(&#123; active: true &#125;, tabs =&gt; &#123;</span><br><span class="line">  chrome.tabs.sendMessage(tabs[0].id, &#123; action: &quot;updateUI&quot; &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="storageå­˜å‚¨æ•°æ®"><a href="#storageå­˜å‚¨æ•°æ®" class="headerlink" title="storageå­˜å‚¨æ•°æ®"></a>storageå­˜å‚¨æ•°æ®</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­˜å‚¨</span></span><br><span class="line">chrome.<span class="property">storage</span>.<span class="property">local</span>.<span class="title function_">set</span>(&#123; <span class="attr">info</span>: <span class="string">&#x27;abc&#x27;</span> &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–</span></span><br><span class="line">chrome.<span class="property">storage</span>.<span class="property">local</span>.<span class="title function_">get</span>([<span class="string">&#x27;info&#x27;</span>], <span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(result);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="ç”Ÿå‘½å‘¨æœŸé’©å­"><a href="#ç”Ÿå‘½å‘¨æœŸé’©å­" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸé’©å­"></a>ç”Ÿå‘½å‘¨æœŸé’©å­</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç›‘å¬æ‰©å±•å®‰è£…å’Œæ›´æ–°äº‹ä»¶</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onInstalled</span>.<span class="title function_">addListener</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬æ‰©å±•å¯åŠ¨äº‹ä»¶</span></span><br><span class="line">chrome.<span class="property">runtime</span>.<span class="property">onStartup</span>.<span class="title function_">addListener</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="å¼€å‘å¾®ä¿¡å°ç¨‹åºæ³¨æ„äº‹é¡¹"><a href="#å¼€å‘å¾®ä¿¡å°ç¨‹åºæ³¨æ„äº‹é¡¹" class="headerlink" title="å¼€å‘å¾®ä¿¡å°ç¨‹åºæ³¨æ„äº‹é¡¹"></a>å¼€å‘å¾®ä¿¡å°ç¨‹åºæ³¨æ„äº‹é¡¹</h1><h2 id="æ‰«ç ç™»å½•"><a href="#æ‰«ç ç™»å½•" class="headerlink" title="æ‰«ç ç™»å½•"></a>æ‰«ç ç™»å½•</h2><p>å¾®ä¿¡æ‰«ç ç™»å½•å°ç¨‹åºçš„æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>æœåŠ¡ç«¯æ ¹æ®sceneä»å°ç¨‹åºAPIè·å–äºŒç»´ç ï¼›</li><li>æµè§ˆå™¨æ’ä»¶ä»æœåŠ¡ç«¯è·å–å¹¶å±•ç¤ºäºŒç»´ç ï¼Œè½®è¯¢æ˜¯å¦ç™»å½•ï¼›</li><li>æ‰‹æœºæ‰«æäºŒç»´ç ï¼Œå¾®ä¿¡å°ç¨‹åºå¯ä»¥ä»queryä¸­æ‹¿åˆ°sceneã€‚ç™»å½•åæ‹¿åˆ°tokenï¼Œè¯·æ±‚ç™»å½•æ¥å£ï¼Œè¿”å›sceneå’Œtokenï¼›</li><li>æœåŠ¡ç«¯ä»¥sceneä¸ºkeyè®°å½•æ˜¯å¦ç™»å½•ã€‚ç¼“å­˜sceneå’Œtokenï¼ŒæŸ¥è¯¢æ˜¯å¦ç™»å½•æ ¹æ®sessionStorageä¸­çš„æ•°æ®åˆ¤æ–­ï¼›</li><li>æµè§ˆå™¨æ’ä»¶æŸ¥è¯¢åˆ°å·²ç™»å½•ï¼Œç»“æŸè½®è¯¢ï¼›</li></ol><p>ä¸»è¦ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–accessToken</span></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">`https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=<span class="subst">$&#123;appid&#125;</span>&amp;secret=<span class="subst">$&#123;secret&#125;</span>`</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ¹æ®accessTokenè·å–äºŒç»´ç </span></span><br><span class="line"><span class="keyword">const</span> scene = <span class="title function_">randomBytes</span>(<span class="number">16</span>).<span class="title function_">toString</span>(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">`https://api.weixin.qq.com/wxa/getwxacodeunlimit?access_token=<span class="subst">$&#123;accessToken&#125;</span>`</span>, &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">      scene,</span><br><span class="line">      <span class="attr">width</span>: <span class="number">200</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="keyword">const</span> buffer = <span class="keyword">await</span> response.<span class="title function_">arrayBuffer</span>();</span><br><span class="line"><span class="keyword">const</span> base64Image = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(buffer).<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line">  res.<span class="title function_">jsonSuccess</span>(&#123;</span><br><span class="line">    <span class="attr">qrcode</span>: <span class="string">`data:image/png;base64,<span class="subst">$&#123;base64Image&#125;</span>`</span>,</span><br><span class="line">    scene,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="è·å–ç”¨æˆ·ä¿¡æ¯"><a href="#è·å–ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="è·å–ç”¨æˆ·ä¿¡æ¯"></a>è·å–ç”¨æˆ·ä¿¡æ¯</h2><p><code>wx.getUserInfo</code>å’Œ<code>wx.getUserProfile</code>å·²ç»è¢«åºŸå¼ƒï¼Œæ— æ³•æ‹¿åˆ°ç”¨æˆ·å¤´åƒå’Œæ˜µç§°ã€‚</p><p>éœ€è¦è®©ç”¨æˆ·è‡ªå·±é€‰æ‹©å¤´åƒå’Œæ˜µç§°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- ç”¨æˆ·ä¿¡æ¯å¼¹çª— --&gt;</span><br><span class="line">&lt;view class=&quot;user-info-modal&quot; wx:if=&quot;&#123;&#123;isLoggedIn &amp;&amp; (!userName || !userAvatar)&#125;&#125;&quot;&gt;</span><br><span class="line">  &lt;view class=&quot;user-info-content&quot;&gt;</span><br><span class="line">    &lt;button class=&quot;avatar-wrapper&quot; open-type=&quot;chooseAvatar&quot; bind:chooseavatar=&quot;onChooseAvatar&quot;&gt;</span><br><span class="line">      &lt;image class=&quot;avatar&quot; src=&quot;&#123;&#123;userAvatar&#125;&#125;&quot;&gt;&lt;/image&gt;</span><br><span class="line">    &lt;/button&gt;</span><br><span class="line">    &lt;input type=&quot;nickname&quot; class=&quot;weui-input&quot; placeholder=&quot;è¯·è¾“å…¥æ˜µç§°&quot; bindinput=&quot;onInputName&quot; /&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">&lt;/view&gt;</span><br></pre></td></tr></table></figure><h2 id="ä¸Šä¼ å¾®ä¿¡å¤´åƒ"><a href="#ä¸Šä¼ å¾®ä¿¡å¤´åƒ" class="headerlink" title="ä¸Šä¼ å¾®ä¿¡å¤´åƒ"></a>ä¸Šä¼ å¾®ä¿¡å¤´åƒ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">const &#123; userName, userAvatar, scene &#125; = this.data</span><br><span class="line">wx.uploadFile(&#123;</span><br><span class="line">  url: &#x27;xx&#x27;,</span><br><span class="line">  filePath: userAvatar,</span><br><span class="line">  name: &#x27;file&#x27;,</span><br><span class="line">  formData: &#123;</span><br><span class="line">    openid: wx.getStorageSync(&#x27;token&#x27;),</span><br><span class="line">    scene,</span><br><span class="line">    nickname: userName</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™æ˜¯ä¸€ä¸ªæ—¥å¸¸ç”¨å¾—ä¸Šçš„é¡¹ç›®ï¼Œåˆé”»ç‚¼äº†å¼€å‘æµè§ˆå™¨æ’ä»¶ã€å¾®ä¿¡å°ç¨‹åºã€nodeã€‚æœ€å¤æ‚çš„æ˜¯æ‰«ç ç™»å½•é‚£å—ã€‚</p><p>ps: å› ä¸ºå‘å¸ƒæµè§ˆå™¨æ’ä»¶éœ€è¦ä»˜è´¹ï¼Œsoï¼Œå¯ä»¥é€šè¿‡ <a href="https://github.com/chendx97/word-grabber-extension">ä¸‹è½½æ’ä»¶</a> æ¥æ‰‹åŠ¨å®‰è£…æµè§ˆå™¨æ’ä»¶ã€‚   </p><p>å°ç¨‹åºäºŒç»´ç ï¼š<br><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/%E5%B0%8F%E7%A8%8B%E5%BA%8F.png" alt="å°ç¨‹åºäºŒç»´ç "> </p>]]></content>
      
      
      <categories>
          
          <category> æŒ‡å— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> node </tag>
            
            <tag> æµè§ˆå™¨æ’ä»¶ </tag>
            
            <tag> å¾®ä¿¡å°ç¨‹åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ–‡æœ¬ç‰‡æ®µï¼šæ¯”Ctrl+Fæ›´æ™ºèƒ½</title>
      <link href="/2024/12/20/text-fragement/"/>
      <url>/2024/12/20/text-fragement/</url>
      
        <content type="html"><![CDATA[<h1 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h1><p>ä»¥å‰ï¼Œä½ å¯ä»¥é€šè¿‡<code>url</code>è·³è½¬åˆ°å…¶ä»–é¡µé¢é¡¶éƒ¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡<code>id</code>è·³è½¬åˆ°æŸä¸ªDOMèŠ‚ç‚¹ã€‚<strong>æ–‡æœ¬ç‰‡æ®µ</strong>å…è®¸ä½ ç›´æ¥é“¾æ¥åˆ°ç½‘é¡µä¸­çš„ç‰¹å®šæ–‡æœ¬éƒ¨åˆ†ï¼Œè€Œä¸”å¯ä»¥é«˜äº®é“¾æ¥æ–‡æœ¬éƒ¨åˆ†ã€‚å®ƒå¯ä»¥ç”¨æ¥ç”Ÿæˆæ›´æœ‰æ•ˆçš„å†…å®¹å…±äº«é“¾æ¥ï¼Œè®©ç”¨æˆ·äº’ç›¸ä¼ é€’ã€‚</p><h1 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://example.com#:~:text=[prefix-,]textStart[,textEnd][,-suffix]</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯æ¯éƒ¨åˆ†çš„è¯¦ç»†è¯´æ˜ï¼š<br><strong>#</strong><br><code>#</code>æ˜¯å¿…é¡»çš„ï¼Œå®ƒæ˜¯urlç‰‡æ®µæ ‡è¯†ç¬¦çš„ä¸€éƒ¨åˆ†ï¼Œç”¨äºæŒ‡ç¤ºæµè§ˆå™¨è·³è½¬åˆ°é¡µé¢ä¸­çš„ç‰¹å®šä½ç½®æˆ–æ–‡æœ¬ã€‚<br><strong>:~:</strong><br>ç‰‡æ®µæŒ‡ä»¤ï¼Œå‘Šè¯‰æµè§ˆå™¨æ¥ä¸‹æ¥æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡ä»¤ï¼Œè·³è½¬åè¿™äº›æŒ‡ä»¤ä¼šä»urlä¸­å‰¥ç¦»ã€‚<br><strong>text&#x3D;</strong><br>ä»£è¡¨æ¥ä¸‹æ¥æ˜¯ä¸€æ®µæ–‡æœ¬æŒ‡ä»¤ã€‚<br><strong>textStart</strong><br>ä¸€ä¸ªæ–‡æœ¬å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šé“¾æ¥æ–‡æœ¬çš„å¼€å§‹ã€‚<br><strong>textEnd</strong><br>ä¸€ä¸ªæ–‡æœ¬å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šé“¾æ¥æ–‡æœ¬çš„ç»“æŸã€‚<br><strong>prefix-</strong><br>ä¸€ä¸ªæ–‡æœ¬å­—ç¬¦ä¸²+ä¸€ä¸ªè¿å­—ç¬¦ï¼ŒæŒ‡å®šé“¾æ¥æ–‡æœ¬å‰é¢åº”è¯¥æœ‰ä»€ä¹ˆæ–‡æœ¬ï¼Œæœ‰åŠ©äºæ›´ç²¾ç¡®çš„é€‰æ‹©é“¾æ¥æ–‡æœ¬ã€‚<br><strong>-suffix</strong><br>ä¸€ä¸ªè¿å­—ç¬¦+ä¸€ä¸ªæ–‡æœ¬å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šé“¾æ¥æ–‡æœ¬åé¢åº”è¯¥æœ‰ä»€ä¹ˆæ–‡æœ¬ã€‚</p><h1 id="ä½¿ç”¨è¯´æ˜"><a href="#ä½¿ç”¨è¯´æ˜" class="headerlink" title="ä½¿ç”¨è¯´æ˜"></a>ä½¿ç”¨è¯´æ˜</h1><ul><li>åªé«˜äº®ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„é“¾æ¥æ–‡æœ¬ã€‚</li><li><code>textStart</code>ã€<code>textEnd</code>ã€<code>prefix</code>ã€<code>suffix</code>éœ€è¦åšç™¾åˆ†æ¯”ç¼–ç (encodeURIComponent)ã€‚</li><li>åŒ¹é…å¤§å°å†™ä¸æ•æ„Ÿã€‚</li><li>å•ç‹¬çš„<code>textStart</code>ã€<code>textEnd</code>ã€<code>prefix</code>ã€<code>suffix</code>å­—ç¬¦ä¸²éœ€è¦å®Œå…¨ä½äºåŒä¸€ä¸ªå—çº§å…ƒç´ ä¸­ï¼Œå®Œæ•´çš„åŒ¹é…å¯ä»¥è·¨è¶Šå¤šä¸ªè¾¹ç•Œã€‚</li><li>å‡ºäºå®‰å…¨è€ƒè™‘ï¼Œå¦‚æœæ˜¯<code>&lt;a&gt;</code>éœ€è¦æ·»åŠ <code>rel=&quot;noopener&quot;</code>ï¼Œå¦‚æœæ˜¯<code>window.open()</code>éœ€è¦æ·»åŠ <code>noopener</code>ã€‚</li><li>æ–‡æœ¬ç‰‡æ®µåªåœ¨éåŒä¸€é¡µé¢ã€ç”¨æˆ·å‘èµ·çš„å¯¼èˆªä¸­è¢«è°ƒç”¨ã€‚</li><li>æ–‡æœ¬ç‰‡æ®µåªé€‚ç”¨äºä¸»æ¡†æ¶ï¼Œä¸æ”¯æŒ<code>iframe</code>ã€‚</li><li>å¦‚æœä¸æƒ³æ”¯æŒæ–‡æœ¬ç‰‡æ®µï¼Œå¯ä»¥è®¾ç½®<code>Document-Policy: force-load-at-top</code>ã€‚</li><li>é»˜è®¤è·³è½¬åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„é“¾æ¥æ–‡æœ¬ï¼Œå¦‚æœæ²¡åŒ¹é…åˆ°æˆ–ä¸æ”¯æŒï¼Œè·³è½¬åˆ°æ–‡æ¡£é¡¶éƒ¨ã€‚</li><li>å¦‚æœåŒ¹é…åˆ°<code>&lt;details&gt;</code>å†…çš„å†…å®¹ï¼Œå®ƒä¼šè‡ªåŠ¨æ‰“å¼€ã€‚</li></ul><h1 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ç¬¬ä¸€æ¬¡å‡ºç°â€œforâ€çš„åœ°æ–¹--&gt;</span></span><br><span class="line">https://example.com#:~:text=for</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--ç¬¬ä¸€æ¬¡ä»¥â€œäººç±»â€å¼€å¤´è€Œä¸”ä»¥â€œURLâ€ç»“å°¾çš„åœ°æ–¹--&gt;</span></span><br><span class="line">https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/a#:~:text=äººç±»,URL </span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--ç¬¬ä¸€æ¬¡å‡ºç°â€œforâ€è€Œä¸”å‰é¢æ˜¯â€œaskingâ€çš„åœ°æ–¹--&gt;</span></span><br><span class="line">https://example.com#:~:text=asking-,for</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    ç¬¬ä¸€ä¸ªé«˜äº®æ˜¯ç¬¬ä¸€æ¬¡å‡ºç°â€œå¯¼è‡´â€çš„åœ°æ–¹ï¼Œ</span></span><br><span class="line"><span class="comment">    ç¬¬äºŒä¸ªé«˜äº®æ˜¯ç¬¬ä¸€æ¬¡å‡ºç°â€œé“¾æ¥çš„â€çš„åœ°æ–¹ï¼Œ</span></span><br><span class="line"><span class="comment">    å¹¶ä¸”è·³è½¬åˆ°ç¬¬ä¸€ä¸ªé«˜äº®çš„åœ°æ–¹ã€‚</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/a#:~:text=å¯¼è‡´&amp;text=é“¾æ¥çš„</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    ç¬¬ä¸€ä¸ªé«˜äº®æ˜¯ç¬¬ä¸€æ¬¡å‡ºç°â€œé“¾æ¥çš„ URLâ€è€Œä¸”åé¢ç´§è·Ÿâ€œï¼Œâ€çš„åœ°æ–¹ï¼Œ</span></span><br><span class="line"><span class="comment">    ç¬¬äºŒä¸ªé«˜äº®æ˜¯ä»¥â€œé¡µé¢â€å¼€å¤´è€Œä¸”ä»¥â€œæµè§ˆç¯å¢ƒâ€ç»“å°¾ï¼Œè€Œä¸”å‰é¢æ˜¯â€œå½“å‰â€çš„åœ°æ–¹ï¼Œ</span></span><br><span class="line"><span class="comment">    å¹¶ä¸”è·³è½¬åˆ°ç¬¬ä¸€ä¸ªé«˜äº®çš„åœ°æ–¹ã€‚</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/a#:~:text=é“¾æ¥çš„%20URL,-ï¼Œ&amp;text=å½“å‰-,é¡µé¢,æµè§ˆç¯å¢ƒ</span><br></pre></td></tr></table></figure><h1 id="ç»™æ–‡æœ¬ç‰‡æ®µæ·»åŠ æ ·å¼"><a href="#ç»™æ–‡æœ¬ç‰‡æ®µæ·»åŠ æ ·å¼" class="headerlink" title="ç»™æ–‡æœ¬ç‰‡æ®µæ·»åŠ æ ·å¼"></a>ç»™æ–‡æœ¬ç‰‡æ®µæ·»åŠ æ ·å¼</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">::target-text &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: rebeccapurple;</span><br><span class="line">  <span class="attribute">color</span>: white;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”¯æŒçš„å±æ€§ï¼š</p><ul><li><code>color</code></li><li><code>background-color</code></li><li><code>text-decoration</code>ã€<code>text-underline-position</code>ã€<code>text-underline-offset</code></li><li><code>text-shadow</code></li><li><code>stroke-color</code>ã€<code>fill-color</code>ã€<code>stroke-width</code></li><li>è‡ªå®šä¹‰å±æ€§</li></ul><h1 id="æ£€æµ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒæ–‡æœ¬ç‰‡æ®µ"><a href="#æ£€æµ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒæ–‡æœ¬ç‰‡æ®µ" class="headerlink" title="æ£€æµ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒæ–‡æœ¬ç‰‡æ®µ"></a>æ£€æµ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒæ–‡æœ¬ç‰‡æ®µ</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="property">fragmentDirective</span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ç©ºå¯¹è±¡ä»£è¡¨æ”¯æŒï¼Œå¦‚æœæ˜¯undefinedä»£è¡¨ä¸æ”¯æŒã€‚<br>ç›®å‰ä»æ˜¯ç©ºå¯¹è±¡ï¼Œæœªæ¥å¯èƒ½åŒ…å«ç‰‡æ®µä¿¡æ¯ã€‚</p><h1 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h1><p>åªèƒ½è·³è½¬å¹¶é«˜äº®ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„åœ°æ–¹ï¼Œä¸èƒ½è·³è½¬å¹¶é«˜äº®ä»¥ååŒ¹é…åˆ°çš„åœ°æ–¹ã€‚å¦‚æœå°è¯•æŒ‰<code>Tab</code>é”®ï¼Œç„¦ç‚¹ä¼šç§»è‡³ä¸‹ä¸€ä¸ªå¯èšç„¦å…ƒç´ (å¦‚é“¾æ¥)ã€‚</p><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><p><a href="https://alfy.blog/2024/10/19/linking-directly-to-web-page-content.html">https://alfy.blog/2024/10/19/linking-directly-to-web-page-content.html</a><br><a href="https://developer.mozilla.org/zh-CN/docs/Web/URI/Fragment/Text_fragments">https://developer.mozilla.org/zh-CN/docs/Web/URI/Fragment/Text_fragments</a></p>]]></content>
      
      
      <categories>
          
          <category> HTML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ–‡æœ¬ç‰‡æ®µ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ“ƒ9æ¡CSSé‡ç½®æ ·å¼è§„åˆ™</title>
      <link href="/2024/12/18/reset-rule/"/>
      <url>/2024/12/18/reset-rule/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æµè§ˆå™¨çš„ä¸€äº›é»˜è®¤æ ·å¼ï¼Œæˆ‘ä»¬å¯èƒ½ä¸éœ€è¦ã€‚æ¯”å¦‚ï¼Œ<code>body &#123;margin: 8px;&#125;</code>ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¸Œæœ›æœ€å¤–å±‚æ²¡æœ‰å¤–è¾¹è·ï¼Œç‰¹åˆ«æ˜¯åœ¨æœ‰<code>&lt;header /&gt;</code>æˆ–èƒŒæ™¯å›¾æ—¶ã€‚å†æ¯”å¦‚ï¼Œ<code>&lt;img/&gt;</code>é»˜è®¤å±•ç¤ºä¸ºåŸå›¾å¤§å°ï¼ŒåŸå›¾çš„å®½é«˜ä¸€èˆ¬éƒ½éå¸¸å¤§ï¼Œæˆ‘ä»¬å¯èƒ½å¸Œæœ›å›¾ç‰‡ä¸è¦è¶…è¿‡çˆ¶å…ƒç´ ã€‚</p><h1 id="é‡ç½®çš„è§„åˆ™"><a href="#é‡ç½®çš„è§„åˆ™" class="headerlink" title="é‡ç½®çš„è§„åˆ™"></a>é‡ç½®çš„è§„åˆ™</h1><p>æ¥ä¸‹æ¥ï¼Œè¯¦ç»†è®²ä¸€ä¸‹éƒ¨åˆ†è§„åˆ™ï¼Œä¸€äº›æ˜¾è€Œæ˜“è§çš„è§„åˆ™å°±æ²¡å¿…è¦ä¸€ä¸€è¯´æ˜äº†ã€‚</p><h2 id="line-height"><a href="#line-height" class="headerlink" title="line-height"></a>line-height</h2><p>æµè§ˆå™¨çš„é»˜è®¤è¡Œé«˜ä¸€èˆ¬æ˜¯1.2ï¼Œä½†è¿™ä¸ªè·ç¦»å¯èƒ½ä¼šæœ‰ç‚¹ç´§å‡‘ï¼Œè€Œä¸”WCAG æ ‡å‡†è§„å®šè¡Œé«˜åº”è‡³å°‘ä¸º 1.5ã€‚<br>è¡Œé«˜å¯ä»¥ç»§æ‰¿ï¼Œæ‰€ä»¥åœ¨<code>body</code>ä¸Šè®¾ç½®å°±å¯ä»¥äº†ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">body &#123;</span><br><span class="line">    line-height: 1.5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•æœ‰ä¸ªç¼ºç‚¹ï¼šå¦‚<code>&lt;h1/&gt;</code>çš„è¡Œé—´è·å¤ªå¤§äº†ã€‚</p><p>å¦ä¸€ä¸ªæ–¹æ³•æ˜¯ï¼Œä»¥<code>font-size</code>ä¸ºåŸºç¡€ï¼Œæ¯è¡Œæ·»åŠ å›ºå®šé«˜åº¦ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line">    line-height: calc(1em + 0.5rem);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•çš„ç¼ºç‚¹æ˜¯ï¼šä¸èƒ½è®¾ç½®åœ¨<code>body</code>ä¸Šï¼Œå› ä¸ºä¸ä¼šä¸ºæ¯ä¸ªå…ƒç´ é‡æ–°è®¡ç®—<code>1em</code>ã€‚</p><h2 id="è¡¨å•æ§ä»¶çš„å­—ä½“ç»§æ‰¿"><a href="#è¡¨å•æ§ä»¶çš„å­—ä½“ç»§æ‰¿" class="headerlink" title="è¡¨å•æ§ä»¶çš„å­—ä½“ç»§æ‰¿"></a>è¡¨å•æ§ä»¶çš„å­—ä½“ç»§æ‰¿</h2><p><code>font-size</code>ã€<code>font-family</code>ã€<code>font-weight</code>åœ¨é™¤è¡¨å•å…ƒç´ ä»¥å¤–çš„æ§ä»¶ä¸­æ˜¯å¯ä»¥ç»§æ‰¿çš„ã€‚<code>input</code>ã€<code>textarea</code>ç­‰å…ƒç´ ä¼šä½¿ç”¨æµè§ˆå™¨é»˜è®¤å€¼ã€‚<br>è¿™ä¸åˆç†ï¼Œé»˜è®¤å€¼å¤ªå°ï¼Œè€Œä¸”ä¸çˆ¶çº§ä¸ç»Ÿä¸€ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åº”è¯¥æŒ‡å®šè¿™äº›å…ƒç´ ç»§æ‰¿çˆ¶çº§æ ·å¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">input, button, textarea, select &#123;</span><br><span class="line">  font: inherit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ”¹å–„æ¢è¡Œ"><a href="#æ”¹å–„æ¢è¡Œ" class="headerlink" title="æ”¹å–„æ¢è¡Œ"></a>æ”¹å–„æ¢è¡Œ</h2><p>é»˜è®¤çš„æ¢è¡Œæ˜¯å°†è¶…å‡ºçš„å•è¯æ¨é€åˆ°ä¸‹ä¸€è¡Œï¼Œæœ‰æ—¶ä¼šäº§ç”Ÿä¸å¥½çš„æ•ˆæœï¼Œæ¯”å¦‚æœ€åä¸€è¡Œåªæœ‰ä¸€ä¸ªå¥å·ã€‚<br>ä½¿ç”¨<code>text-wrap</code>å±æ€§å¯ä»¥ä¼˜åŒ–æ¢è¡Œçš„æ˜¾ç¤ºã€‚å¯¹äº<code>&lt;p&gt;</code>ï¼Œä½¿ç”¨<code>pretty</code>é€‰é¡¹å°†ç¡®ä¿æœ€åä¸€è¡Œæœ‰è‡³å°‘2ä¸ªæ–‡æœ¬ã€‚å¯¹äº<code>&lt;h1&gt;</code>ï¼Œä½¿ç”¨<code>balance</code>é€‰é¡¹ï¼Œå°†è¯•å›¾ä½¿æ¯è¡Œçš„æ–‡æœ¬é•¿åº¦å¤§è‡´ç›¸åŒã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">p &#123;</span><br><span class="line">  text-wrap: pretty;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">h1, h2, h3, h4, h5, h6 &#123;</span><br><span class="line">  text-wrap: balance;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ ¹å †å ä¸Šä¸‹æ–‡"><a href="#æ ¹å †å ä¸Šä¸‹æ–‡" class="headerlink" title="æ ¹å †å ä¸Šä¸‹æ–‡"></a>æ ¹å †å ä¸Šä¸‹æ–‡</h2><p><code>isolation</code>å±æ€§å…è®¸æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å †æ ˆä¸Šä¸‹æ–‡ï¼Œè€Œæ— éœ€è®¾ç½®<code>z-index</code>ã€‚<br>åœ¨ä½¿ç”¨<code>Vue</code>ç­‰æ¡†æ¶æ—¶ï¼Œå¦‚æœå¯¹æ ¹å…ƒç´ è®¾ç½®<code>isolate</code>ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä¿è¯æŸäº›é«˜ä¼˜å…ˆçº§å…ƒç´ ï¼ˆæ¨¡å¼ã€ä¸‹æ‹‰èœå•ã€å·¥å…·æç¤ºï¼‰å§‹ç»ˆæ˜¾ç¤ºåœ¨åº”ç”¨ç¨‹åºä¸­çš„å…¶ä»–å…ƒç´ ä¹‹ä¸Šã€‚</p><h1 id="å®Œæ•´è§„åˆ™"><a href="#å®Œæ•´è§„åˆ™" class="headerlink" title="å®Œæ•´è§„åˆ™"></a>å®Œæ•´è§„åˆ™</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">*, *::before, *::after &#123;</span><br><span class="line">  box-sizing: border-box;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">* &#123;</span><br><span class="line">  margin: 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">body &#123;</span><br><span class="line">  line-height: 1.5;</span><br><span class="line">  -webkit-font-smoothing: antialiased;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">img, picture, video, canvas, svg &#123;</span><br><span class="line">  display: block;</span><br><span class="line">  max-width: 100%;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">input, button, textarea, select &#123;</span><br><span class="line">  font: inherit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">p, h1, h2, h3, h4, h5, h6 &#123;</span><br><span class="line">  overflow-wrap: break-word;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">p &#123;</span><br><span class="line">  text-wrap: pretty;</span><br><span class="line">&#125;</span><br><span class="line">h1, h2, h3, h4, h5, h6 &#123;</span><br><span class="line">  text-wrap: balance;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#root, #__next &#123;</span><br><span class="line">  isolation: isolate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸æ¨èåœ¨æ—§é¡¹ç›®ä¸Šè®¾ç½®è¿™äº›è§„åˆ™ï¼Œä½†æ¨èåœ¨æ–°é¡¹ç›®ä¸Šéƒ½è®¾ç½®è¿™äº›è§„åˆ™ã€‚</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://www.joshwcomeau.com/css/custom-css-reset/">custom-css-reset</a><br><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/text-wrap">MDN: text-wrap</a><br><a href="https://www.zhangxinxu.com/wordpress/2016/01/understand-css3-isolation-isolate/">ç†è§£CSS3 isolation: isolateçš„è¡¨ç°å’Œä½œç”¨</a></p>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css reset </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vuepress2è‡ªå®šä¹‰ä¸»é¢˜è¯¦ç»†æŒ‡å—</title>
      <link href="/2024/12/18/vuepress2/"/>
      <url>/2024/12/18/vuepress2/</url>
      
        <content type="html"><![CDATA[<h1 id="åˆ›å»ºé¡¹ç›®"><a href="#åˆ›å»ºé¡¹ç›®" class="headerlink" title="åˆ›å»ºé¡¹ç›®"></a>åˆ›å»ºé¡¹ç›®</h1><p>é¦–å…ˆï¼Œåˆ›å»ºé¡¹ç›®ï¼Œ<code>vuepress-starter</code>ä»£è¡¨ä½ çš„é¡¹ç›®åï¼Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init vuepress vuepress-starter</span><br></pre></td></tr></table></figure><p>é¡µé¢ç›®å½•ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ<br><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20241110195042.png" alt="image"><br>ç„¶åå¯åŠ¨é¡¹ç›®ï¼Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run docs:dev</span><br></pre></td></tr></table></figure><h1 id="è‡ªå®šä¹‰é¦–é¡µ"><a href="#è‡ªå®šä¹‰é¦–é¡µ" class="headerlink" title="è‡ªå®šä¹‰é¦–é¡µ"></a>è‡ªå®šä¹‰é¦–é¡µ</h1><p>é¦–å…ˆåœ¨<code>.vuepress/layouts/LayoutHome.vue</code>ä¸­å®šä¹‰é¦–é¡µå¦‚ä½•å¸ƒå±€ï¼Œç„¶ååœ¨<code>/vuepress/clients.js</code>ä¸­æ³¨å†Œè¯¥å¸ƒå±€ï¼Œæœ€ååœ¨<code>README.md</code>ä¸­å£°æ˜é¦–é¡µä½¿ç”¨æ­¤å¸ƒå±€ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// /vuepress/clients.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineClientConfig, resolvers  &#125; <span class="keyword">from</span> <span class="string">&#x27;vuepress/client&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">LayoutHome</span> <span class="keyword">from</span> <span class="string">&#x27;./layouts/LayoutHome.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineClientConfig</span>(&#123;</span><br><span class="line">  <span class="attr">layouts</span>: &#123;</span><br><span class="line">    <span class="title class_">LayoutHome</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">home: true</span><br><span class="line">layout: LayoutHome</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>é¦–é¡µå…·ä½“ä»£ç ä¸å±•ç¤ºã€‚å…¶ä»–é¡µé¢çš„è‡ªå®šä¹‰å¸ƒå±€ä¸é¦–é¡µä¸åŒï¼Œä¼šåœ¨åé¢è®²åˆ°ã€‚</p><h1 id="è‡ªå®šä¹‰ç»„ä»¶"><a href="#è‡ªå®šä¹‰ç»„ä»¶" class="headerlink" title="è‡ªå®šä¹‰ç»„ä»¶"></a>è‡ªå®šä¹‰ç»„ä»¶</h1><p>ç»„ä»¶éƒ½æ”¾åœ¨<code>.vuepress/components</code>ä¸‹ï¼Œä¸€å…±æœ‰3ç§ç»„ä»¶ã€‚<br>ç¬¬ä¸€ç§ï¼Œéå…¨å±€ç»„ä»¶ï¼Œä½¿ç”¨æ—¶éœ€è¦å¼•å…¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import ParentLayout from &#x27;@vuepress/theme-default/layouts/Layout.vue&#x27;</span><br><span class="line">import ArticleList from &#x27;../components/ArticleList.vue&#x27;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;ParentLayout&gt;</span><br><span class="line">    &lt;template #navbar&gt;</span><br><span class="line">      hi</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    &lt;template #page&gt;</span><br><span class="line">      &lt;main class=&quot;page&quot;&gt;</span><br><span class="line">        &lt;ArticleList :items=&quot;articles.items&quot; /&gt;</span><br><span class="line">      &lt;/main&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/ParentLayout&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§ï¼Œå…¨å±€ç»„ä»¶éœ€è¦æ³¨å†Œï¼Œä¸éœ€è¦å¼•å…¥ï¼Œä½¿ç”¨æ—¶æ‰ä¼šè¢«æ·»åŠ åˆ°é¡µé¢ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// .vuepress/theme/client.js</span><br><span class="line">import &#123; defineClientConfig &#125; from &#x27;vuepress/client&#x27;;</span><br><span class="line">import Layout from &#x27;./layouts/Layout.vue&#x27;;</span><br><span class="line">import Navbar from &#x27;./components/Navbar.vue&#x27;;</span><br><span class="line"></span><br><span class="line">export default defineClientConfig(&#123;</span><br><span class="line">  layouts: &#123;</span><br><span class="line">    Layout,</span><br><span class="line">  &#125;,</span><br><span class="line">  enhance(&#123; app &#125;) &#123;</span><br><span class="line">    app.component(&#x27;Navbar&#x27;, Navbar);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰ç§ï¼ŒrootComponentsæŒ‡å®šçš„ç»„ä»¶ä¼šè¢«ç›´æ¥æ”¾åœ¨æ ¹èŠ‚ç‚¹ä¸­ï¼Œå…¨å±€å¼¹çª—ä¹‹ç±»çš„ç»„ä»¶å¯ä»¥ç”¨è¿™ç§æ–¹æ³•ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; defineClientConfig &#125; from &#x27;vuepress/client&#x27;</span><br><span class="line">import GlobalPopup from &#x27;./components/GlobalPopup.vue&#x27;</span><br><span class="line"></span><br><span class="line">export default defineClientConfig(&#123;</span><br><span class="line">  rootComponents: [GlobalPopup],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="è‡ªå®šä¹‰å¸ƒå±€"><a href="#è‡ªå®šä¹‰å¸ƒå±€" class="headerlink" title="è‡ªå®šä¹‰å¸ƒå±€"></a>è‡ªå®šä¹‰å¸ƒå±€</h1><p>åœ¨æ–‡ä»¶<code>.vuepress/layouts/LayoutDefault.vue</code>ä¸­å®šä¹‰é¡µé¢å†…å®¹ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--.vuepress/layouts/LayoutDefault.vue--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">setup</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Navbar</span> <span class="keyword">from</span> <span class="string">&quot;../components/Navbar.vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"><span class="keyword">import</span> <span class="title class_">Footer</span> <span class="keyword">from</span> <span class="string">&quot;../components/Footer.vue&quot;</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Navbar</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">Footer</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œåœ¨<code>.vuepress/client.js</code>ä¸­æ³¨å†Œè¯¥å¸ƒå±€ï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .vuepress/client.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; defineClientConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vuepress/client&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">LayoutDefault</span> <span class="keyword">from</span> <span class="string">&#x27;./layouts/LayoutDefault.vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Navbar</span> <span class="keyword">from</span> <span class="string">&#x27;./components/Navbar.vue&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineClientConfig</span>(&#123;</span><br><span class="line">  <span class="attr">layouts</span>: &#123;</span><br><span class="line">    <span class="title class_">LayoutDefault</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æœ€ååœ¨ä½¿ç”¨è¯¥å¸ƒå±€çš„é¡µé¢ä¸­ï¼Œå¼•å…¥å¹¶å°†å†…å®¹å¡«å……è¿›slotã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">import LayoutDefault from &quot;./LayoutDefault.vue&quot;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;LayoutDefault&gt;</span><br><span class="line">    hi</span><br><span class="line">  &lt;/LayoutDefault&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h1 id="ä¿®æ”¹é»˜è®¤é¡µé¢"><a href="#ä¿®æ”¹é»˜è®¤é¡µé¢" class="headerlink" title="ä¿®æ”¹é»˜è®¤é¡µé¢"></a>ä¿®æ”¹é»˜è®¤é¡µé¢</h1><p>é»˜è®¤çš„é¡µé¢æœ‰æ–‡ç« åˆ—è¡¨é¡µã€æ ‡ç­¾é¡µã€ç±»åˆ«é¡µã€æ—¶é—´è½´é¡µã€‚æœ‰2ç§æ–¹æ¡ˆï¼šæ›¿æ¢é»˜è®¤æ’æ§½ã€æ›¿æ¢æ•´ä¸ªå¸ƒå±€é¡µã€‚<br>æ¯ä¸ªé¡µé¢éƒ½æœ‰å›ºå®šçš„æ–‡ä»¶åï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li>æ–‡ç« åˆ—è¡¨é¡µï¼šlayouts&#x2F;Article.vue</li><li>æ–‡ç« å†…å®¹é¡µï¼šlayouts&#x2F;Layout.vue</li><li>æ ‡ç­¾é¡µï¼šlayouts&#x2F;Tag.vue</li><li>ç±»åˆ«é¡µï¼šlayouts&#x2F;Category.vue</li><li>æ—¶é—´è½´é¡µï¼šlayouts&#x2F;Timeline.vue</li></ul><p>ä¸‹é¢ä»¥æ–‡ç« å†…å®¹é¡µä¸ºä¾‹ï¼Œå¿…é¡»è¦åœ¨<code>.vuepress/layouts/Layout.vue</code>æ–‡ä»¶ä¸­å®šä¹‰æ–‡ç« å†…å®¹é¡µçš„å†…å®¹ã€‚<br>æ–¹æ¡ˆä¸€ï¼šæ›¿æ¢é»˜è®¤æ’æ§½ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- .vuepress/layouts/Layout.vue --&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import ParentLayout from &quot;@vuepress/theme-default/layouts/Layout.vue&quot;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;ParentLayout&gt;</span><br><span class="line">    &lt;template #navbar&gt;</span><br><span class="line">      &lt;Navbar /&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">    &lt;template #page-bottom&gt;</span><br><span class="line">      &lt;Footer /&gt;</span><br><span class="line">    &lt;/template&gt;</span><br><span class="line">  &lt;/ParentLayout&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p>æ–¹æ¡ˆäºŒï¼šæ›¿æ¢æ•´ä¸ªå¸ƒå±€é¡µï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- .vuepress/layouts/Layout.vue --&gt;</span><br><span class="line">&lt;script setup&gt;</span><br><span class="line">import LayoutDefault from &quot;./LayoutDefault.vue&quot;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;LayoutDefault&gt;</span><br><span class="line">    &lt;Content /&gt;</span><br><span class="line">  &lt;/LayoutDefault&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><p><code>&lt;Content/&gt;</code>å°±æ˜¯<code>.md</code>æ–‡ä»¶é‡Œçš„å†…å®¹ï¼Œä¸éœ€è¦å¼•å…¥ã€‚</p><h1 id="æ·»åŠ æ–°é¡µé¢"><a href="#æ·»åŠ æ–°é¡µé¢" class="headerlink" title="æ·»åŠ æ–°é¡µé¢"></a>æ·»åŠ æ–°é¡µé¢</h1><p>æ¯”å¦‚ï¼Œæƒ³æ·»åŠ ä¸€ä¸ªå‹é“¾é¡µã€‚<br>éœ€è¦å…ˆåœ¨<code>.vuepress/layouts/Friends.vue</code>ä¸­å®šä¹‰é¡µé¢å†…å®¹ï¼Œç„¶ååœ¨<code>.vuepress/client.js</code>ä¸­æ³¨å†Œè¯¥å¸ƒå±€ã€‚ç„¶ååœ¨<code>.vuepress/config.js</code>ä¸­æ·»åŠ æ–°é¡µé¢ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .vuepress/config.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; createPage &#125; <span class="keyword">from</span> <span class="string">&#x27;vuepress/core&#x27;</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineUserConfig</span>(&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">onInitialized</span>: <span class="title function_">async</span> (app) =&gt; &#123;</span><br><span class="line">        app.<span class="property">pages</span>.<span class="title function_">push</span>(<span class="keyword">await</span> <span class="title function_">createPage</span>(app, &#123;</span><br><span class="line">            <span class="attr">path</span>: <span class="string">&#x27;/friends.html&#x27;</span>,</span><br><span class="line">            <span class="attr">frontmatter</span>: &#123;</span><br><span class="line">                <span class="attr">layout</span>: <span class="string">&#x27;Friends&#x27;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">    &#125;))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h1 id="å¦‚ä½•è¦†ç›–é»˜è®¤æ ·å¼"><a href="#å¦‚ä½•è¦†ç›–é»˜è®¤æ ·å¼" class="headerlink" title="å¦‚ä½•è¦†ç›–é»˜è®¤æ ·å¼"></a>å¦‚ä½•è¦†ç›–é»˜è®¤æ ·å¼</h1><p>åœ¨<code>.vuepress/styles/index.scss</code>(ä¸€å®šæ˜¯è¿™ä¸ªåå­—)ä¸­å®šä¹‰æ ·å¼ï¼Œä¸éœ€è¦å¼•å…¥ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// <span class="selector-class">.vuepress</span>/styles/index<span class="selector-class">.scss</span></span><br><span class="line"><span class="selector-class">.text-color</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å¯èƒ½ç”¨åˆ°çš„api"><a href="#å¯èƒ½ç”¨åˆ°çš„api" class="headerlink" title="å¯èƒ½ç”¨åˆ°çš„api"></a>å¯èƒ½ç”¨åˆ°çš„api</h1><h2 id="useClientData"><a href="#useClientData" class="headerlink" title="useClientData"></a>useClientData</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup lang=&quot;ts&quot;&gt;</span><br><span class="line">import &#123; useClientData &#125; from &#x27;vuepress/client&#x27;</span><br><span class="line"></span><br><span class="line">const &#123;</span><br><span class="line">  pageData,</span><br><span class="line">  pageFrontmatter,</span><br><span class="line">  pageHead,</span><br><span class="line">  pageHeadTitle,</span><br><span class="line">  pageLang,</span><br><span class="line">  routeLocale,</span><br><span class="line">  siteData,</span><br><span class="line">  siteLocaleData,</span><br><span class="line">&#125; = useClientData()</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><code>useClientData()</code>çš„è¿”å›å€¼å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20241110203033.png" alt="image"><br><code>useClientData()</code>è¿”å›å…¨éƒ¨å®¢æˆ·ç«¯refå¯¹è±¡ï¼Œå¦å¤–è¿˜å¯ä»¥é€šè¿‡ä»¥ä¸‹ç»„åˆå¼apiè·å–å•ç‹¬æ•°æ®ï¼Œ</p><ul><li>usePageData è·å–å½“å‰é¡µé¢æ•°æ®ï¼›<br><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20241110203042.png" alt="image"></li><li>usePageFrontmatter è·å–å½“å‰é¡µé¢çš„frontmatteré…ç½®ï¼›<br><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20241110203049.png" alt="image"></li><li>usePageHead è·å–å½“å‰é¡µé¢headä¿¡æ¯ï¼Œå¦‚metaã€titleç­‰ï¼›</li><li><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20241110203057.png" alt="image"></li><li>usePageHeadTitle è·å–å½“å‰é¡µé¢çš„titleï¼Œé¡µé¢title+ç«™ç‚¹titleï¼›<br><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20241110203105.png" alt="image"></li><li>usePageLang è·å–å½“å‰é¡µé¢è¯­è¨€ï¼›<br><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20241110203113.png" alt="image"></li></ul><h2 id="useRoutes"><a href="#useRoutes" class="headerlink" title="useRoutes"></a>useRoutes</h2><p>è¯¥apiè¿”å›æ‰€æœ‰è·¯ç”±ï¼Œ<br><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20241124201337.png" alt="image"></p><h2 id="useSiteData"><a href="#useSiteData" class="headerlink" title="useSiteData"></a>useSiteData</h2><p>è¯¥apiè¿”å›ç«™ç‚¹ä¿¡æ¯ï¼Œ<br><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20241124201343.png" alt="image"></p><h2 id="defineClientConfig"><a href="#defineClientConfig" class="headerlink" title="defineClientConfig"></a>defineClientConfig</h2><p><code>defineClientConfig</code>éœ€è¦å®šä¹‰åœ¨<code>.vuepress/client.js</code>ä¸­ã€‚å¦‚æœæ˜¯åœ¨è‡ªå®šä¹‰ä¸»é¢˜ä¸­ä½¿ç”¨ï¼Œéœ€è¦å£°æ˜è¯¥æ–‡ä»¶çš„ä½ç½®ï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config.js</span></span><br><span class="line"><span class="attr">clientConfigFile</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./path/to/client.js&#x27;</span>),</span><br></pre></td></tr></table></figure><p><code>defineClientConfig</code>çš„å…·ä½“ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineClientConfig &#125; <span class="keyword">from</span> <span class="string">&#x27;vuepress/client&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineClientConfig</span>(&#123;</span><br><span class="line">  <span class="title function_">enhance</span>(<span class="params">&#123; app, router, siteData &#125;</span>) &#123;</span><br><span class="line">    <span class="comment">// å¯ä»¥åœ¨è¿™é‡Œæ³¨å†Œå…¨å±€ç»„ä»¶</span></span><br><span class="line">    <span class="comment">// app.component(&#x27;MyComponent&#x27;, MyComponent)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¯ä»¥ä½¿ç”¨è·¯ç”±æ–¹æ³•</span></span><br><span class="line">    router.<span class="title function_">beforeEach</span>(<span class="function">(<span class="params">to</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;before navigation&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œç›¸å½“äºæ ¹ç»„ä»¶çš„setupçš„ä¸€éƒ¨åˆ†ï¼Œåœ¨è¿™é‡Œå¯ä»¥ä½¿ç”¨vueçš„api</span></span><br><span class="line">    <span class="comment">// provide(&#x27;count&#x27;, 3)</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">layouts</span>: &#123;&#125;, <span class="comment">// æ³¨å†Œå¸ƒå±€</span></span><br><span class="line">  <span class="attr">rootComponents</span>: [], <span class="comment">// æ³¨å†Œå…¨å±€æ ¹ç»„ä»¶</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="resolveRoute"><a href="#resolveRoute" class="headerlink" title="resolveRoute"></a>resolveRoute</h2><p><code>useRoutes()</code>è·å–å…¨éƒ¨è·¯ç”±ï¼Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œkeyæ˜¯pathï¼Œå€¼æ˜¯è·¯ç”±ä¿¡æ¯ï¼›<br><code>resolveRoutePath(url)</code>æ ¹æ®ä¼ å…¥çš„urlè·å–pathï¼›<br><code>resolveRoute(link)</code>è¿”å›è·¯ç”±ä¿¡æ¯ï¼›<br><code>withBase(path)</code> æ‹¼æ¥ä¸Šbaseå€¼ï¼›<br>åœ¨è‡ªå®šä¹‰ä¸»é¢˜æ—¶ï¼Œå¯ä»¥é€šè¿‡<code>withBase</code>è·å–èµ„æºæ­£ç¡®è·¯å¾„ï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line"><span class="keyword">import</span> &#123; ref &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; withBase &#125; <span class="keyword">from</span> <span class="string">&#x27;vuepress/client&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> logoPath = <span class="title function_">ref</span>(<span class="string">&#x27;/images/hero.png&#x27;</span>)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;withBase(logoPath)&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span></span><br></pre></td></tr></table></figure><h2 id="å·²å®šä¹‰çš„å¸¸é‡"><a href="#å·²å®šä¹‰çš„å¸¸é‡" class="headerlink" title="å·²å®šä¹‰çš„å¸¸é‡"></a>å·²å®šä¹‰çš„å¸¸é‡</h2><ul><li><strong>VUEPRESS_VERSION</strong> vuepressæ ¸å¿ƒåŒ…çš„ç‰ˆæœ¬ï¼›</li><li><strong>VUEPRESS_BASE</strong> config.jsä¸­baseé…ç½®ï¼›</li><li><strong>VUEPRESS_DEV</strong> æ˜¯å¦æ˜¯devç¯å¢ƒï¼›</li><li><strong>VUEPRESS_SSR</strong> æ˜¯å¦æ˜¯ssrç¯å¢ƒï¼›<br>è¿™äº›å¸¸é‡å¯ä»¥åœ¨<code>js</code>ä»£ç ä¸­ç›´æ¥ä½¿ç”¨ï¼Œ<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script setup&gt;</span><br><span class="line">console.log(__VUEPRESS_VERSION__)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li></ul><h2 id="resolvers"><a href="#resolvers" class="headerlink" title="resolvers"></a>resolvers</h2><p>è¦†ç›–ä¸€äº›é»˜è®¤çš„è®¡ç®—æ–¹æ³•ï¼Œå®éªŒæ€§åŠŸèƒ½ï¼Œä¿®æ”¹æ—¶éœ€å……åˆ†äº†è§£åŸæ¥çš„ç›®çš„ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; defineClientConfig, resolvers &#125; <span class="keyword">from</span> <span class="string">&#x27;vuepress/client&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineClientConfig</span>(&#123;</span><br><span class="line">  <span class="title function_">enhance</span>(<span class="params">&#123; app, router, siteData &#125;</span>) &#123;</span><br><span class="line">    resolvers.<span class="property">resolvePageHeadTitle</span> = <span class="function">(<span class="params">page, siteLocale</span>) =&gt;</span></span><br><span class="line">      <span class="string">`<span class="subst">$&#123;siteLocale.title&#125;</span> &gt; <span class="subst">$&#123;page.title&#125;</span>`</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20241110203057.png" alt="image"></p><h1 id="æ·»åŠ è¿›é˜¶åŠŸèƒ½"><a href="#æ·»åŠ è¿›é˜¶åŠŸèƒ½" class="headerlink" title="æ·»åŠ è¿›é˜¶åŠŸèƒ½"></a>æ·»åŠ è¿›é˜¶åŠŸèƒ½</h1><h2 id="è¯„è®ºæ¨¡å—"><a href="#è¯„è®ºæ¨¡å—" class="headerlink" title="è¯„è®ºæ¨¡å—"></a>è¯„è®ºæ¨¡å—</h2><p>é¦–å…ˆï¼Œå®‰è£…ä¾èµ–ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -D @vuepress/plugin-comment@next</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œé…ç½®æ’ä»¶ï¼Œç”³è¯·è¯„è®ºæœåŠ¡ï¼Œè¯„è®ºæœåŠ¡æ¨è<code>Giscus</code>ï¼Œ<br><a href="https://ecosystem.vuejs.press/zh/plugins/blog/comment/giscus/">https://ecosystem.vuejs.press/zh/plugins/blog/comment/giscus/</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .vuepress/config.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; commentPlugin &#125; <span class="keyword">from</span> <span class="string">&#x27;@vuepress/plugin-comment&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title function_">defineUserConfig</span>(&#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="title function_">commentPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">provider</span>: <span class="string">&#x27;Giscus&#x27;</span>,</span><br><span class="line">      <span class="attr">repo</span>: <span class="string">&#x27;...&#x27;</span>,</span><br><span class="line">      <span class="attr">repoId</span>: <span class="string">&#x27;...&#x27;</span>,</span><br><span class="line">      <span class="attr">category</span>: <span class="string">&#x27;...&#x27;</span>,</span><br><span class="line">      <span class="attr">categoryId</span>: <span class="string">&#x27;...&#x27;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="vuepress-helperè¾…åŠ©å‡½æ•°"><a href="#vuepress-helperè¾…åŠ©å‡½æ•°" class="headerlink" title="@vuepress&#x2F;helperè¾…åŠ©å‡½æ•°"></a>@vuepress&#x2F;helperè¾…åŠ©å‡½æ•°</h2><p><a href="https://ecosystem.vuejs.press/zh/tools/helper/">https://ecosystem.vuejs.press/zh/tools/helper/</a></p><h2 id="æ·»åŠ æ˜¾ç¤ºè®¿é—®é‡åŠŸèƒ½ï¼›"><a href="#æ·»åŠ æ˜¾ç¤ºè®¿é—®é‡åŠŸèƒ½ï¼›" class="headerlink" title="æ·»åŠ æ˜¾ç¤ºè®¿é—®é‡åŠŸèƒ½ï¼›"></a>æ·»åŠ æ˜¾ç¤ºè®¿é—®é‡åŠŸèƒ½ï¼›</h2><p><a href="https://ecosystem.vuejs.press/zh/plugins/analytics/umami-analytics.html">https://ecosystem.vuejs.press/zh/plugins/analytics/umami-analytics.html</a></p><h2 id="è®¾ç½®sitemap"><a href="#è®¾ç½®sitemap" class="headerlink" title="è®¾ç½®sitemap"></a>è®¾ç½®sitemap</h2><p><a href="https://vuepress-plugin-blog.billyyyyy3320.com/zh/guide/getting-started.html#frontmatter-%E5%88%86%E7%B1%BB%E5%99%A8">https://vuepress-plugin-blog.billyyyyy3320.com/zh/guide/getting-started.html#frontmatter-%E5%88%86%E7%B1%BB%E5%99%A8</a></p><h2 id="å¼€å¯ssr"><a href="#å¼€å¯ssr" class="headerlink" title="å¼€å¯ssr"></a>å¼€å¯ssr</h2><p>seoæ’ä»¶ï¼›<a href="https://ecosystem.vuejs.press/zh/plugins/seo/seo/">https://ecosystem.vuejs.press/zh/plugins/seo/seo/</a></p><h2 id="ä»£ç å¤åˆ¶åŠŸèƒ½"><a href="#ä»£ç å¤åˆ¶åŠŸèƒ½" class="headerlink" title="ä»£ç å¤åˆ¶åŠŸèƒ½"></a>ä»£ç å¤åˆ¶åŠŸèƒ½</h2><p><a href="https://ecosystem.vuejs.press/zh/plugins/features/copy-code.html">https://ecosystem.vuejs.press/zh/plugins/features/copy-code.html</a></p><h2 id="æœç´¢åŠŸèƒ½"><a href="#æœç´¢åŠŸèƒ½" class="headerlink" title="æœç´¢åŠŸèƒ½"></a>æœç´¢åŠŸèƒ½</h2><p><a href="https://ecosystem.vuejs.press/zh/plugins/search/search.html#hotkeys">https://ecosystem.vuejs.press/zh/plugins/search/search.html#hotkeys</a></p><h2 id="å†…ç½®å…¨å±€ç»„ä»¶"><a href="#å†…ç½®å…¨å±€ç»„ä»¶" class="headerlink" title="å†…ç½®å…¨å±€ç»„ä»¶"></a>å†…ç½®å…¨å±€ç»„ä»¶</h2><p><a href="https://vuepress.github.io/zh/reference/components.html#autolink">https://vuepress.github.io/zh/reference/components.html#autolink</a></p><h2 id="é»˜è®¤æ’æ§½"><a href="#é»˜è®¤æ’æ§½" class="headerlink" title="é»˜è®¤æ’æ§½"></a>é»˜è®¤æ’æ§½</h2><p><a href="https://ecosystem.vuejs.press/zh/themes/default/extending.html#%E5%B8%83%E5%B1%80%E6%8F%92%E6%A7%BD">https://ecosystem.vuejs.press/zh/themes/default/extending.html#%E5%B8%83%E5%B1%80%E6%8F%92%E6%A7%BD</a></p><h2 id="æ›¿æ¢éå…¨å±€ç»„ä»¶"><a href="#æ›¿æ¢éå…¨å±€ç»„ä»¶" class="headerlink" title="æ›¿æ¢éå…¨å±€ç»„ä»¶"></a>æ›¿æ¢éå…¨å±€ç»„ä»¶</h2><p><a href="https://ecosystem.vuejs.press/zh/themes/default/extending.html#%E7%BB%84%E4%BB%B6%E6%9B%BF%E6%8D%A2">https://ecosystem.vuejs.press/zh/themes/default/extending.html#%E7%BB%84%E4%BB%B6%E6%9B%BF%E6%8D%A2</a></p><h2 id="éå…¨å±€ç»„ä»¶åˆ—è¡¨"><a href="#éå…¨å±€ç»„ä»¶åˆ—è¡¨" class="headerlink" title="éå…¨å±€ç»„ä»¶åˆ—è¡¨"></a>éå…¨å±€ç»„ä»¶åˆ—è¡¨</h2><p><a href="https://github.com/vuepress/ecosystem/tree/main/themes/theme-default/src/client/components">https://github.com/vuepress/ecosystem/tree/main/themes/theme-default/src/client/components</a></p><h2 id="å›¾ç‰‡ç¼©æ”¾åŠŸèƒ½"><a href="#å›¾ç‰‡ç¼©æ”¾åŠŸèƒ½" class="headerlink" title="å›¾ç‰‡ç¼©æ”¾åŠŸèƒ½"></a>å›¾ç‰‡ç¼©æ”¾åŠŸèƒ½</h2><p><a href="https://ecosystem.vuejs.press/zh/plugins/features/medium-zoom.html">https://ecosystem.vuejs.press/zh/plugins/features/medium-zoom.html</a></p><h2 id="è¦†ç›–ä¸»é¢˜csså˜é‡"><a href="#è¦†ç›–ä¸»é¢˜csså˜é‡" class="headerlink" title="è¦†ç›–ä¸»é¢˜csså˜é‡"></a>è¦†ç›–ä¸»é¢˜csså˜é‡</h2><p><a href="https://ecosystem.vuejs.press/zh/themes/default/styles.html#style-%E6%96%87%E4%BB%B6">https://ecosystem.vuejs.press/zh/themes/default/styles.html#style-%E6%96%87%E4%BB%B6</a></p><h1 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h1><p>çƒ‚å°¾äº†ï¼Œä¸ä¸€å®šè¡¥å……ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æŒ‡å— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vuepress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ“¢å½»åº•äº†è§£Vu3çš„watchEffectå’Œwatch</title>
      <link href="/2024/11/19/watch/"/>
      <url>/2024/11/19/watch/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æˆ‘ç»å¸¸ä½¿ç”¨<code>watch</code>å’Œ<code>watcheffect</code>ï¼Œä½†å‰å‡ å¤©é‡åˆ°ä¸€ä¸ªç¨å¾®å¤æ‚ç‚¹çš„åŠŸèƒ½ï¼Œå°±å‡ºç°äº†æ„æ–™ä¹‹å¤–çš„æƒ…å†µï¼Œæ„Ÿè§‰å¯¹å®ƒä»¬äº†è§£çš„è¿˜ä¸å¤Ÿã€‚æ‰€ä»¥ï¼Œåœ¨æ­¤è¯¦ç»†æ¢ç´¢ä¸€ä¸‹å®ƒä»¬ã€‚</p><h1 id="watch-vs-watchEffect"><a href="#watch-vs-watchEffect" class="headerlink" title="watch vs watchEffect"></a>watch vs watchEffect</h1><p>å®ƒä»¬çš„ç›¸åŒç‚¹æ˜¯éƒ½å¯ä»¥ç›‘å¬<strong>å“åº”å¼æ•°æ®</strong>çš„å˜åŒ–ï¼Œå¹¶æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚ä¸åŒç‚¹æ¯”è¾ƒå¤šã€‚<br>ä¸åŒç‚¹å¦‚ä¸‹ï¼š</p><ul><li>watchéœ€è¦æ˜¾ç¤ºæŒ‡å®šè¦ç›‘å¬çš„æ•°æ®ï¼ŒwatchEffectä¼š<strong>è‡ªåŠ¨</strong>æ”¶é›†ä¾èµ–ï¼›</li><li>watchEffectä¼š<strong>ç«‹å³</strong>æ‰§è¡Œä¸€æ¬¡ï¼Œwatchåœ¨è®¾ç½®<code>&#123;immediate: true&#125;</code>æ—¶æ‰ä¼šç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼›</li><li>watchå¯ä»¥è·å–åˆ°<strong>æ—§å€¼</strong>ï¼ŒwatchEffectä¸å¯ä»¥ï¼›</li><li>watchå¯ä»¥é€šè¿‡é€‰é¡¹è®¾ç½®ä¸º<strong>ä»…æ‰§è¡Œä¸€æ¬¡</strong>ï¼ŒwatchEffectä¸å¯ä»¥ï¼›</li><li>watchå¯ä»¥è®¾ç½®ç›‘å¬å¯¹è±¡çš„<strong>å±‚æ•°</strong>ï¼ŒwatchEffectä¸å¯ä»¥ï¼›</li></ul><p>å®˜æ–¹æ–‡æ¡£ä¹Ÿæœ‰æŒ‡å‡ºï¼Œwatchç›¸å¯¹äºwatchEffectçš„ä¼˜ç‚¹ï¼š</p><blockquote><p>ä¸ watchEffect() ç›¸æ¯”ï¼Œwatch() ä½¿æˆ‘ä»¬å¯ä»¥ï¼š</p><ul><li>æ‡’æ‰§è¡Œå‰¯ä½œç”¨ï¼›</li><li>æ›´åŠ æ˜ç¡®æ˜¯åº”è¯¥ç”±å“ªä¸ªçŠ¶æ€è§¦å‘ä¾¦å¬å™¨é‡æ–°æ‰§è¡Œï¼›</li><li>å¯ä»¥è®¿é—®æ‰€ä¾¦å¬çŠ¶æ€çš„å‰ä¸€ä¸ªå€¼å’Œå½“å‰å€¼</li></ul></blockquote><p>ç»¼ä¸Šæ‰€è¿°ï¼Œä½¿ç”¨watchEffectè™½ç„¶æ¯”è¾ƒçœäº‹ï¼Œä½†å¦‚æœåŠŸèƒ½å¤æ‚å¾ˆå®¹æ˜“å‡ºç°é—®é¢˜ï¼Œçµæ´»æ€§ä¹Ÿä¸å¦‚watchã€‚æ¯”å¦‚ï¼Œåœ¨watchEffectå†…è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œä½†è¿™ä¸ªå‡½æ•°å†…è¯»å–äº†æŸä¸ªå“åº”å¼æ•°æ®ï¼Œå¯¼è‡´è¿™ä¸ªæ•°æ®è¢«æ„å¤–ç›‘å¬ã€‚æ‰€ä»¥ï¼Œæˆ‘æ¨è&#x3D;&#x3D;ä»»ä½•æƒ…å†µéƒ½ä½¿ç”¨<strong>watch</strong>&#x3D;&#x3D;ã€‚</p><h1 id="watchè¯¦è§£"><a href="#watchè¯¦è§£" class="headerlink" title="watchè¯¦è§£"></a>watchè¯¦è§£</h1><h2 id="ç¬¬ä¸€ä¸ªå‚æ•°ï¼šä¾¦å¬æº"><a href="#ç¬¬ä¸€ä¸ªå‚æ•°ï¼šä¾¦å¬æº" class="headerlink" title="ç¬¬ä¸€ä¸ªå‚æ•°ï¼šä¾¦å¬æº"></a>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šä¾¦å¬æº</h2><p>watchçš„ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šè¦ç›‘å¬å“ªäº›å“åº”å¼æ•°æ®ã€‚è¿™äº›æ•°æ®å¿…é¡»æ˜¯å“åº”å¼çš„ï¼Œä½†å¯ä»¥åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>ä¸€ä¸ªref</li><li>ä¸€ä¸ªå“åº”å¼å¯¹è±¡</li><li>ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ªå€¼</li><li>ç”±ä»¥ä¸Šç±»å‹çš„å€¼ç»„æˆçš„æ•°ç»„</li></ul><p>å½“ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å“åº”å¼å¯¹è±¡æ—¶ï¼Œé»˜è®¤å¼€å¯æ·±åº¦ç›‘å¬ã€‚<br>å½“ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°ä¼šç«‹å³æ‰§è¡Œã€‚<br>å½“ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯getterå‡½æ•°æ—¶ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š</p><ul><li>å¦‚æœè¯¥å‡½æ•°è¿”å›å“åº”å¼å¯¹è±¡ï¼Œå›è°ƒå‡½æ•°ä¸è§¦å‘ï¼›<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;);</span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> state,</span><br><span class="line">  <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(newValue === oldValue);</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li>å¦‚æœè¿”å›å“åº”å¼å¯¹è±¡çš„æŸä¸ªå±æ€§ï¼Œå›è°ƒå‡½æ•°è§¦å‘ï¼›<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;);</span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> state.<span class="property">count</span>,</span><br><span class="line">  <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(newValue === oldValue);</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li><li>å¦‚æœè¿”å›å“åº”å¼å¯¹è±¡ï¼Œä½†å¼€å¯<code>&#123;deep: true&#125;</code>ï¼Œå›è°ƒå‡½æ•°è§¦å‘ã€‚ä½†ï¼Œæ­¤æ—¶æ–°å€¼å’Œæ—§å€¼ç›¸åŒã€‚<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> state = <span class="title function_">reactive</span>(&#123; <span class="attr">count</span>: <span class="number">0</span> &#125;);</span><br><span class="line"><span class="title function_">watch</span>(</span><br><span class="line">  <span class="function">() =&gt;</span> state,</span><br><span class="line">  <span class="function">(<span class="params">newValue, oldValue</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(newValue === oldValue);</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">deep</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li></ul><h2 id="ç¬¬äºŒä¸ªå‚æ•°ï¼šå›è°ƒå‡½æ•°"><a href="#ç¬¬äºŒä¸ªå‚æ•°ï¼šå›è°ƒå‡½æ•°" class="headerlink" title="ç¬¬äºŒä¸ªå‚æ•°ï¼šå›è°ƒå‡½æ•°"></a>ç¬¬äºŒä¸ªå‚æ•°ï¼šå›è°ƒå‡½æ•°</h2><p>watchçš„ç¬¬äºŒä¸ªå‚æ•°ä¼šåœ¨ç›‘å¬çš„æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶è¢«è°ƒç”¨ã€‚å¦‚æœç›‘å¬çš„å¤šä¸ªæ•°æ®éƒ½å‘ç”Ÿå˜åŒ–ï¼Œåœ¨ä¸€ä¸ªäº‹ä»¶å¾ªç¯å‘¨æœŸå†…å›è°ƒåªæ‰§è¡Œä¸€æ¬¡ã€‚<br>è¯¥å›è°ƒå‡½æ•°æœ‰3ä¸ªå‚æ•°ï¼šæ–°å€¼ã€æ—§å€¼ã€ä¸€ä¸ªç”¨æ¥<strong>æ¸…ç†å‰¯ä½œç”¨</strong>çš„æ–¹æ³•ã€‚<br>å½“ç›‘å¬æ•°ç»„æ—¶ï¼Œæ–°å€¼å’Œæ—§å€¼ä¹Ÿéƒ½æ˜¯æ•°ç»„ï¼Œä¸ç›‘å¬æºä¸€ä¸€å¯¹åº”ã€‚</p><h3 id="å‰¯ä½œç”¨æ¸…ç†"><a href="#å‰¯ä½œç”¨æ¸…ç†" class="headerlink" title="å‰¯ä½œç”¨æ¸…ç†"></a>å‰¯ä½œç”¨æ¸…ç†</h3><p>å‰¯ä½œç”¨æ¸…ç†çš„ä½¿ç”¨åœºæ™¯ï¼šå¼‚æ­¥æœªè¿”å›æ—¶ï¼Œwatchçš„å›è°ƒå°±å†æ¬¡æ‰§è¡Œã€‚<br>ä½¿ç”¨æ–¹æ³•ï¼šæŠŠæ¸…ç†å‰¯ä½œç”¨çš„æ–¹æ³•ä¼ å…¥åˆ°<code>onCleanup</code>ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œ<code>cancel</code>å¹¶ä¸ä¼šé©¬ä¸Šæ‰§è¡Œï¼Œè€Œæ˜¯ä¸‹ä¸€æ¬¡æ‰§è¡Œwatchçš„å›è°ƒå‡½æ•°æ—¶æ‰§è¡Œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(id, <span class="title function_">async</span> (newId, oldId, onCleanup) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; response, cancel &#125; = <span class="title function_">doAsyncWork</span>(newId) <span class="comment">// !!!æ³¨æ„ï¼šæ²¡æœ‰await</span></span><br><span class="line">  <span class="title function_">onCleanup</span>(cancel)</span><br><span class="line">  data.<span class="property">value</span> = <span class="keyword">await</span> response</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>vue3.5+å¼•å…¥äº†onWatcherCleanupï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; onWatcherCleanup &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">watch</span>(id, <span class="title function_">async</span> (newId) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; response, cancel &#125; = <span class="title function_">doAsyncWork</span>(newId)</span><br><span class="line">  <span class="title function_">onWatcherCleanup</span>(cancel)</span><br><span class="line">  data.<span class="property">value</span> = <span class="keyword">await</span> response</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆï¼ŒonCleanupå’ŒonWatcherCleanupæœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ</p><ol><li>è¯­ä¹‰å‹å¥½ï¼ŒonWatcherCleanupæ˜ç¡®è¡¨ç¤ºè¿™ä¸ªæ–¹æ³•ä¸watchçš„æ¸…ç†æ“ä½œç›¸å…³ï¼›</li><li>onWatcherCleanupæ›´å¥½çš„å’Œvue3.5+çš„æ–°ç‰¹æ€§ç»“åˆï¼Œvue3.5+æ–°å¢äº†watché€‰é¡¹ã€ä¼˜åŒ–äº†watcherçš„ç®¡ç†æœºåˆ¶ï¼›</li><li>å‡ºç°é”™è¯¯æ—¶ï¼Œvueä¼šä¸ºonWatcherCleanupè¿”å›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼›</li></ol><p>&#x3D;&#x3D;æ€»ç»“ï¼šå¦‚æœä½ çš„vueç‰ˆæœ¬æ˜¯3.5+ï¼Œè¯·é€‰æ‹©onWatcherCleanupã€‚&#x3D;&#x3D;</p><h2 id="ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šé…ç½®å¯¹è±¡"><a href="#ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šé…ç½®å¯¹è±¡" class="headerlink" title="ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šé…ç½®å¯¹è±¡"></a>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šé…ç½®å¯¹è±¡</h2><p>ç¬¬ä¸‰ä¸ªå¯é€‰çš„å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ”¯æŒä»¥ä¸‹é€‰é¡¹ï¼š</p><ul><li>immediate: ç«‹å³è§¦å‘å›è°ƒï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æ—§å€¼æ˜¯<code>undefined</code>ï¼›</li><li>deep: å¦‚æœæºæ˜¯å¯¹è±¡ï¼Œè¿›è¡Œæ·±åº¦éå†ã€‚åœ¨3.5+ä¸­å¯ä»¥è®¾ç½®ä¸ºæœ€å¤§éå†æ·±åº¦çš„æ•°å­—ï¼›</li><li>once: å›è°ƒå‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ï¼›</li><li>flush: è®¾ç½®å›è°ƒå‡½æ•°çš„åˆ·æ–°æ—¶æœºï¼›</li><li>onTrack&#x2F;onTrigger: è°ƒè¯•ä¾¦å¬å™¨çš„ä¾èµ–ï¼›</li></ul><p>å‰3ä¸ªé€‰é¡¹æ¯”è¾ƒå¥½ç†è§£ä¹Ÿç»å¸¸ç”¨ï¼Œæ¥ä¸‹æ¥äº†è§£ä¸€ä¸‹åé¢2ä¸ªã€‚</p><h3 id="flush"><a href="#flush" class="headerlink" title="flush"></a>flush</h3><p>flushçš„å€¼æœ‰2ä¸ªï¼š<code>post</code>å’Œ<code>sync</code>ã€‚<br>é»˜è®¤æƒ…å†µä¸‹ï¼Œwatchçš„å›è°ƒå‡½æ•°ä¼šåœ¨çˆ¶ç»„ä»¶æ›´æ–°ä¹‹åã€æ‰€å±ç»„ä»¶çš„DOMæ›´æ–°<strong>ä¹‹å‰</strong>è¢«è°ƒç”¨ã€‚å½“ä½ åœ¨å›è°ƒå‡½æ•°ä¸­è®¿é—®æ‰€å±ç»„ä»¶çš„DOMæ—¶ï¼Œè·å–åˆ°çš„æ˜¯<strong>æ›´æ–°å‰çš„çŠ¶æ€</strong>ã€‚<br>å½“è®¾ç½®flushä¸ºpostæ—¶ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­è·å–åˆ°çš„DOMæ˜¯æ›´æ–°ä¹‹åçš„çŠ¶æ€ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå›è°ƒå‡½æ•°ä¼šè¢«æ‰¹é‡å¤„ç†ï¼Œä¸€ä¸ªäº‹ä»¶å¾ªç¯å†…åªæ‰§è¡Œä¸€æ¬¡ã€‚<br>å½“è®¾ç½®flushä¸ºsyncæ—¶ï¼Œç›‘å¬çš„æ•°æ®å˜åŒ–æ—¶å°±é©¬ä¸Šè§¦å‘å›è°ƒå‡½æ•°ã€‚æ‰€ä»¥è¦æ…é‡ä½¿ç”¨ï¼Œå¯ä»¥ç›‘å¬å¸ƒå°”å€¼ï¼Œé¿å…ç›‘å¬å¯èƒ½å¤šæ¬¡åŒæ­¥ä¿®æ”¹çš„æ•°æ®æºã€‚</p><h3 id="onTrack-onTrigger"><a href="#onTrack-onTrigger" class="headerlink" title="onTrack&#x2F;onTrigger"></a>onTrack&#x2F;onTrigger</h3><p>æ³¨æ„ï¼šè¿™ä¸¤ä¸ªæ–¹æ³•ä»…åœ¨å¼€å‘æ¨¡å¼ä¸‹ç”Ÿæ•ˆã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">watch</span>(source, callback, &#123;</span><br><span class="line">  <span class="title function_">onTrack</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">debugger</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onTrigger</span>(<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">debugger</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>onTrackåœ¨å“åº”å¼æ•°æ®è¢«è¿½è¸ªæ—¶è°ƒç”¨ï¼ŒonTriggeråœ¨å“åº”å¼æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶è¢«è°ƒç”¨ã€‚<br>å¯ä»¥ç”¨è¿™2ä¸ªæ–¹æ³•åœ¨å¼€å‘ç¯å¢ƒè¿›è¡Œè°ƒè¯•ã€‚</p><h2 id="è¿”å›å€¼ï¼šä¸€ä¸ªåœæ­¢ç›‘å¬çš„å‡½æ•°"><a href="#è¿”å›å€¼ï¼šä¸€ä¸ªåœæ­¢ç›‘å¬çš„å‡½æ•°" class="headerlink" title="è¿”å›å€¼ï¼šä¸€ä¸ªåœæ­¢ç›‘å¬çš„å‡½æ•°"></a>è¿”å›å€¼ï¼šä¸€ä¸ªåœæ­¢ç›‘å¬çš„å‡½æ•°</h2><p>watchçš„è¿”å›å€¼å¯ä»¥ç”¨æ¥åœæ­¢ã€æš‚åœã€æ¢å¤ç›‘å¬ï¼Œç±»å‹å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">interface <span class="title class_">WatchHandle</span> &#123;</span><br><span class="line">  (): <span class="keyword">void</span> <span class="comment">// å¯è°ƒç”¨ï¼Œä¸ `stop` ç›¸åŒ</span></span><br><span class="line">  <span class="attr">pause</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span></span><br><span class="line">  <span class="attr">resume</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span></span><br><span class="line">  <span class="attr">stop</span>: <span class="function">() =&gt;</span> <span class="keyword">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨åœºæ™¯ï¼šåœ¨ç»„ä»¶é”€æ¯æ—¶ï¼Œæˆ–è¾¾åˆ°æŸä¸ªæ¡ä»¶æ—¶ï¼Œåœæ­¢ç›‘å¬ã€‚</p><h1 id="watchæºç è§£æ"><a href="#watchæºç è§£æ" class="headerlink" title="watchæºç è§£æ"></a>watchæºç è§£æ</h1><p>é¦–å…ˆè§£é‡Šå‡ ä¸ªåè¯ï¼Œå‡è®¾ç›‘å¬æºæ˜¯sourceï¼Œç›‘å¬çš„å›è°ƒå‡½æ•°æ˜¯cbï¼Œ</p><ul><li><strong>traverse</strong>: ä¸€ä¸ªæ·±åº¦ä¼˜å…ˆéå†å¯¹è±¡çš„æ–¹æ³•ã€‚å½“sourceæ˜¯<strong>å“åº”å¼å¯¹è±¡</strong>æ—¶ï¼Œç”¨traverseéå†sourceï¼Œé‚£ä¹ˆå“åº”å¼å¯¹è±¡çš„æ¯ä¸€ä¸ªå±æ€§éƒ½æ‰§è¡Œäº†<strong>è¯»å–æ“ä½œ</strong>ï¼Œæ‰€ä»¥å½“å“åº”å¼å¯¹è±¡ä»»ä¸€å±æ€§å‘ç”Ÿå˜åŒ–æ—¶éƒ½èƒ½è§¦å‘å›è°ƒå‡½æ•°çš„æ‰§è¡Œã€‚</li><li><strong>getter</strong>: ä¸€ä¸ªè·å–sourceçš„å‡½æ•°ã€‚æ ¹æ®sourceçš„ç±»å‹ï¼Œå¯¹sourceè¿›è¡Œè¯»å–æ“ä½œï¼Œä½¿sourceçš„å˜åŒ–èƒ½è¢«ç›‘å¬ã€‚</li><li><strong>effect</strong>: å‰¯ä½œç”¨å‡½æ•°ã€‚ å½“å“åº”å¼å¯¹è±¡æŸä¸ªå±æ€§çš„å€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéœ€è¦é‡æ–°æ‰§è¡Œçš„å‡½æ•°ã€‚</li><li><strong>onWatcherCleanup</strong>: ä¸€ä¸ªæ³¨å†Œæ¸…ç†å‰¯ä½œç”¨çš„å‡½æ•°ï¼Œæ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œæ¯”å¦‚æŠŠä¸€ä¸ªæ¸…é™¤å®šæ—¶å™¨çš„å‡½æ•°ä¼ ç»™å®ƒã€‚æ³¨æ„è¿™ä¸ªå‰¯ä½œç”¨ä¸æ˜¯æŒ‡effectï¼Œè€Œæ˜¯æŒ‡å®šæ—¶å™¨ã€å¼‚æ­¥ç­‰ï¼Œå®ƒä»¬ä¼šå½±å“ä¸‹ä¸€æ¬¡cbçš„æ‰§è¡Œã€‚</li><li><strong>boundCleanup</strong>: æ˜¯onWatcherCleanupçš„ç»‘å®šç‰ˆæœ¬ï¼ŒæŠŠeffectä¼ ç»™onWatcherCleanupã€‚</li><li><strong>cleanup</strong>: æ‰§è¡Œä¼ ç»™onWatcherCleanupçš„é‚£äº›æ¸…ç†å‰¯ä½œç”¨çš„å‡½æ•°ã€‚</li><li><strong>ReactiveEffect</strong>: ä¸€ä¸ªç±»ï¼Œå®ƒçš„å®ä¾‹æ˜¯effectï¼Œå®ƒå…·æœ‰çš„å±æ€§å’Œæ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼Œ<ul><li>active: å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå‰¯ä½œç”¨å‡½æ•°æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œsourceå˜åŒ–æ—¶ï¼Œå½“activeæ˜¯trueï¼Œcbæ‰é‡æ–°æ‰§è¡Œï¼›</li><li>deps: æ•°ç»„ï¼ŒåŒ…å«å‰¯ä½œç”¨å‡½æ•°çš„ä¾èµ–é¡¹ï¼›</li><li>fn: å‰¯ä½œç”¨å‡½æ•°æœ¬èº«ï¼›</li><li>scheduler: ä¸€ä¸ªè°ƒåº¦å™¨å‡½æ•°ï¼Œæ§åˆ¶å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œæ—¶æœºï¼›</li><li>scope: å‰¯ä½œç”¨å‡½æ•°çš„ä½œç”¨åŸŸï¼›</li><li>run: ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºæ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ï¼›</li><li>stop: ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåœæ­¢å‰¯ä½œç”¨å‡½æ•°ï¼›</li><li>pause: ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºæš‚åœå‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œï¼›</li><li>resume: ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºæ¢å¤å‰¯ä½œç”¨å‡½æ•°çš„æ‰§è¡Œï¼›</li><li>onStop: ä¸€ä¸ªæ–¹æ³•ï¼Œstopè¢«è°ƒç”¨æ—¶æ‰§è¡Œï¼›</li></ul></li></ul><p>å®Œæ•´æºç ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">function</span> <span class="title function_">watch</span>(<span class="params">source, cb, options</span>) &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * immediate: æ˜¯å¦ç«‹å³æ‰§è¡Œå›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="comment">   * deep: æ˜¯å¦æ·±åº¦ç›‘å¬</span></span><br><span class="line"><span class="comment">   * once: æ˜¯å¦åªç›‘å¬ä¸€æ¬¡</span></span><br><span class="line"><span class="comment">   * scheduler: è°ƒåº¦å™¨ï¼Œç”¨äºæ§åˆ¶å›è°ƒå‡½æ•°çš„æ‰§è¡Œæ—¶æœº</span></span><br><span class="line"><span class="comment">   * augmentJob: å¯¹jobå‡½æ•°è¿›è¡Œå¢å¼ºï¼Œå³æ‰§è¡Œjobå‡½æ•°æ—¶åšäº›é¢å¤–æ“ä½œ</span></span><br><span class="line"><span class="comment">   * call: ä¼ å…¥ä¸€ä¸ªæ–¹æ³•ï¼Œå¤„ç†æ–¹æ³•æ‰§è¡Œä¸­å‡ºç°çš„å¼‚å¸¸ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦è¢«è°ƒç”¨çš„å‡½æ•°fnï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºfnçš„ç±»å‹ï¼Œ</span></span><br><span class="line"><span class="comment">   *       ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¼ é€’ç»™fnçš„å‚æ•°</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">const</span> &#123; immediate, deep, once, scheduler, augmentJob, call &#125; = options;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ®deepé…ç½®å’ŒisShallow(source)ç¡®å®šå¦‚ä½•è¯»å–source</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">reactiveGetter</span> = (<span class="params">source</span>) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (deep) <span class="keyword">return</span> source</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">isShallow</span>(source) || deep === <span class="literal">false</span> || deep === <span class="number">0</span>)</span><br><span class="line">      <span class="keyword">return</span> <span class="title function_">traverse</span>(source, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">traverse</span>(source)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> effect; <span class="comment">// å‰¯ä½œç”¨å‡½æ•°å®ä¾‹</span></span><br><span class="line">  <span class="keyword">let</span> getter; <span class="comment">// è¯»å–æ•°æ®</span></span><br><span class="line">  <span class="keyword">let</span> cleanup;</span><br><span class="line">  <span class="keyword">let</span> boundCleanup;</span><br><span class="line">  <span class="comment">// å½“æ•°æ®æºæ˜¯(æˆ–åŒ…å«)å“åº”å¼å¯¹è±¡æ—¶ï¼Œç”±äºå¼•ç”¨ç±»å‹çš„ç‰¹æ€§ï¼Œæ–°æ—§å¯¹è±¡ç›¸åŒï¼Œæ— æ³•ç¡®å®šæ˜¯å¦å‘ç”Ÿäº†æ”¹å˜ï¼Œæ‰€ä»¥éœ€è¦å¼ºåˆ¶è§¦å‘å›è°ƒå‡½æ•°çš„è°ƒç”¨</span></span><br><span class="line">  <span class="keyword">let</span> forceTrigger = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">let</span> isMultiSource = <span class="literal">false</span>; <span class="comment">// æ˜¯å¦ç›‘å¬å¤šä¸ªæ•°æ®æº</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isRef</span>(source)) &#123;</span><br><span class="line">    getter = <span class="function">() =&gt;</span> source.<span class="property">value</span></span><br><span class="line">    forceTrigger = <span class="title function_">isShallow</span>(source)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isReactive</span>(source)) &#123;</span><br><span class="line">    getter = <span class="function">() =&gt;</span> <span class="title function_">reactiveGetter</span>(source)</span><br><span class="line">    forceTrigger = <span class="literal">true</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isArray</span>(source)) &#123;</span><br><span class="line">    isMultiSource = <span class="literal">true</span></span><br><span class="line">    forceTrigger = source.<span class="title function_">some</span>(<span class="function"><span class="params">s</span> =&gt;</span> <span class="title function_">isReactive</span>(s) || <span class="title function_">isShallow</span>(s))</span><br><span class="line">    getter = <span class="function">() =&gt;</span></span><br><span class="line">      source.<span class="title function_">map</span>(<span class="function"><span class="params">s</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_">isRef</span>(s)) &#123;</span><br><span class="line">          <span class="keyword">return</span> s.<span class="property">value</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isReactive</span>(s)) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="title function_">reactiveGetter</span>(s)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isFunction</span>(s)) &#123;</span><br><span class="line">          <span class="keyword">return</span> call ? <span class="title function_">call</span>(s, <span class="title class_">WatchErrorCodes</span>.<span class="property">WATCH_GETTER</span>) : <span class="title function_">s</span>()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// warnInvalidSource æ‰“å°è­¦å‘Šä¿¡æ¯</span></span><br><span class="line">          __DEV__ &amp;&amp; <span class="title function_">warnInvalidSource</span>(s)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_">isFunction</span>(source)) &#123;</span><br><span class="line">    <span class="comment">// å½“sourceæ˜¯å‡½æ•°æ—¶ï¼Œcbå¯ä»¥ä¸ä¼ ï¼Œsourceä½œä¸ºcbï¼Œç›¸å½“äºwatchEffect</span></span><br><span class="line">    <span class="keyword">if</span> (cb) &#123;</span><br><span class="line">      getter = call</span><br><span class="line">        ? <span class="function">() =&gt;</span> <span class="title function_">call</span>(source, <span class="title class_">WatchErrorCodes</span>.<span class="property">WATCH_GETTER</span>)</span><br><span class="line">        : source</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      getter = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// å½“sourceä½œä¸ºcbæ—¶ï¼Œsource å‡½æ•°å¯èƒ½ä¼šåˆ›å»ºä¸€äº›éœ€è¦åœ¨å‡½æ•°æ‰§è¡Œç»“æŸåæ¸…ç†çš„èµ„æºï¼Œä¾‹å¦‚å®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬å™¨ç­‰ï¼Œ</span></span><br><span class="line">        <span class="comment">// å› æ­¤ï¼Œè¿™ç§æƒ…å†µéœ€è¦è°ƒç”¨cleanupæ¸…é™¤ä¹‹å‰çš„å‰¯ä½œç”¨ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (cleanup) &#123;</span><br><span class="line">          <span class="comment">// åœ¨æ¸…ç†å‰¯ä½œç”¨æ—¶ï¼Œéœ€è¦æš‚åœä¾èµ–æ”¶é›†ï¼Œä»¥é¿å…åœ¨æ¸…ç†è¿‡ç¨‹ä¸­è§¦å‘ä¸å¿…è¦çš„å‰¯ä½œç”¨ã€‚</span></span><br><span class="line">          <span class="title function_">pauseTracking</span>()</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="title function_">cleanup</span>()</span><br><span class="line">          &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="title function_">resetTracking</span>()</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// activeWatcherï¼švueéœ€è¦çŸ¥é“å“åº”å¼æ•°æ®æ˜¯è¢«å“ªä¸ªwatcherè®¿é—®çš„ï¼Œä»¥ä¾¿è¿™äº›æ•°æ®å˜åŒ–æ—¶é€šçŸ¥å¯¹åº”watcher</span></span><br><span class="line">        <span class="comment">// åœ¨å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œå‰ï¼Œæš‚å­˜åŸæ¥çš„activeWatcherï¼Œå¹¶å°†å½“å‰å‰¯ä½œç”¨effectèµ‹å€¼ç»™activeWatcher</span></span><br><span class="line">        <span class="keyword">const</span> currentEffect = activeWatcher</span><br><span class="line">        activeWatcher = effect</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> call</span><br><span class="line">            ? <span class="title function_">call</span>(source, <span class="title class_">WatchErrorCodes</span>.<span class="property">WATCH_CALLBACK</span>, [boundCleanup])</span><br><span class="line">            : <span class="title function_">source</span>(boundCleanup)</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          <span class="comment">// åœ¨å‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œç»“æŸåï¼Œæ¢å¤åŸæ¥çš„activeWatcher</span></span><br><span class="line">          activeWatcher = currentEffect</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    getter = <span class="variable constant_">NOOP</span> <span class="comment">// NOOPæ˜¯ä¸€ä¸ªç©ºå‡½æ•°</span></span><br><span class="line">    __DEV__ &amp;&amp; <span class="title function_">warnInvalidSource</span>(source)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†deepé€‰é¡¹</span></span><br><span class="line">  <span class="keyword">if</span> (cb &amp;&amp; deep) &#123;</span><br><span class="line">    <span class="keyword">const</span> baseGetter = getter</span><br><span class="line">    <span class="keyword">const</span> depth = deep === <span class="literal">true</span> ? <span class="title class_">Infinity</span> : deep</span><br><span class="line">    getter = <span class="function">() =&gt;</span> <span class="title function_">traverse</span>(<span class="title function_">baseGetter</span>(), depth)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// scopeï¼šå½“å‰ä½œç”¨åŸŸ</span></span><br><span class="line">  <span class="keyword">const</span> scope = <span class="title function_">getCurrentScope</span>()</span><br><span class="line">  <span class="comment">// watchHandleæ˜¯watchçš„è¿”å›å€¼ï¼Œå¯ä»¥æš‚åœã€æ¢å¤ã€åœæ­¢ç›‘å¬ï¼Œç›´æ¥è°ƒç”¨å°±æ˜¯åœæ­¢ç›‘å¬</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">watchHandle</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">    effect.<span class="title function_">stop</span>()</span><br><span class="line">    <span class="keyword">if</span> (scope &amp;&amp; scope.<span class="property">active</span>) &#123;</span><br><span class="line">      <span class="title function_">remove</span>(scope.<span class="property">effects</span>, effect)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¤„ç†onceé€‰é¡¹</span></span><br><span class="line">  <span class="keyword">if</span> (once &amp;&amp; cb) &#123;</span><br><span class="line">    <span class="keyword">const</span> _cb = cb</span><br><span class="line">    cb = <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title function_">_cb</span>(...args)</span><br><span class="line">      <span class="title function_">watchHandle</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// INITIAL_WATCHER_VALUE æ˜¯&#123;&#125;</span></span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–æ—§å€¼</span></span><br><span class="line">  <span class="keyword">let</span> oldValue = isMultiSource</span><br><span class="line">    ? <span class="keyword">new</span> <span class="title class_">Array</span>(source.<span class="property">length</span>).<span class="title function_">fill</span>(<span class="variable constant_">INITIAL_WATCHER_VALUE</span>)</span><br><span class="line">    : <span class="variable constant_">INITIAL_WATCHER_VALUE</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// jobçš„ä½œç”¨æ˜¯åœ¨æ•°æ®æºå‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œå¹¶æ›´æ–°æ—§å€¼ã€‚</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">job</span> = (<span class="params">immediateFirstRun</span>) =&gt; &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœeffectæ²¡æœ‰å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œæˆ–è€…effectçš„dirtyæ ‡å¿—ä½ä¸ºfalseä¸”immediateFirstRunä¸ºfalseï¼Œåˆ™ç›´æ¥è¿”å›ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      !(effect.<span class="property">flags</span> &amp; <span class="title class_">EffectFlags</span>.<span class="property">ACTIVE</span>) ||</span><br><span class="line">      (!effect.<span class="property">dirty</span> &amp;&amp; !immediateFirstRun)</span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (cb) &#123;</span><br><span class="line">      <span class="keyword">const</span> newValue = effect.<span class="title function_">run</span>()</span><br><span class="line">      <span class="comment">// å¦‚æœdeepé€‰é¡¹ä¸ºtrueï¼Œæˆ–è€…éœ€è¦å¼ºåˆ¶è§¦å‘å›è°ƒï¼Œæˆ–è€…æ–°å€¼å’Œæ—§å€¼ä¸ç›¸ç­‰ï¼Œåˆ™æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚</span></span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        deep ||</span><br><span class="line">        forceTrigger ||</span><br><span class="line">        (isMultiSource</span><br><span class="line">          ? newValue.<span class="title function_">some</span>(<span class="function">(<span class="params">v, i</span>) =&gt;</span> <span class="title function_">hasChanged</span>(v, oldValue[i]))</span><br><span class="line">          : <span class="title function_">hasChanged</span>(newValue, oldValue))</span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cleanup) &#123;</span><br><span class="line">          <span class="title function_">cleanup</span>()</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">const</span> currentWatcher = activeWatcher</span><br><span class="line">        activeWatcher = effect</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">// watchçš„ç¬¬äºŒä¸ªå‚æ•°cbï¼Œcbæ¥å—3ä¸ªå‚æ•°ï¼šæ–°å€¼ã€æ—§å€¼ã€ç”¨æ¥æ¸…ç†å‰¯ä½œç”¨çš„cleanupå‡½æ•°</span></span><br><span class="line">          <span class="keyword">const</span> args = [</span><br><span class="line">            newValue,</span><br><span class="line">            oldValue === <span class="variable constant_">INITIAL_WATCHER_VALUE</span></span><br><span class="line">              ? <span class="literal">undefined</span></span><br><span class="line">              : isMultiSource &amp;&amp; oldValue[<span class="number">0</span>] === <span class="variable constant_">INITIAL_WATCHER_VALUE</span></span><br><span class="line">                ? []</span><br><span class="line">                : oldValue,</span><br><span class="line">            boundCleanup,</span><br><span class="line">          ]</span><br><span class="line">          call</span><br><span class="line">            ? <span class="title function_">call</span>(cb, <span class="title class_">WatchErrorCodes</span>.<span class="property">WATCH_CALLBACK</span>, args)</span><br><span class="line">            :</span><br><span class="line">            <span class="title function_">cb</span>(...args)</span><br><span class="line">          oldValue = newValue</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">          activeWatcher = currentWatcher</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// æ‰§è¡Œsourceå‡½æ•°</span></span><br><span class="line">      effect.<span class="title function_">run</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœç”¨æˆ·è‡ªå®šä¹‰äº†augmentJobå‡½æ•°ï¼Œåˆ™è°ƒç”¨è¯¥å‡½æ•°å¯¹jobè¿›è¡Œå¢å¼ºã€‚</span></span><br><span class="line">  <span class="keyword">if</span> (augmentJob) &#123;</span><br><span class="line">    <span class="title function_">augmentJob</span>(job)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  effect = <span class="keyword">new</span> <span class="title class_">ReactiveEffect</span>(getter)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœç”¨æˆ·è‡ªå®šä¹‰äº†schedulerå‡½æ•°ï¼Œåˆ™å°†è¯¥å‡½æ•°ä½œä¸ºeffectçš„è°ƒåº¦å™¨</span></span><br><span class="line">  effect.<span class="property">scheduler</span> = scheduler</span><br><span class="line">    ? <span class="function">() =&gt;</span> <span class="title function_">scheduler</span>(job, <span class="literal">false</span>)</span><br><span class="line">    : job</span><br><span class="line"></span><br><span class="line">  <span class="comment">// boundCleanupæ˜¯å¯¹onWatcherCleanupçš„åŒ…è£¹</span></span><br><span class="line">  boundCleanup = <span class="function"><span class="params">fn</span> =&gt;</span> <span class="title function_">onWatcherCleanup</span>(fn, <span class="literal">false</span>, effect)</span><br><span class="line"></span><br><span class="line">  cleanup = effect.<span class="property">onStop</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> cleanups = cleanupMap.<span class="title function_">get</span>(effect)</span><br><span class="line">    <span class="keyword">if</span> (cleanups) &#123;</span><br><span class="line">      <span class="keyword">if</span> (call) &#123;</span><br><span class="line">        <span class="title function_">call</span>(cleanups, <span class="title class_">WatchErrorCodes</span>.<span class="property">WATCH_CLEANUP</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> cleanup <span class="keyword">of</span> cleanups) <span class="title function_">cleanup</span>()</span><br><span class="line">      &#125;</span><br><span class="line">      cleanupMap.<span class="title function_">delete</span>(effect)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (__DEV__) &#123;</span><br><span class="line">    effect.<span class="property">onTrack</span> = options.<span class="property">onTrack</span></span><br><span class="line">    effect.<span class="property">onTrigger</span> = options.<span class="property">onTrigger</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (cb) &#123;</span><br><span class="line">    <span class="keyword">if</span> (immediate) &#123;</span><br><span class="line">      <span class="title function_">job</span>(<span class="literal">true</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// æ‰§è¡Œsourceå‡½æ•°ï¼Œå¹¶æ›´æ–°æ—§å€¼</span></span><br><span class="line">      oldValue = effect.<span class="title function_">run</span>()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (scheduler) &#123;</span><br><span class="line">    <span class="title function_">scheduler</span>(job.<span class="title function_">bind</span>(<span class="literal">null</span>, <span class="literal">true</span>), <span class="literal">true</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    effect.<span class="title function_">run</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  watchHandle.<span class="property">pause</span> = effect.<span class="property">pause</span>.<span class="title function_">bind</span>(effect)</span><br><span class="line">  watchHandle.<span class="property">resume</span> = effect.<span class="property">resume</span>.<span class="title function_">bind</span>(effect)</span><br><span class="line">  watchHandle.<span class="property">stop</span> = watchHandle</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> watchHandle</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æºç  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
            <tag> watch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>npm error-could not determine executable to run</title>
      <link href="/2024/10/10/could-not-determine-executable-to-run/"/>
      <url>/2024/10/10/could-not-determine-executable-to-run/</url>
      
        <content type="html"><![CDATA[<h1 id="é‡è§é—®é¢˜"><a href="#é‡è§é—®é¢˜" class="headerlink" title="é‡è§é—®é¢˜"></a>é‡è§é—®é¢˜</h1><p>åœ¨ç”¨æˆ‘è‡ªå·±çš„è„šæ‰‹æ¶åˆ›å»ºé¡¹ç›®æ—¶ï¼Œé‡åˆ°äº†ä¸€ä¸ªæŠ¥é”™ï¼Œä½†åˆ«äººåŒæ ·çš„æ“ä½œæ²¡æœ‰æŠ¥é”™ã€‚<br><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/image.png" alt="æŠ¥é”™ä¿¡æ¯"><br>ç„¶åæ‰“å¼€.logæ–‡ä»¶ï¼Œçœ‹åˆ°äº†æ›´è¯¦ç»†ä¸€ç‚¹çš„æŠ¥é”™ä¿¡æ¯ã€‚<br><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/image%20(1).png" alt="æŠ¥é”™2"></p><h1 id="åˆ†æé—®é¢˜"><a href="#åˆ†æé—®é¢˜" class="headerlink" title="åˆ†æé—®é¢˜"></a>åˆ†æé—®é¢˜</h1><p>æœç´¢<code>Error: could not determine executable to run</code>å’Œ<code>getBinFromManifest</code>å‘ç°ï¼Œå¹¶æ²¡æœ‰æ˜ç¡®çš„åŸå› ï¼Œå¾ˆå¤šäººè§£å†³çš„æ–¹æ³•<a href="https://stackoverflow.com/questions/67833794/npm-err-could-not-determine-executable-to-run">ï¼ˆè§£å†³æ–¹æ¡ˆé›†åˆï¼‰</a>éƒ½å®Œå…¨ä¸ä¸€æ ·ã€‚æˆ‘ä¸€ä¸€éƒ½è¯•äº†ä¹Ÿä¸è¡Œã€‚<br>ç„¶åå†çœ‹æŠ¥é”™ä¿¡æ¯çš„åé¢å‡ è¡Œï¼Œå‘ç°äº†æœ‰ä»€ä¹ˆåœ°æ–¹ä¸å¯¹åŠ²ï¼Œ<br><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/image%20(2).png" alt="æŠ¥é”™3"><br>æˆ‘è¦ä½¿ç”¨çš„<code>create-pro</code>çš„ç‰ˆæœ¬æ ¹æœ¬ä¸æ˜¯0.0.0ï¼Œè€Œæ‰“å¼€ç¬¬14è¡Œçš„é“¾æ¥ï¼Œè¿™ä¸ªnpmåŒ…ä¹Ÿä¸æ˜¯æˆ‘è¦ç”¨çš„é‚£ä¸ªã€‚æˆ‘çš„åº“æ˜¯æ”¾åœ¨æŸä¸ªscopeä¸‹çš„ï¼Œè¿™ä¸ªé“¾æ¥æŒ‡å‘çš„åŒ…ä¸æˆ‘çš„åŒ…åŒåï¼Œä½†ä¸åœ¨scopeå†…ã€‚<br>ä½†æ˜¯æˆ‘è¦ç”¨çš„åº“å·²ç»å…¨å±€å®‰è£…è¿‡äº†ï¼Œä¸æ˜ç™½ä¸ºä»€ä¹ˆnpmæ‹‰é”™äº†åŒ…ã€‚</p><h1 id="è§£å†³é—®é¢˜"><a href="#è§£å†³é—®é¢˜" class="headerlink" title="è§£å†³é—®é¢˜"></a>è§£å†³é—®é¢˜</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># npm create pro // åŸå‘½ä»¤</span></span><br><span class="line">npm create @chen/pro // âˆš</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>é‡åˆ°è¿™ä¸ªæŠ¥é”™çš„æ—¶å€™ï¼Œå¦‚æœä¹Ÿæ˜¯ä½¿ç”¨è„šæ‰‹æ¶ï¼Œå¯ä»¥çœ‹çœ‹åŒ…æ˜¯å¦åœ¨scopeå†…ã€‚ä¸ç„¶ï¼Œå¯ä»¥å…ˆçœ‹çœ‹å‘½ä»¤æœ‰æ²¡æœ‰è¯­æ³•é”™è¯¯ï¼Œç„¶åè¯•è¯•é‡å¯vscodeã€é‡æ–°å®‰è£…ä¾èµ–ã€èµ‹äºˆå½“å‰ç”¨æˆ·å¯¹nodeå®Œå…¨æ§åˆ¶çš„æƒé™ç­‰æ–¹æ³•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> npm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ› å¦‚ä½•ä½¿ç”¨CICDå®ç°è‡ªåŠ¨åŒ–éƒ¨ç½²</title>
      <link href="/2024/10/08/use-cicd-auto-deploy/"/>
      <url>/2024/10/08/use-cicd-auto-deploy/</url>
      
        <content type="html"><![CDATA[<h1 id="CICD"><a href="#CICD" class="headerlink" title="CICD"></a>CICD</h1><p>CICD æ˜¯â€œæŒç»­é›†æˆâ€ï¼ˆContinuous Integrationï¼‰å’Œâ€œæŒç»­äº¤ä»˜&#x2F;éƒ¨ç½²â€ï¼ˆContinuous Delivery&#x2F;Deploymentï¼‰çš„ç¼©å†™ã€‚å®ƒæ˜¯ä¸€ç§è½¯ä»¶å¼€å‘å®è·µï¼Œæ—¨åœ¨é€šè¿‡è‡ªåŠ¨åŒ–å·¥å…·å’Œæµç¨‹æé«˜è½¯ä»¶å¼€å‘çš„è´¨é‡å’Œæ•ˆç‡ã€‚</p><p>æŒç»­é›†æˆè¦æ±‚å¼€å‘äººå‘˜é¢‘ç¹åœ°å°†ä»£ç æäº¤åˆ°å…±äº«çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ã€‚</p><p>æŒç»­é›†æˆçš„æµç¨‹ï¼š</p><ol><li>å¼€å‘äººå‘˜æäº¤ä»£ç åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå¦‚ Gitï¼‰ã€‚</li><li>è‡ªåŠ¨åŒ–æ„å»ºç³»ç»Ÿè‡ªåŠ¨æ‹‰å–æœ€æ–°çš„ä»£ç ã€‚&#x20;</li><li>æ‰§è¡Œè‡ªåŠ¨åŒ–æ„å»ºå’Œæµ‹è¯•ã€‚&#x20;</li><li>å‘ç°å¹¶æŠ¥å‘Šé”™è¯¯æˆ–å¤±è´¥çš„æµ‹è¯•ã€‚</li></ol><p>æŒç»­äº¤ä»˜æ˜¯åœ¨æŒç»­é›†æˆçš„åŸºç¡€ä¸Šè¿›ä¸€æ­¥æ‰©å±•ï¼Œç¡®ä¿æ¯æ¬¡æäº¤çš„ä»£ç éƒ½å¯ä»¥éšæ—¶éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚</p><p>æŒç»­äº¤ä»˜çš„æµç¨‹ï¼š</p><ol><li>è‡ªåŠ¨åŒ–æ„å»ºå’Œæµ‹è¯•ã€‚</li><li>è‡ªåŠ¨åŒ–éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒã€‚</li><li>æ‰‹åŠ¨æˆ–è‡ªåŠ¨åŒ–éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚</li></ol><p>æŒç»­éƒ¨ç½²æ˜¯åœ¨æŒç»­äº¤ä»˜çš„åŸºç¡€ä¸Šè¿›ä¸€æ­¥æ‰©å±•ï¼Œè‡ªåŠ¨å°†é€šè¿‡æµ‹è¯•çš„ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚</p><p>æŒç»­éƒ¨ç½²çš„æµç¨‹ï¼š</p><ol><li>è‡ªåŠ¨åŒ–æ„å»ºå’Œæµ‹è¯•ã€‚</li><li>è‡ªåŠ¨åŒ–éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒã€‚&#x20;</li><li>è‡ªåŠ¨åŒ–éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚</li></ol><h1 id="Github-Actions"><a href="#Github-Actions" class="headerlink" title="Github Actions"></a>Github Actions</h1><p>GitHub Actions æ˜¯ GitHub æä¾›çš„ä¸€ç§å¼ºå¤§çš„è‡ªåŠ¨åŒ–å·¥å…·ï¼Œç”¨äºè‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ä»£ç ã€‚å®ƒå…è®¸ä½ åœ¨ GitHub ä»“åº“ä¸­ç›´æ¥ç¼–å†™å’Œè¿è¡Œå·¥ä½œæµï¼ˆworkflowsï¼‰ï¼Œä»è€Œå®ç°æŒç»­é›†æˆï¼ˆCIï¼‰å’ŒæŒç»­éƒ¨ç½²ï¼ˆCDï¼‰ã€‚</p><p>Workflowï¼šä¸€ä¸ªå·¥ä½œæµï¼ˆworkflowï¼‰æ˜¯ç”±ä¸€ç³»åˆ—æ­¥éª¤ï¼ˆstepsï¼‰ç»„æˆçš„ YAML æ–‡ä»¶ï¼Œç”¨äºå®šä¹‰è‡ªåŠ¨åŒ–ä»»åŠ¡ã€‚</p><p>Jobï¼šä¸€ä¸ªå·¥ä½œæµå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªä½œä¸šï¼ˆjobï¼‰ï¼Œæ¯ä¸ªä½œä¸šåœ¨ä¸åŒçš„è™šæ‹Ÿç¯å¢ƒä¸­è¿è¡Œã€‚</p><p>Stepï¼šæ¯ä¸ªä½œä¸šç”±ä¸€ç³»åˆ—æ­¥éª¤ï¼ˆstepï¼‰ç»„æˆï¼Œæ¯ä¸ªæ­¥éª¤å¯ä»¥æ‰§è¡Œ shell å‘½ä»¤ã€è¿è¡Œè„šæœ¬æˆ–ä½¿ç”¨é¢„å®šä¹‰çš„åŠ¨ä½œï¼ˆactionï¼‰ã€‚</p><p>Actionï¼šåŠ¨ä½œï¼ˆactionï¼‰æ˜¯ GitHub Actions ä¸­çš„åŸºæœ¬æ„å»ºå—ï¼Œå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„è„šæœ¬ã€å®¹å™¨æˆ–é¢„å®šä¹‰çš„ç¤¾åŒºåŠ¨ä½œã€‚</p><p>å·¥ä½œæµçš„è§¦å‘æ–¹å¼æœ‰å¾ˆå¤šï¼Œä¸€èˆ¬ä½¿ç”¨<strong>push</strong>ã€‚</p><p>å¸¸ç”¨åŠ¨ä½œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- name: Checkout Repository</span><br><span class="line">  uses: actions/checkout@v3 # æ£€å‡ºä»“åº“ä¸­çš„ä»£ç </span><br><span class="line"></span><br><span class="line">- name: Setup Node.js</span><br><span class="line">  uses: actions/setup-node@v3 # è®¾ç½®nodeç¯å¢ƒ</span><br><span class="line">  with:</span><br><span class="line">    node-version: 16</span><br><span class="line"></span><br><span class="line">- name: Install Dependencies</span><br><span class="line">  run: npm install # è¿è¡Œshellè„šæœ¬æˆ–å‘½ä»¤</span><br><span class="line"></span><br><span class="line">env: # å®šä¹‰ç¯å¢ƒå˜é‡</span><br><span class="line">  NODE_ENV: production</span><br><span class="line">  DATABASE_URL: $&#123;&#123; secrets.DATABASE_URL &#125;&#125;</span><br></pre></td></tr></table></figure><h1 id="åˆ›å»ºå·¥ä½œæµ"><a href="#åˆ›å»ºå·¥ä½œæµ" class="headerlink" title="åˆ›å»ºå·¥ä½œæµ"></a>åˆ›å»ºå·¥ä½œæµ</h1><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œåˆ›å»ºæ–‡ä»¶.github&#x2F;workflows&#x2F;deploy.ymlï¼Œå†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">name: Deploy to GitHub Pages # å®šä¹‰å·¥ä½œæµçš„åç§°</span><br><span class="line"></span><br><span class="line">on: # å®šä¹‰è§¦å‘å·¥ä½œæµçš„äº‹ä»¶ï¼Œå¦‚pushã€pull_requestç­‰</span><br><span class="line">  push: # å½“æœ‰ä»£ç æ¨é€åˆ°ç‰¹å®šåˆ†æ”¯æ—¶è§¦å‘å·¥ä½œæµ</span><br><span class="line">    branches: # é™å®šè§¦å‘å·¥ä½œçš„åˆ†æ”¯ï¼Œæ•°ç»„</span><br><span class="line">      - main</span><br><span class="line">if: contains(github.event.head_commit.message, &#x27;deploy&#x27;) # å½“æäº¤ä¸€ä¸ªåŒ…å« deploy å…³é”®å­—çš„ commit æ—¶è§¦å‘</span><br><span class="line"># ä»¥ä¸Šï¼Œæ€»çš„æ¥è¯´ï¼Œåœ¨mainåˆ†æ”¯æäº¤åŒ…å« deploy çš„commit æ—¶ï¼Œä¼šè§¦å‘å·¥ä½œæµ</span><br><span class="line"></span><br><span class="line">jobs: # å®šä¹‰å·¥ä½œæµä¸­çš„ä½œä¸šï¼ˆjobï¼‰</span><br><span class="line">  build-and-deploy: # å®šä¹‰ä¸€ä¸ªåä¸º build-and-deploy çš„ä½œä¸šï¼Œæ¯ä¸ªä½œä¸šæœ‰ä¸€ä¸ªå”¯ä¸€çš„åç§°</span><br><span class="line">    runs-on: ubuntu-latest # æŒ‡å®šä½œä¸šè¿è¡Œçš„æ“ä½œç³»ç»Ÿç¯å¢ƒ</span><br><span class="line"></span><br><span class="line">    steps: # å®šä¹‰ä½œä¸šä¸­çš„æ­¥éª¤ï¼ˆstepï¼‰</span><br><span class="line">    - name: Checkout Repository # name å®šä¹‰æ­¥éª¤çš„åç§°ï¼Œä¾¿äºè¯†åˆ«å’Œè°ƒè¯•</span><br><span class="line">      uses: actions/checkout@v3 # ä½¿ç”¨é¢„å®šä¹‰çš„ actions/checkout åŠ¨ä½œæ¥æ£€å‡ºä»£ç ã€‚</span><br><span class="line">      # uses åé¢æŒ‡å®šåŠ¨ä½œçš„æ¥æºå’Œç‰ˆæœ¬ï¼Œactions/checkout@v3 è¡¨ç¤ºä½¿ç”¨ actions/checkout çš„ç¬¬ 3 ç‰ˆæœ¬ã€‚</span><br><span class="line"></span><br><span class="line">    - name: Setup Node.js</span><br><span class="line">      uses: actions/setup-node@v3 # ä½¿ç”¨é¢„å®šä¹‰çš„ actions/setup-node åŠ¨ä½œæ¥è®¾ç½® Node.js ç¯å¢ƒã€‚</span><br><span class="line">      with: # å®šä¹‰åŠ¨ä½œçš„è¾“å…¥å‚æ•°</span><br><span class="line">        node-version: 20</span><br><span class="line">    </span><br><span class="line">    - name: Clear Cache</span><br><span class="line">      run: | # æ‰§è¡Œ shell å‘½ä»¤æˆ–è„šæœ¬ã€‚run åé¢æŒ‡å®šè¦æ‰§è¡Œçš„å‘½ä»¤æˆ–è„šæœ¬ï¼Œ| è¡¨ç¤ºå¤šè¡Œå‘½ä»¤ã€‚</span><br><span class="line">        rm -rf package-lock.json node_modules # åˆ é™¤ package-lock.json å’Œ node_modules ç›®å½•ã€‚</span><br><span class="line"></span><br><span class="line">    - name: Install Dependencies</span><br><span class="line">      run: npm install # å®‰è£…é¡¹ç›®ä¾èµ–</span><br><span class="line"></span><br><span class="line">    - name: Build Project</span><br><span class="line">      run: npm run build # æ„å»ºé¡¹ç›®</span><br><span class="line"></span><br><span class="line">    - name: Deploy to GitHub Pages</span><br><span class="line">      uses: peaceiris/actions-gh-pages@v3 # ä½¿ç”¨é¢„å®šä¹‰çš„ peaceiris/actions-gh-pages åŠ¨ä½œæ¥éƒ¨ç½²é¡¹ç›®åˆ° GitHub Pagesã€‚</span><br><span class="line">      with:</span><br><span class="line">        github_token: $&#123;&#123; secrets.GITHUB_TOKEN &#125;&#125;</span><br><span class="line">        publish_dir: ./dist</span><br><span class="line">        user_name: &#x27;your name&#x27;</span><br><span class="line">        user_email: &#x27;your email&#x27;</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œé¡¹ç›®éœ€è¦æ·»åŠ baseè·¯å¾„é…ç½®ï¼Œ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vite.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="attr">base</span>: process.<span class="property">env</span>.<span class="property">NODE_ENV</span> === <span class="string">&#x27;production&#x27;</span> ? <span class="string">&#x27;/your repository/&#x27;</span> : <span class="string">&#x27;/&#x27;</span>,</span><br></pre></td></tr></table></figure><p>ç„¶åç¡®ä¿<code>Settings/Pages/Build and deploymentä¸­</code>ï¼Œbranchä¸º<strong>gh-pages</strong>ï¼Œç›®å½•ä¸º&#x2F;(root)ã€‚</p><p>æœ€åï¼Œé€šè¿‡<code>Settings/Pages/Github Pages</code>ä¸‹æ˜¾ç¤ºçš„åœ°å€å°±å¯ä»¥è®¿é—®é¡¹ç›®äº†ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20241007235921.png" alt="image"></p><h1 id="å¯èƒ½é‡åˆ°çš„é—®é¢˜"><a href="#å¯èƒ½é‡åˆ°çš„é—®é¢˜" class="headerlink" title="å¯èƒ½é‡åˆ°çš„é—®é¢˜"></a>å¯èƒ½é‡åˆ°çš„é—®é¢˜</h1><p>é—®é¢˜1ï¼šæ¨é€æ— æƒé™</p><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20241007225937.png" alt="image"></p><p>è§£å†³åŠæ³•ï¼š</p><p>æ£€æŸ¥æƒé™è®¾ç½®ï¼Œåœ¨<code>Settings/Actions/General/Workflow permissions</code>é…ç½®ä¸­ï¼Œé€‰æ‹©<code>Read and write permissions</code>ã€‚</p><p>é—®é¢˜2ï¼šCannot find module @rollup&#x2F;rollup-linux-x64-gnu.</p><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/20241007230511.png" alt="image"></p><p>è§£å†³åŠæ³•ï¼š</p><p>æ¸…é™¤ç¼“å­˜ï¼Œåœ¨<strong>npm install</strong>å‰æ·»åŠ å¦‚ä¸‹é…ç½®ï¼Œ</p><pre><code>   - name: Clear Cache      run: |        rm -rf package-lock.json node_modules</code></pre>]]></content>
      
      
      <categories>
          
          <category> æŒ‡å— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CICD </tag>
            
            <tag> Git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ§æ–‡æœ¬æº¢å‡º+å®Œæ•´å†…å®¹æç¤º</title>
      <link href="/2024/09/25/text-ellipsis/"/>
      <url>/2024/09/25/text-ellipsis/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨å¼€å‘ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°è¶…å‡ºçœç•¥å¹¶æ˜¾ç¤ºâ€¦çš„éœ€æ±‚ã€‚æœ‰æ—¶ï¼Œè¿˜éœ€è¦åšåˆ°åœ¨é¼ æ ‡ç§»å…¥çš„æ—¶å€™æ˜¾ç¤ºå…·ä½“å†…å®¹ã€‚è¿™äº›éƒ½å¾ˆç®€å•ï¼Œä½†å¦‚æœè¦å®ç°â€œ<strong>æ–‡æœ¬å¦‚æœè¶…å‡ºå°±åœ¨é¼ æ ‡ç§»å…¥æ—¶æ˜¾ç¤ºå…·ä½“å†…å®¹ï¼Œæ–‡æœ¬ä¸è¶…å‡ºé¼ æ ‡ç§»å…¥å°±ä¸æ˜¾ç¤º</strong>â€ï¼Œå°±æœ‰ä¸€ç‚¹ç‚¹éº»çƒ¦ã€‚è€Œä¸”ï¼Œæ–‡æœ¬é•¿åº¦é€šå¸¸ä¸å›ºå®šï¼Œéœ€è¦è¿™ç§å¤„ç†çš„æ–‡æœ¬æœ‰å¤šä¸ªã€‚æ‰€ä»¥ï¼Œåœ¨æ­¤æ€»ç»“ä¸€ä¸‹å¦‚ä½•å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p><h1 id="æ–‡æœ¬è¶…å‡ºæ˜¾ç¤ºâ€¦"><a href="#æ–‡æœ¬è¶…å‡ºæ˜¾ç¤ºâ€¦" class="headerlink" title="æ–‡æœ¬è¶…å‡ºæ˜¾ç¤ºâ€¦"></a>æ–‡æœ¬è¶…å‡ºæ˜¾ç¤ºâ€¦</h1><p>åˆ†ä¸ºå•è¡Œæ–‡æœ¬å’Œå¤šè¡Œæ–‡æœ¬2ç§æƒ…å†µï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// å•è¡Œæ–‡æœ¬</span><br><span class="line"><span class="selector-class">.text-single</span> &#123;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  <span class="attribute">text-overflow</span>: ellipsis;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// å¤šè¡Œæ–‡æœ¬</span><br><span class="line"><span class="selector-class">.text-multi</span> &#123;</span><br><span class="line">  <span class="attribute">display</span>: -webkit-box;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">  -webkit-<span class="selector-tag">line</span>-clamp: <span class="number">2</span>;</span><br><span class="line">  -webkit-<span class="attribute">box-orient</span>: vertical;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ–¹æ³•ä¸€ï¼šæ ¹æ®scrollWidthå’ŒoffsetWidthåˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºtooltip"><a href="#æ–¹æ³•ä¸€ï¼šæ ¹æ®scrollWidthå’ŒoffsetWidthåˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºtooltip" class="headerlink" title="æ–¹æ³•ä¸€ï¼šæ ¹æ®scrollWidthå’ŒoffsetWidthåˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºtooltip"></a>æ–¹æ³•ä¸€ï¼šæ ¹æ®scrollWidthå’ŒoffsetWidthåˆ¤æ–­æ˜¯å¦æ˜¾ç¤ºtooltip</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">v-for</span>=<span class="string">&quot;item in info&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-tooltip</span> <span class="attr">:visible</span>=<span class="string">&quot;nameVisible[item.key]&quot;</span> <span class="attr">:content</span>=<span class="string">&quot;item.content&quot;</span> <span class="attr">placement</span>=<span class="string">&quot;top&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> @<span class="attr">mouseenter</span>=<span class="string">&quot;(e: any) =&gt; handleMouseEnterName(e, item.key)&quot;</span> @<span class="attr">mouseleave</span>=<span class="string">&quot;handleMouseLeaveName(item.key)&quot;</span>&gt;</span></span><br><span class="line">        &#123;&#123; item.content &#125;&#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-tooltip</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">function handleMouseEnter(e: any, key: string) &#123;</span><br><span class="line">  if (e.target.scrollWidth &gt; e.target.clientWidth) &#123;</span><br><span class="line">    nameVisible.value[key] = true;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    nameVisible.value[key] = false;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function handleMouseLeave(key: string) &#123;</span><br><span class="line">  nameVisible.value[key] = false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ–¹æ³•äºŒï¼šå€ŸåŠ©titleå±æ€§"><a href="#æ–¹æ³•äºŒï¼šå€ŸåŠ©titleå±æ€§" class="headerlink" title="æ–¹æ³•äºŒï¼šå€ŸåŠ©titleå±æ€§"></a>æ–¹æ³•äºŒï¼šå€ŸåŠ©titleå±æ€§</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">title</span>=<span class="string">&quot;this is title&quot;</span>&gt;</span>show title when hover<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä»…è®¾ç½®titleå±æ€§è¿˜è¾¾ä¸åˆ°æƒ³è¦çš„æ•ˆæœï¼Œè€Œä¸”ä¸èƒ½ä¿®æ”¹titleçš„æ ·å¼ã€‚<br>å¦‚æœè¦å®ç°æƒ³è¦çš„æ•ˆæœï¼Œå…·ä½“æ€è·¯å¦‚ä¸‹ï¼šç”¨2ä»½ç›¸åŒçš„æ–‡æœ¬Aå’ŒBï¼ŒBè®¾ç½®titleå±æ€§ï¼Œå¹¶ä¸”ä¸Šç§»Nè¡Œï¼Œçˆ¶å…ƒç´ è®¾ç½®è¶…å‡ºä¸æ˜¾ç¤ºã€‚å•è¡Œçœç•¥æ—¶Næ˜¯2ï¼Œè¶…å‡º2è¡Œçœç•¥æ—¶Næ˜¯4ã€‚<br>åŸå› ï¼šå‡è®¾å•è¡Œçœç•¥ï¼ŒBä¸Šç§»2è¡Œåï¼Œå¦‚æœæ–‡æœ¬åªæœ‰ä¸€è¡Œï¼ŒBç§»å‡ºäº†çˆ¶å…ƒç´ èŒƒå›´ä¸æ˜¾ç¤ºï¼Œé¼ æ ‡ç§»å…¥Aä¸æ˜¾ç¤ºtitleï¼›å¦‚æœæ–‡æœ¬æœ‰å¤šè¡Œï¼ŒBè¦†ç›–äº†Aï¼Œé¼ æ ‡ç§»å…¥æ˜¾ç¤ºtitleã€‚</p><p><img src="https://p0-xtjj-private.juejin.cn/tos-cn-i-73owjymdk6/73dea461a6644cefa6eb83e02723d14c~tplv-73owjymdk6-jj-mark-v1:0:0:0:0:5o6Y6YeR5oqA5pyv56S-5Yy6IEAg5rKz6LGa6byT6byT:q75.awebp?policy=eyJ2bSI6MywidWlkIjoiNjM4MTYxNDYwNDAzMjg3In0=&rk3s=e9ecf3d6&x-orig-authkey=f32326d3454f2ac7e96d3d06cdbb035152127018&x-orig-expires=1727360824&x-orig-sign=q3n2O7WUPkXjjIBDSx0zrSdXVXA=" alt="633840727-9c53a45a583a5b50_fix732.webp"></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;wrap&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;txt&quot;</span>&gt;</span>å…ƒç´ ä¼šè¢«ç§»å‡ºæ­£å¸¸æ–‡æ¡£æµï¼Œå¹¶ä¸ä¸ºå…ƒç´ é¢„ç•™<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;title&quot;</span> <span class="attr">title</span>=<span class="string">&quot;å…ƒç´ ä¼šè¢«ç§»å‡ºæ­£å¸¸æ–‡æ¡£æµï¼Œå¹¶ä¸ä¸ºå…ƒç´ é¢„ç•™&quot;</span>&gt;</span>å…ƒç´ ä¼šè¢«ç§»å‡ºæ­£å¸¸æ–‡æ¡£æµï¼Œå¹¶ä¸ä¸ºå…ƒç´ é¢„ç•™<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">.wrap&#123;</span><br><span class="line">    position: relative;</span><br><span class="line">    line-height: 1.5;</span><br><span class="line">    height: 1.5em;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">&#125;</span><br><span class="line">.title&#123;</span><br><span class="line">    display: block;</span><br><span class="line">    white-space: nowrap;</span><br><span class="line">    text-overflow: ellipsis;</span><br><span class="line">    background-color: #fff;</span><br><span class="line">    overflow: hidden;</span><br><span class="line">    position: relative;</span><br><span class="line">    top: -3em;</span><br><span class="line">&#125;</span><br><span class="line">.txt&#123;</span><br><span class="line">  display: block;</span><br><span class="line">    max-height: 3em;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡data-*å±æ€§å’Œä¼ªå…ƒç´ æ¥è®¾ç½®titleæ ·å¼ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* éšè—title */</span></span><br><span class="line"><span class="selector-class">.title</span><span class="selector-attr">[title]</span> &#123;</span><br><span class="line">  <span class="attribute">text-decoration</span>: none;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* è‡ªå®šä¹‰title */</span></span><br><span class="line"><span class="selector-class">.title</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="built_in">attr</span>(data-title);</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#000</span>;</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">color</span>: <span class="number">#000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h1><p>å‚è€ƒé“¾æ¥ï¼š<br><a href="https://github.com/iplaces/blog/issues/3">æ–‡æœ¬æº¢å‡ºä¸ Tooltipï¼Œå¦‚ä½•æ›´å¥½çš„å¤„ç†äºŒè€…</a><br><a href="https://segmentfault.com/a/1190000040057525#item-1">CSS æ–‡æœ¬è¶…å‡ºæç¤ºæ•ˆæœ</a><br><a href="https://segmentfault.com/q/1010000045092125">è®¾ç½®titleæ ·å¼</a></p>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tooltip </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSSå˜é‡å’ŒCSSå‡½æ•°</title>
      <link href="/2024/09/23/css-var-func/"/>
      <url>/2024/09/23/css-var-func/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>CSSå˜é‡å’ŒCSSå‡½æ•°å¯ä»¥å¸®åŠ©å¼€å‘è€…æ–¹ä¾¿åœ°å®ç°åŠŸèƒ½ã€‚</p><h1 id="CSSå˜é‡"><a href="#CSSå˜é‡" class="headerlink" title="CSSå˜é‡"></a>CSSå˜é‡</h1><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-pseudo">:root</span> &#123;</span><br><span class="line">  <span class="attr">--main-bg-color</span>: brown;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">element &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="built_in">var</span>(--main-bg-color);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>CSSå˜é‡åä»¥â€“å¼€å¤´ï¼›<br>å˜é‡å¯ä»¥ç»§æ‰¿çˆ¶å…ƒç´ çš„å€¼ï¼›<br>varç¬¬2ä¸ªå‚æ•°ä¸ºå¤‡ç”¨å€¼ï¼Œå˜é‡ä¸ç”Ÿæ•ˆæ—¶è¢«ä½¿ç”¨ï¼›</p><h1 id="CSSå‡½æ•°"><a href="#CSSå‡½æ•°" class="headerlink" title="CSSå‡½æ•°"></a>CSSå‡½æ•°</h1><p>å¸¸ç”¨çš„csså‡½æ•°åŒ…æ‹¬ï¼šcalc()ã€linear-gradient()ã€translate(), rotate(), scale()ã€rgba()ã€hsla()ã€attr()ã€clamp()ã€min()ã€max()ã€‚  </p><h2 id="calc-æ‰§è¡Œè®¡ç®—"><a href="#calc-æ‰§è¡Œè®¡ç®—" class="headerlink" title="calc()æ‰§è¡Œè®¡ç®—"></a>calc()æ‰§è¡Œè®¡ç®—</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">calc</span>(<span class="number">100%</span> - <span class="number">30px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="linear-gradient-åˆ›å»ºä¸€ä¸ªçº¿æ€§æ¸å˜"><a href="#linear-gradient-åˆ›å»ºä¸€ä¸ªçº¿æ€§æ¸å˜" class="headerlink" title="linear-gradient()åˆ›å»ºä¸€ä¸ªçº¿æ€§æ¸å˜"></a>linear-gradient()åˆ›å»ºä¸€ä¸ªçº¿æ€§æ¸å˜</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.background</span> &#123;</span><br><span class="line">  <span class="attribute">background-image</span>: <span class="built_in">linear-gradient</span>(to right, red, yellow);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="transformå‡½æ•°æ”¹å˜å…ƒç´ çš„å½¢çŠ¶ã€ä½ç½®å’Œå°ºå¯¸"><a href="#transformå‡½æ•°æ”¹å˜å…ƒç´ çš„å½¢çŠ¶ã€ä½ç½®å’Œå°ºå¯¸" class="headerlink" title="transformå‡½æ•°æ”¹å˜å…ƒç´ çš„å½¢çŠ¶ã€ä½ç½®å’Œå°ºå¯¸"></a>transformå‡½æ•°æ”¹å˜å…ƒç´ çš„å½¢çŠ¶ã€ä½ç½®å’Œå°ºå¯¸</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.moved</span> &#123;</span><br><span class="line">  <span class="attribute">transform</span>: <span class="built_in">translate</span>(<span class="number">50px</span>, <span class="number">100px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="rgba-ã€hsla-å®šä¹‰é¢œè‰²"><a href="#rgba-ã€hsla-å®šä¹‰é¢œè‰²" class="headerlink" title="rgba()ã€hsla()å®šä¹‰é¢œè‰²"></a>rgba()ã€hsla()å®šä¹‰é¢œè‰²</h2><p>rgba(çº¢ï¼Œç»¿ï¼Œè“ï¼Œé€æ˜åº¦)<br>hsla(è‰²è°ƒï¼Œé¥±å’Œåº¦ï¼Œäº®åº¦ï¼Œé€æ˜åº¦)  </p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.text</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">99</span>, <span class="number">71</span>, <span class="number">0.5</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="attr-å¼•ç”¨å…ƒç´ çš„å±æ€§å€¼"><a href="#attr-å¼•ç”¨å…ƒç´ çš„å±æ€§å€¼" class="headerlink" title="attr()å¼•ç”¨å…ƒç´ çš„å±æ€§å€¼"></a>attr()å¼•ç”¨å…ƒç´ çš„å±æ€§å€¼</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span><span class="selector-pseudo">::before</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="built_in">attr</span>(data-tooltip);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="clamp-é™åˆ¶ä¸€ä¸ªå€¼åœ¨ä¸€ä¸ªç‰¹å®šèŒƒå›´å†…"><a href="#clamp-é™åˆ¶ä¸€ä¸ªå€¼åœ¨ä¸€ä¸ªç‰¹å®šèŒƒå›´å†…" class="headerlink" title="clamp()é™åˆ¶ä¸€ä¸ªå€¼åœ¨ä¸€ä¸ªç‰¹å®šèŒƒå›´å†…"></a>clamp()é™åˆ¶ä¸€ä¸ªå€¼åœ¨ä¸€ä¸ªç‰¹å®šèŒƒå›´å†…</h2><p>å®ƒæ¥å—ä¸‰ä¸ªå‚æ•°ï¼šæœ€å°å€¼ã€ä¼˜é€‰å€¼å’Œæœ€å¤§å€¼ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">h1</span> &#123;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="built_in">clamp</span>(<span class="number">2rem</span>, <span class="number">4vw</span> + <span class="number">1rem</span>, <span class="number">8rem</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°çš„å·¥ä½œæ–¹å¼æ˜¯ï¼šå¦‚æœä¼˜é€‰å€¼å°äºæœ€å°å€¼ï¼Œé‚£ä¹ˆè¿”å›æœ€å°å€¼ï¼›å¦‚æœä¼˜é€‰å€¼å¤§äºæœ€å¤§å€¼ï¼Œé‚£ä¹ˆè¿”å›æœ€å¤§å€¼ï¼›å¦‚æœä¼˜é€‰å€¼åœ¨æœ€å°å€¼å’Œæœ€å¤§å€¼ä¹‹é—´ï¼Œé‚£ä¹ˆè¿”å›ä¼˜é€‰å€¼ã€‚<br>ä¾‹å¦‚ï¼Œfont-size: clamp(12px, 5vw, 24px); è¿™ä¸ª CSS è§„åˆ™ä¼šè®¾ç½®å­—ä½“å¤§å°ä¸ºè§†å£å®½åº¦çš„ 5%ï¼Œä½†æ˜¯ä¸ä¼šå°äº 12pxï¼Œä¹Ÿä¸ä¼šå¤§äº 24pxã€‚è¿™åœ¨å“åº”å¼è®¾è®¡ä¸­éå¸¸æœ‰ç”¨ï¼Œå¯ä»¥ç¡®ä¿å…ƒç´ çš„å¤§å°åœ¨ä¸åŒçš„è®¾å¤‡å’Œå±å¹•å°ºå¯¸ä¸Šéƒ½èƒ½ä¿æŒåˆé€‚çš„æ¯”ä¾‹ï¼ŒåŒæ—¶ä¹Ÿä¸ä¼šè¿‡å°æˆ–è¿‡å¤§ã€‚   </p><h2 id="min-ã€max-è¿”å›ä¸€ç»„æ•°å€¼ä¸­æœ€å°æˆ–æœ€å¤§ä¸€ä¸ªå€¼"><a href="#min-ã€max-è¿”å›ä¸€ç»„æ•°å€¼ä¸­æœ€å°æˆ–æœ€å¤§ä¸€ä¸ªå€¼" class="headerlink" title="min()ã€max()è¿”å›ä¸€ç»„æ•°å€¼ä¸­æœ€å°æˆ–æœ€å¤§ä¸€ä¸ªå€¼"></a>min()ã€max()è¿”å›ä¸€ç»„æ•°å€¼ä¸­æœ€å°æˆ–æœ€å¤§ä¸€ä¸ªå€¼</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.container</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="built_in">min</span>(<span class="number">100%</span>, <span class="number">600px</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‚æ•°çš„ç±»å‹ï¼š<br>&lt;length&gt;ï¼šé•¿åº¦å€¼ï¼Œå¦‚ px, em, rem, vw, vh ç­‰ã€‚<br>&lt;number&gt;ï¼šæ•°å­—å€¼ã€‚<br>&lt;percentage&gt;ï¼šç™¾åˆ†æ¯”ã€‚<br>&lt;calc()&gt;ï¼šå¦ä¸€ä¸ª calc() å‡½æ•°çš„è¡¨è¾¾å¼ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> css </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ’DockeråŸºç¡€çŸ¥è¯†æ€»ç»“</title>
      <link href="/2024/09/02/docker-tutorial/"/>
      <url>/2024/09/02/docker-tutorial/</url>
      
        <content type="html"><![CDATA[<h1 id="1-dockerçš„ä½œç”¨"><a href="#1-dockerçš„ä½œç”¨" class="headerlink" title="1.dockerçš„ä½œç”¨"></a>1.dockerçš„ä½œç”¨</h1><p>æ‰“åŒ…ã€åˆ†å‘ã€éƒ¨ç½²<br>æ‰“åŒ…ï¼šå°±æ˜¯æŠŠä½ è½¯ä»¶è¿è¡Œæ‰€éœ€çš„ä¾èµ–ã€ç¬¬ä¸‰æ–¹åº“ã€è½¯ä»¶æ‰“åŒ…åˆ°ä¸€èµ·ï¼Œå˜æˆä¸€ä¸ªå®‰è£…åŒ…ï¼›<br>åˆ†å‘ï¼šä½ å¯ä»¥æŠŠä½ æ‰“åŒ…å¥½çš„â€œå®‰è£…åŒ…â€ä¸Šä¼ åˆ°ä¸€ä¸ªé•œåƒä»“åº“ï¼Œå…¶ä»–äººå¯ä»¥éå¸¸æ–¹ä¾¿çš„è·å–å’Œå®‰è£…ï¼›<br>éƒ¨ç½²ï¼šæ‹¿ç€â€œå®‰è£…åŒ…â€å°±å¯ä»¥ä¸€ä¸ªå‘½ä»¤è¿è¡Œèµ·æ¥ä½ çš„åº”ç”¨ï¼Œè‡ªåŠ¨æ¨¡æ‹Ÿå‡ºä¸€æ¨¡ä¸€æ ·çš„è¿è¡Œç¯å¢ƒï¼Œä¸ç®¡æ˜¯åœ¨ Windows&#x2F;Mac&#x2F;Linuxã€‚   </p><h1 id="2-dockerå‘½ä»¤"><a href="#2-dockerå‘½ä»¤" class="headerlink" title="2.dockerå‘½ä»¤"></a>2.dockerå‘½ä»¤</h1><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t test:v1 .     </span><br></pre></td></tr></table></figure><p>-t æŒ‡å®šé•œåƒåå­—å’Œç‰ˆæœ¬å·ï¼›<br>. æŒ‡åœ¨å½“å‰ç›®å½•buildï¼Œå°†å½“å‰ç›®å½•ä½œä¸ºæ„å»ºä¸Šä¸‹æ–‡ï¼›<br>å‚è€ƒé“¾æ¥ï¼š<a href="https://docs.docker.com/engine/reference/commandline/build/">docker buildå‘½ä»¤</a></p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="language-bash"> -dt -p 8089:8089 demo</span></span><br></pre></td></tr></table></figure><p>-p port1:port2 æŒ‡å®šç«¯å£å·ï¼Œport1è¦è®¿é—®çš„ç«¯å£å·ï¼Œport2dockerå†…éƒ¨ä½¿ç”¨çš„ç«¯å£å·ï¼›<br>-d åå°è¿è¡Œï¼Œ-i ä»¥äº¤äº’æ¨¡å¼è¿è¡Œå®¹å™¨ï¼Œ-tä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œ-itåœ¨ä¸€ä¸ªæ–°ç»ˆç«¯é‡Œè¿è¡Œå®¹å™¨ï¼Œ-dtåœ¨ç»ˆç«¯çš„åå°è¿è¡Œå®¹å™¨ï¼›<br>å‚è€ƒé“¾æ¥ï¼š<a href="https://docs.docker.com/engine/reference/commandline/run/">docker runå‘½ä»¤</a>  </p><p>å…¶ä»–å¸¸è§å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š<br>docker ps æŸ¥çœ‹å½“å‰è¿è¡Œä¸­çš„å®¹å™¨<br>docker exec -it  containerid sh  &#x2F;&#x2F; è¿›å…¥å®¹å™¨ï¼Œåœ¨å®¹å™¨å†…å¯ä»¥æ‰§è¡Œnpm run startç­‰å‘½ä»¤<br>docker images æŸ¥çœ‹é•œåƒåˆ—è¡¨<br>docker rm container-id åˆ é™¤æŒ‡å®š id çš„å®¹å™¨<br>docker stop&#x2F;start container-id åœæ­¢&#x2F;å¯åŠ¨æŒ‡å®š id çš„å®¹å™¨<br>docker rmi image-id åˆ é™¤æŒ‡å®š id çš„é•œåƒ</p><h1 id="3-Dockerfileæ–‡ä»¶"><a href="#3-Dockerfileæ–‡ä»¶" class="headerlink" title="3.Dockerfileæ–‡ä»¶"></a>3.Dockerfileæ–‡ä»¶</h1><p>æ–‡ä»¶ä¸­å‘½ä»¤è§£é‡Šå¦‚ä¸‹æ‰€ç¤ºï¼š  </p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">14</span>-alpine <span class="comment"># æŒ‡å®šåŸºç¡€é•œåƒ</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app <span class="comment"># æŒ‡å®šshellè¯­å¥è¿è¡Œçš„ç›®å½•ï¼Œå¦‚æœç›®å½•ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»º</span></span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> a.txt /app/ <span class="comment"># å°†æœ¬åœ°æ–‡ä»¶æ‹·è´åˆ°å®¹å™¨çš„æŸç›®å½•ä¸‹</span></span></span><br><span class="line"><span class="comment"># ADD a.txt /app/ # æ‹·è´æœ¬åœ°æˆ–è¿œç¨‹æ–‡ä»¶,å¯ä»¥è‡ªåŠ¨è§£å‹ç¼©ï¼Œè¿˜ä¼šä½¿æ„å»ºç¼“å­˜å¤±æ•ˆ</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm i <span class="comment"># è¿è¡Œshellè¯­å¥ï¼Œæ„å»ºæ—¶è¿è¡Œ</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash">  [<span class="string">&quot;npm&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;start&quot;</span>]  <span class="comment"># æŒ‡å®šé•œåƒå¯åŠ¨è¿è¡Œçš„è„šæœ¬</span></span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;npm&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;start&quot;</span>] <span class="comment"># ç±»ä¼¼CMD  </span></span></span><br><span class="line"><span class="keyword">MAINTAINER</span> &lt;name&gt;  <span class="comment"># æŒ‡å®šç”Ÿæˆé•œåƒçš„ä½œè€…ï¼ŒLABELæ›´çµæ´»ã€‚  </span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8089</span> <span class="comment"># æš´éœ²é•œåƒåœ¨å®¹å™¨å†…è¿è¡Œçš„ç«¯å£å·  </span></span><br><span class="line"><span class="keyword">ENV</span> PORT=<span class="number">8089</span> <span class="comment"># æŒ‡å®šç¯å¢ƒå˜é‡ï¼Œè¿è¡Œæ—¶ä¹Ÿç”Ÿæ•ˆ  </span></span><br><span class="line"><span class="keyword">ARG</span>   <span class="comment"># æ„å»ºå‚æ•°ï¼Œè¿è¡Œæ—¶æ— æ•ˆï¼Œå¯ä»¥æ„å»ºæ—¶å€™ä¸´æ—¶ä¿®æ”¹å˜é‡</span></span><br></pre></td></tr></table></figure><p>æ•™ç¨‹1ï¼š<a href="https://docker.easydoc.net/doc/81170005/cCewZWoN/lTKfePfP">https://docker.easydoc.net/doc/81170005/cCewZWoN/lTKfePfP</a><br>æ•™ç¨‹2ï¼š<a href="https://www.bilibili.com/video/BV1k7411B7QL/?spm_id_from=333.337.search-card.all.click&vd_source=6452cc89d77d512e999c37668481d36b">https://www.bilibili.com/video/BV1k7411B7QL/?spm_id_from=333.337.search-card.all.click&amp;vd_source=6452cc89d77d512e999c37668481d36b</a><br>æ•™ç¨‹3ï¼š<a href="https://yeasy.gitbook.io/docker_practice/appendix/best_practices#dockerfile-zhi-ling">https://yeasy.gitbook.io/docker_practice/appendix/best_practices#dockerfile-zhi-ling</a>  </p><h1 id="4-dockerfileé…ç½®æ–¹æ¡ˆ"><a href="#4-dockerfileé…ç½®æ–¹æ¡ˆ" class="headerlink" title="4.dockerfileé…ç½®æ–¹æ¡ˆ"></a>4.dockerfileé…ç½®æ–¹æ¡ˆ</h1><p>æ–¹æ¡ˆ1ï¼š<br>æœ¬åœ°æ‰“åŒ…ï¼Œç„¶åå¤åˆ¶åˆ°å®¹å™¨ä¸­ã€‚</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># node å¯åŠ¨</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">14</span>-alpine</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> package.json /app/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> ./.output /app/.output</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8089</span></span><br><span class="line"><span class="keyword">ENV</span> PORT=<span class="number">8089</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;npm&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;start&quot;</span>]</span></span><br></pre></td></tr></table></figure><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nginx</span></span><br><span class="line"><span class="keyword">FROM</span> nginx:alpine</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> /dist /usr/share/nginx/html/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> nginx.conf /etc/nginx/conf.d/nginx.conf</span></span><br></pre></td></tr></table></figure><p>æ–¹æ¡ˆ2ï¼šæŠŠæœ¬åœ°æ•´ä¸ªæ–‡ä»¶å¤¹å¤åˆ¶åˆ°å®¹å™¨ä¸­ï¼Œåœ¨å®¹å™¨ä¸­æ‰“åŒ…ã€‚éœ€è¦æ·»åŠ .dockerignoreæ–‡ä»¶ï¼Œé¿å…ä¸Šä¼ çš„æ–‡ä»¶å¤¹æ¯”è¾ƒå¤§ã€‚</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># node</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">14</span>-alpine</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . /app/</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">cd</span> /app &amp;&amp; yarn &amp;&amp; yarn build</span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;npm&quot;</span>, <span class="string">&quot;run&quot;</span>, <span class="string">&quot;start&quot;</span>]</span></span><br></pre></td></tr></table></figure><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nginx</span></span><br><span class="line"><span class="keyword">FROM</span> nginx:alpine</span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . /app/</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">cd</span> /app &amp;&amp; yarn &amp;&amp; yarn build</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> /app/dist /usr/share/nginx/html/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> nginx.conf /etc/nginx/conf.d/nginx.conf</span></span><br></pre></td></tr></table></figure><p>æ–¹æ¡ˆ1éœ€è¦åœ¨docker buildå‰æ‰§è¡Œä¸€éyarn buildï¼Œ<br>æ–¹æ¡ˆ2æ‰“åŒ…å‡ºæ¥çš„é•œåƒæ¯”è¾ƒå¤§ã€‚</p><h1 id="5-æŠ¥é”™è§£å†³"><a href="#5-æŠ¥é”™è§£å†³" class="headerlink" title="5.æŠ¥é”™è§£å†³"></a>5.æŠ¥é”™è§£å†³</h1><p>This version of npm is compatible with lockfileVersion@1, but package-lock.json was generated for lockfileVersion@2<br>dockerç‰ˆæœ¬å’Œæœ¬åœ°ç”µè„‘ä¸­nodeç‰ˆæœ¬ä¸åŒ¹é…ï¼Œå‡çº§dockerä¸­çš„nodeï¼Œæˆ–ä½¿ç”¨yarnã€‚</p><h1 id="6-è°ƒè¯•docker-build"><a href="#6-è°ƒè¯•docker-build" class="headerlink" title="6.è°ƒè¯•docker build"></a>6.è°ƒè¯•docker build</h1><p>åœ¨dockerfileä¸­åªè®¾ç½®åŸºç¡€é•œåƒï¼Œç„¶åå¯åŠ¨ï¼Œåœ¨ç»ˆç«¯ä¸­è¿è¡Œéœ€è¦çš„æ­¥éª¤ï¼Œå¦‚æœæˆåŠŸå°±æŠŠæ¯ä¸ªæ­¥éª¤çš„å‘½ä»¤å†™å…¥dockerfileæ–‡ä»¶ä¸­ã€‚</p><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> node:<span class="number">14</span>-alpine</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;tail&quot;</span>, <span class="string">&quot;-f&quot;</span>, <span class="string">&quot;/dev/null&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>è¿›å…¥è°ƒè¯•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker build -t demo .</span><br><span class="line">docker run -dt -p 8089:8089 demo</span><br><span class="line">docker <span class="built_in">exec</span> -it  containerid sh</span><br></pre></td></tr></table></figure><p>ç„¶åå¯ä»¥åœ¨ç»ˆç«¯ä¸­æ‰§è¡ŒDockerfileä¸­æƒ³è¦æ·»åŠ çš„RUNå‘½ä»¤ã€‚  </p><p>è°ƒè¯•åå…³é—­å®¹å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line">docker stop <span class="built_in">id</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æŒ‡å— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ğŸ”‘è¾“å…¥å¯†ç æ—¶åˆ¤æ–­æ˜¯å¦å¼€å¯å¤§å†™é”å®š</title>
      <link href="/2024/07/23/is-caps-lock/"/>
      <url>/2024/07/23/is-caps-lock/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä»»ä½•äººåœ¨ä»»ä½•æ—¶å€™éƒ½æœ‰å¯èƒ½æ‚„æ— å£°æ¯çš„æŠŠå¤§å†™é”å®šæ‰“å¼€ã€‚åœ¨å¤§éƒ¨åˆ†è¾“å…¥æ—¶ï¼Œç”¨æˆ·å¯ä»¥è½»æ˜“åœ°å‘ç°è¾“å…¥çš„æ˜¯å¤§å†™ã€‚ä½†ï¼Œåœ¨è¾“å…¥å¯†ç æ—¶ï¼Œç”¨æˆ·å°±ä¸å®¹æ˜“å‘ç°äº†ã€‚ä¸ºäº†æ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç”¨æˆ·è¾“å…¥å¯†ç æ—¶æç¤ºå¤§å†™é”å®šå·²å¼€å¯ã€‚ä½ ä¹Ÿä¸€å®šè§è¿‡è¿™ç§åœºæ™¯å§ã€‚</p><h1 id="æç¤ºç”¨æˆ·å¤§å†™é”å®šå·²å¼€å¯"><a href="#æç¤ºç”¨æˆ·å¤§å†™é”å®šå·²å¼€å¯" class="headerlink" title="æç¤ºç”¨æˆ·å¤§å†™é”å®šå·²å¼€å¯"></a>æç¤ºç”¨æˆ·å¤§å†™é”å®šå·²å¼€å¯</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> inputElement = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#your-input-element&#x27;</span>);</span><br><span class="line"></span><br><span class="line">inputElement.<span class="title function_">addEventListener</span>(<span class="string">&#x27;keydown&#x27;</span>, <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.<span class="title function_">getModifierState</span>(<span class="string">&#x27;CapsLock&#x27;</span>)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å¤§å†™é”å®šæ˜¯æ‰“å¼€çš„&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;å¤§å†™é”å®šæ˜¯å…³é—­çš„&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç æ˜¯åœ¨ç›‘å¬ç”¨æˆ·åœ¨è¾“å…¥æ¡†è¾“å…¥æ—¶åˆ¤æ–­çš„ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨æŒ‰ä¸‹ä»»ä½•é”®çš„æ—¶å€™åˆ¤æ–­ã€‚</p><h1 id="getModifierState"><a href="#getModifierState" class="headerlink" title="getModifierState"></a>getModifierState</h1><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getModifierState</span>(key)</span><br></pre></td></tr></table></figure><p>KeyboardEvent.getModifierState() æ–¹æ³•è¿”å›æŒ‡å®šä¿®é¥°é”®çš„å½“å‰çŠ¶æ€ï¼šå¦‚æœä¿®é¥°é”®å¤„äºæ´»åŠ¨çŠ¶æ€ï¼ˆå³ä¿®é¥°é”®è¢«æŒ‰ä¸‹æˆ–é”å®šï¼‰ï¼Œåˆ™è¿”å› true ï¼Œå¦åˆ™è¿”å› falseã€‚</p><p>å‚æ•°keyè¿˜å¯ä»¥æ˜¯Altã€NumLockç­‰ã€‚å¯¹ä¿®é¥°ç¬¦åŠä¸åŒå¹³å°çš„æ”¯æŒå¯è§æ­¤<a href="https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/getModifierState#modifier_keys_on_firefox">é“¾æ¥</a>ã€‚</p><h2 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h2><h3 id="æ£€æµ‹å¿«æ·é”®ç»„åˆ"><a href="#æ£€æµ‹å¿«æ·é”®ç»„åˆ" class="headerlink" title="æ£€æµ‹å¿«æ·é”®ç»„åˆ"></a>æ£€æµ‹å¿«æ·é”®ç»„åˆ</h3><p>æ£€æŸ¥å¤šä¸ªä¿®é¥°é”®æ˜¯å¦åŒæ—¶è¢«æŒ‰ä¸‹ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;keydown&#x27;</span>, <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.<span class="title function_">getModifierState</span>(<span class="string">&#x27;Control&#x27;</span>) &amp;&amp; event.<span class="title function_">getModifierState</span>(<span class="string">&#x27;Alt&#x27;</span>) &amp;&amp; event.<span class="property">key</span> === <span class="string">&#x27;S&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡ŒCtrl+Alt+Sçš„å¿«æ·æ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ä¼˜åŒ–è¾“å…¥ä½“éªŒ"><a href="#ä¼˜åŒ–è¾“å…¥ä½“éªŒ" class="headerlink" title="ä¼˜åŒ–è¾“å…¥ä½“éªŒ"></a>ä¼˜åŒ–è¾“å…¥ä½“éªŒ</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;input&#x27;</span>, <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.<span class="title function_">getModifierState</span>(<span class="string">&#x27;NumLock&#x27;</span>) &amp;&amp; event.<span class="property">target</span>.<span class="property">type</span> === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// æç¤ºç”¨æˆ·NumLockå¯èƒ½å½±å“è¾“å…¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºè‡ªå®šä¹‰é”®ç›˜å¿«æ·æ“ä½œ"><a href="#åˆ›å»ºè‡ªå®šä¹‰é”®ç›˜å¿«æ·æ“ä½œ" class="headerlink" title="åˆ›å»ºè‡ªå®šä¹‰é”®ç›˜å¿«æ·æ“ä½œ"></a>åˆ›å»ºè‡ªå®šä¹‰é”®ç›˜å¿«æ·æ“ä½œ</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;keydown&#x27;</span>, <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.<span class="title function_">getModifierState</span>(<span class="string">&#x27;Shift&#x27;</span>) &amp;&amp; event.<span class="title function_">getModifierState</span>(<span class="string">&#x27;Alt&#x27;</span>) &amp;&amp; event.<span class="property">key</span> === <span class="string">&#x27;Z&#x27;</span>) &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œè‡ªå®šä¹‰æ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="ä»…èƒ½ä½¿ç”¨getModifierStateçš„åœºæ™¯"><a href="#ä»…èƒ½ä½¿ç”¨getModifierStateçš„åœºæ™¯" class="headerlink" title="ä»…èƒ½ä½¿ç”¨getModifierStateçš„åœºæ™¯"></a>ä»…èƒ½ä½¿ç”¨getModifierStateçš„åœºæ™¯</h2><h3 id="æ£€æµ‹å¤§å†™é”å®š"><a href="#æ£€æµ‹å¤§å†™é”å®š" class="headerlink" title="æ£€æµ‹å¤§å†™é”å®š"></a>æ£€æµ‹å¤§å†™é”å®š</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;keydown&#x27;</span>, <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.<span class="title function_">getModifierState</span>(<span class="string">&#x27;CapsLock&#x27;</span>)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Caps Lock is active&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="æ£€æµ‹æ•°å­—é”å®š"><a href="#æ£€æµ‹æ•°å­—é”å®š" class="headerlink" title="æ£€æµ‹æ•°å­—é”å®š"></a>æ£€æµ‹æ•°å­—é”å®š</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;keydown&#x27;</span>, <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.<span class="title function_">getModifierState</span>(<span class="string">&#x27;NumLock&#x27;</span>)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Num Lock is active&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æŸäº›æƒ…å†µä¸‹ï¼Œå¯èƒ½è¯¯è§¦æ•°å­—é”å®šé”®ï¼Œæˆ–è€…åˆå§‹æŸäº›é”®ç›˜åˆå§‹å°±æ˜¯æ•°å­—é”å®šçš„ã€‚å½“ä½ è¾“å…¥uï¼Œæ˜¾ç¤º4ï¼›å½“ä½ è¾“å…¥kï¼Œæ˜¾ç¤ºçš„æ˜¯2ã€‚è¿™æ—¶å€™å°±éœ€è¦æŒ‰ä¸€ä¸‹F11è§£é™¤æ•°å­—é”å®šã€‚</p><h3 id="æ£€æµ‹æ»šåŠ¨é”å®š"><a href="#æ£€æµ‹æ»šåŠ¨é”å®š" class="headerlink" title="æ£€æµ‹æ»šåŠ¨é”å®š"></a>æ£€æµ‹æ»šåŠ¨é”å®š</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;keydown&#x27;</span>, <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.<span class="title function_">getModifierState</span>(<span class="string">&#x27;ScrollLock&#x27;</span>)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Scroll Lock is active&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="æ£€æµ‹å…¶ä»–ç‰¹æ®Šä¿®é¥°é”®"><a href="#æ£€æµ‹å…¶ä»–ç‰¹æ®Šä¿®é¥°é”®" class="headerlink" title="æ£€æµ‹å…¶ä»–ç‰¹æ®Šä¿®é¥°é”®"></a>æ£€æµ‹å…¶ä»–ç‰¹æ®Šä¿®é¥°é”®</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;keydown&#x27;</span>, <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (event.<span class="title function_">getModifierState</span>(<span class="string">&#x27;AltGraph&#x27;</span>)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;AltGraph is active&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (event.<span class="title function_">getModifierState</span>(<span class="string">&#x27;OS&#x27;</span>)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;OS key (Windows key or Command key) is active&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h1><p><a href="https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/getModifierState">MDN: getModifierState</a><br><a href="https://davidwalsh.name/detect-caps-lock">David Walsh: detect-caps-lock</a></p>]]></content>
      
      
      <categories>
          
          <category> js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> codeKey </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç¿»è¯‘ã€‘200è¡ŒJSå®ç°çš„è™šæ‹ŸDOM</title>
      <link href="/2024/07/04/virtual-node/"/>
      <url>/2024/07/04/virtual-node/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä½œè€…å°†æ¼”ç¤ºå¦‚ä½•ç”¨200å¤šè¡ŒJSå®ç°ä¸€ä¸ªè™šæ‹ŸDOMã€‚è€Œä¸”å®ç°çš„æ˜¯ä¸€ä¸ªåŠŸèƒ½é½å…¨ã€æ€§èƒ½è¶³å¤Ÿçš„npmåº“ã€‚ä¸»è¦ç›®æ ‡æ˜¯è¯´æ˜reactã€vueç­‰æ¡†æ¶èƒŒåçš„åŸºæœ¬æŠ€æœ¯ã€‚reactã€vueã€Elméƒ½å…è®¸ç”¨æˆ·æè¿°ç½‘é¡µå¤–è§‚ï¼Œä»è€Œç®€åŒ–äº†äº¤äº’å¼ç½‘é¡µåˆ›å»ºï¼Œä¸å¿…ä½¿ç”¨æ·»åŠ &#x2F;åˆ é™¤å…ƒç´ æ¥å®ç°è¯¥é¡µé¢ï¼Œå®ƒä»¬éƒ½æ˜¯é€šè¿‡è™šæ‹ŸDOMæ¥åšåˆ°çš„ã€‚</p><p>Elmæ˜¯ä¸€ä¸ªçº¯å‡½æ•°å¼çš„è¯­è¨€ï¼Œå®ƒå£°æ˜å¼çš„åˆ›å»ºç½‘é¡µã€‚</p><h1 id="è™šæ‹ŸDOMçš„ç›®æ ‡"><a href="#è™šæ‹ŸDOMçš„ç›®æ ‡" class="headerlink" title="è™šæ‹ŸDOMçš„ç›®æ ‡"></a>è™šæ‹ŸDOMçš„ç›®æ ‡</h1><p>å®ƒä¸æ€§èƒ½æ— å…³ã€‚</p><p>è™šæ‹ŸDOMæ˜¯ä¸€ç§æŠ½è±¡ï¼Œå®ƒç”¨äºç®€åŒ–ä¿®æ”¹UIçš„æ“ä½œã€‚</p><p>ç”¨æˆ·æè¿°æœŸå¾…çš„å¤–è§‚ï¼Œåº“è´Ÿè´£å°†DOMä»å½“å‰çŠ¶æ€è½¬æ¢æˆç”¨æˆ·æœŸæœ›çš„çŠ¶æ€ã€‚</p><h1 id="å…³é”®æ€æƒ³"><a href="#å…³é”®æ€æƒ³" class="headerlink" title="å…³é”®æ€æƒ³"></a>å…³é”®æ€æƒ³</h1><p>è¯¥åº“å°†æ¥ç®¡å•ä¸ªDOMå¹¶åœ¨å…¶ä¸­è¿›è¡Œæ“ä½œã€‚</p><p>è¯¥å…ƒç´ æœ€åˆåº”è¯¥æ˜¯ç©ºçš„ï¼Œè€Œä¸”å‡è®¾é™¤äº†è¯¥åº“æ²¡æœ‰ä»»ä½•ä¸œè¥¿èƒ½ä¿®æ”¹å®ƒï¼Œè¿™æ˜¯ç”¨æˆ·åº”ç”¨ç¨‹åºçš„æ ¹ã€‚</p><p>å¦‚æœåªæœ‰æˆ‘ä»¬èƒ½ä¿®æ”¹å®ƒï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸éœ€è¦æ£€æŸ¥å°±å¯ä»¥çŸ¥é“å…ƒç´ é‡Œéƒ½æœ‰ä»€ä¹ˆã€‚å¦‚ä½•çŸ¥é“ï¼Ÿé€šè¿‡è¿½è¸ªæˆ‘ä»¬å¯¹å®ƒçš„æ‰€æœ‰ä¿®æ”¹ã€‚</p><p>æˆ‘ä»¬å°†é€šè¿‡ä¿ç•™åŒ…å«æ¯ä¸ªHTMLå…ƒç´ ç®€åŒ–è¡¨ç¤ºçš„ç»“æ„ï¼Œæ¥è¿½è¸ªæ ¹èŠ‚ç‚¹çš„å†…å®¹ã€‚å‡†ç¡®çš„è¯´ï¼Œæ˜¯æ¯ä¸ªDOMèŠ‚ç‚¹ã€‚</p><p>å› ä¸ºè¿™ä¸ªè¡¨ç¤ºæ˜¯çœŸå®DOMçš„æ˜ å°„ï¼Œä¸åœ¨çœŸå®çš„DOMä¸­ï¼Œæ‰€ä»¥ç§°å…¶ä¸ºè™šæ‹ŸèŠ‚ç‚¹ã€‚å®ƒä»¬ç»„æˆè™šæ‹ŸDOMã€‚</p><p>ç”¨æˆ·æ°¸è¿œä¸ä¼šåˆ›å»ºçœŸå®çš„ DOM èŠ‚ç‚¹ï¼Œåªä¼šåˆ›å»ºé‚£äº›è™šæ‹Ÿçš„èŠ‚ç‚¹ã€‚ä»–ä»¬ä¼šå‘Šè¯‰æˆ‘ä»¬é€šè¿‡ä½¿ç”¨è™šæ‹ŸèŠ‚ç‚¹æ•´ä¸ªé¡µé¢åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ã€‚ç„¶åæˆ‘ä»¬çš„åº“å°†è´Ÿè´£ä¿®æ”¹çœŸå®çš„ DOMï¼Œä½¿å…¶ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚</p><p>ä¸ºäº†çŸ¥é“è¦ä¿®æ”¹ä»€ä¹ˆï¼Œæˆ‘ä»¬çš„åº“å°†è·å–ç”¨æˆ·åˆ›å»ºçš„è™šæ‹Ÿ DOMï¼Œå¹¶å°†å…¶ä¸è¡¨ç¤ºé¡µé¢å½“å‰å¤–è§‚çš„è™šæ‹Ÿ DOM è¿›è¡Œæ¯”è¾ƒã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºæ¯”è¾ƒã€‚å®ƒå°†è®°å½•å·®å¼‚ï¼Œä¾‹å¦‚åº”æ·»åŠ æˆ–åˆ é™¤å“ªäº›å…ƒç´ ä»¥åŠåº”æ·»åŠ æˆ–åˆ é™¤å“ªäº›å±æ€§ã€‚æ¯”è¾ƒçš„è¾“å‡ºæ˜¯è™šæ‹Ÿ DOM ä¹‹é—´çš„å·®å¼‚ã€‚</p><p>ç„¶åæˆ‘ä»¬å°†è¯¥å·®å¼‚çš„æ›´æ”¹åº”ç”¨åˆ°çœŸå®çš„ DOM ä¸­ã€‚ä¸€æ—¦æˆ‘ä»¬å®Œæˆä¿®æ”¹ï¼Œç”¨æˆ·åˆ›å»ºçš„è™šæ‹Ÿ DOM å°±æˆä¸ºçœŸå® DOM çš„å½“å‰çœŸå®è¡¨ç¤ºã€‚</p><p>æ‰€ä»¥ï¼Œå¯¹äºUIéƒ¨åˆ†ï¼Œæˆ‘ä»¬éœ€è¦ä»¥ä¸‹3ç‚¹ï¼š</p><ul><li><p>åˆ›å»ºDOMçš„è™šæ‹Ÿè¡¨ç¤ºï¼›</p></li><li><p>å¯¹æ¯”è™šæ‹ŸDOMèŠ‚ç‚¹ï¼›</p></li><li><p>å°†è™šæ‹ŸDOMçš„å·®å¼‚æ›´æ–°åˆ°çœŸå®çš„HTMLå…ƒç´ ä¸Šï¼›</p></li></ul><p>æ„å»ºä¹‹åï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•é€šè¿‡åœ¨çŸ­çŸ­å‡ è¡Œä»£ç ä¸­æ·»åŠ çŠ¶æ€å¤„ç†æ¥å……åˆ†åˆ©ç”¨è¿™ç§è™šæ‹ŸDOMä½œä¸ºä¸€ä¸ªå¼ºå¤§çš„åº“ã€‚</p><blockquote><p>æ€»çš„æ¥è¯´ï¼Œç”¨ä¸€ä¸ªå¯¹è±¡è¡¨ç¤ºä¸€ä¸ªDOMèŠ‚ç‚¹ï¼Œå¯¹è±¡ä¹‹é—´æ„æˆæ ‘çŠ¶å…³ç³»ã€‚è¿™ç§å¯¹è±¡åªæœ‰å½“å‰åº“èƒ½å¤Ÿä¿®æ”¹ï¼Œè¿½è¸ªåº“å¯¹è¿™ç§å¯¹è±¡çš„æ‰€æœ‰ä¿®æ”¹ã€‚å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œå¯¹æ¯”æ–°æ—§å¯¹è±¡å·®å¼‚ï¼Œç„¶åæŒ‰å·®å¼‚ä¿®æ”¹çœŸå®DOMã€‚</p></blockquote><h1 id="ä»£è¡¨DOM"><a href="#ä»£è¡¨DOM" class="headerlink" title="ä»£è¡¨DOM"></a>ä»£è¡¨DOM</h1><p>æˆ‘ä»¬å¸Œæœ›è¿™ä¸ªç»“æ„åŒ…å«å°½å¯èƒ½å°‘çš„ä¿¡æ¯ï¼Œä»¥å¿ å®çš„è¡¨ç¤ºé¡µé¢ä¸­çš„å†…å®¹ã€‚</p><p>DOMèŠ‚ç‚¹å…·æœ‰æ ‡ç­¾åã€å±æ€§å’Œå­èŠ‚ç‚¹ã€‚æ‰€ä»¥è¡¨ç¤ºDOMçš„å¯¹è±¡çš„ç»“æ„å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> exampleButton = &#123; </span><br><span class="line">    tag : <span class="string">&quot;button&quot;</span>, </span><br><span class="line">    <span class="attr">properties</span>: &#123; </span><br><span class="line">        <span class="attr">class</span>: <span class="string">&quot;primary&quot;</span>, </span><br><span class="line">        <span class="attr">disabled</span>: <span class="literal">true</span>, </span><br><span class="line">        <span class="attr">onClick</span>: doSomething </span><br><span class="line">    &#125;, </span><br><span class="line">    children : [] <span class="comment">// æ•°ç»„å…ƒç´ ç±»å‹ä¸å½“å‰å¯¹è±¡ç›¸åŒ </span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ–‡æœ¬èŠ‚ç‚¹åªæœ‰æ–‡å­—å†…å®¹ï¼Œéœ€è¦å•ç‹¬è¡¨ç¤ºï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> exampleText = &#123; <span class="attr">text</span>: <span class="string">&quot;Hello World&quot;</span> &#125;;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ£€æŸ¥tagæˆ–textå±æ€§æ˜¯å¦å­˜åœ¨æ¥åŒºåˆ†DOMèŠ‚ç‚¹å’Œæ–‡æœ¬èŠ‚ç‚¹ã€‚</p><p>æ–¹ä¾¿èµ·è§ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥åˆ›å»ºè¿™äº›èŠ‚ç‚¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">h</span>(<span class="params">tag, properties, children</span>) &#123; </span><br><span class="line">    <span class="keyword">return</span> &#123; tag, properties, children); </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">text</span>(<span class="params">content</span>) &#123; </span><br><span class="line">    <span class="keyword">return</span> &#123; text : content &#125;; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾çš„åˆ›å»ºå‡ºå¤æ‚çš„åµŒå¥—ç»“æ„ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pausedScreen = <span class="title function_">h</span>(<span class="string">&quot;div&quot;</span>, &#123;&#125;, [ </span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&quot;h2&quot;</span>, &#123;&#125;, <span class="title function_">text</span>(<span class="string">&quot;Game Paused&quot;</span>)), </span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&quot;button&quot;</span>, &#123; <span class="attr">onClick</span>: resumeGame &#125;, [ <span class="title function_">text</span>(<span class="string">&quot;Resume&quot;</span>) ]), </span><br><span class="line">    <span class="title function_">h</span>(<span class="string">&quot;button&quot;</span>, &#123; <span class="attr">onClick</span>: quitGame &#125;, [ <span class="title function_">text</span>(<span class="string">&quot;Quit&quot;</span>) ]) </span><br><span class="line">])</span><br></pre></td></tr></table></figure><h1 id="æ¯”è¾ƒ"><a href="#æ¯”è¾ƒ" class="headerlink" title="æ¯”è¾ƒ"></a>æ¯”è¾ƒ</h1><p>åœ¨å¼€å§‹æ¯”è¾ƒä¹‹å‰ï¼Œå…ˆæ€è€ƒä¸€ä¸‹æ¯”è¾ƒæ“ä½œçš„æœŸæœ›è¾“å‡ºæ˜¯ä»€ä¹ˆã€‚</p><p>æ¯”è¾ƒæ“ä½œæè¿°å¦‚ä½•ä¿®æ”¹å…ƒç´ ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¿®æ”¹ç±»å‹æ¥åˆ¤æ–­è¾“å‡ºã€‚</p><ul><li><p>åˆ›å»ºï¼šåº”è¿”å›è¦æ·»åŠ çš„è™šæ‹ŸDOMèŠ‚ç‚¹ï¼›</p></li><li><p>åˆ é™¤ï¼šæ— è¿”å›ï¼›</p></li><li><p>æ›¿æ¢ï¼šè¿”å›æ–°çš„DOMèŠ‚ç‚¹ï¼›</p></li><li><p>ä¿®æ”¹æŸèŠ‚ç‚¹ï¼šè¦æ·»åŠ æˆ–åˆ é™¤çš„å±æ€§ã€å¯¹å­èŠ‚ç‚¹çš„ä¿®æ”¹æ•°ç»„ï¼›</p></li><li><p>æ— å˜åŒ–ï¼šä¸éœ€è¦ä»»ä½•æ“ä½œã€‚</p></li></ul><p>ä½ å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæœ‰æ›¿æ¢ï¼Œå› ä¸ºé™¤éç”¨æˆ·ä¸ºæ¯ä¸ªè™šæ‹ŸDOMèŠ‚ç‚¹æä¾›ä¸€ä¸ªå”¯ä¸€æ ‡è¯†ç¬¦ï¼Œå¦åˆ™æˆ‘ä»¬æ— æ³•ç¡®å®šå­å…ƒç´ çš„é¡ºåºæ˜¯å¦å‘ç”Ÿå˜åŒ–ã€‚</p><p>æ¯”å¦‚ï¼Œåˆå§‹DOMæè¿°å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">    <span class="attr">tag</span>: <span class="string">&quot;div&quot;</span>, </span><br><span class="line">    <span class="attr">properties</span>: &#123;&#125;, </span><br><span class="line">    <span class="attr">chidlren</span>: [ &#123; <span class="attr">text</span>: <span class="string">&quot;One&quot;</span> &#125;, &#123; <span class="attr">text</span>: <span class="string">&quot;Two&quot;</span> &#125;, &#123; <span class="attr">text</span>: <span class="string">&quot;Three&quot;</span> &#125; ] </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘ç”Ÿä¿®æ”¹åçš„DOMæè¿°å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">    <span class="attr">tag</span>: <span class="string">&quot;div&quot;</span>, </span><br><span class="line">    <span class="attr">properties</span>: &#123;&#125;, </span><br><span class="line">    <span class="attr">chidlren</span>: [ &#123; <span class="attr">text</span>: <span class="string">&quot;Three&quot;</span> &#125; &#123; <span class="attr">text</span>: <span class="string">&quot;Two&quot;</span> &#125;, &#123; <span class="attr">text</span>: <span class="string">&quot;One&quot;</span> &#125;, ] </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€å’Œä¸‰äº¤æ¢äº†ä½ç½®ï¼Œæˆ‘ä»¬å¿…é¡»å°†ç¬¬ä¸€ä¸ªå¯¹è±¡çš„æ¯ä¸ªå­å¯¹è±¡ä¸ç¬¬äºŒä¸ªå¯¹è±¡çš„æ¯ä¸ªå­å¯¹è±¡è¿›è¡Œæ¯”è¾ƒï¼Œè¿™æ•ˆç‡å¤ªä½äº†ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬é€šè¿‡childrenæ•°ç»„çš„ç´¢å¼•æ¥è¯†åˆ«å…ƒç´ ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä»…éœ€äº¤äº’ç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªå­å¯¹è±¡ã€‚</p><p>æ‰€ä»¥ï¼Œå½“æ’å…¥ä¸€ä¸ªå…ƒç´ ä½œä¸ºæœ€åä¸€ä¸ªå­å…ƒç´ æ—¶ï¼Œä½¿ç”¨createã€‚å¦åˆ™ï¼Œä½¿ç”¨replaceã€‚</p><p>å¦‚æœæ²¡æœ‰å”¯ä¸€IDæ ‡è¯†å­å…ƒç´ ï¼Œæˆ‘ä»¬å°†é€šè¿‡O(nÂ²)çš„æ¯”è¾ƒæ‰çŸ¥é“äº¤æ¢äº†ä½ç½®ã€‚</p><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥ç›´æ¥æ·±å…¥å¹¶å®ç°è¿™ä¸ªdiffå‡½æ•°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">diffOne</span>(<span class="params">l, r</span>) &#123; </span><br><span class="line">    <span class="keyword">const</span> isText = l.<span class="property">text</span> !== <span class="literal">undefined</span>; </span><br><span class="line">    <span class="comment">// å¤„ç†æ–‡æœ¬èŠ‚ç‚¹ </span></span><br><span class="line">    <span class="keyword">if</span> (isText) &#123; </span><br><span class="line">        <span class="comment">// replaceæ›¿æ¢ noopæ— å˜åŒ– </span></span><br><span class="line">        <span class="keyword">return</span> l.<span class="property">text</span> !== r.<span class="property">text</span> ? &#123;<span class="attr">replace</span>: r&#125; : &#123;<span class="attr">noop</span>: <span class="literal">true</span>&#125;; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// æ›¿æ¢æ•´ä¸ªèŠ‚ç‚¹ </span></span><br><span class="line">    <span class="keyword">if</span> (l.<span class="property">tag</span> !== r.<span class="property">tag</span>) &#123; </span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="attr">replace</span>: r&#125;; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// æ¥ä¸‹æ¥æ˜¯ä¿®æ”¹ </span></span><br><span class="line">    <span class="comment">// è·å–åˆ é™¤çš„å±æ€§ </span></span><br><span class="line">    <span class="keyword">const</span> remove = []; </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> prop <span class="keyword">in</span> l.<span class="property">properties</span>) &#123; </span><br><span class="line">        <span class="keyword">if</span> (r.<span class="property">properties</span>[prop] === <span class="literal">undefined</span>) &#123; </span><br><span class="line">            remove.<span class="title function_">push</span>(prop); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// è·å–æ–°å¢å’Œä¿®æ”¹çš„å±æ€§ </span></span><br><span class="line">    <span class="keyword">const</span> set = &#123;&#125;; </span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> prop <span class="keyword">in</span> r.<span class="property">properties</span>) &#123; </span><br><span class="line">        <span class="keyword">if</span> (r.<span class="property">properties</span>[prop] !== l.<span class="property">properties</span>[prop]) &#123; </span><br><span class="line">            set[prop] = r.<span class="property">properties</span>[prop]; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="comment">// å¯¹æ¯”children </span></span><br><span class="line">    <span class="keyword">const</span> children = <span class="title function_">diffList</span>(l.<span class="property">children</span>, r.<span class="property">children</span>); </span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">modify</span>: &#123;remove, set, children&#125;&#125;; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½œä¸ºä¸€ç§ä¼˜åŒ–ï¼Œæˆ‘ä»¬å‘ç°ï¼Œå½“æ²¡æœ‰å±æ€§æ›´æ”¹è€Œä¸”æ‰€æœ‰å­å…ƒç´ ä¿®æ”¹éƒ½æ˜¯noopæ—¶ï¼Œå¯ä»¥è®¾ç½®è¯¥å…ƒç´ ä¸ºnoopã€‚</p><p>å¯¹æ¯”childrençš„æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">diffList</span>(<span class="params">ls, ls</span>) &#123; </span><br><span class="line">    <span class="keyword">const</span> length = <span class="title class_">Math</span>.<span class="title function_">max</span>(ls.<span class="property">length</span>, rs.<span class="property">length</span>); </span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">from</span>(&#123;length&#125;).<span class="title function_">map</span>(<span class="function">(<span class="params">_, i</span>) =&gt;</span> &#123; </span><br><span class="line">        <span class="keyword">if</span> (ls[i] === <span class="literal">undefined</span>) &#123; </span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="attr">create</span>: rs[i]&#125;; </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (rs[i] === <span class="literal">undefined</span>) &#123; </span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="attr">remove</span>: <span class="literal">true</span>&#125;; </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="title function_">diffOne</span>(ls[i], rs[i]); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="åº”ç”¨å·®å¼‚"><a href="#åº”ç”¨å·®å¼‚" class="headerlink" title="åº”ç”¨å·®å¼‚"></a>åº”ç”¨å·®å¼‚</h1><p>æˆ‘ä»¬å·²ç»å¯ä»¥åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿ DOM å¹¶å¯¹å…¶è¿›è¡Œæ¯”è¾ƒã€‚ç°åœ¨æ˜¯æ—¶å€™å°† diff åº”ç”¨äºçœŸå®çš„ DOM äº†ã€‚</p><p>applyå‡½æ•°æ¥æ”¶2ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªçœŸå®çš„DOMèŠ‚ç‚¹ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸Šä¸€æ­¥ä¸­çš„å­èŠ‚ç‚¹çš„å·®å¼‚æ•°ç»„ã€‚</p><p>applyå‡½æ•°æ²¡æœ‰ä»»ä½•è¿”å›å€¼ï¼Œå®ƒçš„ä¸»è¦ç›®çš„æ˜¯æ‰§è¡Œä¿®æ”¹DOMçš„å‰¯ä½œç”¨ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">apply</span>(<span class="params">el, childrenDiff</span>) &#123; </span><br><span class="line">    <span class="keyword">const</span> children = <span class="title class_">Array</span>.<span class="title function_">from</span>(el.<span class="property">childNodes</span>); </span><br><span class="line">    childrenDiff.<span class="title function_">forEach</span>(<span class="function">(<span class="params">diff, i</span>) =&gt;</span> &#123; </span><br><span class="line">        <span class="keyword">const</span> action = <span class="title class_">Object</span>.<span class="title function_">keys</span>(diff)[<span class="number">0</span>]; </span><br><span class="line">        <span class="keyword">switch</span> (action) &#123; </span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;remove&#x27;</span>: </span><br><span class="line">                children[i].<span class="title function_">remove</span>(); </span><br><span class="line">                <span class="keyword">break</span>; </span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;modify&#x27;</span>: </span><br><span class="line">                <span class="title function_">modify</span>(children[i], diff.<span class="property">modify</span>); </span><br><span class="line">                <span class="keyword">break</span>; </span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;create&#x27;</span>: </span><br><span class="line">                <span class="comment">// æ·»åŠ &#123;&#125;æ˜¯ä¸ºäº†è®©ä¸‹é¢åˆ›å»ºçš„childåœ¨å—çº§ä½œç”¨åŸŸä¸­ </span></span><br><span class="line">                &#123; </span><br><span class="line">                    <span class="keyword">const</span> child = <span class="title function_">create</span>(diff.<span class="property">create</span>); </span><br><span class="line">                    el.<span class="title function_">appendChild</span>(child); </span><br><span class="line">                    <span class="keyword">break</span>; </span><br><span class="line">                &#125; </span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;replace&#x27;</span>: </span><br><span class="line">                &#123; </span><br><span class="line">                    <span class="keyword">const</span> child = <span class="title function_">create</span>(diff.<span class="property">replace</span>); </span><br><span class="line">                    children[i].<span class="title function_">replaceWith</span>(child); </span><br><span class="line">                    <span class="keyword">break</span>; </span><br><span class="line">                &#125; </span><br><span class="line">            <span class="keyword">case</span> <span class="string">&#x27;noop&#x27;</span>: </span><br><span class="line">                <span class="keyword">break</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="äº‹ä»¶ç›‘å¬å™¨"><a href="#äº‹ä»¶ç›‘å¬å™¨" class="headerlink" title="äº‹ä»¶ç›‘å¬å™¨"></a>äº‹ä»¶ç›‘å¬å™¨</h2><p>åœ¨å¤„ç†åˆ›å»ºå’Œä¿®æ”¹ä¹‹å‰ï¼Œå…ˆè€ƒè™‘ä¸€ä¸‹å¦‚ä½•å¤„ç†äº‹ä»¶ç›‘å¬å™¨ã€‚</p><p>æœŸæœ›æ–¹ä¾¿æ·»åŠ å’Œåˆ é™¤ç›‘å¬å™¨ï¼Œä¸ä¼šç•™ä¸‹ç›‘å¬å™¨æœªç»‘å®šï¼Œä¸€ä¸ªèŠ‚ç‚¹çš„æ¯ä¸ªäº‹ä»¶åªæœ‰ä¸€ä¸ªç›‘å¬å™¨ï¼Œäº‹ä»¶åä½œä¸ºkeyä¸”ä¸èƒ½é‡å¤ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å‘DOMå¯¹è±¡æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰çš„ç‰¹æ®Šå±æ€§ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">element[<span class="string">&quot;_ui&quot;</span>] = &#123; listeners : &#123; <span class="attr">click</span>: doSomething &#125; &#125;;</span><br></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªlistenerå‡½æ•°ï¼Œä¸€æ—¦è§¦å‘äº‹ä»¶ï¼Œè¯¥å‡½æ•°å°±ä¼šè·å–æ­¤äº‹ä»¶ï¼Œå¹¶åˆ†é…ç»™å¯¹åº”çš„ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°æ¥å¤„ç†ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">listener</span>(<span class="params">event</span>) &#123; </span><br><span class="line">    <span class="keyword">const</span> el = event.<span class="property">currentTarget</span>; </span><br><span class="line">    <span class="keyword">const</span> handler = el.<span class="property">_ui</span>.<span class="property">listeners</span>[event.<span class="property">type</span>]; </span><br><span class="line">    <span class="title function_">handler</span>(event); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡‡ç”¨è¿™ç§åŠæ³•ï¼Œåœ¨ä¿®æ”¹ç›‘å¬å™¨å‡½æ•°æ—¶ï¼Œä¸éœ€è¦è°ƒç”¨addEventListenerå’ŒremoveEventListenerï¼Œåªéœ€è¦ä¿®æ”¹listenersä¸­å¯¹è±¡çš„å€¼ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥å°†äº‹ä»¶ç›‘å¬å™¨æ·»åŠ åˆ°DOMèŠ‚ç‚¹ä¸Šã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setListener</span>(<span class="params">el, event, handle</span>) &#123; </span><br><span class="line">    <span class="keyword">if</span> (el.<span class="property">_ui</span>.<span class="property">listeners</span>[event] === <span class="literal">undefined</span>) &#123; </span><br><span class="line">        el.<span class="title function_">addEventListener</span>(event, listener); </span><br><span class="line">    &#125; </span><br><span class="line">    el.<span class="property">_ui</span>.<span class="property">listeners</span>[event] = handle; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦åˆ¤æ–­propertiesä¸­çš„å±æ€§åæ˜¯å¦æ˜¯äº‹ä»¶ç›‘å¬å™¨ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">eventName</span>(<span class="params">str</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (str.<span class="title function_">indexOf</span>(<span class="string">&quot;on&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">slice</span>(<span class="number">2</span>).<span class="title function_">toLowerCase</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å±æ€§"><a href="#å±æ€§" class="headerlink" title="å±æ€§"></a>å±æ€§</h2><p>ä¸€éƒ¨åˆ†å±æ€§éœ€è¦è°ƒç”¨setAttributeè®¾ç½®ï¼Œå¦ä¸€éƒ¨åˆ†å±æ€§éœ€è¦ç›´æ¥åœ¨DOMèŠ‚ç‚¹ä¸Šè®¾ç½®ã€‚æ¯”å¦‚ï¼Œç»™å¤é€‰æ¡†è®¾ç½®æ˜¯å¦é€‰ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">checkboxDom.<span class="property">checked</span> = <span class="literal">true</span>; <span class="comment">// âˆš </span></span><br><span class="line">checkboxDom.<span class="title function_">setAttribute</span>(<span class="string">&quot;checked&quot;</span>, <span class="literal">true</span>); <span class="comment">// Ã— ä¸ç”Ÿæ•ˆ</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥å°†å…¶ä¸­ä¸€éƒ¨åˆ†å±æ€§æ”¾åœ¨åˆ—è¡¨ä¸­ï¼Œæ ¹æ®æ˜¯å¦å­˜åœ¨äºåˆ—è¡¨ä¸­æ¥å†³å®šè®¾ç½®å±æ€§çš„æ–¹å¼ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="keyword">new</span> <span class="title class_">Set</span>([ <span class="string">&quot;autoplay&quot;</span>, <span class="string">&quot;checked&quot;</span>, <span class="string">&quot;checked&quot;</span>, <span class="string">&quot;contentEditable&quot;</span>, <span class="string">&quot;controls&quot;</span>,</span><br><span class="line">  <span class="string">&quot;default&quot;</span>, <span class="string">&quot;hidden&quot;</span>, <span class="string">&quot;loop&quot;</span>, <span class="string">&quot;selected&quot;</span>, <span class="string">&quot;spellcheck&quot;</span>, <span class="string">&quot;value&quot;</span>, <span class="string">&quot;id&quot;</span>, <span class="string">&quot;title&quot;</span>,</span><br><span class="line">  <span class="string">&quot;accessKey&quot;</span>, <span class="string">&quot;dir&quot;</span>, <span class="string">&quot;dropzone&quot;</span>, <span class="string">&quot;lang&quot;</span>, <span class="string">&quot;src&quot;</span>, <span class="string">&quot;alt&quot;</span>, <span class="string">&quot;preload&quot;</span>, <span class="string">&quot;poster&quot;</span>,</span><br><span class="line">  <span class="string">&quot;kind&quot;</span>, <span class="string">&quot;label&quot;</span>, <span class="string">&quot;srclang&quot;</span>, <span class="string">&quot;sandbox&quot;</span>, <span class="string">&quot;srcdoc&quot;</span>, <span class="string">&quot;type&quot;</span>, <span class="string">&quot;value&quot;</span>, <span class="string">&quot;accept&quot;</span>,</span><br><span class="line">  <span class="string">&quot;placeholder&quot;</span>, <span class="string">&quot;acceptCharset&quot;</span>, <span class="string">&quot;action&quot;</span>, <span class="string">&quot;autocomplete&quot;</span>, <span class="string">&quot;enctype&quot;</span>, <span class="string">&quot;method&quot;</span>,</span><br><span class="line">  <span class="string">&quot;name&quot;</span>, <span class="string">&quot;pattern&quot;</span>, <span class="string">&quot;htmlFor&quot;</span>, <span class="string">&quot;max&quot;</span>, <span class="string">&quot;min&quot;</span>, <span class="string">&quot;step&quot;</span>, <span class="string">&quot;wrap&quot;</span>, <span class="string">&quot;useMap&quot;</span>, <span class="string">&quot;shape&quot;</span>,</span><br><span class="line">  <span class="string">&quot;coords&quot;</span>, <span class="string">&quot;align&quot;</span>, <span class="string">&quot;cite&quot;</span>, <span class="string">&quot;href&quot;</span>, <span class="string">&quot;target&quot;</span>, <span class="string">&quot;download&quot;</span>, <span class="string">&quot;download&quot;</span>,</span><br><span class="line">  <span class="string">&quot;hreflang&quot;</span>, <span class="string">&quot;ping&quot;</span>, <span class="string">&quot;start&quot;</span>, <span class="string">&quot;headers&quot;</span>, <span class="string">&quot;scope&quot;</span>, <span class="string">&quot;span&quot;</span> ]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setProperty</span>(<span class="params">prop, value, el</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (props.<span class="title function_">has</span>(prop)) &#123;</span><br><span class="line">    el[prop] = value;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    el.<span class="title function_">setAttribute</span>(prop, value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ›å»ºå’Œä¿®æ”¹"><a href="#åˆ›å»ºå’Œä¿®æ”¹" class="headerlink" title="åˆ›å»ºå’Œä¿®æ”¹"></a>åˆ›å»ºå’Œä¿®æ”¹</h2><p>æ ¹æ®è™šæ‹ŸDOMå¯¹è±¡åˆ›å»ºçœŸå®DOMå¯¹è±¡çš„æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">create</span>(<span class="params">vnode</span>) &#123;</span><br><span class="line">  <span class="comment">// æ–‡æœ¬èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">if</span> (vnode.<span class="property">text</span>!== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(vnode.<span class="property">text</span>);</span><br><span class="line">    <span class="keyword">return</span> el;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å…ƒç´ èŠ‚ç‚¹</span></span><br><span class="line">  <span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(vnode.<span class="property">tag</span>);</span><br><span class="line">  el.<span class="property">_ui</span> = &#123;<span class="attr">listeners</span>: &#123;&#125;&#125;;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">const</span> prop <span class="keyword">in</span> vnode.<span class="property">properties</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> event = <span class="title function_">eventName</span>(prop);</span><br><span class="line">    <span class="keyword">const</span> value = vnode.<span class="property">properties</span>[prop];</span><br><span class="line">    <span class="keyword">if</span> (event !== <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="title function_">setListener</span>(el, event, value);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">setProperty</span>(prop, value, el);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">const</span> childVNode <span class="keyword">of</span> vnode.<span class="property">children</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> child = <span class="title function_">create</span>(childVNode);</span><br><span class="line">    el.<span class="title function_">appendChild</span>(child);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> el;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">modify</span>(<span class="params">el, diff</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">const</span> prop <span class="keyword">in</span> diff.<span class="property">remove</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> event = <span class="title function_">eventName</span>(prop);</span><br><span class="line">    <span class="keyword">if</span> (event === <span class="literal">null</span>) &#123;</span><br><span class="line">      el.<span class="title function_">removeAttribute</span>(prop);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      el.<span class="property">_ui</span>.<span class="property">listeners</span>[event] = <span class="literal">undefined</span>;</span><br><span class="line">      el.<span class="title function_">removeEventListener</span>(event, listener);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">const</span> prop <span class="keyword">in</span> diff.<span class="property">set</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> value = diff.<span class="property">set</span>[prop];</span><br><span class="line">    <span class="keyword">const</span> event = <span class="title function_">eventName</span>(prop);</span><br><span class="line">    <span class="keyword">if</span> (event === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="title function_">setProperty</span>(prop, value, el);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_">setListener</span>(el, event, value);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">apply</span>(el, diff.<span class="property">children</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œmodifyå’Œapplyå­˜åœ¨é€’å½’è°ƒç”¨ã€‚</p><h1 id="å¤„ç†çŠ¶æ€"><a href="#å¤„ç†çŠ¶æ€" class="headerlink" title="å¤„ç†çŠ¶æ€"></a>å¤„ç†çŠ¶æ€</h1><p>æˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªå®Œæ•´çš„è™šæ‹ŸDOMæ¸²æŸ“å®ç°ã€‚ä½¿ç”¨hå’Œtextå¯ä»¥åˆ›å»ºä¸€ä¸ªè™šæ‹ŸDOMï¼Œä½¿ç”¨applyå’ŒdiffListå°†å…¶å…·ä½“åŒ–ä¸ºçœŸå®DOMå¹¶æ›´æ–°å®ƒã€‚</p><p>æˆ‘ä»¬å¯ä»¥åˆ°æ­¤ä¸ºæ­¢ï¼Œä½†æˆ‘è®¤ä¸ºå¦‚æœæ²¡æœ‰ç»“æ„åŒ–çš„æ–¹æ³•æ¥å¤„ç†çŠ¶æ€æ›´æ”¹ï¼Œé‚£ä¹ˆå®ç°æ˜¯ä¸å®Œæ•´çš„ã€‚æ€»ä¹‹ï¼Œè™šæ‹Ÿ DOM çš„å…¨éƒ¨æ„ä¹‰åœ¨äºï¼Œå½“çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæ‚¨å¯ä»¥é‡å¤åœ°é‡æ–°åˆ›å»ºå®ƒã€‚</p><h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p>æœ‰ä¸¤ç§ç±»å‹çš„ç”¨æˆ·å®šä¹‰å€¼ï¼š</p><ul><li><p>åº”ç”¨ç¨‹åºçŠ¶æ€<strong>state</strong>ï¼šåŒ…å«æ¸²æŸ“VDOMæ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯çš„å€¼ï¼›</p></li><li><p>åº”ç”¨ç¨‹åºæ¶ˆæ¯<strong>msg</strong>ï¼šåŒ…å«æœ‰å…³å¦‚ä½•æ›´æ”¹çŠ¶æ€çš„ä¿¡æ¯çš„å€¼ï¼›</p></li></ul><p>æˆ‘ä»¬ä¼šè¦æ±‚ç”¨æˆ·å®ç°ä¸¤ä¸ªåŠŸèƒ½ï¼š</p><ul><li><p><strong>view</strong>å‡½æ•°ï¼šå‚æ•°æ˜¯åº”ç”¨ç¨‹åºçŠ¶æ€ï¼Œè¿”å›å€¼æ˜¯VDOMï¼›</p></li><li><p><strong>update</strong>å‡½æ•°ï¼šå‚æ•°æ˜¯åº”ç”¨ç¨‹åºçŠ¶æ€å’Œä¸€æ¡åº”ç”¨ç¨‹åºæ¶ˆæ¯ï¼Œè¿”å›å€¼æ˜¯ä¸€ä¸ªæ–°çš„åº”ç”¨ç¨‹åºçŠ¶æ€ï¼›</p></li></ul><p>ç”¨æˆ·åœ¨ç¨‹åºå¼€å§‹æ—¶æä¾›è¿™ä¸¤ä¸ªå‡½æ•°ï¼ŒVDOM åº“å°†æ§åˆ¶ä½•æ—¶è°ƒç”¨å®ƒä»¬ã€‚ç”¨æˆ·ä»ä¸ç›´æ¥è°ƒç”¨å®ƒä»¬ã€‚</p><p>å¦å¤–ï¼Œç”¨æˆ·æ ¹æ®æˆ‘ä»¬è¿”å›çš„<strong>enqueue</strong>å‡½æ•°æ¥å‘å‡ºè¦é€šè¿‡ update å‡½æ•°å¤„ç†çš„æ¶ˆæ¯ã€‚å³ï¼Œè°ƒç”¨enqueueæ—¶ä¼ çš„å‚æ•°ä¼šæ˜¯updateå‡½æ•°çš„ç¬¬2ä¸ªå‚æ•°ã€‚</p><p>æœ€åï¼Œç”¨æˆ·è¿˜éœ€è¦æä¾›åˆå§‹çŠ¶æ€å’ŒVDOMæŒ‚è½½çš„èŠ‚ç‚¹ã€‚</p><p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåä¸º init çš„å‡½æ•°ï¼Œå®ƒå°†è·å–ç”¨æˆ·æ‰€éœ€çš„æ‰€æœ‰è¾“å…¥å¹¶å¯åŠ¨åº”ç”¨ç¨‹åºã€‚å®ƒå°†è¿”å›è¯¥åº”ç”¨ç¨‹åºçš„ enqueue å‡½æ•°ã€‚è¿™ç§è®¾è®¡å…è®¸æˆ‘ä»¬åœ¨åŒä¸€é¡µé¢ä¸­è¿è¡Œå¤šä¸ª VDOM åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½æœ‰è‡ªå·±çš„ enqueue åŠŸèƒ½ã€‚</p><p>ä»¥å®ç°ä¸€ä¸ªè®¡æ•°å™¨ä¸ºä¾‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">view</span>(<span class="params">state</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> [</span><br><span class="line">        <span class="title function_">h</span>(<span class="string">&quot;p&quot;</span>, &#123;&#125;, [ <span class="title function_">text</span>(<span class="string">`Counter: <span class="subst">$&#123;state.counter&#125;</span>`</span>) ])</span><br><span class="line">    ];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">update</span>(<span class="params">state, msg</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; counter : state.<span class="property">counter</span> + msg &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> initialState = &#123; <span class="attr">counter</span>: <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> root = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;.my-application&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; enqueue &#125; = <span class="title function_">init</span>(root, initialState, update, view);</span><br><span class="line"></span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> <span class="title function_">enqueue</span>(<span class="number">1</span>), <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><h2 id="initå‡½æ•°"><a href="#initå‡½æ•°" class="headerlink" title="initå‡½æ•°"></a>initå‡½æ•°</h2><p>æ€è€ƒä¸€ä¸‹å¦‚ä½•å®ç°initå‡½æ•°ã€‚</p><p>æˆ‘ä»¬è‚¯å®šä¼šä¸ºæ¯æ¡æ¶ˆæ¯è°ƒç”¨ä¸€æ¬¡ update ã€‚ä½†æˆ‘ä»¬ä¸éœ€è¦æ¯æ¬¡çŠ¶æ€æ›´æ”¹æ—¶éƒ½è°ƒç”¨ view ï¼Œå› ä¸ºè¿™å¯èƒ½ä¼šå¯¼è‡´æˆ‘ä»¬æ›´æ–° DOM çš„é¢‘ç‡è¶…è¿‡æµè§ˆå™¨èƒ½å¤Ÿæ˜¾ç¤º DOM æ›´æ–°çš„é¢‘ç‡ã€‚æˆ‘ä»¬å¸Œæœ›<em>æ¯ä¸ªåŠ¨ç”»å¸§</em>æœ€å¤šè°ƒç”¨ä¸€æ¬¡ view ã€‚</p><p>æ­¤å¤–ï¼Œæˆ‘ä»¬å¸Œæœ›ç”¨æˆ·èƒ½å¤Ÿæ ¹æ®éœ€è¦å¤šæ¬¡è°ƒç”¨ enqueue ï¼Œå¹¶ä¸”å¯ä»¥<em>ä»ä»»ä½•åœ°æ–¹è°ƒç”¨</em>ï¼Œè€Œä¸ä¼šå¯¼è‡´æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå´©æºƒã€‚è¿™æ„å‘³ç€æˆ‘ä»¬åº”è¯¥æ¥å— enqueue è¢«è°ƒç”¨ï¼Œå³ä½¿æ˜¯åœ¨ update å‡½æ•°ä¸­ã€‚</p><p>æˆ‘ä»¬å°†é€šè¿‡è§£è€¦æ¶ˆæ¯é˜Ÿåˆ—ã€æ›´æ–°çŠ¶æ€å’Œæ›´æ–° DOM æ¥å®ç°è¿™ä¸€ç‚¹ã€‚</p><p>è°ƒç”¨ enqueue åªä¼šå°†æ¶ˆæ¯æ·»åŠ åˆ°æ•°ç»„ä¸­ã€‚ç„¶åï¼Œåœ¨æ¯ä¸ªåŠ¨ç”»å¸§ä¸Šï¼Œæˆ‘ä»¬å°†è·å–æ‰€æœ‰æ’é˜Ÿçš„æ¶ˆæ¯ï¼Œå¹¶é€šè¿‡åœ¨æ¯ä¸ªåŠ¨ç”»å¸§ä¸Šè°ƒç”¨ update æ¥å¤„ç†å®ƒä»¬ã€‚å¤„ç†å®Œæ‰€æœ‰æ¶ˆæ¯åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ view å‡½æ•°å‘ˆç°ç»“æœçŠ¶æ€ã€‚</p><p>å…·ä½“å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">init</span>(<span class="params">root, initialState, update, view</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> state = initialState;</span><br><span class="line">  <span class="keyword">let</span> nodes = []; <span class="comment">// è™šæ‹ŸDOM</span></span><br><span class="line">  <span class="keyword">let</span> queue = []; <span class="comment">// æ¶ˆæ¯é˜Ÿåˆ—</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">enqueue</span>(<span class="params">msg</span>) &#123;</span><br><span class="line">    queue.<span class="title function_">push</span>(msg);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ ¹æ®å½“å‰çŠ¶æ€æ¸²æŸ“é¡µé¢</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> newNodes = <span class="title function_">view</span>(state); <span class="comment">// æ ¹æ®åˆå§‹çŠ¶æ€è¿”å›è™šæ‹Ÿnode</span></span><br><span class="line">    <span class="title function_">apply</span>(root, <span class="title function_">diffList</span>(nodes, newNodes)); <span class="comment">// å¯¹æ¯”æ–°æ—§è™šæ‹Ÿnodeå·®å¼‚ï¼Œç„¶åæ›´æ–°çœŸå®DOM</span></span><br><span class="line">    nodes = newNodes; <span class="comment">// å°†è™šæ‹ŸDOMè®¾ç½®ä¸ºæ–°çš„</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">updateState</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (queue.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> msgs = queue;</span><br><span class="line">      <span class="comment">// å°†é˜Ÿåˆ—æ›¿æ¢ä¸ºç©ºæ•°ç»„ï¼Œä»¥ä¾¿æˆ‘ä»¬åœ¨æœ¬è½®ä¸­ä¸å¤„ç†æ–°æ’é˜Ÿçš„æ¶ˆæ¯</span></span><br><span class="line">      queue = [];</span><br><span class="line">      <span class="keyword">for</span> (msg <span class="keyword">of</span> msgs) &#123;</span><br><span class="line">        state = <span class="title function_">update</span>(state, msg);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">draw</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">requestAnimationFrame</span>(updateState);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">draw</span>();         <span class="comment">// æ ¹æ®åˆå§‹çŠ¶æ€æ¸²æŸ“</span></span><br><span class="line">  <span class="title function_">updateState</span>();  <span class="comment">// å¯åŠ¨çŠ¶æ€æ›´æ–°å‘¨æœŸ</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; enqueue &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›®å‰ï¼Œä¸èƒ½ä»updateå’Œviewä¸­è°ƒç”¨enqueueï¼Œå› ä¸ºenqueueä»initè¿”å›ï¼Œè€Œæ‰§è¡Œinitæ—¶æœŸæœ›å·²å®šä¹‰updateå’Œviewã€‚</p><p>æƒ³åœ¨updateä¸­è°ƒç”¨enqueueï¼Œå¯ä»¥å°†enqueueä½œä¸ºupdateçš„ç¬¬3ä¸ªå‚æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">state = <span class="title function_">update</span>(state, msg, enqueue)</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ€è€ƒå¦‚ä½•åœ¨viewä¸­è°ƒç”¨enqueueã€‚</p><p>ç”¨æˆ·åœ¨æ¸²æŸ“æœŸé—´ä¸ä¼šè°ƒç”¨ enqueue ã€‚ä»–ä»¬ä¼šè°ƒç”¨å®ƒæ¥å“åº”æŸäº›äº‹ä»¶ï¼Œä¾‹å¦‚ onClick æˆ– onInput ã€‚å› æ­¤ï¼Œç”¨æˆ·ä¸ºè¿™äº›äº‹ä»¶åˆ›å»ºçš„å¤„ç†å‡½æ•°æ¥æ”¶ enqueue ä½œä¸ºå‚æ•°ä»¥åŠäº‹ä»¶å¯¹è±¡æ˜¯æœ‰æ„ä¹‰çš„ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> button = <span class="title function_">h</span>(</span><br><span class="line">    <span class="string">&quot;button&quot;</span>,</span><br><span class="line">    &#123; onClick : <span class="function">(<span class="params">_event, enqueue</span>) =&gt;</span> &#123; <span class="title function_">enqueue</span>(<span class="number">1</span>) &#125; &#125;,</span><br><span class="line">    [<span class="title function_">text</span>(<span class="string">&quot;Increase counter&quot;</span>)]</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†äº‹ä»¶å¤„ç†ç¨‹åºè¿”å›çš„ä¸ undefined ä¸åŒçš„ä»»ä½•å€¼éƒ½è§†ä¸ºæ¶ˆæ¯æ¥ä½¿å…¶å˜å¾—æ›´åŠ å®¹æ˜“ã€‚æ‰€ä»¥å¯ä»¥ç®€å†™ä¸ºå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> button = <span class="title function_">h</span>(</span><br><span class="line">    <span class="string">&quot;button&quot;</span>,</span><br><span class="line">    &#123; onClick : <span class="function">() =&gt;</span> <span class="number">1</span> &#125;,</span><br><span class="line">    [<span class="title function_">text</span>(<span class="string">&quot;Increase counter&quot;</span>)]</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬è°ƒåº¦äº‹ä»¶çš„å•ä¸ª listener å‡½æ•°éœ€è¦è®¿é—® enqueue ã€‚ä¼ é€’å®ƒçš„æœ€ç®€å•æ–¹æ³•æ˜¯é€šè¿‡å·²ä¿å­˜ç”¨æˆ·å®šä¹‰ä¾¦å¬å™¨çš„<br>**_ui ** å¯¹è±¡ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">listener</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> el = event.<span class="property">currentTarget</span>;</span><br><span class="line">  <span class="keyword">const</span> handler = el.<span class="property">_ui</span>.<span class="property">listeners</span>[event.<span class="property">type</span>];</span><br><span class="line">  <span class="keyword">const</span> enqueue = el.<span class="property">_ui</span>.<span class="property">enqueue</span>;</span><br><span class="line">  <span class="keyword">const</span> msg = <span class="title function_">handler</span>(event);</span><br><span class="line">  <span class="keyword">if</span> (msg !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="title function_">enqueue</span>(msg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦åœ¨èŠ‚ç‚¹åˆ›å»ºæ—¶å°† enqueue æ·»åŠ åˆ° _ui ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶ä¼ é€’ç»™ applyã€ modify å’Œ create ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">apply</span>(<span class="params">el, enqueue, childrenDiff</span>) &#123; ... &#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">modify</span>(<span class="params">el, enqueue, diff</span>) &#123; ... &#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">create</span>(<span class="params">enqueue, vnode</span>) &#123; ... &#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> props = <span class="keyword">new</span> <span class="title class_">Set</span>([ <span class="string">&quot;autoplay&quot;</span>, <span class="string">&quot;checked&quot;</span>, <span class="string">&quot;checked&quot;</span>, <span class="string">&quot;contentEditable&quot;</span>, <span class="string">&quot;controls&quot;</span>,</span><br><span class="line">  <span class="string">&quot;default&quot;</span>, <span class="string">&quot;hidden&quot;</span>, <span class="string">&quot;loop&quot;</span>, <span class="string">&quot;selected&quot;</span>, <span class="string">&quot;spellcheck&quot;</span>, <span class="string">&quot;value&quot;</span>, <span class="string">&quot;id&quot;</span>, <span class="string">&quot;title&quot;</span>,</span><br><span class="line">  <span class="string">&quot;accessKey&quot;</span>, <span class="string">&quot;dir&quot;</span>, <span class="string">&quot;dropzone&quot;</span>, <span class="string">&quot;lang&quot;</span>, <span class="string">&quot;src&quot;</span>, <span class="string">&quot;alt&quot;</span>, <span class="string">&quot;preload&quot;</span>, <span class="string">&quot;poster&quot;</span>,</span><br><span class="line">  <span class="string">&quot;kind&quot;</span>, <span class="string">&quot;label&quot;</span>, <span class="string">&quot;srclang&quot;</span>, <span class="string">&quot;sandbox&quot;</span>, <span class="string">&quot;srcdoc&quot;</span>, <span class="string">&quot;type&quot;</span>, <span class="string">&quot;value&quot;</span>, <span class="string">&quot;accept&quot;</span>,</span><br><span class="line">  <span class="string">&quot;placeholder&quot;</span>, <span class="string">&quot;acceptCharset&quot;</span>, <span class="string">&quot;action&quot;</span>, <span class="string">&quot;autocomplete&quot;</span>, <span class="string">&quot;enctype&quot;</span>, <span class="string">&quot;method&quot;</span>,</span><br><span class="line">  <span class="string">&quot;name&quot;</span>, <span class="string">&quot;pattern&quot;</span>, <span class="string">&quot;htmlFor&quot;</span>, <span class="string">&quot;max&quot;</span>, <span class="string">&quot;min&quot;</span>, <span class="string">&quot;step&quot;</span>, <span class="string">&quot;wrap&quot;</span>, <span class="string">&quot;useMap&quot;</span>, <span class="string">&quot;shape&quot;</span>,</span><br><span class="line">  <span class="string">&quot;coords&quot;</span>, <span class="string">&quot;align&quot;</span>, <span class="string">&quot;cite&quot;</span>, <span class="string">&quot;href&quot;</span>, <span class="string">&quot;target&quot;</span>, <span class="string">&quot;download&quot;</span>, <span class="string">&quot;download&quot;</span>,</span><br><span class="line">  <span class="string">&quot;hreflang&quot;</span>, <span class="string">&quot;ping&quot;</span>, <span class="string">&quot;start&quot;</span>, <span class="string">&quot;headers&quot;</span>, <span class="string">&quot;scope&quot;</span>, <span class="string">&quot;span&quot;</span> ]);</span><br><span class="line"><span class="comment">// ç»™çœŸå®DOMæ·»åŠ å±æ€§</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setProperty</span>(<span class="params">prop, value, el</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (props.<span class="title function_">has</span>(prop)) &#123;</span><br><span class="line">    el[prop] = value;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    el.<span class="title function_">setAttribute</span>(prop, value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“DOMè§¦å‘ç‚¹å‡»ç­‰äº‹ä»¶æ—¶è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚æ‰§è¡Œç»‘å®šçš„ç›‘å¬å›è°ƒå‡½æ•°ï¼ŒæŠŠç›‘å¬å›è°ƒå‡½æ•°çš„è¿”å›å€¼ä½œä¸ºæ¶ˆæ¯ä¼ é€’ç»™enqueueï¼Œenqueueæ¥æ›´æ–°æ¶ˆæ¯é˜Ÿåˆ—ã€‚</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">listener</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> el = event.<span class="property">currentTarget</span>;</span><br><span class="line">  <span class="keyword">const</span> handler = el.<span class="property">_ui</span>.<span class="property">listeners</span>[event.<span class="property">type</span>];</span><br><span class="line">  <span class="keyword">const</span> enqueue = el.<span class="property">_ui</span>.<span class="property">enqueue</span>;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">const</span> msg = <span class="title function_">handler</span>(event);</span><br><span class="line">  <span class="keyword">if</span> (msg !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="title function_">enqueue</span>(msg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨è™šæ‹ŸDOMåˆ›å»ºçœŸå®DOMæ—¶ç»‘å®šç›‘å¬å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">setListener</span>(<span class="params">el, event, handle</span>) &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">if</span> (el.<span class="property">_ui</span>.<span class="property">listeners</span>[event] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">    el.<span class="title function_">addEventListener</span>(event, listener);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  el.<span class="property">_ui</span>.<span class="property">listeners</span>[event] = handle;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ¤æ–­eventæ˜¯å¦æ˜¯å¯ä»¥ç›‘å¬çš„äº‹ä»¶</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">eventName</span>(<span class="params">str</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (str.<span class="title function_">indexOf</span>(<span class="string">&quot;on&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> str.<span class="title function_">slice</span>(<span class="number">2</span>).<span class="title function_">toLowerCase</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¯”è¾ƒè™šæ‹ŸDOM</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">diffOne</span>(<span class="params">l, r</span>) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> isText = l.<span class="property">text</span> !== <span class="literal">undefined</span>;</span><br><span class="line">  <span class="keyword">if</span> (isText) &#123;</span><br><span class="line">    <span class="keyword">return</span> l.<span class="property">text</span> !== r.<span class="property">text</span></span><br><span class="line">      ? &#123; <span class="attr">replace</span>: r &#125;</span><br><span class="line">      : &#123; noop : <span class="literal">true</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (l.<span class="property">tag</span> !== r.<span class="property">tag</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; <span class="attr">replace</span>: r &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> remove = [];</span><br><span class="line">  <span class="keyword">const</span> set = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> prop <span class="keyword">in</span> l.<span class="property">properties</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (r.<span class="property">properties</span>[prop] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">      remove.<span class="title function_">push</span>(prop);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> prop <span class="keyword">in</span> r.<span class="property">properties</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (r.<span class="property">properties</span>[prop] !== l.<span class="property">properties</span>[prop]) &#123;</span><br><span class="line">      set[prop] = r.<span class="property">properties</span>[prop];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> children = <span class="title function_">diffList</span>(l.<span class="property">children</span>, r.<span class="property">children</span>);</span><br><span class="line">  <span class="keyword">const</span> noChildrenChange = children.<span class="title function_">every</span>(<span class="function"><span class="params">e</span> =&gt;</span> e.<span class="property">noop</span>);</span><br><span class="line">  <span class="keyword">const</span> noPropertyChange =</span><br><span class="line">        (remove.<span class="property">length</span> === <span class="number">0</span>) &amp;&amp;</span><br><span class="line">        (<span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="title class_">Object</span>.<span class="title function_">keys</span>(set)).<span class="property">length</span> == <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (noChildrenChange &amp;&amp; noPropertyChange)</span><br><span class="line">    ? &#123; noop : <span class="literal">true</span> &#125;</span><br><span class="line">    : &#123; <span class="attr">modify</span>: &#123; remove, set, children &#125; &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">diffList</span>(<span class="params">ls, rs</span>) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> length = <span class="title class_">Math</span>.<span class="title function_">max</span>(ls.<span class="property">length</span>, rs.<span class="property">length</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">from</span>(&#123; length &#125;)</span><br><span class="line">    .<span class="title function_">map</span>(<span class="function">(<span class="params">_,i</span>) =&gt;</span></span><br><span class="line">      (ls[i] === <span class="literal">undefined</span>)</span><br><span class="line">      ? &#123; <span class="attr">create</span>: rs[i] &#125;</span><br><span class="line">      : (rs[i] == <span class="literal">undefined</span>)</span><br><span class="line">      ? &#123; <span class="attr">remove</span>: <span class="literal">true</span> &#125;</span><br><span class="line">      : <span class="title function_">diffOne</span>(ls[i], rs[i])</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ¹æ®æ–°æ—§è™šæ‹ŸDOMæ¯”è¾ƒç»“æœï¼Œåˆ›å»ºæ–°çš„çœŸå®DOM</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">create</span>(<span class="params">enqueue, vnode</span>) &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (vnode.<span class="property">text</span> !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">createTextNode</span>(vnode.<span class="property">text</span>);</span><br><span class="line">    <span class="keyword">return</span> el;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> el = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(vnode.<span class="property">tag</span>);</span><br><span class="line">  el.<span class="property">_ui</span> = &#123; listeners : &#123;&#125;, enqueue &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> prop <span class="keyword">in</span> vnode.<span class="property">properties</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> event = <span class="title function_">eventName</span>(prop);</span><br><span class="line">    <span class="keyword">const</span> value = vnode.<span class="property">properties</span>[prop];</span><br><span class="line">    (event === <span class="literal">null</span>)</span><br><span class="line">      ? <span class="title function_">setProperty</span>(prop, value, el)</span><br><span class="line">      : <span class="title function_">setListener</span>(el, event, value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> childVNode <span class="keyword">of</span> vnode.<span class="property">children</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> child = <span class="title function_">create</span>(enqueue, childVNode);</span><br><span class="line">    el.<span class="title function_">appendChild</span>(child);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> el;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ¹æ®å•ä¸ªæ–°æ—§è™šæ‹ŸDOMæ¯”è¾ƒç»“æœï¼Œä¿®æ”¹çœŸå®DOM</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">modify</span>(<span class="params">el, enqueue, diff</span>) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> prop <span class="keyword">of</span> diff.<span class="property">remove</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> event = <span class="title function_">eventName</span>(prop);</span><br><span class="line">    <span class="keyword">if</span> (event === <span class="literal">null</span>) &#123;</span><br><span class="line">      el.<span class="title function_">removeAttribute</span>(prop);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      el.<span class="property">_ui</span>.<span class="property">listeners</span>[event] = <span class="literal">undefined</span>;</span><br><span class="line">      el.<span class="title function_">removeEventListener</span>(event, listener);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> prop <span class="keyword">in</span> diff.<span class="property">set</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> value = diff.<span class="property">set</span>[prop];</span><br><span class="line">    <span class="keyword">const</span> event = <span class="title function_">eventName</span>(prop);</span><br><span class="line">    (event === <span class="literal">null</span>)</span><br><span class="line">      ? <span class="title function_">setProperty</span>(prop, value, el)</span><br><span class="line">      : <span class="title function_">setListener</span>(el, event, value);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  <span class="title function_">apply</span>(el, enqueue, diff.<span class="property">children</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†å­è™šæ‹ŸDOMå·®å¼‚ï¼Œä¿®æ”¹çœŸå®DOM</span></span><br><span class="line"><span class="comment">// applyå’Œmodifyäº’ç›¸é€’å½’è°ƒç”¨</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">apply</span>(<span class="params">el, enqueue, childrenDiff</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> children = <span class="title class_">Array</span>.<span class="title function_">from</span>(el.<span class="property">childNodes</span>);</span><br><span class="line"></span><br><span class="line">  childrenDiff.<span class="title function_">forEach</span>(<span class="function">(<span class="params">diff, i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> action = <span class="title class_">Object</span>.<span class="title function_">keys</span>(diff)[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">switch</span> (action) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;remove&quot;</span>:</span><br><span class="line">        children[i].<span class="title function_">remove</span>();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;modify&quot;</span>:</span><br><span class="line">        <span class="title function_">modify</span>(children[i], enqueue, diff.<span class="property">modify</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;create&quot;</span>: &#123;</span><br><span class="line">       </span><br><span class="line">        <span class="keyword">const</span> child = <span class="title function_">create</span>(enqueue, diff.<span class="property">create</span>);</span><br><span class="line">        el.<span class="title function_">appendChild</span>(child);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;replace&quot;</span>: &#123;</span><br><span class="line">        <span class="keyword">const</span> child = <span class="title function_">create</span>(enqueue, diff.<span class="property">replace</span>);</span><br><span class="line">        children[i].<span class="title function_">replaceWith</span>(child);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&quot;noop&quot;</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Unexpected diff option: &quot;</span> + <span class="title class_">Object</span>.<span class="title function_">keys</span>(diff));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºè™šæ‹ŸDOM</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">h</span>(<span class="params">tag, properties, children</span>) &#123;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">VirtualNode</span>(&#123; tag, properties, children &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">text</span>(<span class="params">content</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">VirtualNode</span>(&#123; <span class="attr">text</span>: content &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">init</span>(<span class="params">root, initialState, update, view</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> state = initialState;</span><br><span class="line">  <span class="keyword">let</span> nodes = [];</span><br><span class="line">  <span class="keyword">let</span> queue = [];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">enqueue</span>(<span class="params">msg</span>) &#123;</span><br><span class="line">    queue.<span class="title function_">push</span>(msg);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">draw</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> newNodes = <span class="title function_">view</span>(state);</span><br><span class="line">    <span class="title function_">apply</span>(root, enqueue, <span class="title function_">diffList</span>(nodes, newNodes));</span><br><span class="line">    nodes = newNodes;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">updateState</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (queue.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> msgs = queue;</span><br><span class="line">      queue = [];</span><br><span class="line"></span><br><span class="line">      msgs.<span class="title function_">forEach</span>(<span class="function"><span class="params">msg</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          state = <span class="title function_">update</span>(state, msg, enqueue);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">error</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="title function_">draw</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">window</span>.<span class="title function_">requestAnimationFrame</span>(updateState);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">draw</span>();</span><br><span class="line">  <span class="title function_">updateState</span>();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123; enqueue &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// å¯¼å‡ºinitã€hã€text</span></span><br></pre></td></tr></table></figure><h1 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h1><p>è®¡æ•°å™¨ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;container&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./smvc.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">const</span> &#123; init, h, text &#125; = <span class="variable constant_">SMVC</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">const</span> root = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#container&quot;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">const</span> initialState = <span class="number">0</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">const</span> <span class="title function_">update</span> = (<span class="params">state, msg, enqueue</span>) =&gt; state + msg;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">const</span> <span class="title function_">view</span> = (<span class="params">state</span>) =&gt; [</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">h</span>(<span class="string">&quot;div&quot;</span>, &#123; <span class="attr">style</span>: <span class="string">&quot;color: red&quot;</span>, <span class="attr">onClick</span>: <span class="function">() =&gt;</span> <span class="number">2</span> &#125;, [</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="title function_">h</span>(<span class="string">&quot;p&quot;</span>, &#123;&#125;, [</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">            <span class="title function_">text</span>(<span class="string">`The count is <span class="subst">$&#123;state&#125;</span>. Click here to increment.`</span>)</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          ])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        ])</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      ];</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">const</span> &#123; enqueue &#125; = <span class="title function_">init</span>(root, initialState, update, view);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">enqueue</span>(<span class="number">1</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p><a href="https://github.com/lazamar/smvc/blob/main/demos/todoMVC.js">todo MVC</a></p><p><a href="https://github.com/lazamar/smvc/blob/main/demos/million.js">å¤§é‡node</a></p><h1 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h1><p><a href="https://lazamar.github.io/virtual-dom/">åŸæ–‡é“¾æ¥</a></p><p><a href="https://github.com/lazamar/smvc/tree/main">è¯¥æ–‡ç« æ‰€å®ç°çš„åº“</a></p>]]></content>
      
      
      <categories>
          
          <category> æºç  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
            <tag> VDOM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>âœ¨å¦‚ä½•åˆ¤æ–­æ¥å£æ˜¯å¦åœ¨è®¾å®šæ—¶é—´å†…è¿”å›</title>
      <link href="/2024/07/02/api-return-within-time/"/>
      <url>/2024/07/02/api-return-within-time/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æŸäº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³è¦çŸ¥é“æ¥å£æ˜¯å¦åœ¨è®¾å®šæ—¶é—´å†…è¿”å›ã€‚æ¯”å¦‚ï¼Œè¯·æ±‚å‘å‡º30sè¿˜æ²¡è¿”å›å°±å¯ä»¥æç¤ºç”¨æˆ·å½“å‰å µå¡æ˜¯å¦ç»§ç»­æ’é˜Ÿã€‚æ¯”å¦‚ï¼ŒæŸä¸ªè¯·æ±‚æ­£å¸¸æƒ…å†µä¸‹3sè¿”å›ç»“æœï¼Œå¦‚æœç­‰30sæ²¡ç»“æœå°±å¯ä»¥ä¸¢å¼ƒè¿™æ¬¡ç»“æœã€‚æ¯”å¦‚ï¼Œè¶…è¿‡è®¾å®šæ—¶é—´åè‡ªåŠ¨é‡è¯•ã€‚</p><h1 id="axiosè®¾ç½®timeout"><a href="#axiosè®¾ç½®timeout" class="headerlink" title="axiosè®¾ç½®timeout"></a>axiosè®¾ç½®timeout</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> axios <span class="keyword">from</span> <span class="string">&#x27;axios&#x27;</span>; </span><br><span class="line"><span class="comment">// è®¾ç½®è¶…æ—¶æ—¶é—´ä¸º10ç§’ </span></span><br><span class="line"><span class="keyword">const</span> timeout = <span class="number">10000</span>; </span><br><span class="line"><span class="comment">// å‘é€è¯·æ±‚ </span></span><br><span class="line">axios.<span class="title function_">get</span>(<span class="string">&#x27;https://api.example.com/data&#x27;</span>, &#123; <span class="attr">timeout</span>: timeout &#125;) </span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯·æ±‚æˆåŠŸ:&#x27;</span>, response.<span class="property">data</span>); </span><br><span class="line">&#125;) </span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123; </span><br><span class="line">    <span class="keyword">if</span> (axios.<span class="title function_">isCancel</span>(error)) &#123; </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯·æ±‚å–æ¶ˆ:&#x27;</span>, error.<span class="property">message</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (error.<span class="property">code</span> === <span class="string">&#x27;ECONNABORTED&#x27;</span> &amp;&amp; error.<span class="property">message</span>.<span class="title function_">includes</span>(<span class="string">&#x27;timeout&#x27;</span>)) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯·æ±‚è¶…æ—¶&#x27;</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯·æ±‚å¤±è´¥:&#x27;</span>, error); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="vueuseçš„useFetch-timeout"><a href="#vueuseçš„useFetch-timeout" class="headerlink" title="vueuseçš„useFetch+timeout"></a>vueuseçš„useFetch+timeout</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; data &#125; = <span class="title function_">useFetch</span>(url, &#123; <span class="attr">timeout</span>: <span class="number">1000</span> &#125;)</span><br></pre></td></tr></table></figure><p>å¦‚æœåªæ˜¯åœ¨åˆ°è¾¾è®¾å®šæ—¶é—´åè¿›è¡Œä¸€äº›å¤„ç†ï¼Œä¸ä¸¢å¼ƒè¶…æ—¶ç»“æœï¼Œåˆ™å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; canAbort &#125; = <span class="title function_">useFetch</span>(url); </span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; </span><br><span class="line">    <span class="keyword">if</span> (canAbort.<span class="property">value</span>) &#123; </span><br><span class="line">        <span class="comment">// ... </span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;, <span class="number">1000</span>)</span><br></pre></td></tr></table></figure><h1 id="fetch-AbortController"><a href="#fetch-AbortController" class="headerlink" title="fetch+AbortController"></a>fetch+AbortController</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªAbortControllerå®ä¾‹ </span></span><br><span class="line"><span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>(); </span><br><span class="line"><span class="comment">// è·å–abortä¿¡å· </span></span><br><span class="line"><span class="keyword">const</span> signal = controller.<span class="property">signal</span>; </span><br><span class="line"><span class="comment">// å‘é€fetchè¯·æ±‚ï¼Œå¹¶å°†signalä¼ é€’ç»™fetché€‰é¡¹ </span></span><br><span class="line"><span class="title function_">fetch</span>(url, &#123; signal &#125;) </span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123; </span><br><span class="line">    <span class="keyword">if</span> (!response.<span class="property">ok</span>) &#123; </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Network response was not ok&#x27;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> response.<span class="title function_">json</span>(); </span><br><span class="line">&#125;) </span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯·æ±‚æˆåŠŸ:&#x27;</span>, data); </span><br><span class="line">&#125;) </span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123; </span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">name</span> === <span class="string">&#x27;AbortError&#x27;</span>) &#123; </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;è¯·æ±‚è¢«å–æ¶ˆ&#x27;</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;è¯·æ±‚å¤±è´¥:&#x27;</span>, error); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;); </span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; </span><br><span class="line">    controller.<span class="title function_">abort</span>(); </span><br><span class="line">&#125;, <span class="number">3000</span>);</span><br></pre></td></tr></table></figure><p>ğŸ‰ AbortControllerä¸æ”¯æŒIEã€‚</p><h1 id="Promise-race-setTimeout"><a href="#Promise-race-setTimeout" class="headerlink" title="Promise.race + setTimeout"></a>Promise.race + setTimeout</h1><p>ğŸ‡ å…ˆå¤ä¹ ä¸€ä¸‹Promise.raceï¼Œæ¥æ”¶ä¸€ä¸ªåŒ…å«å¤šä¸ªpromiseå¯¹è±¡çš„æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œ<em>åªè¦æœ‰ä¸€ä¸ª</em>promiseæ”¹å˜çŠ¶æ€ï¼ŒPromise.raceå°±ç«‹åˆ»è¿”å›ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timerPromise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123; </span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer1&quot;</span>); </span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&quot;timer end&quot;</span>); <span class="comment">// è¿™é‡Œä¼šæ‰§è¡Œï¼Œä½†Promise.race().thenæ¥æ”¶ä¸åˆ° </span></span><br><span class="line">    &#125;, <span class="number">10000</span>); </span><br><span class="line">&#125;); </span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fetchPromise</span> = (<span class="params"></span>) =&gt; &#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fetch</span>().<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123; </span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">code</span> !== <span class="number">200</span>) &#123; </span><br><span class="line">            <span class="comment">// æ¥å£é”™è¯¯å¤„ç† </span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">() =&gt;</span> &#123; &#125;); </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="keyword">return</span> res; </span><br><span class="line">     &#125;); </span><br><span class="line"> &#125;) </span><br><span class="line"> <span class="title class_">Promise</span>.<span class="title function_">race</span>([timerPromise, fetchPromise]).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123; </span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(res); </span><br><span class="line">     <span class="keyword">if</span> (res === <span class="string">&#x27;timeout&#x27;</span>) &#123; </span><br><span class="line">         <span class="comment">// å¤„ç†è¶…æ—¶åé€»è¾‘ </span></span><br><span class="line">         <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">() =&gt;</span> &#123; &#125;); </span><br><span class="line">     &#125; </span><br><span class="line">     <span class="keyword">return</span> res; </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœï¼š<br>start fetch<br>get fetch res<br>timer1</p><p>å¦å¤–ï¼Œéœ€è¦æ³¨æ„ï¼ŒfetchPromise.thenæ˜¯å…ˆäºPromise.race().thenæ‰§è¡Œçš„ã€‚</p><p>è¿™ç§æ–¹æ¡ˆå¯ä»¥å®ç°åœ¨è¶…æ—¶çš„æ—¶å€™è¿›è¡Œä¸€äº›æ“ä½œï¼Œè€Œä¸ä¸€å®šæŠ›å¼ƒè¯·æ±‚ç»“æœã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç å°±å¯ä»¥åœ¨è¶…æ—¶ä¹‹åè¿›è¡Œä¸€äº›æ“ä½œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> timerPromise = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span> &#123; </span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123; </span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;timer1&quot;</span>); </span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&quot;timer end&quot;</span>); </span><br><span class="line">    &#125;, <span class="number">10000</span>); </span><br><span class="line">&#125;); </span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fetchPromise</span> = (<span class="params"></span>) =&gt; &#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">fetch</span>().<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>()).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123; </span><br><span class="line">        <span class="keyword">if</span> (res.<span class="property">code</span> !== <span class="number">200</span>) &#123; </span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">() =&gt;</span> &#123; &#125;); </span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">// !!! åœ¨è¿™é‡Œè¿›è¡Œä¸€äº›æ“ä½œï¼Œå°±ç®—å…ˆè®¡æ—¶ç»“æŸï¼Œè¿™é‡Œä¹Ÿä¼šæ‰§è¡Œã€‚æ¯”å¦‚è®¾ç½®ä¸€äº›å…¨å±€å˜é‡ç­‰ã€‚                     console.log(&#x27;after timeout&#x27;); </span></span><br><span class="line">        <span class="keyword">return</span> res; </span><br><span class="line">    &#125;); </span><br><span class="line">&#125;) </span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">race</span>([timerPromise, fetchPromise]).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123; </span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(res); </span><br><span class="line">    <span class="keyword">if</span> (res === <span class="string">&#x27;timeout&#x27;</span>) &#123; </span><br><span class="line">        <span class="comment">// å¤„ç†è¶…æ—¶åé€»è¾‘ </span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">() =&gt;</span> &#123; &#125;); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> res; </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> è¯·æ±‚ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> axios </tag>
            
            <tag> fetch </tag>
            
            <tag> timeout </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxå®ç°ç›®å½•æµè§ˆåŠŸèƒ½åŠæƒé™æ ¡éªŒ</title>
      <link href="/2024/06/26/nginx-autoindex-auth/"/>
      <url>/2024/06/26/nginx-autoindex-auth/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>éœ€è¦å®ç°çš„åŠŸèƒ½æ˜¯ï¼Œæ‰“å¼€ <a href="http://a.b.c.d/">http://a.b.c.d</a> å¯ä»¥è®¿é—®æœåŠ¡å™¨ä¸Šçš„æŸä¸ªç›®å½•ã€‚è€Œä¸”ï¼Œåœ¨ç¬¬ä¸€æ¬¡ç™»å½•åŠç™»å½•è¿‡æœŸæ—¶ä¼šè¿›è¡Œç™»å½•ï¼Œç™»å½•æˆåŠŸåæ‰å¯ä»¥è®¿é—®åˆ°ç›®å½•ã€‚</p><h1 id="å¼€å¯ç›®å½•æµè§ˆåŠŸèƒ½"><a href="#å¼€å¯ç›®å½•æµè§ˆåŠŸèƒ½" class="headerlink" title="å¼€å¯ç›®å½•æµè§ˆåŠŸèƒ½"></a>å¼€å¯ç›®å½•æµè§ˆåŠŸèƒ½</h1><p>ä½¿ç”¨ <strong>autoindex</strong> æŒ‡ä»¤å¯ä»¥å¼€å¯ç›®å½•æµè§ˆåŠŸèƒ½ã€‚<br>ä¸ä»…è¦è®¾ç½®autoindexï¼Œè¿˜å¿…é¡»è¦è®¾ç½®rootæˆ–aliasã€‚</p><h2 id="è®¿é—®-æ—¶ï¼Œæ ¹ç›®å½•å¼€å¯ç›®å½•æµè§ˆ"><a href="#è®¿é—®-æ—¶ï¼Œæ ¹ç›®å½•å¼€å¯ç›®å½•æµè§ˆ" class="headerlink" title="è®¿é—® &#x2F; æ—¶ï¼Œæ ¹ç›®å½•å¼€å¯ç›®å½•æµè§ˆ"></a>è®¿é—® &#x2F; æ—¶ï¼Œæ ¹ç›®å½•å¼€å¯ç›®å½•æµè§ˆ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">localtion / &#123; </span><br><span class="line">    root /; </span><br><span class="line">    autoindex on; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è®¿é—®å­˜åœ¨çš„pathæ—¶ï¼Œè¯¥å­ç›®å½•å¼€å¯ç›®å½•æµè§ˆ"><a href="#è®¿é—®å­˜åœ¨çš„pathæ—¶ï¼Œè¯¥å­ç›®å½•å¼€å¯ç›®å½•æµè§ˆ" class="headerlink" title="è®¿é—®å­˜åœ¨çš„pathæ—¶ï¼Œè¯¥å­ç›®å½•å¼€å¯ç›®å½•æµè§ˆ"></a>è®¿é—®å­˜åœ¨çš„pathæ—¶ï¼Œè¯¥å­ç›®å½•å¼€å¯ç›®å½•æµè§ˆ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location /a/ &#123; </span><br><span class="line">    root /; </span><br><span class="line">    autoindex on; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è®¿é—®ä¸å­˜åœ¨çš„pathæ—¶ï¼ŒæŸä¸ªå­ç›®å½•å¼€å¯ç›®å½•æµè§ˆåŠŸèƒ½"><a href="#è®¿é—®ä¸å­˜åœ¨çš„pathæ—¶ï¼ŒæŸä¸ªå­ç›®å½•å¼€å¯ç›®å½•æµè§ˆåŠŸèƒ½" class="headerlink" title="è®¿é—®ä¸å­˜åœ¨çš„pathæ—¶ï¼ŒæŸä¸ªå­ç›®å½•å¼€å¯ç›®å½•æµè§ˆåŠŸèƒ½"></a>è®¿é—®ä¸å­˜åœ¨çš„pathæ—¶ï¼ŒæŸä¸ªå­ç›®å½•å¼€å¯ç›®å½•æµè§ˆåŠŸèƒ½</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">location</span> /x/ &#123; </span><br><span class="line">    <span class="attribute">alias</span> /b/; <span class="comment"># æ³¨æ„ æœ€åä¸€ä¸ª/æ˜¯å¿…éœ€çš„ </span></span><br><span class="line">    <span class="attribute">autoindex</span> <span class="literal">on</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å…¶ä»–autoindexæŒ‡ä»¤"><a href="#å…¶ä»–autoindexæŒ‡ä»¤" class="headerlink" title="å…¶ä»–autoindexæŒ‡ä»¤"></a>å…¶ä»–autoindexæŒ‡ä»¤</h2><ul><li><p><em>autoindex_exact_size</em> on | off;ï¼šæ§åˆ¶æ˜¯å¦æ˜¾ç¤ºæ–‡ä»¶çš„ç²¾ç¡®å¤§å°ã€‚é»˜è®¤ä¸º onã€‚</p></li><li><p><em>autoindex_format html</em> | xml | json | jsonp;ï¼šæŒ‡å®šç›®å½•åˆ—è¡¨çš„æ ¼å¼ã€‚é»˜è®¤ä¸º htmlã€‚</p></li><li><p><em>autoindex_localtime</em> on | off;ï¼šæ§åˆ¶æ˜¯å¦æ˜¾ç¤ºæ–‡ä»¶çš„æœ€åä¿®æ”¹æ—¶é—´ä¸ºæœ¬åœ°æ—¶é—´ã€‚é»˜è®¤ä¸º offã€‚</p></li></ul><h1 id="rootå’Œaliasçš„åŒºåˆ«"><a href="#rootå’Œaliasçš„åŒºåˆ«" class="headerlink" title="rootå’Œaliasçš„åŒºåˆ«"></a>rootå’Œaliasçš„åŒºåˆ«</h1><p>ç›¸åŒç‚¹ï¼šéƒ½ç”¨äºæŒ‡å®šè¯·æ±‚çš„æ–‡ä»¶åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä½ç½®ã€‚</p><p>ä¸åŒç‚¹ï¼š</p><p>ç¬¬ä¸€ï¼Œroot å¯ä»¥åœ¨ httpã€server æˆ– location å—ä¸­ä½¿ç”¨ï¼Œalias åªèƒ½åœ¨ <strong>location</strong> å—ä¸­ä½¿ç”¨ã€‚</p><p>ç¬¬äºŒï¼Œnginxå°†uri<strong>æ‹¼æ¥</strong>åœ¨rootæŒ‡å®šçš„è·¯å¾„åé¢ï¼Œä½†aliasä¼š<strong>æ›¿ä»£</strong>æŒ‡å®šçš„è·¯å¾„ã€‚</p><p>ä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /docs/ &#123; </span><br><span class="line">    root /var/www/html; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒ¹é…åˆ°è¿™æ¡è§„åˆ™æ—¶ï¼ŒnginxæŸ¥æ‰¾çš„æ–‡ä»¶æ˜¯ <em>&#x2F;var&#x2F;www&#x2F;html&#x2F;docs&#x2F;index.html</em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /docs/ &#123; </span><br><span class="line">    alias /var/www/html/; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒ¹é…åˆ°è¿™æ¡è§„åˆ™æ—¶ï¼ŒnginxæŸ¥æ‰¾çš„æ–‡ä»¶æ˜¯ <em>&#x2F;var&#x2F;www&#x2F;html&#x2F;index.html</em></p><h1 id="æƒé™æ ¡éªŒ"><a href="#æƒé™æ ¡éªŒ" class="headerlink" title="æƒé™æ ¡éªŒ"></a>æƒé™æ ¡éªŒ</h1><h2 id="æ ¡éªŒæ–¹æ³•ä¸€ï¼šauth-basic-user-file"><a href="#æ ¡éªŒæ–¹æ³•ä¸€ï¼šauth-basic-user-file" class="headerlink" title="æ ¡éªŒæ–¹æ³•ä¸€ï¼šauth_basic_user_file"></a>æ ¡éªŒæ–¹æ³•ä¸€ï¼š<strong>auth_basic_user_file</strong></h2><p>å°†ç”¨æˆ·åå¯†ç ä¿å­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå°†æ–‡ä»¶è·¯å¾„æ·»åŠ åˆ°é…ç½®ä¸­ã€‚</p><p>å¯†ç å¯ä»¥é€šè¿‡<a href="https://tool.oschina.net/htpasswd">tool-htpasswd</a>ç”Ÿæˆï¼Œwindowsä¸ŠåŠ å¯†ç®—æ³•é€‰md5ï¼Œlinuxä¸Šé€‰cryptã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location / &#123; </span><br><span class="line">    root /; </span><br><span class="line">    autoindex on; </span><br><span class="line">    auth_basic &quot;Authorized users only&quot;; </span><br><span class="line">    auth_basic_user_file /pwd/htpasswd; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>htpasswdç”Ÿæˆçš„å¯†ç çš„å‰ç¼€æŒ‡ç¤ºäº†åŠ å¯†æ–¹æ³•ã€‚nginxä¼šæ ¹æ®å¯†ç æ–‡ä»¶çš„å†…å®¹è‡ªåŠ¨è¯†åˆ«åŠ å¯†æ–¹å¼ã€‚</p><h2 id="æ ¡éªŒæ–¹æ³•äºŒï¼šè¯·æ±‚è‡ªå·±çš„ç™»å½•æ¥å£"><a href="#æ ¡éªŒæ–¹æ³•äºŒï¼šè¯·æ±‚è‡ªå·±çš„ç™»å½•æ¥å£" class="headerlink" title="æ ¡éªŒæ–¹æ³•äºŒï¼šè¯·æ±‚è‡ªå·±çš„ç™»å½•æ¥å£"></a>æ ¡éªŒæ–¹æ³•äºŒï¼šè¯·æ±‚è‡ªå·±çš„ç™»å½•æ¥å£</h2><p>å…·ä½“æ€è·¯ï¼šè®¿é—®æ—¶åˆ¤æ–­æ˜¯å¦æœ‰æŒ‡å®šcookieï¼Œå¦‚æœæ²¡æœ‰è·³ç™»å½•ï¼Œå¦‚æœæœ‰æ­£å¸¸è®¿é—®ã€‚ç™»å½•æ¥å£éœ€è¦èƒ½è·³è½¬å›æ¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location / &#123; </span><br><span class="line">    if ($cookie_my_cookie = &#x27;&#x27;) &#123; </span><br><span class="line">        return http://x.x.x.x/login?redirect_url=http://a.b.c.d; </span><br><span class="line">    &#125; </span><br><span class="line">    root /; </span><br><span class="line">    autoindex on; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ¥å£ä¸èƒ½æŠŠtokenæ³¨å…¥åˆ°cookieä¸­ï¼Œè€Œæ˜¯æ”¾åœ¨äº†è·³è½¬å›æ¥çš„queryå‚æ•°é‡Œï¼Œåˆ™éœ€è¦è‡ªå·±æ³¨å…¥cookieå¹¶ä¸”æŠŠurlé‡Œçš„queryæ¸…ç©ºï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">location / &#123; </span><br><span class="line">    if ($cookie_my_cookie = &#x27;&#x27;) &#123; </span><br><span class="line">        return http://x.x.x.x/login?redirect_url=http://a.b.c.d/login; </span><br><span class="line">    &#125; </span><br><span class="line">    root /; </span><br><span class="line">    autoindex on; </span><br><span class="line">&#125; </span><br><span class="line">location /login/ &#123; </span><br><span class="line">    add_header Set-Cookie &quot;my_cookie=$args&quot;; </span><br><span class="line">    rewrite ^/login(.*) /? permanent; # æ³¨æ„ /åé¢çš„?æ˜¯å¿…éœ€çš„ </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ¶‰åŠçš„NginxçŸ¥è¯†ç‚¹"><a href="#æ¶‰åŠçš„NginxçŸ¥è¯†ç‚¹" class="headerlink" title="æ¶‰åŠçš„NginxçŸ¥è¯†ç‚¹"></a>æ¶‰åŠçš„NginxçŸ¥è¯†ç‚¹</h1><h2 id="nginxå˜é‡"><a href="#nginxå˜é‡" class="headerlink" title="nginxå˜é‡"></a>nginxå˜é‡</h2><p><strong>$args</strong>ï¼šqueryå‚æ•°ï¼›</p><p><strong>$cookie_my_cookie</strong>ï¼šcookieä¸­nameä¸ºmy_cookieçš„å€¼ï¼›</p><h2 id="nginx-ifè¯­å¥"><a href="#nginx-ifè¯­å¥" class="headerlink" title="nginx ifè¯­å¥"></a>nginx ifè¯­å¥</h2><p>åªæœ‰ifï¼Œæ²¡æœ‰elseã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">if ($cookie_my_cookie = &quot;&quot;) &#123; </span><br><span class="line">    # å¦‚æœcookieä¸ºç©ºï¼Œæ‰§è¡Œä¸‹é¢çš„æ“ä½œ </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">if ($cookie_my_cookie ~* &quot;value&quot;) &#123; </span><br><span class="line">    # å¦‚æœcookieåŒ…å«valueï¼Œæ‰§è¡Œä¸‹é¢çš„æ“ä½œ </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">if ($cookie_my_cookie !~* &quot;value&quot;) &#123; </span><br><span class="line">    # å¦‚æœcookieä¸åŒ…å«valueï¼Œæ‰§è¡Œä¸‹é¢çš„æ“ä½œ </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h2><h3 id="returnæŒ‡ä»¤"><a href="#returnæŒ‡ä»¤" class="headerlink" title="returnæŒ‡ä»¤"></a>returnæŒ‡ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /x/ &#123; </span><br><span class="line">    return 301 http://localhost:8083/abc; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœè®¿é—®&#x2F;x?123ï¼Œä¼šè·³è½¬åˆ°&#x2F;abcã€‚</p><p>returnä¸ä»…å¯ä»¥è¿”å›ä¸€ä¸ªurlï¼Œä¹Ÿå¯ä»¥è¿”å›ä¸€å¥è¯æˆ–è€…ä¸€ä¸ªjsonã€‚</p><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯<strong>çŠ¶æ€ç </strong>ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯é€‰çš„<strong>æ¶ˆæ¯ä½“</strong>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">location / &#123; </span><br><span class="line">    default_type text/html; </span><br><span class="line">    return 200 &quot;Hello, World!&quot;; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">location / &#123; </span><br><span class="line">    default_type application/json; </span><br><span class="line">    return 200 &quot;&#123;a:1&#125;&quot;; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>text&#x2F;plainï¼šé€‚ç”¨äºè¿”å›çš„æ–‡æœ¬å†…å®¹ï¼Œé»˜è®¤å€¼ã€‚</p></li><li><p>text&#x2F;htmlï¼šé€‚ç”¨äºè¿”å›çš„HTMLå†…å®¹ã€‚</p></li><li><p>application&#x2F;jsonï¼šé€‚ç”¨äºè¿”å›çš„JSONæ ¼å¼å†…å®¹ã€‚</p></li><li><p>application&#x2F;xmlï¼šé€‚ç”¨äºè¿”å›çš„XMLæ ¼å¼å†…å®¹ã€‚</p></li><li><p>application&#x2F;octet-streamï¼šé€‚ç”¨äºè¿”å›çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</p></li></ul><h3 id="rewriteæŒ‡ä»¤"><a href="#rewriteæŒ‡ä»¤" class="headerlink" title="rewriteæŒ‡ä»¤"></a>rewriteæŒ‡ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /x/ &#123; </span><br><span class="line">    rewrite ^/x(.*) /y? permanent; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸åŠ ?ä¼šä¿ç•™åŸæ¥çš„queryå‚æ•°ï¼ŒåŠ ?ä¼šä¸ä¿ç•™ã€‚</p><h3 id="try-filesæŒ‡ä»¤"><a href="#try-filesæŒ‡ä»¤" class="headerlink" title="try_filesæŒ‡ä»¤"></a>try_filesæŒ‡ä»¤</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location /x/ &#123; </span><br><span class="line">    try_files $uri$uri/ /index.html; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±è¿”å›index.htmlã€‚</p><p><em>$uri</em>ï¼šå°è¯•åŒ¹é…ç¡®åˆ‡çš„è¯·æ±‚è·¯å¾„ã€‚</p><p>*$uri&#x2F;*ï¼šå°è¯•åŒ¹é…è¯·æ±‚è·¯å¾„çš„ç›®å½•ç‰ˆæœ¬ã€‚</p><h1 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h1><h2 id="nginxå‘½ä»¤"><a href="#nginxå‘½ä»¤" class="headerlink" title="nginxå‘½ä»¤"></a>nginxå‘½ä»¤</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">start nginx <span class="comment"># å¯åŠ¨ </span></span><br><span class="line">nginx -s reload <span class="comment"># åˆ·æ–° </span></span><br><span class="line">nginx -s stop <span class="comment"># å…³é—­ </span></span><br><span class="line">tasklist /fi <span class="string">&quot;imagename eq nginx.exe&quot;</span> <span class="comment"># æŸ¥çœ‹å…¨éƒ¨nginxè¿›ç¨‹ </span></span><br><span class="line">taskkill /pid pid /f <span class="comment"># å…³é—­æŸä¸ªnginxè¿›ç¨‹ </span></span><br><span class="line">taskkill /f /im nginx.exe <span class="comment"># å…³é—­æ‰€æœ‰nginxè¿›ç¨‹</span></span><br></pre></td></tr></table></figure><h2 id="location-aå’Œlocation-a-çš„åŒºåˆ«"><a href="#location-aå’Œlocation-a-çš„åŒºåˆ«" class="headerlink" title="location &#x2F;aå’Œlocation &#x2F;a&#x2F;çš„åŒºåˆ«"></a>location &#x2F;aå’Œlocation &#x2F;a&#x2F;çš„åŒºåˆ«</h2><p>location &#x2F;aåŒ¹é…&#x2F;aã€&#x2F;a&#x2F;ã€&#x2F;ab</p><p>location &#x2F;a&#x2F;åŒ¹é…&#x2F;a&#x2F;ã€&#x2F;a&#x2F;b</p><h2 id="åˆ·æ–°ä¸ç”Ÿæ•ˆ"><a href="#åˆ·æ–°ä¸ç”Ÿæ•ˆ" class="headerlink" title="åˆ·æ–°ä¸ç”Ÿæ•ˆ"></a>åˆ·æ–°ä¸ç”Ÿæ•ˆ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sendfile off;</span><br></pre></td></tr></table></figure><p>è¿˜å¯ä»¥æŸ¥çœ‹nginxè¿›ç¨‹æ˜¯å¦æœ‰å¾ˆå¤šä¸ªï¼Œå¦‚æœæ˜¯å…¨éƒ¨å…³é—­å†å¯åŠ¨ã€‚</p><h2 id="é…ç½®æœ¬åœ°åŸŸåæ˜ å°„"><a href="#é…ç½®æœ¬åœ°åŸŸåæ˜ å°„" class="headerlink" title="é…ç½®æœ¬åœ°åŸŸåæ˜ å°„"></a>é…ç½®æœ¬åœ°åŸŸåæ˜ å°„</h2><p>æ‰¾åˆ°<strong>hosts</strong>æ–‡ä»¶ï¼Œåœ¨C:\Windows\System32\drivers\etcä¸‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localhost my.com</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>tailwindä½¿ç”¨æŒ‡å—</title>
      <link href="/2024/06/18/tailwind-guide/"/>
      <url>/2024/06/18/tailwind-guide/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>tailwindå­¦ä¹ æ›²çº¿æ¯”è¾ƒé™¡å³­ï¼Œç†Ÿæ‚‰ä¹‹åä¼šæ–¹ä¾¿å¼€å‘ï¼Œä½†ç†Ÿæ‚‰ä¹‹å‰éœ€è¦é¢‘ç¹æŸ¥æ–‡æ¡£ã€‚ä¸‹é¢è®²ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨tailwindåŠå¸¸ç”¨æ ·å¼ï¼Œå¸®åŠ©å¿«é€Ÿä¸Šæ‰‹ã€‚æˆ‘ä½¿ç”¨çš„æŠ€æœ¯æ ˆæ˜¯<strong>vite+vue</strong>ã€‚</p><h1 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h1><h3 id="å®‰è£…-1"><a href="#å®‰è£…-1" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install -D tailwindcss postcss autoprefixer </span><br><span class="line">npx tailwindcss init -p</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ é…ç½®"><a href="#æ·»åŠ é…ç½®" class="headerlink" title="æ·»åŠ é…ç½®"></a>æ·»åŠ é…ç½®</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// tailwind.config.js </span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; </span><br><span class="line">    <span class="attr">content</span>: [ <span class="string">&quot;./index.html&quot;</span>, <span class="string">&quot;./src/**/*.&#123;vue,js,ts,jsx,tsx&#125;&quot;</span>, ], </span><br><span class="line">    <span class="attr">theme</span>: &#123; <span class="attr">extend</span>: &#123;&#125;, &#125;, </span><br><span class="line">    <span class="attr">plugins</span>: [], </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¼•å…¥tailwindæ ·å¼"><a href="#å¼•å…¥tailwindæ ·å¼" class="headerlink" title="å¼•å…¥tailwindæ ·å¼"></a>å¼•å…¥tailwindæ ·å¼</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// style<span class="selector-class">.css</span> </span><br><span class="line"><span class="keyword">@tailwind</span> base; </span><br><span class="line"><span class="keyword">@tailwind</span> components; </span><br><span class="line"><span class="keyword">@tailwind</span> utilities;</span><br></pre></td></tr></table></figure><p>åœ¨main.tsä¸­å¯¼å…¥è¯¥æ–‡ä»¶ã€‚</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">&quot;text-3xl font-bold underline&quot;</span>&gt;</span> Hello world! <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="å¸¸ç”¨æ ·å¼"><a href="#å¸¸ç”¨æ ·å¼" class="headerlink" title="å¸¸ç”¨æ ·å¼"></a>å¸¸ç”¨æ ·å¼</h1><p>tailwind<em>é¢„è®¾</em>äº†ä¸€éƒ¨åˆ†å±æ€§å€¼ï¼Œæ¯”å¦‚ w-1 è¡¨ç¤º width: 0.25rem; &#x2F;* 4px *&#x2F;ã€‚ä½†æ–°æ‰‹å¯ä»¥ä¸ä½¿ç”¨é¢„è®¾å€¼ï¼Œç›´æ¥ç”¨ [] è®¾ç½®è‡ªå®šä¹‰çš„å€¼ã€‚</p><div class="w-1"></div> <div class="w-[4px]"></div><h2 id="å®½é«˜"><a href="#å®½é«˜" class="headerlink" title="å®½é«˜"></a>å®½é«˜</h2><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>class</td><td>å±æ€§</td></tr><tr><td>w-[10px]</td><td>width: 10px;</td></tr><tr><td>h-[10px]</td><td>height: 10px;</td></tr><tr><td>min-w-[10px]</td><td>min-width: 10px;</td></tr><tr><td>max-w-[10px]</td><td>max-width: 10px;</td></tr><tr><td>size-[10px]</td><td>width: 10px;height: 10px;</td></tr></tbody></table><h2 id="å¸ƒå±€"><a href="#å¸ƒå±€" class="headerlink" title="å¸ƒå±€"></a>å¸ƒå±€</h2><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>class</td><td>å±æ€§</td></tr><tr><td>block</td><td>display: block;</td></tr><tr><td>flex</td><td>display: flex;</td></tr><tr><td>hidden</td><td>display: none;</td></tr><tr><td>box-border</td><td>box-sizing: border-box;</td></tr><tr><td>float-left</td><td>float: left;</td></tr><tr><td>overflow-hidden</td><td>overflow: hidden;</td></tr><tr><td>overflow-x-auto</td><td>overflow-x: auto;</td></tr><tr><td>absolute</td><td>position: absolute;</td></tr><tr><td>top-[10px]</td><td>top: 10px;</td></tr></tbody></table><h2 id="flex"><a href="#flex" class="headerlink" title="flex"></a>flex</h2><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>class</td><td>å±æ€§</td></tr><tr><td>flex-col</td><td>flex-direction: column;</td></tr><tr><td>flex-nowrap</td><td>flex-wrap: nowrap;</td></tr><tr><td>justify-center</td><td>justify-content: center;</td></tr><tr><td>items-center</td><td>align-items: center;</td></tr></tbody></table><h2 id="margin-padding"><a href="#margin-padding" class="headerlink" title="margin &amp; padding"></a>margin &amp; padding</h2><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>class</td><td>å±æ€§</td></tr><tr><td>m-[10px]</td><td>margin: 10px;</td></tr><tr><td>mx-[10px]</td><td>margin-left: 10px;margin-right: 10px;</td></tr><tr><td>ml-[10px]</td><td>margin-left: 10px;</td></tr></tbody></table><p>paddingå°±æ˜¯æŠŠmæ¢æˆpã€‚<strong>x</strong>ä»£è¡¨leftå’Œrightã€‚<strong>y</strong>ä»£è¡¨topå’Œbottomã€‚</p><h2 id="font"><a href="#font" class="headerlink" title="font"></a>font</h2><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>class</td><td>å±æ€§</td></tr><tr><td>text-[16px]</td><td>font-size: 16px;</td></tr><tr><td>font-bold</td><td>font-weight: 700;</td></tr><tr><td>text-center</td><td>text-align: center;</td></tr><tr><td>tracking-[2px]</td><td>letter-spacing: 2px;</td></tr><tr><td>text-[#000]</td><td>color: #000;</td></tr><tr><td>line-clamp-2</td><td>è¶…å‡º2è¡Œçœç•¥</td></tr><tr><td>leading-[30px]</td><td>line-height: 30px;</td></tr></tbody></table><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>class</td><td>å±æ€§</td></tr><tr><td>bg-[#000]</td><td>background-color: #000;</td></tr><tr><td>bg-[url(&#x2F;src&#x2F;assets&#x2F;xx.png)]</td><td>background-image: url(&#x2F;src&#x2F;assets&#x2F;xx.png);</td></tr><tr><td>bg-no-repeat</td><td>background-repeat: no-repeat;</td></tr><tr><td>bg-cover</td><td>background-size: cover;</td></tr><tr><td>bg-center</td><td>background-position: center;</td></tr></tbody></table><h2 id="border"><a href="#border" class="headerlink" title="border"></a>border</h2><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>class</td><td>å±æ€§</td></tr><tr><td>border-[2px]</td><td>border-width: 2px;</td></tr><tr><td>border-[#000]</td><td>border-color: #000;</td></tr><tr><td>border-solid</td><td>border-style: solid;</td></tr><tr><td>rounded-[4px]</td><td>border-radius: 4px;</td></tr><tr><td>divide-[#000]</td><td>é¢œè‰²ä¸º#000çš„åˆ†å‰²çº¿</td></tr></tbody></table><h2 id="åŠ¨ç”»"><a href="#åŠ¨ç”»" class="headerlink" title="åŠ¨ç”»"></a>åŠ¨ç”»</h2><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>class</td><td>å±æ€§</td></tr><tr><td>translate-x-[10px]</td><td>transform: translateX(10px);</td></tr><tr><td>scale-[1.1]</td><td>transform: scale(1.1);</td></tr><tr><td>rotate-[60deg]</td><td>transform: rotate(60deg);</td></tr><tr><td>origin-center</td><td>transform-origin: center;</td></tr><tr><td>transition-[height]</td><td>transition-property: height;</td></tr><tr><td>duration-[2000ms]</td><td>transition-duration: 2000ms;</td></tr><tr><td>ease-linear</td><td>transition-timing-function: linear;</td></tr><tr><td>delay-[2000ms]</td><td>transition-delay: 2000ms;</td></tr></tbody></table><p>animationæ¨ètheme.extendä¸­è®¾ç½®ã€‚</p><h2 id="äº¤äº’"><a href="#äº¤äº’" class="headerlink" title="äº¤äº’"></a>äº¤äº’</h2><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td>class</td><td>å±æ€§</td></tr><tr><td>cursor-pointer</td><td>cursor: pointer;</td></tr><tr><td>pointer-events-none</td><td>pointer-events: none;</td></tr></tbody></table><h1 id="è‡ªå®šä¹‰ä¸»é¢˜"><a href="#è‡ªå®šä¹‰ä¸»é¢˜" class="headerlink" title="è‡ªå®šä¹‰ä¸»é¢˜"></a>è‡ªå®šä¹‰ä¸»é¢˜</h1><p>åœ¨tailwind.config.jsä¸­å¯ä»¥è‡ªå®šä¹‰ä¸»é¢˜ã€‚å¯ä»¥è®¾ç½®çš„æ ·å¼åŒ…æ‹¬<strong>screens</strong>ã€<strong>colors</strong>ã€<strong>borderRadius</strong>ç­‰ç­‰ã€‚</p><p>åœ¨themeä¸­è®¾ç½®è¡¨ç¤ºè¦†ç›–æŸå±æ€§åŸæ¥çš„æ‰€æœ‰é€‰é¡¹ã€‚ä½†ï¼Œå¦‚æœæƒ³ä¿ç•™æŸå±æ€§é»˜è®¤çš„é€‰é¡¹ï¼Œä½†åˆæƒ³æ·»åŠ æ–°çš„é€‰é¡¹ï¼Œå¯ä»¥åœ¨theme.extendä¸­é…ç½®ã€‚</p><p>æ¯”å¦‚ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½éœ€è¦è®¾ç½®border-radius: 6pxï¼Œé‚£å¯ä»¥è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123; </span><br><span class="line">    <span class="attr">theme</span>: &#123; </span><br><span class="line">        <span class="attr">borderRadius</span>: &#123; </span><br><span class="line">            <span class="attr">DEFAULT</span>: <span class="string">&#x27;6px&#x27;</span>, </span><br><span class="line">            <span class="string">&#x27;lg&#x27;</span>: <span class="string">&#x27;12px&#x27;</span>, </span><br><span class="line">        &#125;, </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨å¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;rounded&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;rounded-lg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€ä¸ªdivçš„border-radiusä¸º6pxï¼Œç¬¬äºŒä¸ªdivçš„border-radiusä¸º12pxã€‚</p><h1 id="å¯èƒ½é‡åˆ°çš„é—®é¢˜"><a href="#å¯èƒ½é‡åˆ°çš„é—®é¢˜" class="headerlink" title="å¯èƒ½é‡åˆ°çš„é—®é¢˜"></a>å¯èƒ½é‡åˆ°çš„é—®é¢˜</h1><h2 id="åŠ¨æ€è®¾ç½®class"><a href="#åŠ¨æ€è®¾ç½®class" class="headerlink" title="åŠ¨æ€è®¾ç½®class"></a>åŠ¨æ€è®¾ç½®class</h2><p>åˆ©ç”¨ <strong>data-*</strong> å±æ€§</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">data-x</span>=<span class="string">&quot;a&quot;</span> <span class="attr">class</span>=<span class="string">&quot;bg-red data-[x=a]:bg-green&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ç‰¹æ®Šå±æ€§ä¸æ”¯æŒ"><a href="#ç‰¹æ®Šå±æ€§ä¸æ”¯æŒ" class="headerlink" title="ç‰¹æ®Šå±æ€§ä¸æ”¯æŒ"></a>ç‰¹æ®Šå±æ€§ä¸æ”¯æŒ</h2><p>å¦‚æœæŸäº›å±æ€§ï¼Œtailwindä¸æ”¯æŒï¼Œå¯ä»¥ç”¨ <strong>@layer utilities {}</strong> è®¾ç½®</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@layer</span> utilities &#123; </span><br><span class="line">    <span class="selector-class">.stroke-progress</span> &#123; </span><br><span class="line">        -webkit-<span class="selector-tag">text</span>-<span class="attribute">stroke</span>: <span class="number">0.4rem</span> <span class="number">#010507</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨tailwindåŒæ—¶ä½¿ç”¨UIç»„ä»¶åº“"><a href="#ä½¿ç”¨tailwindåŒæ—¶ä½¿ç”¨UIç»„ä»¶åº“" class="headerlink" title="ä½¿ç”¨tailwindåŒæ—¶ä½¿ç”¨UIç»„ä»¶åº“"></a>ä½¿ç”¨tailwindåŒæ—¶ä½¿ç”¨UIç»„ä»¶åº“</h2><p>å¦‚æœèˆä¸å¾—UIç»„ä»¶çš„æŸäº›åŠŸèƒ½ï¼Œæƒ³å’Œç»„ä»¶åº“æ­é…ä½¿ç”¨</p><p>å¯ä»¥ç”¨ <strong>@layer components{}</strong> ä¿®æ”¹UIåº“ç»„ä»¶çš„æ ·å¼</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@layer</span> components &#123; </span><br><span class="line">    <span class="selector-class">.el-dialog</span> &#123;&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="elementplusä¸‹æ‹‰æ¡†æ ·å¼"><a href="#elementplusä¸‹æ‹‰æ¡†æ ·å¼" class="headerlink" title="elementplusä¸‹æ‹‰æ¡†æ ·å¼"></a>elementplusä¸‹æ‹‰æ¡†æ ·å¼</h2><p>tailwind+elementplusï¼Œç»™ç»„ä»¶çš„ä¸‹æ‹‰æ¡†è®¾ç½®æ ·å¼æ—¶ï¼Œéœ€è¦è®¾ç½® <strong>:teleported&#x3D;â€falseâ€</strong> ï¼Œ@layeræ‰ä¼šç”Ÿæ•ˆã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æŒ‡å— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tailwind </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ç¿»è¯‘ã€‘å¦‚ä½•å®ç°ä¸€ä¸ªçº¯CSSè®¡æ—¶å™¨</title>
      <link href="/2024/06/17/css-timer/"/>
      <url>/2024/06/17/css-timer/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æœ‰æ—¶æˆ‘ä»¬ä¼šåœ¨é¡µé¢ä¸Šä½¿ç”¨è®¡æ—¶å™¨ã€‚é€šå¸¸æˆ‘ä»¬ä¼šç”¨jså®ç°è®¡æ—¶å™¨åŠŸèƒ½ï¼Œä½†æŸäº›æ—¶å€™æ›´é€‚åˆç”¨cssï¼Œæ¯”å¦‚æŸäº›é‚®ä»¶å®¢æˆ·ç«¯ä¸æ”¯æŒè¿è¡Œjsã€‚</p><h1 id="4ä¸ªå±æ€§"><a href="#4ä¸ªå±æ€§" class="headerlink" title="4ä¸ªå±æ€§"></a>4ä¸ªå±æ€§</h1><ul><li>counter()ï¼šä¸€ä¸ªcsså‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªä»£è¡¨è®¡æ•°å™¨çš„å½“å‰å€¼çš„å­—ç¬¦ä¸²ã€‚å®ƒé€šå¸¸å’Œä¼ªå…ƒç´ æ­é…ä½¿ç”¨ï¼Œä½†æ˜¯ç†è®ºä¸Šå¯ä»¥åœ¨æ”¯æŒå€¼çš„ä»»ä½•åœ°æ–¹ä½¿ç”¨ã€‚</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">counter(è®¡æ•°å™¨åç§°);</span><br></pre></td></tr></table></figure><ul><li>@propertyï¼šè‡ªå®šä¹‰csså±æ€§ï¼Œå…¼å®¹æ€§ä¸æ˜¯ç‰¹åˆ«å¥½ï¼Œå€¼çš„ç±»å‹å¯ä»¥æ˜¯<em>integer</em>ã€<em>number</em>ã€<em>color</em>ã€<em>url</em>ã€<em>percentage</em>ã€<em>transform-function</em>ç­‰ã€‚</li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">@property</span> --property-name &#123; </span><br><span class="line">    syntax: <span class="string">&quot;&lt;color&gt;&quot;</span>; // å€¼ç±»å‹æ£€æµ‹ </span><br><span class="line">    inherits: false; // æ˜¯å¦å…è®¸ç»§æ‰¿ </span><br><span class="line">    initial-value: <span class="number">#c0ffee</span>; // é»˜è®¤å€¼ </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/9dfff96036164eb2abe5299c708b6184~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="caniuse"></p><ul><li>ä¼ªå…ƒç´ </li><li>@keyframes</li></ul><h1 id="3ä¸ªè¦æ±‚"><a href="#3ä¸ªè¦æ±‚" class="headerlink" title="3ä¸ªè¦æ±‚"></a>3ä¸ªè¦æ±‚</h1><p>å®ç°çš„æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œé¼ æ ‡ç§»åŠ¨åˆ°æ¡†å†…å¼€å§‹å€’è®¡æ—¶ã€‚<br><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/3521f2df17864273846772fb9422bc15~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="æ•ˆæœ"></p><p>å®ç°è¿™ä¸ªè®¡æ—¶å™¨éœ€è¦åšåˆ°ä»¥ä¸‹3ç‚¹ï¼š</p><ul><li>å¯ä»¥ä»5é€’å‡åˆ°0çš„æ•°å­—ï¼›</li><li>ä¸€ç§è®¡æ—¶5ç§’å¹¶é€’å‡æ¯ä¸ªç§’æ•°çš„æ–¹æ³•ï¼›</li><li>ä¸€ç§åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºé€’å‡æ•°å­—çš„æ–¹æ³•ï¼›</li></ul><p>ç¬¬ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <strong>@property</strong> åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰å±æ€§ã€‚</p><pre><code>@property --n &#123;    syntax: &quot;&lt;integer&gt;&quot;;    inherits: false;    initial-value: 0; &#125;</code></pre><p>æ³¨æ„ï¼Œæ˜¯æ•´æ•°ç±»å‹ï¼ŒåŒ…æ‹¬0ã€æ­£æ•´æ•°ã€è´Ÿæ•´æ•°ã€‚å¦‚æœå¸Œæœ›æ˜¯å¸¦å°æ•°ç‚¹çš„æ•°å­—å¯ä»¥ç”¨<em>number</em>ã€‚</p><p>ç¬¬äºŒç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <strong>@keyframes</strong> å®ç°ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@keyframes</span> count &#123; </span><br><span class="line">    <span class="selector-tag">from</span> &#123; <span class="attr">--n</span>: <span class="number">5</span>; &#125; </span><br><span class="line">    <span class="selector-tag">to</span> &#123; <span class="attr">--n</span>: <span class="number">0</span>; &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="selector-class">.timer</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::after</span> &#123; </span><br><span class="line">    <span class="attribute">animation</span>: <span class="number">5s</span> linear count; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <strong>counter-reset</strong> å®ç°ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.timer</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::after</span> &#123; </span><br><span class="line">    <span class="attribute">animation</span>: <span class="number">5s</span> linear count; </span><br><span class="line">    <span class="attribute">animation-fill-mode</span>: forwards; </span><br><span class="line">    <span class="attribute">counter-reset</span>: n <span class="built_in">calc</span>(<span class="number">0</span> + <span class="built_in">var</span>(--n)); </span><br><span class="line">    <span class="attribute">content</span>: <span class="built_in">counter</span>(n); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>contentä¸æ¥å—æ•°å­—ç±»å‹çš„å€¼ï¼Œæ‰€ä»¥éœ€è¦å€ŸåŠ©counter()ã€‚<br>å‰é¢æè¿‡ï¼Œcounter()ï¼Œæ¥æ”¶è®¡æ•°å™¨åå­—åšå‚æ•°ï¼Œè¿”å›è®¡æ•°å™¨å½“å‰å€¼ã€‚</p><p>ä½¿ç”¨è®¡æ•°å™¨å‰å¿…é¡»ä½¿ç”¨counter-resetåˆå§‹åŒ–è®¡æ•°å™¨ã€‚<br>counter-resetï¼šç¬¬ä¸€ä¸ªå‚æ•°å¿…é€‰ï¼Œè®¡æ•°å™¨åï¼›ç¬¬äºŒä¸ªå‚æ•°ï¼Œè®¡æ•°å™¨åˆå§‹å€¼ï¼Œé»˜è®¤æ˜¯0ã€‚</p><h1 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h1><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> --n &#123;</span><br><span class="line">  syntax: <span class="string">&quot;&lt;integer&gt;&quot;</span>;</span><br><span class="line">  inherits: false;</span><br><span class="line">  initial-value: <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@keyframes</span> count &#123;</span><br><span class="line">  <span class="selector-tag">from</span> &#123; <span class="attr">--n</span>: <span class="number">5</span>; &#125;</span><br><span class="line">  <span class="selector-tag">to</span> &#123; <span class="attr">--n</span>: <span class="number">0</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.timer</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">::after</span> &#123;</span><br><span class="line">  <span class="attribute">animation</span>: <span class="number">5s</span> linear count;</span><br><span class="line">  <span class="attribute">animation-fill-mode</span>: forwards;</span><br><span class="line">  <span class="attribute">counter-reset</span>: n <span class="built_in">calc</span>(<span class="number">0</span> + <span class="built_in">var</span>(--n));</span><br><span class="line">  <span class="attribute">content</span>: <span class="built_in">counter</span>(n);</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.timer</span><span class="selector-pseudo">::after</span>&#123;</span><br><span class="line">  <span class="attribute">display</span>: block;</span><br><span class="line">  <span class="attribute">content</span>: <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">  <span class="attribute">line-height</span>: <span class="number">200px</span>;</span><br><span class="line">  <span class="attribute">height</span>: <span class="number">1</span>lh;</span><br><span class="line">  <span class="attribute">aspect-ratio</span>: <span class="number">1</span> / <span class="number">1</span>;</span><br><span class="line">  <span class="attribute">font-size</span>: <span class="number">92pt</span>;</span><br><span class="line">  <span class="attribute">text-align</span>: center;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> dashed black;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è¿›é˜¶"><a href="#è¿›é˜¶" class="headerlink" title="è¿›é˜¶"></a>è¿›é˜¶</h1><p>å€ŸåŠ©è¿™äº›çŸ¥è¯†ï¼Œå¯ä»¥è®¾è®¡æ›´å¤æ‚çš„è®¡æ•°å™¨ï¼Œæ¯”å¦‚å‘ä¸Šè®¡æ•°ï¼Œç¾åŒ–uiï¼Œä¸å…¶ä»–loadingï¼ˆæ¯”å¦‚åœ†å½¢è¿›åº¦æ¡ç­‰ï¼‰ç»“åˆã€‚</p><p><a href="https://codepen.io/rpsthecoder/pen/XWwdLPK">æ¼”ç¤º1</a><br><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/2f2cdbb17e124c78bef09c91a18d5ba1~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="1"></p><p><a href="https://codepen.io/rpsthecoder/pen/ExzxrWX">æ¼”ç¤º2</a><br><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/fc09a13466944f2b8b931ccf75585dcd~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="2"></p><p>å¦å¤–ï¼Œcssè‡ªå®šä¹‰å±æ€§ä¹Ÿå¯ä»¥åœ¨jsä¸­åˆ›å»ºå’Œä¿®æ”¹ï¼Œåˆ›å»ºç”¨ <strong>registerProperty(</strong>) ï¼Œä¿®æ”¹ç”¨ <strong>setProperty()</strong> ã€‚å¦‚æœæƒ³çŸ¥é“åŠ¨ç”»æ˜¯å¦å®Œæˆï¼Œå¯ä»¥ç”¨ <em>animationend</em> ç›‘å¬ã€‚</p><h1 id="é“¾æ¥"><a href="#é“¾æ¥" class="headerlink" title="é“¾æ¥"></a>é“¾æ¥</h1><p><a href="https://frontendmasters.com/blog/how-to-make-a-css-timer">åŸæ–‡</a></p><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_counter_styles/Using_CSS_counters">MDNï¼šä½¿ç”¨cssè®¡æ•°å™¨</a></p>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> timer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®ç°è‡ªå®šä¹‰è„šæ‰‹æ¶</title>
      <link href="/2024/04/23/custom-cli/"/>
      <url>/2024/04/23/custom-cli/</url>
      
        <content type="html"><![CDATA[<h1 id="ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰è„šæ‰‹æ¶ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰è„šæ‰‹æ¶ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰è„šæ‰‹æ¶ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰è„šæ‰‹æ¶ï¼Ÿ</h1><p>é¦–å…ˆï¼Œæ¯æ¬¡åˆ›å»ºé¡¹ç›®åéƒ½éœ€è¦å¾ˆå¤šé‡å¤æ€§æ“ä½œï¼Œæ¯”å¦‚å®‰è£…UIåº“ã€cssé¢„å¤„ç†å™¨ã€‚åœ¨ä¸šåŠ¡å±‚é¢ï¼Œæ¯æ¬¡ä¹Ÿè¦æ·»åŠ ä¸€äº›å¿…å¤‡çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ç™»å½•ã€404é¡µé¢ç­‰ã€‚å…¶æ¬¡ï¼Œå¯ä»¥é”»ç‚¼è‡ªå·±çš„æŠ€æœ¯ã€‚</p><h1 id="è„šæ‰‹æ¶çš„åŠŸèƒ½"><a href="#è„šæ‰‹æ¶çš„åŠŸèƒ½" class="headerlink" title="è„šæ‰‹æ¶çš„åŠŸèƒ½"></a>è„šæ‰‹æ¶çš„åŠŸèƒ½</h1><p>è„šæ‰‹æ¶åˆ›å»ºé¡¹ç›®çš„æµç¨‹ï¼š</p><ol><li><p><strong>è®©ç”¨æˆ·é€‰æ‹©æ¨¡æ¿ï¼›</strong></p></li><li><p><strong>æ ¹æ®ç”¨æˆ·è¾“å…¥å¡«å……æ¨¡æ¿ï¼›</strong></p></li><li><p><strong>ä¸‹è½½æ¨¡æ¿æ–‡ä»¶åˆ°åˆ›å»ºçš„æ–°æ–‡ä»¶å¤¹ä¸­ï¼›</strong></p></li></ol><p>ä»æ¡†æ¶æ¥çœ‹ï¼Œåˆ›å»ºé¡¹ç›®çš„æ—¶å€™éœ€è¦é€‰æ‹©æ˜¯vueæ¡†æ¶è¿˜æ˜¯reactæ¡†æ¶ï¼Œä»¥åŠæ˜¯å¦éœ€è¦æ·»åŠ  typescriptã€‚</p><p>ä»æ’ä»¶æ¥çœ‹ï¼Œéœ€è¦å®‰è£…UIåº“ã€CSSé¢„å¤„ç†å™¨ã€è·¯ç”±ã€å…¨å±€çŠ¶æ€ç®¡ç†å™¨ã€‚</p><p>ä»é¡¹ç›®åŠŸèƒ½æ¥çœ‹ï¼Œè¿˜éœ€è¦å°è£…fetchè¯·æ±‚ã€ç™»å½•ã€æœªç™»å½•é¡µé¢ã€404é¡µé¢ã€éƒ¨ç½²é…ç½®æ–‡ä»¶ã€‚</p><p>å†å‚è€ƒä¸€ä¸‹viteï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆè®¾ç½®å‡ ä¸ªæ¨¡æ¿ï¼Œç„¶åæŠŠå°åŠŸèƒ½å¡«å……åˆ°æ¨¡æ¿é‡Œé¢ã€‚</p><h1 id="å…·ä½“çš„é€»è¾‘"><a href="#å…·ä½“çš„é€»è¾‘" class="headerlink" title="å…·ä½“çš„é€»è¾‘"></a>å…·ä½“çš„é€»è¾‘</h1><p><strong>1.åˆ¤æ–­è¿œç¨‹æ˜¯å¦æœ‰æ›´æ–°ç‰ˆæœ¬ï¼Œå¦‚æœæœ‰è¯¢é—®ç”¨æˆ·æ˜¯å¦æ›´æ–°ã€‚</strong></p><p>å½“å‰ç‰ˆæœ¬ä»package.jsonä¸­è·å–ã€‚</p><p>è¿œç¨‹ç‰ˆæœ¬ç”¨<code>exec()</code>è·å–ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">exec</span>(<span class="string">&#x27;npm show xx version&#x27;</span>, <span class="function">(<span class="params">error, stdout, stderr</span>) =&gt;</span> &#123;&#125;)</span><br></pre></td></tr></table></figure><p><strong>2.è¯¢é—®ç”¨æˆ·æƒ³è¦çš„åŠŸèƒ½</strong></p><p>ç”¨<code>inquirer</code>åº“ã€‚</p><p>è¯¢é—®é¡¹ç›®åã€æ¡†æ¶ã€æ˜¯å¦æ·»åŠ  typescriptã€æ˜¯å¦æ·»åŠ  electron å’Œ æ˜¯å¦æ·»åŠ ç™»å½•</p><p><strong>3.æ‹‰å–æ¨¡æ¿ï¼Œæ‹·è´æ¨¡æ¿åˆ°å½“å‰é¡¹ç›®ã€‚</strong></p><p>æ¨¡æ¿å°±æ˜¯å®Œæ•´çš„æœ€åŸºç¡€çš„é¡¹ç›®ï¼Œå¦‚æœæ˜¯å¿…éœ€çš„åŠŸèƒ½å°±ç›´æ¥åŠ è¿›å»ï¼Œå¦‚æœéœ€è¦ç”¨æˆ·é€‰æ‹©æ˜¯å¦æ·»åŠ åˆ™æŠŠè¯¥åŠŸèƒ½æ‰€åœ¨æ–‡ä»¶æ”¹ä¸º<strong>ejs</strong>æ–‡ä»¶ã€‚</p><p>åœ¨æ‹·è´ä¸­åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ˜¯ejsæ–‡ä»¶ï¼Œå¦‚æœæ˜¯åˆ™æŠŠç”¨æˆ·çš„é€‰æ‹©éƒ½ä¼ è¿›å»ã€‚</p><p>å¦‚æœå·²ç»æœ‰åŒåé¡¹ç›®ï¼Œåˆ™åœ¨é¡¹ç›®åååŠ ï¼ˆnï¼‰ã€‚</p><p><em>æ³¨ï¼šæ‹·è´çš„æ—¶å€™æ¨¡æ¿éœ€è¦ç”¨ç›¸å¯¹è·¯å¾„è·å–ã€‚</em></p><p><em>å¯ä»¥ç”¨oraåº“æ·»åŠ loadingã€‚</em></p><h1 id="å¯èƒ½é‡åˆ°çš„é—®é¢˜"><a href="#å¯èƒ½é‡åˆ°çš„é—®é¢˜" class="headerlink" title="å¯èƒ½é‡åˆ°çš„é—®é¢˜"></a>å¯èƒ½é‡åˆ°çš„é—®é¢˜</h1><p><strong>1.npm createå‘½ä»¤</strong></p><p>npm createç­‰ä»·äºnpm init</p><p>npm init æ˜¯æ–°å»ºpackage.jsonæ–‡ä»¶ï¼Œä½† npm create xx ä¼šå…ˆå®‰è£…ä¸€ä¸ªcreate-xxçš„åŒ…ï¼Œç„¶åæ‰§è¡Œè¿™ä¸ªåŒ…ä¸­çš„create-xxå‘½ä»¤</p><p>é€šè¿‡npm exec create-xxæ¥æ‰§è¡Œï¼Œnpm execå¯ä»¥æ‰§è¡Œæœ¬åœ°æˆ–è¿œç¨‹åŒ…ä¸­çš„å‘½ä»¤ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥<strong>è®¾ç½®package.jsonä¸­é¡¹ç›®åä¸ºxx</strong>ï¼Œå‘å¸ƒè„šæ‰‹æ¶åï¼Œç”¨æˆ·å°±å¯ä»¥é€šè¿‡<strong>npm create xx</strong>æ¥é€šè¿‡è„šæ‰‹æ¶åˆ›å»ºé¡¹ç›®ã€‚</p><p><strong>2.npm link</strong></p><p>å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤åœ¨æœ¬åœ°æµ‹è¯•è„šæ‰‹æ¶ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">npm link å°†å½“å‰ç›®å½•é“¾æ¥åˆ°å…¨å±€</span><br><span class="line"></span><br><span class="line">npm list -g --depth=<span class="number">0</span> æŸ¥çœ‹å…¨å±€list</span><br><span class="line"></span><br><span class="line">npm unlink -g xx åˆ é™¤ï¼Œå¦‚æœæ˜¯å…¨å±€ä¸€å®šè¦åŠ -g</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>3.å‘½ä»¤æ— æ³•æ‰§è¡Œ</strong></p><p>bin&#x2F;xx.jsæ–‡ä»¶å¼€å¤´è¦åŠ </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>scriptå£°æ˜å‘½ä»¤æ—¶ï¼Œæ–‡ä»¶éœ€è¦æ·»åŠ .jsåç¼€</p><p><strong>4.ejsæ¡ä»¶æ¸²æŸ“æ—¶ç•™ä¸‹ç©ºè¡Œ</strong></p><p>&lt;%_ â€¦ _%&gt;æ˜¯ä¸å¯è¡Œçš„ã€‚éœ€è¦å°†å¼€å§‹æ ‡ç­¾ç´§è´´ç€å‰ä¸€è¡Œï¼Œç»“æŸæ ‡ç­¾ç´§è´´ç€å¯èƒ½æ˜¾ç¤ºçš„è¡Œã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="number">1</span>,&lt;% <span class="keyword">if</span> (flag) &#123; %&gt; </span><br><span class="line">    <span class="attr">b</span>: <span class="number">2</span>,&lt;% &#125; %&gt; </span><br><span class="line">    <span class="attr">c</span>: <span class="number">3</span>, </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>5.ç”Ÿæˆçš„é¡¹ç›®ä¸­ä¸åŒ…å«.ignoreæ–‡ä»¶</strong></p><p>å°†.ignoreé‡å‘½åä¸ºignoreï¼Œå¤åˆ¶å®Œæ‰€æœ‰æ–‡ä»¶åï¼Œå•ç‹¬å¤åˆ¶ignoreæ–‡ä»¶ä¸º.ignoreï¼Œå¹¶åˆ é™¤å¤åˆ¶åçš„ignore</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.<span class="title function_">copyFileSync</span>(<span class="string">`<span class="subst">$&#123;sourceDir&#125;</span>/gitignore`</span>, <span class="string">`<span class="subst">$&#123;targetDir&#125;</span>/.gitignore`</span>); fs.<span class="title function_">unlinkSync</span>(<span class="string">`<span class="subst">$&#123;targetDir&#125;</span>/gitignore`</span>);</span><br></pre></td></tr></table></figure><p><strong>6.å¼•ç”¨requireræ—¶æŠ¥é”™Error [ERR_REQUIRE_ESM]: require() of ES Module â€¦ from â€¦ is not supported</strong></p><p>é™ç‰ˆæœ¬ï¼Œå¯ä»¥é™åˆ°v8.2.0</p>]]></content>
      
      
      <categories>
          
          <category> æŒ‡å— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> vue </tag>
            
            <tag> cli </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç»™svgè®¾ç½®cursorä¸ç”Ÿæ•ˆ</title>
      <link href="/2024/02/26/svg-cursor/"/>
      <url>/2024/02/26/svg-cursor/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>é¡¹ç›®ä¸­ä¸€èˆ¬ç”¨ svg åšå°å›¾æ ‡æˆ–èƒŒæ™¯å›¾ï¼ŒèƒŒæ™¯å›¾ä¸éœ€è¦è®¾ç½® cursorï¼Œ å°å›¾æ ‡ä¼šå†™æˆå•ä¸ªçš„ IconXx.vue æ–‡ä»¶ã€‚å‰ä¸ä¹…é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œéœ€è¦å±•ç¤º svgï¼Œå¹¶ä¸”å¯ç‚¹å‡»ï¼Œè¿™å°±éœ€è¦è®¾ç½® cursorï¼Œä½†ç›´æ¥è®¾ç½®ä¸ä¼šç”Ÿæ•ˆã€‚</p><h1 id="svg-æ’å…¥é¡µé¢çš„æ–¹æ³•"><a href="#svg-æ’å…¥é¡µé¢çš„æ–¹æ³•" class="headerlink" title="svg æ’å…¥é¡µé¢çš„æ–¹æ³•"></a>svg æ’å…¥é¡µé¢çš„æ–¹æ³•</h1><p>SVG æ–‡ä»¶å¯é€šè¿‡ä»¥ä¸‹æ ‡ç­¾åµŒå…¥ HTML æ–‡æ¡£ï¼š<code>&lt;embed&gt;</code>ã€<code>&lt;object&gt;</code>ã€<code>&lt;iframe&gt;</code>ã€‚<br>SVGçš„ä»£ç å¯ä»¥ç›´æ¥åµŒå…¥åˆ°HTMLé¡µé¢ä¸­ï¼Œæˆ–æ‚¨å¯ä»¥ç›´æ¥é“¾æ¥åˆ°SVGæ–‡ä»¶ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">embed</span> <span class="attr">src</span>=<span class="string">&quot;circle1.svg&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/svg+xml&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">object</span> <span class="attr">data</span>=<span class="string">&quot;circle1.svg&quot;</span> <span class="attr">type</span>=<span class="string">&quot;image/svg+xml&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;circle1.svg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.w3.org/2000/svg&quot;</span> <span class="attr">version</span>=<span class="string">&quot;1.1&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">circle</span> <span class="attr">cx</span>=<span class="string">&quot;100&quot;</span> <span class="attr">cy</span>=<span class="string">&quot;50&quot;</span> <span class="attr">r</span>=<span class="string">&quot;40&quot;</span> <span class="attr">stroke</span>=<span class="string">&quot;black&quot;</span> <span class="attr">stroke-width</span>=<span class="string">&quot;2&quot;</span> <span class="attr">fill</span>=<span class="string">&quot;red&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;circle1.svg&quot;</span>&gt;</span>æŸ¥çœ‹ SVG æ–‡ä»¶<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="åœ¨-svg-ä»£ç ä¸­è®¾ç½®-cursor"><a href="#åœ¨-svg-ä»£ç ä¸­è®¾ç½®-cursor" class="headerlink" title="åœ¨ svg ä»£ç ä¸­è®¾ç½® cursor"></a>åœ¨ svg ä»£ç ä¸­è®¾ç½® cursor</h1><p>è¿™æ ·ä¸ä½†å¯ä»¥è®¾ç½®æ•´ä¸ª svg çš„å…‰æ ‡ï¼Œè€Œä¸”å¯ä»¥è®¾ç½®é‡Œé¢å•ä¸ªå…ƒç´ çš„å…‰æ ‡ã€‚<br>ç¼ºç‚¹æ˜¯éœ€è¦èƒ½ä¿®æ”¹ svg ä»£ç ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">svg</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-tag">svg</span> &#123; <span class="attribute">cursor</span>: pointer; &#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="comment">/* OR */</span></span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css">    <span class="selector-class">.element-name</span> &#123; <span class="attribute">cursor</span>: pointer; &#125;</span></span><br><span class="line"><span class="language-css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">svg</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="åŒ…è£¹ä¸€ä¸‹-svg"><a href="#åŒ…è£¹ä¸€ä¸‹-svg" class="headerlink" title="åŒ…è£¹ä¸€ä¸‹ svg"></a>åŒ…è£¹ä¸€ä¸‹ svg</h1><p>åœ¨ svg çš„å¤–å±‚æ·»åŠ ä¸€å±‚ divï¼Œç»™è¿™ä¸ª div è®¾ç½®å…‰æ ‡ã€‚</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;svg-wrapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">object</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">embed</span> <span class="attr">src</span>=<span class="string">&quot;img.svg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">embed</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.svg-wrapper</span> &#123;</span><br><span class="line">    <span class="attribute">cursor</span>: pointer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> bug </category>
          
      </categories>
      
      
        <tags>
            
            <tag> svg </tag>
            
            <tag> cursor </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git LFSè§£å†³å¤§æ–‡ä»¶ä¸Šä¼ </title>
      <link href="/2024/02/04/git-lfs/"/>
      <url>/2024/02/04/git-lfs/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>git é™åˆ¶ä¸Šä¼ æ–‡ä»¶å¤§å°åœ¨ 100M ä»¥å†…ã€‚åœ¨æ—¥å¸¸å·¥ä½œä¸­ï¼Œå¶å°”ä¼šé‡åˆ°æŸæ¬¡æäº¤çš„æ–‡ä»¶æ€»é‡è¿‡å¤§æˆ–è€…æŸä¸ªæ–‡ä»¶è¿‡å¤§ï¼Œæ‰€ä»¥åœ¨æ­¤è®°å½•ä¸€ä¸‹å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h1 id="åˆ†æ‰¹æ¬¡æäº¤"><a href="#åˆ†æ‰¹æ¬¡æäº¤" class="headerlink" title="åˆ†æ‰¹æ¬¡æäº¤"></a>åˆ†æ‰¹æ¬¡æäº¤</h1><p>å¦‚æœæ˜¯æäº¤å¾ˆå¤šæ–‡ä»¶ï¼Œä½†å•æ–‡ä»¶éƒ½ä¸å¤§çš„æ—¶å€™ï¼Œå¯ä»¥é€‰æ‹©åˆ†æ‰¹æ¬¡æäº¤ã€‚å¦‚æœå·²ç» commit æ‰å‘ç°æ–‡ä»¶æ€»é‡è¿‡å¤§ï¼Œåˆ™éœ€è¦æ’¤é”€ commit ã€‚ä»¥ä¸‹æ˜¯ä¼šç”¨åˆ°çš„ git å‘½ä»¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git reflog æŸ¥çœ‹æ‰€æœ‰æ“ä½œçš„å†å²è®°å½•</span><br><span class="line">git reset HEAD^2 ä¸Šä¸Šä¸€ä¸ªç‰ˆæœ¬</span><br><span class="line">git reset @~ æ’¤é”€ä¸€æ¬¡commit</span><br></pre></td></tr></table></figure><p>å¦‚æœä»…æ’¤é”€ä¸Šä¸€æ¬¡ï¼Œåˆ™ç›´æ¥ç”¨ç¬¬3æ¡å‘½ä»¤ã€‚<br>å¦‚æœåœ¨å°è¯•è§£å†³é—®é¢˜æ—¶è¿›è¡Œäº†å¤šæ¬¡ commitï¼Œåˆ™å¯ä»¥é€šè¿‡ç¬¬1æ¡å‘½ä»¤æŸ¥è¯¢æƒ³è¦å›é€€åˆ°çš„ç‰ˆæœ¬ï¼Œç„¶åé€šè¿‡ç¬¬2æ¡å‘½ä»¤å›é€€ã€‚</p><h1 id="LFS"><a href="#LFS" class="headerlink" title="LFS"></a>LFS</h1><p>é¦–å…ˆï¼Œä¸‹è½½<a href="https://git-lfs.com/">git LFS</a>ã€‚<br>ç„¶åï¼Œå…³è”éœ€è¦ç”¨ LFS ä¸Šä¼ çš„æ–‡ä»¶ï¼Œæ¯”å¦‚ä¸‹é¢çš„å‘½ä»¤ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git lfs track <span class="string">&#x27;xx.mp4&#x27;</span></span><br></pre></td></tr></table></figure><p>æœ€åï¼ŒæŒ‰ç…§æ­£å¸¸çš„æäº¤æµç¨‹è¿›è¡Œæäº¤ã€‚</p><p>ä»¥ä¸‹æ˜¯å¯èƒ½ç”¨åˆ°çš„å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å…³è”æŸç±»å‹æ–‡ä»¶</span></span><br><span class="line">git lfs track <span class="string">&#x27;*.mp4&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥æ‰¾å¤§äº nM çš„æ–‡ä»¶</span></span><br><span class="line">find ./ -size +100M</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¸¸è§çš„hoverèœå•ç¼éš™é—®é¢˜</title>
      <link href="/2024/01/21/secondary-menu/"/>
      <url>/2024/01/21/secondary-menu/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ç»å¸¸é‡åˆ°hoveræ—¶æ˜¾ç¤ºäºŒçº§èœå•çš„éœ€æ±‚ï¼Œåœ¨è¿™ä¸ªéœ€æ±‚ä¸­ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯é¼ æ ‡ç»è¿‡ç¼éš™çš„æ—¶å€™èœå•ä¼šéšè—ã€‚ä½¿ç”¨transitionå¯ä»¥åœ¨ç»è¿‡ç¼éš™æ—¶ä»æ˜¾ç¤ºèœå•ï¼Œä½†å¦‚æœåœ¨ç¼éš™åœç•™æ—¶é—´è¶…å‡ºåŠ¨ç”»æ—¶é—´åˆ™èœå•ä»ä¼šéšè—ã€‚</p><h1 id="åˆçº§"><a href="#åˆçº§" class="headerlink" title="åˆçº§"></a>åˆçº§</h1><p>å¯ä»¥ç”¨transitionæ¥è§£å†³é¼ æ ‡ç»è¿‡<strong>ç¼éš™</strong>æ—¶äºŒçº§èœå•éšè—çš„é—®é¢˜ã€‚<br>ä½†transitionåªæœ‰é›¶ç‚¹å‡ ç§’çš„åŠ¨ç”»æ—¶é—´ï¼Œå¦‚æœé¼ æ ‡<strong>åœç•™</strong>ç¼éš™çš„æ—¶é—´è¶…å‡ºåŠ¨ç”»æ—¶é—´åˆ™äºŒçº§èœå•ä»ä¼šéšè—ã€‚<br><a href="https://code.juejin.cn/pen/7326198843110850623">jcode</a></p><h1 id="è¿›é˜¶ç‰ˆ"><a href="#è¿›é˜¶ç‰ˆ" class="headerlink" title="è¿›é˜¶ç‰ˆ"></a>è¿›é˜¶ç‰ˆ</h1><p>å¯ä»¥ç»™è§¦å‘èœå•çš„å…ƒç´ å’ŒäºŒçº§èœå•ä¹‹é—´å¡«å……ä¸€ä¸ªé€æ˜çš„å…ƒç´ ï¼Œè¿™ä¸ªé€æ˜å…ƒç´ æ˜¯äºŒçº§èœå•çš„<strong>ä¼ªå…ƒç´ </strong>ã€‚è¿™æ ·ï¼Œæ— è®ºé¼ æ ‡åœç•™åœ¨ç¼éš™å¤šä¹…ï¼ŒäºŒçº§èœå•éƒ½ä¸ä¼šéšè—ã€‚<br><a href="https://code.juejin.cn/pen/7326202794765975562">jcode</a></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>cssåšå¤§ç²¾æ·±ï¼</p>]]></content>
      
      
      <categories>
          
          <category> CSS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> äºŒçº§èœå• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸ºä»€ä¹ˆåªè¿™ä¸€ä¸ªæ¥å£502å‘¢ï¼Ÿ</title>
      <link href="/2024/01/20/post-502/"/>
      <url>/2024/01/20/post-502/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>å‰å‡ å¤©é‡åˆ°äº†ä¸€ä¸ªæ²¡è§è¿‡çš„bugï¼Œåœ¨æ­¤è®°å½•ä¸€ä¸‹ã€‚å‰å‡ å¤©ï¼Œæ–°å†™äº†ä¸€ä¸ªé¡µé¢ï¼Œé‡Œé¢æœ‰getè¯·æ±‚ã€jsonå‚æ•°çš„postè¯·æ±‚ã€formå‚æ•°çš„postè¯·æ±‚ï¼Œç„¶åæŠŠè¿™ä¸ªé¡¹ç›®æ‰“åŒ…å‡ºæ¥çš„distæ”¾å…¥nodeä¸­ã€‚æ›´æ–°åˆ°çº¿ä¸Šä»¥åï¼Œå‘ç°ä»…æœ‰jsonå‚æ•°çš„postè¯·æ±‚å‡ºç°nginx 502æŠ¥é”™ï¼Œå…¶ä»–æ¥å£éƒ½æ­£å¸¸ã€‚</p><h1 id="è§£å†³é—®é¢˜çš„æ€è·¯"><a href="#è§£å†³é—®é¢˜çš„æ€è·¯" class="headerlink" title="è§£å†³é—®é¢˜çš„æ€è·¯"></a>è§£å†³é—®é¢˜çš„æ€è·¯</h1><p>åˆšå¼€å§‹æœç´¢äº†ä¸€ä¸‹<strong>nginx 502</strong>ï¼Œæ²¡å‘ç°ä»€ä¹ˆæœ‰ç”¨ä¿¡æ¯ã€‚  </p><p>é¦–å…ˆæ˜¯å‘ç°å…¶ä»–getæ¥å£éƒ½æ­£å¸¸ï¼Œç‚¹å‡»æŒ‰é’®æ—¶è¿™ä¸ªpostæ¥å£æŠ¥é”™ï¼Œå½“æ—¶å°±æœ‰ç‚¹æ‡µã€‚ç„¶åæ£€æŸ¥äº†åŒä¸€ä¸ªé¡¹ç›®å¦ä¸€ä¸ªpostæ¥å£ï¼Œå‘ç°å¦ä¸€ä¸ªpostæ¥å£ä¹Ÿæ­£å¸¸ã€‚æ‰€ä»¥ï¼Œæ¨ç†å¾—<strong>jsonç±»å‹å‚æ•°çš„postè¯·æ±‚</strong>æœ‰é—®é¢˜ã€‚  </p><p>æœ¬åœ°ç¯å¢ƒï¼Œè¿™ä¸ªjsonå‚æ•°çš„è¯·æ±‚æ²¡é—®é¢˜ï¼Œæµ‹è¯•ç¯å¢ƒæ˜¯ç”¨dist+nginxéƒ¨ç½²çš„ï¼Œè¿™ä¸ªè¯·æ±‚ä¹Ÿæ²¡é—®é¢˜ã€‚çº¿ä¸Šç¯å¢ƒæ˜¯<strong>dist+node</strong>éƒ¨ç½²ï¼Œæ‰€ä»¥å°±å®šä½åˆ°äº†http-proxy-middlewareè¿™ä¸ªåº“ã€‚</p><p>åœ¨node+disté¡¹ç›®ä¸­ï¼Œå¦‚æœæ¥å£å°±æ˜¯è¿™ä¸ªnodeçš„å°±ä¸ç”¨ä»£ç†äº†ï¼Œä½†å¦‚æœå‰ç«¯ä»£ç ä¸­è¯·æ±‚äº†åˆ«çš„é¡¹ç›®çš„æ¥å£ï¼Œå°±éœ€è¦ç”¨http-proxy-middlewareæ·»åŠ ä»£ç†é…ç½®ã€‚</p><p>æœç´¢<strong>http-proxy-middleware jsonè¯·æ±‚502</strong>ï¼Œå°±å‘ç°äº†è§£å†³æ–¹æ¡ˆã€‚</p><h1 id="é—®é¢˜åŸå› "><a href="#é—®é¢˜åŸå› " class="headerlink" title="é—®é¢˜åŸå› "></a>é—®é¢˜åŸå› </h1><p>åœ¨nodeé¡¹ç›®ä¸­ï¼Œä¼šä½¿ç”¨bodyParserè¿™ä¸ªåº“æ¥è§£æpostè¯·æ±‚çš„å‚æ•°ï¼Œè¿™ä¸ªåº“ä¼šæ”¹å†™æ‰€æœ‰postè¯·æ±‚çš„bodyï¼Œæ‰€ä»¥å‰ç«¯ä»£ç è¯·æ±‚å…¶ä»–é¡¹ç›®çš„postè¯·æ±‚çš„bodyä¹Ÿä¼šè¢«ä¿®æ”¹ã€‚</p><h1 id="è§£å†³åŠæ³•"><a href="#è§£å†³åŠæ³•" class="headerlink" title="è§£å†³åŠæ³•"></a>è§£å†³åŠæ³•</h1><p>åœ¨ä»£ç†åˆ«çš„é¡¹ç›®çš„æ¥å£æ—¶ä¿®æ”¹bodyã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/myapi&#x27;</span>, <span class="title function_">createProxyMiddleware</span>(&#123;</span><br><span class="line">  <span class="attr">target</span>: <span class="string">&#x27;http://x.x.x.x:x&#x27;</span>,</span><br><span class="line">  <span class="attr">pathRewrite</span>: <span class="function">(<span class="params">path</span>) =&gt;</span> path.<span class="title function_">replace</span>(<span class="string">&quot;/myapi/&quot;</span>, <span class="string">&quot;/&quot;</span>),</span><br><span class="line">  <span class="attr">on</span>: &#123;</span><br><span class="line">    <span class="attr">proxyReq</span>: <span class="function">(<span class="params">proxyReq, req: Request, res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!req.<span class="property">body</span> || !<span class="title class_">Object</span>.<span class="title function_">keys</span>(req.<span class="property">body</span>).<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> contentType = proxyReq.<span class="title function_">getHeader</span>(<span class="string">&#x27;Content-Type&#x27;</span>);</span><br><span class="line">      <span class="keyword">const</span> <span class="title function_">writeBody</span> = (<span class="params">bodyData: string</span>) =&gt; &#123;</span><br><span class="line">          proxyReq.<span class="title function_">setHeader</span>(<span class="string">&#x27;Content-Length&#x27;</span>, <span class="title class_">Buffer</span>.<span class="title function_">byteLength</span>(bodyData));</span><br><span class="line">          proxyReq.<span class="title function_">write</span>(bodyData);</span><br><span class="line">      &#125;;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (contentType === <span class="string">&#x27;application/json&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_">writeBody</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(req.<span class="property">body</span>));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (contentType === <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>) &#123;</span><br><span class="line">        <span class="title function_">writeBody</span>(querystring.<span class="title function_">stringify</span>(req.<span class="property">body</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªissue<a href="https://github.com/chimurai/http-proxy-middleware/issues/320">å‚è€ƒissue</a>ä¸­å‘ç°äº†è§£å†³åŠæ³•ï¼Œç„¶ååˆåœ¨<a href="https://github.com/chimurai/http-proxy-middleware?tab=readme-ov-file#intercept-and-manipulate-requests">http-proxy-middlewareçš„readme</a>ä¸­å‘ç°äº†ç›¸å…³è®°è½½ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/3aa13c5da7ea435998ff9c2ac28314c5~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> bug </category>
          
      </categories>
      
      
        <tags>
            
            <tag> node </tag>
            
            <tag> 502 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€ä¸ªçœ‹èµ·æ¥åªæœ‰2ä¸ªå­—é•¿åº¦å´æœ‰8çš„å­—ç¬¦ä¸²å¼•èµ·çš„bug</title>
      <link href="/2023/12/14/zero-with-character/"/>
      <url>/2023/12/14/zero-with-character/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>æˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œç”¨æˆ·çš„æ˜µç§°å¦‚æœé•¿åº¦è¶…è¿‡6å°±æˆªå–å‰6ä¸ªå­—ç¬¦å¹¶æ˜¾ç¤ºâ€¦ã€‚ä»Šå¤©ï¼Œæµ‹è¯•çªç„¶æäº†ä¸€ä¸ªbugï¼ŒæŸä¸ªç”¨æˆ·çš„æ˜µç§°åªæ˜¾ç¤ºäº†â€¦ï¼Œé¼ æ ‡hoverçš„æ—¶å€™åˆæ˜¾ç¤º2ä¸ªå­—çš„æ˜µç§°ã€‚åˆšçœ‹åˆ°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™æˆ‘ä¹Ÿæ˜¯ä¸€å¤´é›¾æ°´ã€‚</p><h1 id="æ‰¾å‡ºåŸå› "><a href="#æ‰¾å‡ºåŸå› " class="headerlink" title="æ‰¾å‡ºåŸå› "></a>æ‰¾å‡ºåŸå› </h1><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/5c4b9b1adfc34b1987f357a1410f6ed6~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="image.png"><br>åœ¨çœ‹åˆ°è¿™ä¸ªç°è±¡åï¼Œæˆ‘å‘ç°å…¶ä»–æ˜µç§°éƒ½æ˜¾ç¤ºæ­£å¸¸ï¼Œä½†å®åœ¨æ‘¸ä¸ç€å¤´è„‘è¿™åˆ°åº•æ˜¯æ€ä¹ˆå›äº‹ã€‚ç„¶åæŸ¥çœ‹äº†ä¸€ä¸‹å…¶ä»–2ä¸ªå­—çš„æ˜µç§°æ˜¯æ²¡é—®é¢˜çš„ï¼Œç„¶åé€šè¿‡<code>console.log</code>å‘ç°è¿™ä¸ªæ˜µç§°å±…ç„¶é•¿åº¦æœ‰8ï¼Œèµ°äº†æˆªå–çš„åˆ†æ”¯ã€‚ç„¶åé€šè¿‡googleå‘ç°è¿™é‡Œé¢åº”è¯¥åŒ…å«äº†é›¶å®½å­—ç¬¦ã€‚<br>å…¶å®ï¼Œç¬¬ä¸€æ—¶é—´å°±åº”è¯¥æƒ³åˆ°è¿™ä¸ªå­—ç¬¦ä¸²ä¸å¯¹åŠ²çš„ï¼Œä½†å®Œå…¨å¿˜è®°äº†<code>é›¶å®½å­—ç¬¦</code>çš„å­˜åœ¨ï¼Œèµ°äº†ä¸å°‘å¼¯è·¯ã€‚    </p><p>åœ¨æŸ¥æ‰¾çš„è¿‡ç¨‹ä¸­å‘ç°ï¼Œ<code>Array.from</code>å¯ä»¥æŸ¥çœ‹å­—ç¬¦ä¸²çš„çœŸå®é•¿åº¦ï¼Œé™¤äº†<code>emoji</code>ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/d2c30abafa5a48398261240a4424145e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="image.png"><br>ä¸è¿‡<code>Array.from</code>å¹¶ä¸èƒ½è§£å†³æˆ‘çš„é—®é¢˜ã€‚</p><h1 id="ä½¿ç”¨æ­£åˆ™åŒ¹é…unicodeç ç‚¹è¿‡æ»¤é›¶å®½å­—ç¬¦"><a href="#ä½¿ç”¨æ­£åˆ™åŒ¹é…unicodeç ç‚¹è¿‡æ»¤é›¶å®½å­—ç¬¦" class="headerlink" title="ä½¿ç”¨æ­£åˆ™åŒ¹é…unicodeç ç‚¹è¿‡æ»¤é›¶å®½å­—ç¬¦"></a>ä½¿ç”¨æ­£åˆ™åŒ¹é…unicodeç ç‚¹è¿‡æ»¤é›¶å®½å­—ç¬¦</h1><p>åœ¨ç½‘ä¸Šæ‰¾äº†ä¸ªæ–¹æ³•æ¥è¿‡æ»¤æ‰è¿™äº›çœ‹ä¸è§çš„å­—ç¬¦ï¼Œæœ€å¸¸è§çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ä¸‹é¢è¿™è¡Œä»£ç ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">str.<span class="title function_">replace</span>(<span class="regexp">/[\u200b-\u200f\uFEFF\u202a-\u202e]/g</span>, <span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure><p>ç„¶è€Œå¹¶æ²¡æœ‰ç”¨ï¼Œæˆ‘å¼€å§‹æ€€ç–‘æ˜¯ä¸æ˜¯è¿™ä¸ªæ–¹æ³•æœ‰é—®é¢˜ï¼Œç„¶åéå†äº†è¿™ä¸ªæ˜µç§°ï¼ŒæŠŠå®ƒçš„æ¯ä¸ªå­—ç¬¦éƒ½è½¬æ¢æˆç ç‚¹ï¼Œå‘ç°è¿™ä¸ªæ˜µç§°é‡Œçš„é›¶å®½å­—ç¬¦å¹¶ä¸æ˜¯å¸¸è§çš„è¿™å‡ ç§ã€‚      </p><p>åæ¥ï¼Œåˆæ‰¾åˆ°äº†ä¸€ä¸ªæ¯”è¾ƒå®Œå–„çš„ç ç‚¹æ­£åˆ™ï¼Œä½†å®ƒå¤ªå®Œå–„äº†ï¼Œå¾ˆé•¿å¾ˆé•¿ï¼Œä¹Ÿä¼šè¿‡æ»¤æ‰<code>emoji</code>ï¼Œè¿™å¯ä¸è¡Œï¼Œç”¨æˆ·æ˜µç§°å¯èƒ½ä¼šåŒ…å«<code>emoji</code>çš„ã€‚ï¼ˆè¿™é‡Œå°±ä¸è´´å‡ºæ¥ä»£ç äº†ï¼Œå¤ªé•¿äº†è€Œä¸”ä¸é€‚åˆæˆ‘çš„æƒ…å†µã€‚ï¼‰</p><h1 id="ä½¿ç”¨æ­£åˆ™åŒ¹é…unicodeç±»åˆ«"><a href="#ä½¿ç”¨æ­£åˆ™åŒ¹é…unicodeç±»åˆ«" class="headerlink" title="ä½¿ç”¨æ­£åˆ™åŒ¹é…unicodeç±»åˆ«"></a>ä½¿ç”¨æ­£åˆ™åŒ¹é…unicodeç±»åˆ«</h1><p>ä¸€ä¸ªå­—ç¬¦æœ‰å¤šç§unicodeå±æ€§ï¼Œè€Œæ­£åˆ™æ”¯æŒæŒ‰unicodeå±æ€§åŒ¹é…ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">stripNonPrintableAndNormalize</span>(<span class="params">text, stripSurrogatesAndFormats</span>) &#123;</span><br><span class="line">    <span class="comment">// strip control chars. optionally, keep surrogates and formats</span></span><br><span class="line">    <span class="keyword">if</span>(stripSurrogatesAndFormats) &#123;</span><br><span class="line">      text = text.<span class="title function_">replace</span>(<span class="regexp">/\p&#123;C&#125;/gu</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      text = text.<span class="title function_">replace</span>(<span class="regexp">/\p&#123;Cc&#125;/gu</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">      text = text.<span class="title function_">replace</span>(<span class="regexp">/\p&#123;Co&#125;/gu</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">      text = text.<span class="title function_">replace</span>(<span class="regexp">/\p&#123;Cn&#125;/gu</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// other common tasks are to normalize newlines and other whitespace</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// normalize newline</span></span><br><span class="line">    text = text.<span class="title function_">replace</span>(<span class="regexp">/\n\r/g</span>, <span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    text = text.<span class="title function_">replace</span>(<span class="regexp">/\p&#123;Zl&#125;/gu</span>, <span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    text = text.<span class="title function_">replace</span>(<span class="regexp">/\p&#123;Zp&#125;/gu</span>, <span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// normalize space</span></span><br><span class="line">    text = text.<span class="title function_">replace</span>(<span class="regexp">/\p&#123;Zs&#125;/gu</span>, <span class="string">&#x27; &#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> text;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;â®â¡âªâ¡â â®æ²³è±š&quot;</span>.<span class="property">length</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">stripNonPrintableAndNormalize</span>(<span class="string">&quot;â®â¡âªâ¡â â®æ²³è±š&quot;</span>, <span class="literal">true</span>).<span class="property">length</span>);</span><br></pre></td></tr></table></figure><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/333d342f3653422d8aafe3c1cf9b8116~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="image.png"></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™ä¸ªæ˜µç§°å…¶å®å°±æ˜¯åŒ…å«äº†<code>&amp;nobreak;</code>ï¼Œé€šè¿‡unicodeç±»åˆ«åŒ¹é…å¯ä»¥è¿‡æ»¤æ‰å®ƒã€‚ </p><p>æˆ‘ä¹‹å‰æœ‰åœ¨åŸè´´ç”¨æˆ·ä¸»é¡µçš„æ§åˆ¶å°ä¸­çœ‹è§äº†<code>&amp;nobreak;</code>ï¼Œä½†å½“æ—¶å±…ç„¶æ²¡å½“å›äº‹ï¼Œä»¥ä¸ºæ˜¯åˆ«äººå¯¹æ˜µç§°åšçš„å¤„ç†ã€‚å¦‚æœç›´æ¥æœå®ƒé©¬ä¸Šå°±èƒ½è§£å†³é—®é¢˜äº†ï¼Œæœ‰ä¸å°‘äººé‡åˆ°<code>non-break-space</code>å¼•å‘çš„bugã€‚è°¨ä»¥æ­¤è®°ï¼Œå¸å–æ•™è®­ã€‚  </p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://stackoverflow.com/questions/11598786/how-to-replace-non-printable-unicode-characters-javascript">stackoverflowä¸­çš„è§£å†³åŠæ³•</a>ã€<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Regular_expressions/Unicode_character_class_escape">unicodeå±æ€§</a></p>]]></content>
      
      
      <categories>
          
          <category> bug </category>
          
      </categories>
      
      
        <tags>
            
            <tag> é›¶å®½å­—ç¬¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>canvasä¹‹measureTextæµ‹é‡æ–‡æœ¬</title>
      <link href="/2023/10/17/canvas-measureText/"/>
      <url>/2023/10/17/canvas-measureText/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è¿™ç¯‡æ–‡ç« è®²çš„æ˜¯å…³äº<code>canvas</code>çš„ä¸€ä¸ªæ–¹æ³•ï¼š<code>measureText</code>ï¼Œè¿™ä¸ªæ–¹æ³•æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œè¿”å›å…³äºè¿™ä¸ªå­—ç¬¦ä¸²çš„å®½åº¦å’Œæ°´å¹³çº¿åˆ°é¡¶éƒ¨æˆ–åº•éƒ¨çš„è·ç¦»ç­‰ç­‰ã€‚ä¸»è¦æ¶‰åŠçš„çŸ¥è¯†ç‚¹æœ‰ï¼šè·å–æ–‡æœ¬å®½åº¦ã€æ–‡æœ¬åœ¨å‚ç›´æ–¹å‘çš„å¯¹é½æ–¹å¼ã€åŸºçº¿ã€è¡Œé«˜ã€‚</p><h1 id="è·å–å­—ç¬¦ä¸²å®½åº¦"><a href="#è·å–å­—ç¬¦ä¸²å®½åº¦" class="headerlink" title="è·å–å­—ç¬¦ä¸²å®½åº¦"></a>è·å–å­—ç¬¦ä¸²å®½åº¦</h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;canvas id=<span class="string">&quot;canvas&quot;</span> width=<span class="string">&quot;200&quot;</span> height=<span class="string">&quot;200&quot;</span>&gt;&lt;/canvas&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;canvas&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="keyword">const</span> context = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    context.<span class="property">font</span> = <span class="string">&#x27;16px Microsoft YaHei&#x27;</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    <span class="variable language_">console</span>.<span class="title function_">log</span>(context.<span class="title function_">measureText</span>(<span class="string">&#x27;æˆ‘ä½ ä»–&#x27;</span>));</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure><p>æ‰“å°å‡ºæ¥æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶ä¸­çš„<code>width</code>å±æ€§å°±æ˜¯ä¼ å…¥çš„å­—ç¬¦ä¸²çš„å®½åº¦ã€‚æœ‰2ç‚¹éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œç¬¬ä¸€ç‚¹æ˜¯éœ€è¦è®¾ç½®<code>canvas</code>ä¸­çš„æ–‡å­—<code>font</code>å±æ€§ä¸éœ€è¦æµ‹é‡çš„å­—ç¬¦ä¸²çš„å€¼ä¸€è‡´ã€‚ç¬¬2ç‚¹æ˜¯<code>width</code>å€¼æœ‰ä¸€ç‚¹ç‚¹è¯¯å·®ï¼Œæˆ‘åªæµ‹è¯•äº†åœ¨<code>Chrome</code>ä¸­çš„æƒ…å†µï¼Œè¯¯å·®å¦‚ä¸‹ã€‚</p><ul><li>ä¸­æ–‡ï¼Œ<code>width</code>æ˜¯æ•´æ•°ï¼Œæ— è¯¯å·®ã€‚</li><li>è‹±æ–‡ï¼Œæµ‹é‡å€¼ç•¥å°äºå®é™…å€¼0.01å·¦å³ï¼Œå®é™…å€¼&#x3D;æµ‹é‡å€¼çš„å››èˆäº”å…¥ä¿ç•™2ä½å°æ•°å†å‘ä¸Šå–æ•´ä¿ç•™2ä½å°æ•°ã€‚</li><li>æ•°å­—ï¼Œæµ‹é‡å€¼ç•¥å°äºå®é™…å€¼0.01å·¦å³ï¼Œå®é™…å€¼&#x3D;æµ‹é‡å€¼çš„å››èˆäº”å…¥ä¿ç•™2ä½å°æ•°å†å‘ä¸Šå–æ•´ä¿ç•™2ä½å°æ•°ã€‚<br>æ¯”å¦‚æµ‹é‡å€¼æ˜¯85.7109ï¼Œå®é™…å€¼æ˜¯85.72ã€‚æµ‹é‡å€¼æ˜¯62.1796875ï¼Œå®é™…å€¼æ˜¯62.19ã€‚</li></ul><h1 id="åŸºçº¿ç›¸å…³çš„åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºçº¿ç›¸å…³çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºçº¿ç›¸å…³çš„åŸºæœ¬æ¦‚å¿µ"></a>åŸºçº¿ç›¸å…³çš„åŸºæœ¬æ¦‚å¿µ</h1><p><code>measureText</code>çš„è¿”å›å€¼æ˜¯<code>TextMetrics</code>å¯¹è±¡ï¼Œå®ƒçš„å±æ€§é™¤äº†<code>width</code>ï¼Œè¿˜æœ‰ä¸€äº›æ˜¯ä¸åŸºçº¿ã€é¡¶çº¿ç›¸å…³çš„å€¼ï¼Œä¸‹é¢å…ˆäº†è§£ä¸€ä¸‹ç›¸å…³æ¦‚å¿µã€‚å€Ÿç”¨ä¸€ä¸‹åˆ«äººçš„å›¾ç‰‡ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/71bf2577b6bd43ad84d11966bd6ac5a1~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="line.jfif"></p><ul><li>åŸºçº¿ï¼Œxçš„ä¸‹æ²¿</li><li>å†…å®¹åŒºï¼Œä»é¡¶çº¿åˆ°åº•çº¿çš„åŒºåŸŸ</li><li>è¡Œé«˜ï¼Œå†…å®¹åŒº+ä¸Šä¸‹ç©ºç™½åŒºåŸŸçš„é«˜åº¦ï¼Œç­‰äºç›¸é‚»è¡Œçš„åŸºçº¿ä¹‹é—´çš„è·ç¦»</li><li>è¡Œè·ï¼Œä»ä¸Šä¸€è¡ŒåŸºçº¿åˆ°ä¸‹ä¸€è¡Œé¡¶çº¿çš„è·ç¦»</li><li>è¡Œå†…æ¡†ï¼Œå†…å®¹åŒº+ä¸Šä¸‹ç©ºç™½åŒºåŸŸï¼Œå®ƒçš„é«˜åº¦å°±æ˜¯<code>line-height</code>æŒ‡å®šçš„é«˜åº¦</li><li>è¡Œæ¡†ï¼Œä¸€è¡Œå†…å¤šä¸ªå­—ç¬¦ä¸²çš„è¡Œå†…æ¡†çš„æœ€å¤§å€¼</li></ul><p>æ¥ä¸‹æ¥äº†è§£ä¸€ä¸‹<code>TextMetrics</code>å¯¹è±¡å…¶ä»–å±æ€§çš„å«ä¹‰ã€‚<br><code>ctx</code>çš„<code>textBaseline</code>æŒ‡å®šæ–‡å­—åœ¨å‚ç›´æ–¹å‘çš„å¯¹é½æ–¹å¼ï¼Œæ–‡æœ¬åŸºçº¿çš„ä½ç½®ï¼Œä¹‹å‰é‚£ä¸ªåŸºçº¿(xçš„ä¸‹æ²¿)æ˜¯æ ‡å‡†çš„å­—æ¯åŸºçº¿ã€‚</p><ul><li>fontBoundingBoxAscentï¼Œä»æ–‡æœ¬åŸºçº¿åˆ°è¡Œæ¡†é¡¶éƒ¨çš„è·ç¦»</li><li>fontBoundingBoxDescentï¼Œä»æ–‡æœ¬åŸºçº¿åˆ°è¡Œæ¡†åº•éƒ¨çš„è·ç¦»</li><li>actualBoundingBoxAscentï¼Œä»æ–‡æœ¬åŸºçº¿åˆ°é¡¶çº¿çš„è·ç¦»</li><li>actualBoundingBoxDescentï¼Œä»æ–‡æœ¬åŸºçº¿åˆ°åº•çº¿çš„è·ç¦»</li><li>actualBoundingBoxLeftï¼Œä»æ°´å¹³å¯¹é½æ–¹å¼çš„å¯¹é½ç‚¹åˆ°è¡Œæ¡†æœ€å·¦è¾¹çš„è·ç¦»</li><li>actualBoundingBoxRightï¼Œä»æ°´å¹³å¯¹é½æ–¹å¼çš„å¯¹é½ç‚¹åˆ°è¡Œæ¡†æœ€å³è¾¹çš„è·ç¦»</li></ul><p>æ€»ç»“ï¼Œå‰4ä¸ªå±æ€§æš‚ä¸æ¸…æ¥šæœ‰ä»€ä¹ˆä½¿ç”¨åœºæ™¯ï¼Œåé¢2ä¸ªå±æ€§å¯ä»¥ç”¨æ¥è®¡ç®—æ–‡æœ¬å®½åº¦ï¼Œ<code>MDN</code>æ¨èç”¨è¿™2ä¸ªå€¼ç›¸åŠ æ¥è·å–å€¾æ–œå­—ç¬¦ä¸²çš„ç»å¯¹å®½åº¦ã€‚å¦‚æœä¸æ˜¯æ–œä½“ï¼Œæˆ‘æ¨èç”¨<code>width</code>ã€‚</p><h1 id="äº†è§£æµ‹é‡æ–‡æœ¬å¯ä»¥è§£å†³ä»€ä¹ˆé—®é¢˜"><a href="#äº†è§£æµ‹é‡æ–‡æœ¬å¯ä»¥è§£å†³ä»€ä¹ˆé—®é¢˜" class="headerlink" title="äº†è§£æµ‹é‡æ–‡æœ¬å¯ä»¥è§£å†³ä»€ä¹ˆé—®é¢˜"></a>äº†è§£æµ‹é‡æ–‡æœ¬å¯ä»¥è§£å†³ä»€ä¹ˆé—®é¢˜</h1><h3 id="å‚ç›´å±…ä¸­"><a href="#å‚ç›´å±…ä¸­" class="headerlink" title="å‚ç›´å±…ä¸­"></a>å‚ç›´å±…ä¸­</h3><p>æœ€å¸¸è§çš„å°±æ˜¯ä¸€è¡Œä¸­å›¾ç‰‡å’Œæ–‡å­—å¦‚ä½•å‚ç›´å±…ä¸­ã€‚<br>é»˜è®¤æ˜¯åŸºäºåŸºçº¿å¯¹é½çš„ï¼Œè®¾ç½®ä¸ºåŸºäºä¸­çº¿å°±å¯ä»¥åšåˆ°å‚ç›´å±…ä¸­äº†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.<span class="property">img</span> &#123;</span><br><span class="line">    <span class="attr">width</span>: 30px;</span><br><span class="line">    vertical-<span class="attr">align</span>: center;</span><br><span class="line">&#125;</span><br><span class="line">.<span class="property">name</span> &#123;</span><br><span class="line">    vertical-<span class="attr">align</span>: center;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å›¾ç‰‡ä¸‹æ–¹æœ‰ç©ºç™½åŒºåŸŸ"><a href="#å›¾ç‰‡ä¸‹æ–¹æœ‰ç©ºç™½åŒºåŸŸ" class="headerlink" title="å›¾ç‰‡ä¸‹æ–¹æœ‰ç©ºç™½åŒºåŸŸ"></a>å›¾ç‰‡ä¸‹æ–¹æœ‰ç©ºç™½åŒºåŸŸ</h3><p>è¿™æ®µç©ºç™½å°±æ˜¯åº•çº¿åˆ°è¡Œæ¡†çš„è·ç¦»ï¼Œè¡Œæ¡†çš„å¤§å°åˆå–å†³äºè¡Œé«˜ï¼Œæ‰€ä»¥è®¾ç½®<code>line-height</code>æˆ–<code>font-size</code>ä¸º0å³å¯ã€‚</p><h1 id="measureTextçš„åº”ç”¨åœºæ™¯"><a href="#measureTextçš„åº”ç”¨åœºæ™¯" class="headerlink" title="measureTextçš„åº”ç”¨åœºæ™¯"></a>measureTextçš„åº”ç”¨åœºæ™¯</h1><h3 id="åŠ¨æ€è°ƒæ•´æ–‡å­—å¤§å°"><a href="#åŠ¨æ€è°ƒæ•´æ–‡å­—å¤§å°" class="headerlink" title="åŠ¨æ€è°ƒæ•´æ–‡å­—å¤§å°"></a>åŠ¨æ€è°ƒæ•´æ–‡å­—å¤§å°</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getFontSize</span> = (<span class="params">str, parentWidth</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> context = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">  context.<span class="property">font</span> = <span class="string">&#x27;16px Microsoft YaHei&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> &#123; width &#125; = context.<span class="title function_">measureText</span>(str);</span><br><span class="line">  <span class="keyword">if</span> (parentWidth - width &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">14</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">16</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ç”¨æˆ·æ‹–æ‹½æŸä¸ªå¡ç‰‡å¤§å°æ—¶ï¼Œæˆ–æŸä¸ªå®¹å™¨çš„å­—ç¬¦ä¸²ä¸å›ºå®šé•¿åº¦æ—¶å°±å¯ä»¥è¿™æ ·æ¥è°ƒæ•´<code>font-size</code>ã€‚</p><h3 id="ç»å¯¹å®šä½çš„ä¸å®šé•¿æ–‡æœ¬æ°´å¹³å±…ä¸­"><a href="#ç»å¯¹å®šä½çš„ä¸å®šé•¿æ–‡æœ¬æ°´å¹³å±…ä¸­" class="headerlink" title="ç»å¯¹å®šä½çš„ä¸å®šé•¿æ–‡æœ¬æ°´å¹³å±…ä¸­"></a>ç»å¯¹å®šä½çš„ä¸å®šé•¿æ–‡æœ¬æ°´å¹³å±…ä¸­</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">getTextPos</span> = (<span class="params">str, parentWidth</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> context = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">  context.<span class="property">font</span> = <span class="string">&#x27;16px Microsoft YaHei&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> &#123; width &#125; = context.<span class="title function_">measureText</span>(str);</span><br><span class="line">  <span class="keyword">return</span> (parentWidth - width) / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">textDom.<span class="property">style</span>.<span class="property">left</span> = <span class="title function_">getTextPos</span>(<span class="string">&#x27;abcdefgä¸­æ–‡&#x27;</span>, parentDom.<span class="property">width</span>) + <span class="string">&#x27;px&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå°±ç®—æ˜¯ä¸å®šé•¿æ–‡æœ¬ä¹Ÿå¯ä»¥è®¾ç½®<code>text-align: center</code>æ¥æ°´å¹³å±…ä¸­ã€‚ä½†ï¼Œå¦‚æœè¿™æ®µä¸å®šé•¿æ–‡æœ¬æ˜¯ç»å¯¹å®šä½çš„å°±éœ€è¦è®¡ç®—ä¸€ä¸‹åº”è¯¥è®¾ç½®çš„ä½ç½®ã€‚</p><h3 id="åˆ¤æ–­å­—ç¬¦ä¸²ä¼šä¸ä¼šå®¹å™¨èŒƒå›´"><a href="#åˆ¤æ–­å­—ç¬¦ä¸²ä¼šä¸ä¼šå®¹å™¨èŒƒå›´" class="headerlink" title="åˆ¤æ–­å­—ç¬¦ä¸²ä¼šä¸ä¼šå®¹å™¨èŒƒå›´"></a>åˆ¤æ–­å­—ç¬¦ä¸²ä¼šä¸ä¼šå®¹å™¨èŒƒå›´</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">isBeyond</span> = (<span class="params">str, parentWidth</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> canvas = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;canvas&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> context = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">  context.<span class="property">font</span> = <span class="string">&#x27;16px Microsoft YaHei&#x27;</span>;</span><br><span class="line">  <span class="keyword">const</span> &#123; width &#125; = context.<span class="title function_">measureText</span>(str);</span><br><span class="line">  <span class="keyword">return</span> width - parentWidth;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>éœ€è¦è·å–æ–‡æœ¬å®½åº¦çš„æƒ…å†µå¯ä»¥è€ƒè™‘è¿™ä¸ªæ–¹æ³•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> HTML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> canvas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬ä¸€æ¬¡å¼€å‘nodeæ¥å£-å¹²è´§æ€»ç»“</title>
      <link href="/2023/10/17/node-api/"/>
      <url>/2023/10/17/node-api/</url>
      
        <content type="html"><![CDATA[<p>æŠ€æœ¯æ ˆï¼š<code>node</code> + <code>express</code> + <code>mongoose</code><br><a href="https://github.com/chendx97/node-template">gitåœ°å€</a>ï¼Œå¯ç›´æ¥ä½¿ç”¨ã€‚</p><h1 id="nodemon-çƒ­æ›´æ–°"><a href="#nodemon-çƒ­æ›´æ–°" class="headerlink" title="nodemon çƒ­æ›´æ–°"></a>nodemon çƒ­æ›´æ–°</h1><p>ä½¿ç”¨<code>nodemon</code>å¯åŠ¨é¡¹ç›®ï¼Œå¯ä»¥åœ¨ä¿®æ”¹ä»£ç æ—¶ä¸ç”¨é‡æ–°å¯åŠ¨ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// å®‰è£…</span><br><span class="line">npm i nodemon</span><br></pre></td></tr></table></figure><p>å®‰è£…ä¹‹åï¼Œä¿®æ”¹å¯åŠ¨å‘½ä»¤ï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;start&quot;</span>: <span class="string">&quot;nodemon index.js&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ä¸­é—´ä»¶"><a href="#ä¸­é—´ä»¶" class="headerlink" title="ä¸­é—´ä»¶"></a>ä¸­é—´ä»¶</h1><h2 id="body-parser"><a href="#body-parser" class="headerlink" title="body-parser"></a>body-parser</h2><p><code>body-parser</code>è§£æè¯·æ±‚å‚æ•°ï¼Œä½¿æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>req.body.xx</code>è®¿é—®å‚æ•°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br></pre></td></tr></table></figure><h2 id="cookie-parser"><a href="#cookie-parser" class="headerlink" title="cookie-parser"></a>cookie-parser</h2><p><code>cookie-parser</code>è§£æè¯·æ±‚æºå¸¦çš„<code>cookie</code>ï¼Œä½¿æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>req.cookies</code>è®¿é—®<code>cookie</code>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> email = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(req.<span class="property">cookies</span>[config.<span class="property">cookieName</span>]).<span class="property">email</span>;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">var</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>());</span><br></pre></td></tr></table></figure><h1 id="è·¯ç”±ä¸­é—´ä»¶"><a href="#è·¯ç”±ä¸­é—´ä»¶" class="headerlink" title="è·¯ç”±ä¸­é—´ä»¶"></a>è·¯ç”±ä¸­é—´ä»¶</h1><p>å€ŸåŠ©è·¯ç”±ä¸­é—´ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥æ ¼å¼åŒ–æ¥å£è¿”å›å€¼ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routers/index.js</span></span><br><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.<span class="title class_">Router</span>();</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="property">jsonSuccess</span> = <span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">      <span class="attr">result</span>: data,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  res.<span class="property">jsonFail</span> = <span class="function">(<span class="params">message</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="number">500</span>,</span><br><span class="line">      <span class="attr">message</span>: message.<span class="property">message</span> || <span class="string">&#x27;æœåŠ¡å™¨å‡ºäº†ç‚¹é—®é¢˜&#x27;</span>,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure><h1 id="mongooseæŒ‡ä»¤"><a href="#mongooseæŒ‡ä»¤" class="headerlink" title="mongooseæŒ‡ä»¤"></a>mongooseæŒ‡ä»¤</h1><h2 id="æŸ¥"><a href="#æŸ¥" class="headerlink" title="æŸ¥"></a>æŸ¥</h2><p><code>find</code>æŸ¥æ‰¾æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼›<br><code>findOne</code>æŸ¥æ‰¾ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼›<br><code>findById</code>æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼ŒæŸ¥è¯¢æ¡ä»¶ä¸º<code>id</code>ï¼›  </p><p><code>Model.find(conditions, [projection], [options], [callback])</code></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">model.<span class="title function_">find</span>(</span><br><span class="line">    &#123;<span class="attr">age</span>:&#123;<span class="attr">$gte</span>:<span class="number">18</span>,<span class="attr">$lte</span>:<span class="number">80</span>&#125;&#125;, <span class="comment">// ageå­—æ®µå¤§äºç­‰äº18ä¸”å°äºç­‰äº80 çš„æ•°æ®</span></span><br><span class="line">    &#123;<span class="attr">_id</span>:<span class="number">0</span>,<span class="attr">__v</span>:<span class="number">0</span>&#125;, <span class="comment">// æ•°æ®æ–‡æ¡£ä¸è¿”å›_idå’Œ__vå­—æ®µ</span></span><br><span class="line">    &#123;<span class="attr">sort</span>:&#123;<span class="attr">age</span>:-<span class="number">1</span>&#125;&#125; <span class="comment">// æ ¹æ®ageå­—æ®µä»¥å¤§åˆ°å°é¡ºåºè¿”å›æ•°æ®æ–‡æ¡£</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><code>$gte</code>æ˜¯æ“ä½œç¬¦ï¼Œç±»ä¼¼çš„æ“ä½œç¬¦è¿˜æœ‰ä¸å°‘ï¼š   </p><ul><li><code>$eq</code> ç›¸ç­‰  </li><li><code>$ne</code> ä¸ç›¸ç­‰   </li><li><code>$gt</code> å¤§äº</li><li><code>$gte</code> å¤§äºç­‰äº</li><li><code>$lt</code> å°äº</li><li><code>$lte</code> å°äºç­‰äº</li><li><code>$in</code> ä¸æ•°ç»„ä¸­ä»»æ„ä¸€ä¸ªåŒ¹é…</li><li><code>$nin</code> ä¸æ•°ç»„ä¸­æ¯ä¸€ä¸ªéƒ½ä¸åŒ¹é…</li><li><code>$and</code> æ»¡è¶³æ•°ç»„ä¸­æ‰€æœ‰æ¡ä»¶</li><li><code>$nor</code> æ‰€æœ‰æ¡ä»¶éƒ½ä¸æ»¡è¶³</li><li><code>$or</code> æ»¡è¶³æ•°ç»„çš„å…¶ä¸­ä¸€ä¸ªæ¡ä»¶</li><li><code>$not</code> ä¸æ»¡è¶³æ¡ä»¶</li><li><code>$exists</code> å­˜åœ¨æŒ‡å®šå­—æ®µ</li><li><code>$type</code> å±äºæŒ‡å®šç±»å‹</li><li><code>$all</code> åŒ¹é…åŒ…å«æŸ¥è¯¢æ•°ç»„æ‰€æœ‰æ¡ä»¶çš„æ•°ç»„å­—æ®µ</li><li><code>$elemMatch</code> åŒ¹é…æ•°ç»„å­—æ®µä¸­çš„æŸä¸ªå€¼æ»¡è¶³æŒ‡å®šçš„æ‰€æœ‰æ¡ä»¶</li><li><code>$size</code> åŒ¹é…æ•°ç»„å­—æ®µçš„<code>length</code> ä¸æŸ¥è¯¢æ¡ä»¶ç›¸åŒ   Same as querySame as query conditions</li></ul><p><code>projection</code>æŒ‡å®šæŸ¥è¯¢ç»“æœåŒ…å«æˆ–ä¸åŒ…å«å“ªäº›å­—æ®µï¼Œä¹Ÿå¯ä»¥å†™æˆå­—ç¬¦ä¸²ï¼š<code>&quot;-_id -__v&quot;</code>ï¼Œä¸èƒ½åŒ…å«ä¸åŒ…å«åŒæ—¶ä½¿ç”¨ã€‚<br><code>findOne</code>å’Œ<code>findById</code>çš„åŒºåˆ«åœ¨äº<code>id</code>ä¸º<code>undefined</code>çš„æƒ…å†µï¼Œ<code>findOne(&#123; _id: undefined &#125;)</code>è¿”å›ä»»æ„ä¸€æ¡æ•°æ®ï¼Œ<code>findById(undefined)</code>è¿”å›<code>null</code>ã€‚</p><h2 id="å¢"><a href="#å¢" class="headerlink" title="å¢"></a>å¢</h2><p><code>save([options], [options.safe], [options.validateBeforeSave], [fn])</code>å¢åŠ ä¸€æ¡ï¼Œéœ€è¦å†™å®ä¾‹åŒ–ï¼›<br><code>Model.create(doc(s), [callback])</code>å¢åŠ ä¸€æ¡æˆ–å¤šæ¡ï¼›<br><code>Model.insertMany(doc(s), [options], [callback])</code>å¢åŠ å¤šæ¡ï¼›   </p><p><code>save()</code>çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// models/user.js</span></span><br><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;./index&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">UserSchema</span> = mongoose.<span class="title class_">Schema</span>(&#123;</span><br><span class="line">  <span class="attr">email</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="title class_">String</span>,</span><br><span class="line">    <span class="attr">unique</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">UserModel</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;User&#x27;</span>, <span class="title class_">UserSchema</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">UserModel</span>;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routers/user.js</span></span><br><span class="line"><span class="keyword">var</span> router = <span class="built_in">require</span>(<span class="string">&#x27;./index.js&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">User</span> = <span class="built_in">require</span>(<span class="string">&#x27;../models/user&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ–°å¢é¡¹ç›®</span></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/user/add&#x27;</span>, <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">new</span> <span class="title class_">User</span>(req.<span class="property">body</span>);</span><br><span class="line">    <span class="keyword">await</span> user.<span class="title function_">save</span>(); <span class="comment">// save</span></span><br><span class="line">    res.<span class="title function_">jsonSuccess</span>();</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    res.<span class="title function_">jsonFail</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = router;</span><br></pre></td></tr></table></figure><h2 id="åˆ "><a href="#åˆ " class="headerlink" title="åˆ "></a>åˆ </h2><p><code>findOneAndDelete</code>æ‰¾åˆ°ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„å¹¶åˆ é™¤ï¼›<br><code>findByIdAndDelete</code>æŸ¥è¯¢æ¡ä»¶ä¸º<code>id</code>ï¼›<br><code>deleteMany</code>åˆ é™¤æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ï¼›   </p><p><code>Model.findOneAndDelete(filter, options, callback)</code></p><h2 id="æ”¹"><a href="#æ”¹" class="headerlink" title="æ”¹"></a>æ”¹</h2><p><code>findOneAndUpdate</code>å’Œ<code>findByIdAndUpdate</code>éƒ½æ˜¯å…ˆæŸ¥æ‰¾ç„¶åå†ä¿®æ”¹ï¼›<br><code>updateOne</code>ä¹Ÿæ˜¯æŸ¥æ‰¾ç¬¦åˆæ¡ä»¶çš„ç¬¬ä¸€æ¡æ•°æ®å¹¶ä¿®æ”¹ï¼›<br><code>updateMany</code>æ˜¯æ‰¹é‡ä¿®æ”¹æ•°æ®ï¼›  </p><p><code>Model.findOneAndUpdate(filter, update, [options], [callback])</code></p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> info = <span class="keyword">await</span> <span class="title class_">User</span>.<span class="title function_">findByIdAndUpdate</span>(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">_id</span>: req.<span class="property">body</span>.<span class="property">id</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">$set</span>: &#123;</span><br><span class="line">            <span class="attr">pass</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h1 id="è§£æexcelæ–‡ä»¶"><a href="#è§£æexcelæ–‡ä»¶" class="headerlink" title="è§£æexcelæ–‡ä»¶"></a>è§£æexcelæ–‡ä»¶</h1><p>ä½¿ç”¨<code>multer</code>è§£æform-dataæ•°æ®ï¼Œ<a href="https://www.npmjs.com/package/multer">npmåœ°å€</a>ã€‚<br>ä½¿ç”¨<code>node-xlsx</code>è§£æexcelï¼Œ<a href="https://www.npmjs.com/package/node-xlsx">npmåœ°å€</a>ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> multer = <span class="built_in">require</span>(<span class="string">&#x27;multer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> upload = <span class="title function_">multer</span>();</span><br><span class="line"><span class="keyword">const</span> xlsx = <span class="built_in">require</span>(<span class="string">&#x27;node-xlsx&#x27;</span>);</span><br><span class="line"></span><br><span class="line">router.<span class="title function_">post</span>(<span class="string">&#x27;/upload&#x27;</span>, upload.<span class="title function_">single</span>(<span class="string">&#x27;file&#x27;</span>), <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> sheets = xlsx.<span class="title function_">parse</span>(path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../test.xlsx&#x27;</span>));</span><br><span class="line">    <span class="keyword">const</span> data = sheets[<span class="number">0</span>].<span class="property">data</span>; <span class="comment">// äºŒç»´æ•°ç»„</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>req.file.mimetype</code>å¯ä»¥è·å–æ–‡ä»¶çš„<code>MIME type</code>ï¼Œå¯ä»¥ä»¥æ­¤æ¥åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œ<code>excel</code>æ–‡ä»¶çš„<code>MIME type</code>æ˜¯<code>application/vnd.openxmlformats-officedocument.spreadsheetml.sheet</code>æˆ–<code>application/vnd.ms-excel</code>ã€‚</p><h1 id="ä¸‹è½½æ–‡ä»¶æ¥å£"><a href="#ä¸‹è½½æ–‡ä»¶æ¥å£" class="headerlink" title="ä¸‹è½½æ–‡ä»¶æ¥å£"></a>ä¸‹è½½æ–‡ä»¶æ¥å£</h1><p>ä½¿ç”¨<code>sendFile</code>å¯ä»¥ç›´æ¥è¿”å›æ–‡ä»¶ç±»å‹æ•°æ®ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/download&#x27;</span>, <span class="keyword">async</span> <span class="keyword">function</span> (<span class="params">req, res</span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> filePath = path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;../test.xlsx&#x27;</span>);</span><br><span class="line">    res.<span class="title function_">sendFile</span>(filePath);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    res.<span class="title function_">jsonFail</span>(error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">handleDownload</span> = <span class="keyword">async</span> (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/download&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> blob = <span class="keyword">await</span> response.<span class="title function_">blob</span>();</span><br><span class="line">  <span class="title function_">saveAs</span>(blob, <span class="string">&#x27;test.xlsx&#x27;</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="dockeréƒ¨ç½²é…ç½®"><a href="#dockeréƒ¨ç½²é…ç½®" class="headerlink" title="dockeréƒ¨ç½²é…ç½®"></a>dockeréƒ¨ç½²é…ç½®</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Dockefileæ–‡ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä½¿ç”¨Node.jsçš„å®˜æ–¹é•œåƒä½œä¸ºåŸºç¡€ </span></span><br><span class="line">FROM node:14 </span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨å®¹å™¨ä¸­åˆ›å»ºä¸€ä¸ªå·¥ä½œç›®å½• </span></span><br><span class="line">WORKDIR /app </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶åº”ç”¨ç¨‹åºæ–‡ä»¶åˆ°å®¹å™¨ä¸­ </span></span><br><span class="line">COPY package*.json ./ </span><br><span class="line"></span><br><span class="line"><span class="comment"># å®‰è£…ä¾èµ–é¡¹ </span></span><br><span class="line">RUN npm install </span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶åº”ç”¨ç¨‹åºä»£ç åˆ°å®¹å™¨ä¸­ </span></span><br><span class="line">COPY . . </span><br><span class="line"></span><br><span class="line"><span class="comment"># æš´éœ²å®¹å™¨çš„ç«¯å£ </span></span><br><span class="line">EXPOSE 3000 </span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰å®¹å™¨å¯åŠ¨æ—¶è¿è¡Œçš„å‘½ä»¤ </span></span><br><span class="line">CMD [<span class="string">&quot;npm&quot;</span>, <span class="string">&quot;start&quot;</span>]</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æŒ‡å— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> node </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»0åˆ°1å®ç°ä¸€ä¸ªnpmåº“</title>
      <link href="/2023/10/11/npm-lib/"/>
      <url>/2023/10/11/npm-lib/</url>
      
        <content type="html"><![CDATA[<h1 id="é¡¹ç›®çš„ç›®å½•ç»“æ„"><a href="#é¡¹ç›®çš„ç›®å½•ç»“æ„" class="headerlink" title="é¡¹ç›®çš„ç›®å½•ç»“æ„"></a>é¡¹ç›®çš„ç›®å½•ç»“æ„</h1><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªç©ºé¡¹ç›®ï¼Œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm create vue@lastest</span><br><span class="line">npm i</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠ<code>components</code>ä»<code>src</code>ä¸­æŒªåˆ°æ ¹ç›®å½•ä¸‹ï¼ŒæŠŠ<code>src</code>æ”¹åä¸º<code>examples</code>ï¼Œä¿®æ”¹<code>index.html</code>ä¸­<code>main.ts</code>çš„è·¯å¾„ã€‚<br>å…·ä½“çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><ul><li>components</li><li>examples</li><li>node_modules</li><li>public</li><li>index.html</li><li>package.json</li><li>vite.config.ts</li></ul><h1 id="å¯¼å‡ºç»„ä»¶"><a href="#å¯¼å‡ºç»„ä»¶" class="headerlink" title="å¯¼å‡ºç»„ä»¶"></a>å¯¼å‡ºç»„ä»¶</h1><p>åœ¨<code>components/index.ts</code>ä¸­å®šä¹‰å¯¼å‡ºçš„ç»„ä»¶ã€‚<br>ä»¥ä¸‹ä»£ç æ˜¯å¯¼å‡ºå•ä¸ªç»„ä»¶ï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">App</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MyButton</span> <span class="keyword">from</span> <span class="string">&#x27;./Button&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyButtonPlugin</span> = &#123;</span><br><span class="line">  <span class="attr">install</span>: <span class="function">(<span class="params">app: App</span>) =&gt;</span> &#123;</span><br><span class="line">    app.<span class="title function_">component</span>(<span class="string">&#x27;MyButton&#x27;</span>, <span class="title class_">MyButton</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MyButtonPlugin</span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœæœ‰å¤šä¸ªç»„ä»¶éœ€è¦å¯¼å‡ºï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/Button/index.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">App</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MyButton</span> <span class="keyword">from</span> <span class="string">&#x27;./Button&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyButtonPlugin</span> = &#123;</span><br><span class="line">  <span class="attr">install</span>: <span class="function">(<span class="params">app: App</span>) =&gt;</span> &#123;</span><br><span class="line">    app.<span class="title function_">component</span>(<span class="string">&#x27;MyButton&#x27;</span>, <span class="title class_">MyButton</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MyButtonPlugin</span>;</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// components/index.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MyButton</span> <span class="keyword">from</span> <span class="string">&quot;./Button&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MyTable</span> <span class="keyword">from</span> <span class="string">&quot;./Table&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="attr">components</span>: any = &#123;</span><br><span class="line">  <span class="title class_">MyButton</span>,</span><br><span class="line">  <span class="title class_">MyTable</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">MyUI</span> = &#123;</span><br><span class="line">  <span class="attr">install</span>: <span class="function">(<span class="params">Vue: App</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">keys</span>(components).<span class="title function_">forEach</span>(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="title class_">Vue</span>.<span class="title function_">use</span>(components[key]);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¼å‡ºå¤šä¸ªç»„ä»¶ï¼Œæ–¹ä¾¿æŒ‰éœ€å¼•å…¥</span></span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">MyButton</span>, <span class="title class_">MyTable</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨éƒ¨å¯¼å‡º</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="title class_">MyUI</span>;</span><br></pre></td></tr></table></figure><p><em><code>app.use</code>ç”¨æ¥å®‰è£…æ’ä»¶ï¼Œæ’ä»¶å¯ä»¥æ˜¯å…·æœ‰<code>install</code>æ–¹æ³•çš„å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å½“ä½œ<code>install</code>æ–¹æ³•çš„å‡½æ•°ã€‚</em></p><h1 id="å¼•å…¥ç»„ä»¶"><a href="#å¼•å…¥ç»„ä»¶" class="headerlink" title="å¼•å…¥ç»„ä»¶"></a>å¼•å…¥ç»„ä»¶</h1><p>åœ¨<code>examples/main.ts</code>ä¸­ä½¿ç”¨<code>app.use</code>æ¥å®‰è£…æ’ä»¶ï¼Œç„¶åå°±å¯ä»¥å…¨å±€ä½¿ç”¨äº†ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ•´ä¸ªå¼•å…¥</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">MyUI</span> <span class="keyword">from</span> <span class="string">&#x27;../components&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">MyUI</span>);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŒ‰éœ€å¼•å…¥</span></span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">MyButton</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;../components&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">createApp</span>(<span class="title class_">App</span>);</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title class_">MyButton</span>);</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// App.vue</span></span><br><span class="line">&lt;my-button /&gt;</span><br></pre></td></tr></table></figure><h1 id="æ‰“åŒ…ç»„ä»¶åº“"><a href="#æ‰“åŒ…ç»„ä»¶åº“" class="headerlink" title="æ‰“åŒ…ç»„ä»¶åº“"></a>æ‰“åŒ…ç»„ä»¶åº“</h1><p>é¦–å…ˆä¿®æ”¹<code>package.json</code>æ–‡ä»¶ï¼Œå»æ‰<code>private</code>å­—æ®µï¼Œæ·»åŠ <code>main</code>å­—æ®µï¼Œ<code>files</code>å­—æ®µï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;main&quot;</span>: <span class="string">&quot;dist/index.umd.js&quot;</span>,</span><br><span class="line"><span class="string">&quot;files&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;dist&quot;</span>,</span><br><span class="line">    <span class="string">&quot;components&quot;</span></span><br><span class="line">  ],</span><br></pre></td></tr></table></figure><p>ç„¶åä¿®æ”¹<code>vite.config.ts</code>é…ç½®ï¼Œ</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">build</span>: &#123;</span><br><span class="line">    <span class="attr">lib</span>: &#123;</span><br><span class="line">      <span class="attr">entry</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;components&quot;</span>),</span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;MyUI&quot;</span>,</span><br><span class="line">      <span class="attr">fileName</span>: <span class="function">(<span class="params">format, fileName</span>) =&gt;</span> <span class="string">`<span class="subst">$&#123;fileName&#125;</span>.<span class="subst">$&#123;format&#125;</span>.js`</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">rollupOptions</span>: &#123;</span><br><span class="line">      <span class="attr">external</span>: [<span class="string">&#x27;vue&#x27;</span>],</span><br><span class="line">      <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">globals</span>: &#123;</span><br><span class="line">          <span class="attr">vue</span>: <span class="string">&#x27;Vue&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p>æµ‹è¯•æ‰“åŒ…åçš„æ–‡ä»¶:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> test <span class="keyword">from</span> <span class="string">&#x27;../dist/index.es.js&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;../dist/style.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(test);</span><br></pre></td></tr></table></figure><h1 id="å‘å¸ƒåº“"><a href="#å‘å¸ƒåº“" class="headerlink" title="å‘å¸ƒåº“"></a>å‘å¸ƒåº“</h1><p>å¦‚æœæ²¡æœ‰<code>npm</code>è´¦å·éœ€è¦å…ˆæ³¨å†Œä¸€ä¸‹ã€‚<br>å¦‚æœ<code>npm</code>æºä¸æ˜¯é»˜è®¤æºï¼Œéœ€è¦ä¿®æ”¹ä¸ºé»˜è®¤æºã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm login</span><br><span class="line">npm publish</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šæ¯æ¬¡<code>push</code>çš„æ—¶å€™éƒ½è¦ä¿®æ”¹<code>package.json</code>ä¸­çš„<code>version</code>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æŒ‡å— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> npm </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘çš„ç¬¬ä¸€ç¯‡æºç é˜…è¯»ä¹‹fetch-event-source</title>
      <link href="/2023/09/16/fetch-event-source/"/>
      <url>/2023/09/16/fetch-event-source/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ç»ˆäºé‡åˆ°ä¸€ä¸ªç®€å•çš„åº“æ¥å­¦ä¹ å®ƒçš„æºç äº†ã€‚è¿™ä¸ªé¡¹ç›®åªæœ‰2ä¸ªä¸»è¦æ–‡ä»¶ï¼Œä»£ç åŠ èµ·æ¥ä¸åˆ°500è¡Œï¼Œæ˜¯çœŸçš„å¾ˆminiäº†ã€‚<br>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·è¯·æ±‚ç”¨<code>xhr</code>æˆ–<code>fetch</code>ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åŒå‘é€šä¿¡ç”¨<code>websocket</code>ï¼Œè€ŒæœåŠ¡ç«¯ä¸»åŠ¨å‘èµ·è¯·æ±‚ç”¨<code>sse</code>ã€‚<code>chatGPT</code>å°±æ˜¯ç”¨<code>sse</code>å›å¤æé—®çš„ã€‚<br><code>window</code>ä¸­æœ‰ä¸€ä¸ªå«<code>EventSource</code>çš„æ„é€ å‡½æ•°ã€‚ä¸€ä¸ª<code>EventSource</code>å®ä¾‹ä¼šå¯¹æœåŠ¡å™¨å¼€å¯ä¸€ä¸ªæŒä¹…åŒ–çš„è¿æ¥ï¼Œä»¥<code>text/event-stream</code>æ ¼å¼å‘é€äº‹ä»¶ï¼Œæ­¤è¿æ¥ä¼šä¸€ç›´ä¿æŒå¼€å¯ç›´åˆ°é€šè¿‡è°ƒç”¨<code>EventSource.close()</code>å…³é—­ã€‚ä½†ä½¿ç”¨<code>EventSource</code>æ—¶åªèƒ½æŠŠå‚æ•°åŠ åˆ°<code>url</code>åé¢ï¼Œè€Œä¸”ä¹Ÿä¸èƒ½åƒ<code>fetch</code>è¯·æ±‚é‚£æ ·è®¾ç½®<code>header</code>ç­‰å‚æ•°ã€‚å€ŸåŠ©<code>fetch-event-source</code>è¿™ä¸ªåº“å°±å¯ä»¥åƒå‘èµ·<code>fetch</code>è¯·æ±‚ä¸€æ ·å‘èµ·æœåŠ¡å™¨å•å‘é€šä¿¡è¯·æ±‚ã€‚</p><h1 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h1><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/12dd0f1f322e466893e0def92d4d8f1e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="1.webp"></p><h1 id="å…¥å£æ–‡ä»¶"><a href="#å…¥å£æ–‡ä»¶" class="headerlink" title="å…¥å£æ–‡ä»¶"></a>å…¥å£æ–‡ä»¶</h1><p><code>index.ts</code>æ˜¯å…¥å£æ–‡ä»¶ï¼Œé‡Œé¢åªæœ‰2è¡Œä»£ç ï¼Œå¯¼å‡ºäº†<code>fetch.ts</code>å’Œ<code>parse.ts</code>ä¸­éƒ¨åˆ†å˜é‡å’Œæ–¹æ³•ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> &#123; fetchEventSource, <span class="title class_">FetchEventSourceInit</span>, <span class="title class_">EventStreamContentType</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./fetch&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123; <span class="title class_">EventSourceMessage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./parse&#x27;</span>;</span><br></pre></td></tr></table></figure><p><code>export &#123;...&#125; from &#39;xx&#39;</code>å…¶å®æ˜¯<code>import</code> + <code>export</code>çš„ç¼©å†™ã€‚ã€<br>ä¸Šé¢çš„ä»£ç å…¶å®å°±æ˜¯ä¸‹é¢ä»£ç çš„ç¼©å†™ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; fetchEventSource, <span class="title class_">FetchEventSourceInit</span>, <span class="title class_">EventStreamContentType</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./fetch&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">EventSourceMessage</span> &#125; <span class="keyword">from</span> <span class="string">&#x27;./parse&#x27;</span>;</span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">fetchEventSource,</span><br><span class="line"><span class="title class_">FetchEventSourceInit</span>,</span><br><span class="line"><span class="title class_">EventStreamContentType</span>,</span><br><span class="line"><span class="title class_">EventSourceMessage</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å‘èµ·è¯·æ±‚"><a href="#å‘èµ·è¯·æ±‚" class="headerlink" title="å‘èµ·è¯·æ±‚"></a>å‘èµ·è¯·æ±‚</h1><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/569c4d3e662449c594ca9b57531af51e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="1.5.webp"></p><ol><li><p>é¦–å…ˆå®šä¹‰äº†å˜é‡<code>EventStreamContentType</code>ï¼Œå®ƒçš„å€¼æ˜¯<code>sse</code>çš„<code>MIME Type</code>ã€‚å®ƒåœ¨2ä¸ªåœ°æ–¹ä½¿ç”¨ã€‚ç¬¬ä¸€å¤„æ˜¯å‘èµ·è¯·æ±‚æ—¶è®¾ç½®<code>headers.accept</code>ï¼Œå‘Šè¯‰æœåŠ¡å™¨åªæ¥å—**<code>text/event-stream</code>**æ ¼å¼çš„æ•°æ®ã€‚ç¬¬2å¤„æ˜¯åœ¨è¿æ¥å»ºç«‹æ—¶åˆ¤æ–­<code>response.headers.get(&#39;content-type&#39;)</code>æ˜¯å¦ç­‰äº<code>EventStreamContentType</code>çš„å€¼ï¼Œå¦‚æœä¸æ˜¯çš„è¯å°±æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå£°æ˜æœŸå¾…çš„ç±»å‹æ˜¯<code>text/event-stream</code>ã€‚</p></li><li><p>æ¥ä¸‹æ¥å®šä¹‰äº†å˜é‡<code>DefaultRetryInterval</code>ï¼Œ<code>sse</code>æœ‰<strong>è‡ªåŠ¨é‡è¿</strong>æœºåˆ¶ï¼Œè¿™é‡Œå®šä¹‰äº†æ¯æ¬¡é‡è¿çš„é»˜è®¤é—´éš”ä¸º1sã€‚ç„¶åå®šä¹‰äº†å˜é‡<code>LastEventId</code>ï¼Œè¡¨ç¤ºä¸Šä¸€æ¬¡äº‹ä»¶çš„idï¼Œæ·»åŠ åœ¨<code>headers</code>ä¸­å‘é€åˆ°æœåŠ¡ç«¯ã€‚</p></li><li><p>æ¥ä¸‹æ¥å®šä¹‰äº†ä¸€ä¸ªç±»å‹<code>FetchEventSourceInit</code>ï¼Œå®ƒå£°æ˜äº†<code>fetchEventSource</code>çš„ç¬¬2ä¸ªå‚æ•°çš„ç±»å‹ã€‚å‚æ•°ä¸€å…±æœ‰7ä¸ªã€‚<br><code>headers</code> è¯·æ±‚å¤´ã€‚<br><code>onopen</code> è¿æ¥å»ºç«‹æ—¶çš„å›è°ƒå‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ä¼šè°ƒç”¨é»˜è®¤çš„<code>defaultOnOpen</code>ï¼Œè¿™ä¸ªé»˜è®¤å›è°ƒé‡Œè¿›è¡Œäº†è¿”å›å€¼ç±»å‹åˆ¤æ–­ã€‚<br><code>onmessage</code>æ¯æ¬¡æ”¶åˆ°æ¶ˆæ¯æ—¶çš„å›è°ƒå‡½æ•°ï¼Œå‚æ•°æ˜¯æ¶ˆæ¯å¯¹è±¡ï¼Œå®ƒçš„ç±»å‹å°±æ˜¯<code>parse.ts</code>ä¸­å®šä¹‰çš„<code>EventSourceMessage</code>ã€‚<br><code>onclose</code> è¿æ¥å…³é—­æ—¶çš„å›è°ƒå‡½æ•°ã€‚<br><code>onerror</code>è¿æ¥å‘é€é”™è¯¯æ—¶çš„å›è°ƒå‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šè¿™ä¸ªå›è°ƒæˆ–è¿”å›<code>undefined</code>å°±ä¼šå‘èµ·é‡æ–°è¿æ¥è¯·æ±‚ã€‚<br><code>openWhenHidden</code> é»˜è®¤ä¸º<code>false</code>ï¼Œç›‘å¬<code>visibilitychange</code>ï¼Œå½“é¡µé¢ä¸å¯è§æ—¶å…³é—­è¿æ¥ï¼Œå½“é¡µé¢é‡æ–°å¯è§æ—¶é‡æ–°æ‰“å¼€è¿æ¥ã€‚<br><code>fetch</code>å‘èµ·è¯·æ±‚çš„æ–¹æ³•ï¼Œé»˜è®¤ä¸º<code>window.fetch</code>ã€‚  </p><p><code>Record&lt;string, string&gt;</code>ç­‰ä»·äº<code>&#123;[key: string]: string&#125;</code><br><code>Promise&lt;void&gt;</code>å®šä¹‰äº†ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œè¿”å›å€¼æ˜¯<code>void</code><br><code>typeof fetch</code> è·å–<code>fetch</code>çš„ç±»å‹ï¼Œ<code>typeof</code>åé¢è·Ÿçš„æ˜¯å˜é‡ï¼Œè¡¨ç¤ºç±»å‹å®šä¹‰  </p></li><li><p>æ¥ä¸‹æ¥å°±æ˜¯æœ€é‡è¦çš„<code>fetchEventSource</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œæ¥å—2ä¸ªå‚æ•°ï¼š<code>url</code>å’Œ<code>FetchEventSourceInit</code>ç±»å‹çš„å¯¹è±¡ã€‚<br>åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œé¦–å…ˆå®šä¹‰äº†æ¥å—çš„åª’ä½“ç±»å‹ã€‚ç„¶åæ·»åŠ ç›‘å¬<code>visibilitychange</code>äº‹ä»¶ï¼Œç„¶åæ·»åŠ ç›‘å¬<code>abort</code>äº‹ä»¶ä¾›ä½¿ç”¨è€…å¯ä»¥æ‰‹åŠ¨æ‰“æ–­è¿æ¥ï¼Œç„¶åå‘èµ·è¿æ¥ï¼Œæ‹¿åˆ°è¿”å›å€¼åå°†è¿”å›å€¼ä¼ é€’ç»™<code>onopen</code>ï¼Œç„¶åè°ƒç”¨<code>getBytes</code>è§£æè¿”å›å€¼ï¼Œè§£æä¹‹åå…³é—­è¿æ¥ã€‚<br>ç”¨<code>try...catch</code>åŒ…è£¹å‘èµ·è¿æ¥å’Œè§£æè¿”å›å€¼ä»¥åŠå…³é—­è¿æ¥çš„è¿‡ç¨‹ï¼Œå¦‚æœæ•è·åˆ°é”™è¯¯ä¸”ä¸æ˜¯ä¸»åŠ¨æ‰“æ–­çš„å°±å‘èµ·é‡è¿ã€‚<br>å†è¯´ä¸€ä¸‹ä¸»åŠ¨æ‰“æ–­è¿æ¥è¿™é‡Œï¼Œ<code>fetchEventSource</code>çš„ç¬¬2ä¸ªå‚æ•°å¯ä»¥ä¼ å…¥ä¸€ä¸ªä¿¡å·<code>signal</code>ï¼Œè¿™ä¸ªå±æ€§åœ¨<code>FetchEventSourceInit</code>ä¸­æ²¡æœ‰å®šä¹‰ã€‚å€ŸåŠ©<code>AbortController</code>ä¸­æ–­è¿æ¥ï¼Œå…·ä½“ä¿¡æ¯å¯ä»¥çœ‹<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/AbortController">AbortController-MDN</a>ã€‚</p></li></ol><p><code>??</code>ç±»ä¼¼<code>||</code>ï¼Œç›¸åŒç‚¹åœ¨äºæ ¹æ®å‰é¢çš„å€¼åˆ¤æ–­è¿”å›å‰é¢çš„è¿˜æ˜¯åé¢çš„ï¼Œä¸åŒç‚¹åœ¨äº<code>??</code>çš„ç¬¬ä¸€ä¸ªå€¼ä¸º<code>null</code>æˆ–<code>undefined</code>æ—¶è¿”å›ç¬¬äºŒä¸ªå€¼ï¼Œ<code>||</code>ä¼šå°†ç¬¬ä¸€ä¸ªå€¼å…ˆè½¬æ¢ä¸ºå¸ƒå°”å€¼ã€‚æ¯”å¦‚</p><pre><code><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0 ?? 2 // 0</span><br><span class="line">0 || 2 // 2</span><br></pre></td></tr></table></figure></code></pre><p>5. <code>defaultOnOpen</code>å®šä¹‰é»˜è®¤<code>onopen</code>å›è°ƒï¼Œä¸»è¦æ˜¯æ£€æŸ¥è¿”å›å€¼ç±»å‹ã€‚</p><h1 id="è§£ææ¶ˆæ¯"><a href="#è§£ææ¶ˆæ¯" class="headerlink" title="è§£ææ¶ˆæ¯"></a>è§£ææ¶ˆæ¯</h1><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/f8f916378b15441497a3b83ca5ad0fd5~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="2.PNG"><br>é¦–å…ˆä½¿ç”¨<code>response.body</code>æ¥è·å–å“åº”çš„ä¸»ä½“å†…å®¹ï¼Œå¹¶é€šè¿‡<code>getBytes</code>å‡½æ•°å°†å…¶è½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ã€‚ç„¶åï¼Œä½¿ç”¨<code>getLines</code>å‡½æ•°å°†å­—èŠ‚æ•°ç»„æ‹†åˆ†æˆè¡Œï¼Œå¹¶ä½¿ç”¨<code>getMessages</code>å‡½æ•°å°†æ¯è¡Œè§£æä¸ºäº‹ä»¶æ¶ˆæ¯ã€‚</p><h2 id="å¤„ç†ReadableStreamæ•°æ®"><a href="#å¤„ç†ReadableStreamæ•°æ®" class="headerlink" title="å¤„ç†ReadableStreamæ•°æ®"></a>å¤„ç†ReadableStreamæ•°æ®</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºäº†ä¸€ä¸ªæ•°æ®è¯»å–å™¨</span></span><br><span class="line"><span class="keyword">const</span> reader = response.<span class="title function_">getReader</span>();</span><br><span class="line"><span class="comment">// åˆ›å»ºäº†ä¸€ä¸ªæ–‡æœ¬è§£ç å™¨</span></span><br><span class="line"><span class="keyword">const</span> decoder = <span class="keyword">new</span> <span class="title class_">TextDecoder</span>();</span><br><span class="line"></span><br><span class="line">reader.<span class="title function_">read</span>().<span class="title function_">then</span>(<span class="keyword">function</span> <span class="title function_">processText</span>(<span class="params">&#123; done, value &#125;</span>) &#123;</span><br><span class="line">  <span class="comment">// Result å¯¹è±¡åŒ…å«äº†ä¸¤ä¸ªå±æ€§ï¼š</span></span><br><span class="line">  <span class="comment">// done  - å½“ stream ä¼ å®Œæ‰€æœ‰æ•°æ®æ—¶åˆ™å˜æˆ true</span></span><br><span class="line">  <span class="comment">// value - æ•°æ®ç‰‡æ®µã€‚å½“ done ä¸º true æ—¶å§‹ç»ˆä¸º undefined</span></span><br><span class="line">  <span class="keyword">if</span> (done) &#123;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å°†å­—èŠ‚æµè½¬æ¢ä¸ºå­—ç¬¦</span></span><br><span class="line">  <span class="keyword">const</span> text = decoder.<span class="title function_">decode</span>(value)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å†…å®¹</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(text);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å†æ¬¡è°ƒç”¨è¿™ä¸ªå‡½æ•°ä»¥è¯»å–æ›´å¤šæ•°æ®</span></span><br><span class="line">  <span class="keyword">return</span> reader.<span class="title function_">read</span>().<span class="title function_">then</span>(processText);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="å¤„ç†è¿‡ç¨‹åˆ†æ"><a href="#å¤„ç†è¿‡ç¨‹åˆ†æ" class="headerlink" title="å¤„ç†è¿‡ç¨‹åˆ†æ"></a>å¤„ç†è¿‡ç¨‹åˆ†æ</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> <span class="title function_">getBytes</span>(response.<span class="property">body</span>!, <span class="title function_">getLines</span>(<span class="title function_">getMessages</span>(<span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (id) &#123;</span><br><span class="line">        <span class="comment">// store the id and send it back on the next retry:</span></span><br><span class="line">        headers[<span class="title class_">LastEventId</span>] = id;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// don&#x27;t send the last-event-id header anymore:</span></span><br><span class="line">        <span class="keyword">delete</span> headers[<span class="title class_">LastEventId</span>];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, <span class="function"><span class="params">retry</span> =&gt;</span> &#123;</span><br><span class="line">    retryInterval = retry;</span><br><span class="line">&#125;, onmessage)));</span><br></pre></td></tr></table></figure><p>é¦–å…ˆæ‰§è¡Œçš„æ˜¯<code>getBytes</code>æ–¹æ³•ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªè¯»å–å™¨ï¼Œç”¨<code>while</code>å¾ªç¯è¯»å–æµæ•°æ®ï¼Œæ¯è¯»å–ä¸€æ®µå°±æ‰§è¡Œ<code>onChunk</code>è§£ææµæ•°æ®ï¼Œ<code>onChunk</code>å°±æ˜¯åœ¨<code>fetch.ts</code>ä¸­<code>getLines</code>çš„è¿”å›å€¼ã€‚<br><code>onChunk</code>å°†å­—èŠ‚å—æŒ‰è¡Œåˆ†å‰²ï¼Œå¹¶å°†æ¯è¡Œçš„å­—èŠ‚å­æ•°ç»„å’Œå­—æ®µé•¿åº¦ä¼ é€’ç»™<code>onLine</code>å›è°ƒå‡½æ•°ã€‚<code>onLine</code>åˆ™æ˜¯<code>getMessages</code>çš„è¿”å›å€¼ã€‚<br><code>getMessages</code>åˆ›å»ºäº†ä¸€ä¸ªè§£ç å™¨ï¼Œè¿”å›ä¸€ä¸ªåä¸ºonLineçš„å‡½æ•°ï¼Œç”¨äºå¤„ç†æ¯ä¸ªä¼ å…¥çš„è¡Œæ•°æ®ã€‚å®ƒå°†è¡Œçš„å­—èŠ‚å­æ•°ç»„è§£ç ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶æ ¹æ®å­—æ®µçš„ç±»å‹è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚æ¯”å¦‚ï¼Œå¦‚æœå­—æ®µæ˜¯<code>data</code>ï¼Œå®ƒä¼šå°†å€¼è¿½åŠ åˆ°<code>message.data</code>ä¸­ï¼Œå¦‚æœ<code>message.data</code>å·²ç»å­˜åœ¨ï¼Œåˆ™åœ¨åŸæœ‰å€¼çš„åŸºç¡€ä¸Šæ·»åŠ æ–°å€¼ï¼Œå¹¶ä½¿ç”¨æ¢è¡Œç¬¦åˆ†éš”ã€‚<br>å°†å­—èŠ‚æµå…ˆæŒ‰è¡Œåˆ†å‰²å†è§£ææ˜¯ä¸ºäº†æ›´å¥½çš„å¤„ç†æ•°æ®ï¼Œå› ä¸ºæ•°æ®éƒ½æ˜¯<code>field:value</code>æ ¼å¼çš„ã€‚</p><p><code>TextDecoder</code>è¡¨ç¤ºä¸€ä¸ªæ–‡æœ¬è§£ç å™¨ï¼Œå¯ä»¥å°†å­—èŠ‚æµæ•°æ®è½¬æ¢æˆæŒ‡å®šç ä½æµï¼Œé»˜è®¤æ˜¯utf-8ã€‚</p><h1 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h1><p>åœ¨è°ƒè¯•è¿™ä¸ªåº“çš„æ—¶å€™ï¼Œåœ¨<code>html</code>ä¸­å¼•å…¥æ‰“åŒ…åçš„<code>esm</code>æ–‡ä»¶ä¼šæŠ¥é”™æ–‡ä»¶æ‰¾ä¸åˆ°ï¼Œå› ä¸ºæ–‡ä»¶åæ²¡æœ‰æ·»åŠ åç¼€ã€‚<br>æ¥å£è¿”å›å€¼çš„ç±»å‹å¿…é¡»æ˜¯<code>text/event-stream</code>ç±»å‹çš„ï¼Œå°±ç®—æ˜¯æµæ•°æ®ä¹Ÿä¸è¡Œã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p><code>getBytes</code>çš„ç¬¬2ä¸ªå‚æ•°æ˜¯<code>getLines</code>çš„è¿”å›å€¼ï¼Œ<code>getLines</code>çš„å‚æ•°åˆæ˜¯<code>getMessages</code>çš„è¿”å›å€¼ï¼ŒåµŒå¥—çš„æ¯”è¾ƒæ·±ã€‚<br><code>onChunk</code>å°†å­—èŠ‚å—åˆ‡å‰²æˆä¸€è¡Œä¸€è¡Œçš„å­—èŠ‚ï¼Œæ¶‰åŠå­—èŠ‚æ•°æ®çš„çŸ¥è¯†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æºç  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨canvaså®ç°ä¸€ä¸ªç®€å•çš„ç”»æ¿</title>
      <link href="/2023/09/13/draw-board/"/>
      <url>/2023/09/13/draw-board/</url>
      
        <content type="html"><![CDATA[<h2 id="1-ç”»æ¿çš„åŠŸèƒ½"><a href="#1-ç”»æ¿çš„åŠŸèƒ½" class="headerlink" title="1.ç”»æ¿çš„åŠŸèƒ½"></a>1.ç”»æ¿çš„åŠŸèƒ½</h2><ul><li>ä¿®æ”¹ç”»ç¬”é¢œè‰²ï¼›</li><li>ä¿®æ”¹ç”»ç¬”ç²—ç»†ï¼›</li><li>æ©¡çš®æ“¦ï¼›</li><li>é‡ç½®ç”»æ¿ï¼›</li><li>æ’¤é”€ä¸Šä¸€æ­¥ï¼›</li><li>ä¿å­˜æˆå›¾ç‰‡ï¼›</li></ul><h2 id="2-æ‰€éœ€çŸ¥è¯†"><a href="#2-æ‰€éœ€çŸ¥è¯†" class="headerlink" title="2.æ‰€éœ€çŸ¥è¯†"></a>2.æ‰€éœ€çŸ¥è¯†</h2><p><code>Element.getBoundingClientRect()</code> æ–¹æ³•è¿”å›å…ƒç´ çš„å¤§å°åŠå…¶ç›¸å¯¹äºè§†å£çš„ä½ç½®ã€‚<br><code>ctx.moveTo(x, y)</code> å°†ä¸€ä¸ªæ–°çš„å­è·¯å¾„çš„èµ·å§‹ç‚¹ç§»åŠ¨åˆ°(xï¼Œy)åæ ‡<br><code>ctx.lineTo(x, y)</code> ä½¿ç”¨ç›´çº¿è¿æ¥å­è·¯å¾„çš„ç»ˆç‚¹åˆ°xï¼Œyåæ ‡</p><h2 id="3-ä¸€æ­¥æ­¥å®ç°"><a href="#3-ä¸€æ­¥æ­¥å®ç°" class="headerlink" title="3.ä¸€æ­¥æ­¥å®ç°"></a>3.ä¸€æ­¥æ­¥å®ç°</h2><h4 id="ç¬¬ä¸€æ­¥ï¼Œå®ç°åŸºæœ¬åŠŸèƒ½ï¼Œå¯ä»¥ç”»å‡ºæ¥é¼ æ ‡è·¯å¾„ï¼›"><a href="#ç¬¬ä¸€æ­¥ï¼Œå®ç°åŸºæœ¬åŠŸèƒ½ï¼Œå¯ä»¥ç”»å‡ºæ¥é¼ æ ‡è·¯å¾„ï¼›" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼Œå®ç°åŸºæœ¬åŠŸèƒ½ï¼Œå¯ä»¥ç”»å‡ºæ¥é¼ æ ‡è·¯å¾„ï¼›"></a>ç¬¬ä¸€æ­¥ï¼Œå®ç°åŸºæœ¬åŠŸèƒ½ï¼Œå¯ä»¥ç”»å‡ºæ¥é¼ æ ‡è·¯å¾„ï¼›</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;canvasÂ id=&quot;myCanvas&quot;Â width=&quot;400&quot;Â height=&quot;400&quot;&gt;&lt;/canvas&gt;</span><br><span class="line"></span><br><span class="line">classÂ BoardÂ &#123;</span><br><span class="line">  constructor(id)Â &#123;</span><br><span class="line">    this.canvasÂ =Â document.getElementById(id);</span><br><span class="line">    this.contextÂ =Â this.canvas.getContext(&#x27;2d&#x27;);</span><br><span class="line">    this.isDrawingÂ =Â false;</span><br><span class="line">    this.posXÂ =Â 0;</span><br><span class="line">    this.posYÂ =Â 0;</span><br><span class="line">    this.init();</span><br><span class="line">  &#125;</span><br><span class="line">  init()Â &#123;</span><br><span class="line">    constÂ bindDownÂ =Â this.handleMouseDown.bind(this);</span><br><span class="line">    constÂ bindMoveÂ =Â this.handleMouseMove.bind(this);</span><br><span class="line">    this.canvas.addEventListener(&#x27;mousedown&#x27;,Â bindDown);</span><br><span class="line">    this.canvas.addEventListener(&#x27;mousemove&#x27;,Â bindMove);</span><br><span class="line">    window.addEventListener(&#x27;mouseup&#x27;,Â ()Â =&gt;Â &#123;</span><br><span class="line">      this.isDrawingÂ =Â false;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  handleMouseDown(e)Â &#123;</span><br><span class="line">    constÂ rectÂ =Â this.canvas.getBoundingClientRect();</span><br><span class="line">    this.posXÂ =Â e.clientXÂ -Â rect.left;</span><br><span class="line">    this.posYÂ =Â e.clientYÂ -Â rect.top;</span><br><span class="line">    this.isDrawingÂ =Â true;</span><br><span class="line">  &#125;</span><br><span class="line">  handleMouseMove(e)Â &#123;</span><br><span class="line">    ifÂ (this.isDrawingÂ ===Â true)Â &#123;</span><br><span class="line">      constÂ rectÂ =Â this.canvas.getBoundingClientRect();</span><br><span class="line">      this.drawLine(this.context,Â this.posX,Â this.posY,</span><br><span class="line">Â e.clientXÂ -Â rect.left,Â e.clientYÂ -Â rect.top);</span><br><span class="line">      this.posXÂ =Â e.clientXÂ -Â rect.left;</span><br><span class="line">      this.posYÂ =Â e.clientYÂ -Â rect.top;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  drawLine(context,Â x1,Â y1,Â x2,Â y2)Â &#123;</span><br><span class="line">    context.beginPath();</span><br><span class="line">    context.strokeStyleÂ =Â &#x27;black&#x27;;</span><br><span class="line">    context.lineWidthÂ =Â 1;</span><br><span class="line">    context.moveTo(x1,Â y1);</span><br><span class="line">    context.lineTo(x2,Â y2);</span><br><span class="line">    context.stroke();</span><br><span class="line">    context.closePath();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">newÂ Board(&#x27;myCanvas&#x27;);</span><br></pre></td></tr></table></figure><h4 id="ç¬¬äºŒæ­¥ï¼Œå¯ä»¥ä¿®æ”¹ç”»ç¬”é¢œè‰²ï¼›"><a href="#ç¬¬äºŒæ­¥ï¼Œå¯ä»¥ä¿®æ”¹ç”»ç¬”é¢œè‰²ï¼›" class="headerlink" title="ç¬¬äºŒæ­¥ï¼Œå¯ä»¥ä¿®æ”¹ç”»ç¬”é¢œè‰²ï¼›"></a>ç¬¬äºŒæ­¥ï¼Œå¯ä»¥ä¿®æ”¹ç”»ç¬”é¢œè‰²ï¼›</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;inputÂ id=&quot;colorPicker&quot;Â type=&quot;color&quot;Â /&gt;</span><br><span class="line"></span><br><span class="line">document.getElementById(&#x27;colorPicker&#x27;).addEventListener(&#x27;change&#x27;,Â eÂ =&gt;Â &#123;</span><br><span class="line">Â Â Â Â Â Â b.changeColor(e.target.value);</span><br><span class="line">Â Â Â Â &#125;)</span><br><span class="line">    </span><br><span class="line">    classÂ BoardÂ &#123;</span><br><span class="line">        constructor(id,Â colorÂ =Â &#x27;#000&#x27;)Â &#123;</span><br><span class="line">              this.penColorÂ =Â color; </span><br><span class="line">        &#125;  </span><br><span class="line">        drawLine(context,Â x1,Â y1,Â x2,Â y2)Â &#123;</span><br><span class="line">          context.strokeStyleÂ =Â this.penColor;          </span><br><span class="line">        &#125;</span><br><span class="line">        changeColor(color)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â this.penColorÂ =Â color;</span><br><span class="line">Â Â Â Â Â Â &#125;              </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="ç¬¬ä¸‰æ­¥ï¼Œä¿®æ”¹ç”»ç¬”ç²—ç»†ï¼›"><a href="#ç¬¬ä¸‰æ­¥ï¼Œä¿®æ”¹ç”»ç¬”ç²—ç»†ï¼›" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼Œä¿®æ”¹ç”»ç¬”ç²—ç»†ï¼›"></a>ç¬¬ä¸‰æ­¥ï¼Œä¿®æ”¹ç”»ç¬”ç²—ç»†ï¼›</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.lineWidth = number;</span><br></pre></td></tr></table></figure><h4 id="ç¬¬å››æ­¥ï¼Œæ©¡çš®æ“¦ï¼›"><a href="#ç¬¬å››æ­¥ï¼Œæ©¡çš®æ“¦ï¼›" class="headerlink" title="ç¬¬å››æ­¥ï¼Œæ©¡çš®æ“¦ï¼›"></a>ç¬¬å››æ­¥ï¼Œæ©¡çš®æ“¦ï¼›</h4><p><code>context.globalCompositeOperationÂ =Â &#39;destination-out&#39;;</code><br>å‚ç…§åˆ®åˆ®ä¹åŠŸèƒ½ã€‚</p><h4 id="ç¬¬äº”æ­¥ï¼Œé‡ç½®ç”»æ¿ï¼›"><a href="#ç¬¬äº”æ­¥ï¼Œé‡ç½®ç”»æ¿ï¼›" class="headerlink" title="ç¬¬äº”æ­¥ï¼Œé‡ç½®ç”»æ¿ï¼›"></a>ç¬¬äº”æ­¥ï¼Œé‡ç½®ç”»æ¿ï¼›</h4><p><code>context.clearRect(0,Â 0,Â width, height);</code></p><h4 id="ç¬¬å…­æ­¥ï¼Œæ’¤é”€ä¸Šä¸€æ­¥ï¼›"><a href="#ç¬¬å…­æ­¥ï¼Œæ’¤é”€ä¸Šä¸€æ­¥ï¼›" class="headerlink" title="ç¬¬å…­æ­¥ï¼Œæ’¤é”€ä¸Šä¸€æ­¥ï¼›"></a>ç¬¬å…­æ­¥ï¼Œæ’¤é”€ä¸Šä¸€æ­¥ï¼›</h4><p><code>this.canvas.toDataURL()</code><br>å°†å½“å‰canvasä¿å­˜ä¸ºbase64çš„å›¾ç‰‡ï¼Œå­˜æ”¾åœ¨æ•°ç»„ä¸­ã€‚å†è®¾ç½®ä¸€ä¸ªç´¢å¼•ï¼Œæ’¤é”€&#x2F;æ¢å¤ä¿®æ”¹ç´¢å¼•çš„å€¼ï¼Œä»æ•°ç»„ä¸­å–å‡ºå¯¹åº”çš„å›¾ç‰‡ã€‚</p><h4 id="ç¬¬ä¸ƒæ­¥ï¼Œä¿å­˜ä¸ºå›¾ç‰‡ï¼›"><a href="#ç¬¬ä¸ƒæ­¥ï¼Œä¿å­˜ä¸ºå›¾ç‰‡ï¼›" class="headerlink" title="ç¬¬ä¸ƒæ­¥ï¼Œä¿å­˜ä¸ºå›¾ç‰‡ï¼›"></a>ç¬¬ä¸ƒæ­¥ï¼Œä¿å­˜ä¸ºå›¾ç‰‡ï¼›</h4><p>åˆ›å»ºä¸€ä¸ªaæ ‡ç­¾ï¼Œhrefä¸ºtoDataURL()ç”Ÿæˆçš„å›¾ç‰‡ï¼Œæ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶ï¼Œç‚¹å‡»aé“¾æ¥ã€‚</p><h3 id="4-å®Œæ•´ä»£ç "><a href="#4-å®Œæ•´ä»£ç " class="headerlink" title="4.å®Œæ•´ä»£ç "></a>4.å®Œæ•´ä»£ç </h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;divÂ class=&quot;opera&quot;&gt;</span><br><span class="line">Â Â Â Â &lt;inputÂ id=&quot;colorPicker&quot;Â type=&quot;color&quot;Â /&gt;</span><br><span class="line">Â Â Â Â &lt;selectÂ id=&quot;fontsizeSelect&quot;&gt;</span><br><span class="line">Â Â Â Â Â Â &lt;optionÂ value=&quot;1&quot;&gt;1&lt;/option&gt;</span><br><span class="line">Â Â Â Â Â Â &lt;optionÂ value=&quot;2&quot;&gt;2&lt;/option&gt;</span><br><span class="line">Â Â Â Â Â Â &lt;optionÂ value=&quot;3&quot;&gt;3&lt;/option&gt;</span><br><span class="line">Â Â Â Â Â Â &lt;optionÂ value=&quot;4&quot;&gt;4&lt;/option&gt;</span><br><span class="line">Â Â Â Â Â Â &lt;optionÂ value=&quot;5&quot;&gt;5&lt;/option&gt;</span><br><span class="line">Â Â Â Â &lt;/select&gt;</span><br><span class="line">Â Â Â Â &lt;buttonÂ id=&quot;eraser&quot;&gt;æ©¡çš®æ“¦&lt;/button&gt;</span><br><span class="line">Â Â Â Â &lt;buttonÂ id=&quot;reset&quot;&gt;é‡ç½®&lt;/button&gt;</span><br><span class="line">Â Â Â Â &lt;buttonÂ id=&quot;revoke&quot;&gt;æ’¤é”€&lt;/button&gt;</span><br><span class="line">Â Â Â Â &lt;buttonÂ id=&quot;recover&quot;&gt;æ¢å¤&lt;/button&gt;</span><br><span class="line">Â Â Â Â &lt;buttonÂ id=&quot;saveAsPic&quot;&gt;ä¿å­˜ä¸ºå›¾ç‰‡&lt;/button&gt;</span><br><span class="line">Â Â &lt;/div&gt;</span><br><span class="line">Â Â &lt;canvasÂ id=&quot;myCanvas&quot;Â width=&quot;400&quot;Â height=&quot;400&quot;&gt;&lt;/canvas&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">Â classÂ BoardÂ &#123;</span><br><span class="line">Â Â Â Â Â Â constructor(id,Â colorÂ =Â &#x27;#000&#x27;,Â fontsizeÂ =Â 1)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â this.canvasÂ =Â document.getElementById(id);</span><br><span class="line">Â Â Â Â Â Â Â Â this.contextÂ =Â this.canvas.getContext(&#x27;2d&#x27;);</span><br><span class="line">Â Â Â Â Â Â Â Â this.isDrawingÂ =Â false;</span><br><span class="line">Â Â Â Â Â Â Â Â this.posXÂ =Â 0;</span><br><span class="line">Â Â Â Â Â Â Â Â this.posYÂ =Â 0;</span><br><span class="line">Â Â Â Â Â Â Â Â this.penColorÂ =Â color;</span><br><span class="line">Â Â Â Â Â Â Â Â this.fontsizeÂ =Â fontsize;</span><br><span class="line">Â Â Â Â Â Â Â Â this.isErasingÂ =Â false;</span><br><span class="line">Â Â Â Â Â Â Â Â this.stepÂ =Â 0;</span><br><span class="line">Â Â Â Â Â Â Â Â this.histroyListÂ =Â [];</span><br><span class="line">Â Â Â Â Â Â Â Â this.init();</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â init()Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â constÂ bindDownÂ =Â this.handleMouseDown.bind(this);</span><br><span class="line">Â Â Â Â Â Â Â Â constÂ bindMoveÂ =Â this.handleMouseMove.bind(this);</span><br><span class="line">Â Â Â Â Â Â Â Â this.canvas.addEventListener(&#x27;mousedown&#x27;,Â bindDown);</span><br><span class="line">Â Â Â Â Â Â Â Â this.canvas.addEventListener(&#x27;mousemove&#x27;,Â bindMove);</span><br><span class="line">Â Â Â Â Â Â Â Â window.addEventListener(&#x27;mouseup&#x27;,Â ()Â =&gt;Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â this.isDrawingÂ =Â false;</span><br><span class="line">Â Â Â Â Â Â Â Â &#125;);</span><br><span class="line">Â Â Â Â Â Â Â Â this.canvas.addEventListener(&#x27;mouseup&#x27;,Â ()Â =&gt;Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â this.step++;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â ifÂ (this.stepÂ &lt;Â this.histroyList.length)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â this.histroyList.lengthÂ =Â this.step;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â this.histroyList.push(this.canvas.toDataURL());</span><br><span class="line">Â Â Â Â Â Â Â Â &#125;);</span><br><span class="line">Â Â Â Â Â Â Â Â this.histroyList.push(this.canvas.toDataURL());</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â handleMouseDown(e)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â constÂ rectÂ =Â this.canvas.getBoundingClientRect();</span><br><span class="line">Â Â Â Â Â Â Â Â this.posXÂ =Â e.clientXÂ -Â rect.left;</span><br><span class="line">Â Â Â Â Â Â Â Â this.posYÂ =Â e.clientYÂ -Â rect.top;</span><br><span class="line">Â Â Â Â Â Â Â Â this.isDrawingÂ =Â true;</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â handleMouseMove(e)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â constÂ rectÂ =Â this.canvas.getBoundingClientRect();</span><br><span class="line">Â Â Â Â Â Â Â Â ifÂ (this.isErasing)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â this.context.globalCompositeOperationÂ =Â &#x27;destination-out&#x27;;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â this.context.beginPath();</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â this.context.arc(e.clientXÂ -Â rect.left,Â e.clientYÂ -Â rect.top,</span><br><span class="line">Â 10,Â 0,Â Math.PIÂ *Â 2);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â this.context.fill();</span><br><span class="line">Â Â Â Â Â Â Â Â &#125;Â elseÂ ifÂ (this.isDrawingÂ ===Â true)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â this.drawLine(this.context,Â this.posX,Â this.posY,</span><br><span class="line">Â e.clientXÂ -Â rect.left,Â e.clientYÂ -Â rect.top);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â this.posXÂ =Â e.clientXÂ -Â rect.left;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â this.posYÂ =Â e.clientYÂ -Â rect.top;</span><br><span class="line">Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â drawLine(context,Â x1,Â y1,Â x2,Â y2)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â context.beginPath();</span><br><span class="line">Â Â Â Â Â Â Â Â context.strokeStyleÂ =Â this.penColor;</span><br><span class="line">Â Â Â Â Â Â Â Â context.lineWidthÂ =Â this.fontsize;</span><br><span class="line">Â Â Â Â Â Â Â Â context.moveTo(x1,Â y1);</span><br><span class="line">Â Â Â Â Â Â Â Â context.lineTo(x2,Â y2);</span><br><span class="line">Â Â Â Â Â Â Â Â context.stroke();</span><br><span class="line">Â Â Â Â Â Â Â Â context.closePath();</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â changeColor(color)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â this.penColorÂ =Â color;</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â changeFontSize(size)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â this.fontsizeÂ =Â size;</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â switchEraseStatus()Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â this.isErasingÂ =Â !this.isErasing;</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â clearBoard()Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â this.context.clearRect(0,Â 0,Â window.myCanvas.width,</span><br><span class="line">Â window.myCanvas.height);</span><br><span class="line">Â Â Â Â Â Â Â Â this.stepÂ =Â 0;</span><br><span class="line">Â Â Â Â Â Â Â Â this.histroyListÂ =Â [];</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â revoke()Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â ifÂ (this.stepÂ &gt;Â 0)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â this.step--;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â this.context.clearRect(0,Â 0,Â window.myCanvas.width,Â </span><br><span class="line">window.myCanvas.height);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â letÂ picÂ =Â newÂ Image();</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â pic.srcÂ =Â this.histroyList[this.step];</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â pic.addEventListener(&#x27;load&#x27;,Â ()Â =&gt;Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â this.context.drawImage(pic,Â 0,Â 0);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â &#125;)</span><br><span class="line">Â Â Â Â Â Â Â Â &#125;Â elseÂ &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â console.log(&#x27;ä¸èƒ½ç»§ç»­æ’¤é”€äº†&#x27;)</span><br><span class="line">Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â recover()Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â ifÂ (this.stepÂ &lt;Â this.histroyList.lengthÂ -Â 1)Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â this.step++;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â this.context.clearRect(0,Â 0,Â window.myCanvas.width,</span><br><span class="line">    Â window.myCanvas.height);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â letÂ picÂ =Â newÂ Image();</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â pic.srcÂ =Â this.histroyList[this.step];</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â pic.addEventListener(&#x27;load&#x27;,Â ()Â =&gt;Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â Â Â this.context.drawImage(pic,Â 0,Â 0);</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â &#125;)</span><br><span class="line">Â Â Â Â Â Â Â Â &#125;Â elseÂ &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â Â Â console.log(&#x27;ä¸èƒ½ç»§ç»­æ¢å¤äº†&#x27;)</span><br><span class="line">Â Â Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â Â Â saveAsPic()Â &#123;</span><br><span class="line">Â Â Â Â Â Â Â Â constÂ elÂ =Â document.createElement(&#x27;a&#x27;);</span><br><span class="line">Â Â Â Â Â Â Â Â el.hrefÂ =Â this.canvas.toDataURL();</span><br><span class="line">Â Â Â Â Â Â Â Â el.downloadÂ =Â &#x27;canvas&#x27;;</span><br><span class="line">Â Â Â Â Â Â Â Â constÂ eventÂ =Â newÂ MouseEvent(&#x27;click&#x27;);</span><br><span class="line">Â Â Â Â Â Â Â Â el.dispatchEvent(event);</span><br><span class="line">Â Â Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â &#125;</span><br><span class="line">Â Â Â Â constÂ bÂ =Â newÂ Board(&#x27;myCanvas&#x27;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Â Â Â Â window.colorPicker.addEventListener(&#x27;change&#x27;,Â eÂ =&gt;Â &#123;</span><br><span class="line">Â Â Â Â Â Â b.changeColor(e.target.value);</span><br><span class="line">Â Â Â Â &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Â Â Â Â window.fontsizeSelect.addEventListener(&#x27;change&#x27;,Â eÂ =&gt;Â &#123;</span><br><span class="line">Â Â Â Â Â Â b.changeFontSize(window.fontsizeSelect.value);</span><br><span class="line">Â Â Â Â &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Â Â Â Â window.eraser.addEventListener(&#x27;click&#x27;,Â ()Â =&gt;Â &#123;</span><br><span class="line">Â Â Â Â Â Â b.switchEraseStatus();</span><br><span class="line">Â Â Â Â &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Â Â Â Â window.reset.addEventListener(&#x27;click&#x27;,Â ()Â =&gt;Â &#123;</span><br><span class="line">Â Â Â Â Â Â b.clearBoard();</span><br><span class="line">Â Â Â Â &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Â Â Â Â window.revoke.addEventListener(&#x27;click&#x27;,Â ()Â =&gt;Â &#123;</span><br><span class="line">Â Â Â Â Â Â b.revoke();</span><br><span class="line">Â Â Â Â &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Â Â Â Â window.recover.addEventListener(&#x27;click&#x27;,Â ()Â =&gt;Â &#123;</span><br><span class="line">Â Â Â Â Â Â b.recover();</span><br><span class="line">Â Â Â Â &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Â Â Â Â window.saveAsPic.addEventListener(&#x27;click&#x27;,Â ()Â =&gt;Â &#123;</span><br><span class="line">Â Â Â Â Â Â b.saveAsPic();</span><br><span class="line">Â Â Â Â &#125;)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> HTML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> canvas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>element-plusè‡ªåŠ¨æŒ‰éœ€å¼•å…¥</title>
      <link href="/2023/09/13/element-plus-use/"/>
      <url>/2023/09/13/element-plus-use/</url>
      
        <content type="html"><![CDATA[<p>å‰è¨€ï¼šä½¿ç”¨<code>unplugin-vue-components</code>åï¼Œå¯ä»¥å®ç°æŒ‰éœ€å¼•å…¥ï¼Œè€Œä¸”ä¹Ÿä¸ç”¨å†ä½¿ç”¨<code>import</code>å¼•å…¥éœ€è¦çš„ç»„ä»¶ï¼Œç›´æ¥ä½¿ç”¨<code>&lt;el-button&gt;</code>ç­‰ç»„ä»¶å°±å¯ä»¥ã€‚</p><h2 id="1-å®‰è£…npmåŒ…"><a href="#1-å®‰è£…npmåŒ…" class="headerlink" title="1.å®‰è£…npmåŒ…"></a>1.å®‰è£…npmåŒ…</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i unplugin-vue-components unplugin-auto-import -D</span><br></pre></td></tr></table></figure><h2 id="2-é…ç½®"><a href="#2-é…ç½®" class="headerlink" title="2.é…ç½®"></a>2.é…ç½®</h2><p><code>vue.config.js</code>ï¼ˆè¿™é‡Œæ˜¯vueclié…ç½®æ–¹æ³•ï¼Œå…¶ä»–è„šæ‰‹æ¶éœ€è¦å‚è€ƒæ–‡æ¡£ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const AutoImport = require(&#x27;unplugin-auto-import/webpack&#x27;)</span><br><span class="line">const Components = require(&#x27;unplugin-vue-components/webpack&#x27;)</span><br><span class="line">const &#123; ElementPlusResolver &#125; = require(&#x27;unplugin-vue-components/resolvers&#x27;)</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">configureWebpack: &#123;</span><br><span class="line">      plugins: [</span><br><span class="line">        AutoImport(&#123;</span><br><span class="line">          resolvers: [ElementPlusResolver()],</span><br><span class="line">        &#125;),</span><br><span class="line">        Components(&#123;</span><br><span class="line">          resolvers: [ElementPlusResolver()],</span><br><span class="line">        &#125;),</span><br><span class="line">      ],</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-å…·ä½“ä½¿ç”¨"><a href="#3-å…·ä½“ä½¿ç”¨" class="headerlink" title="3.å…·ä½“ä½¿ç”¨"></a>3.å…·ä½“ä½¿ç”¨</h2><p><code>app.vue</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">&lt;div&gt;</span><br><span class="line">&lt;el-button&gt;æŒ‰é’®&lt;/el-button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br></pre></td></tr></table></figure><h2 id="4-ç¡®è®¤æ˜¯å¦æŒ‰éœ€å¼•å…¥"><a href="#4-ç¡®è®¤æ˜¯å¦æŒ‰éœ€å¼•å…¥" class="headerlink" title="4.ç¡®è®¤æ˜¯å¦æŒ‰éœ€å¼•å…¥"></a>4.ç¡®è®¤æ˜¯å¦æŒ‰éœ€å¼•å…¥</h2><p>é¦–å…ˆï¼Œå®‰è£…<code>webpack-bundle-analyzer</code>æ’ä»¶ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev webpack-bundle-analyzer</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build --report</span><br></pre></td></tr></table></figure><p>ä¸ç”¨åšä»»ä½•é…ç½®ï¼Œå°±å¯ä»¥çœ‹åˆ°ç»ˆç«¯æ‰“å°å‡ºæ¥æ‰“åŒ…åå„æ–‡ä»¶å¤§å°ã€‚</p><h2 id="å¦‚æœæƒ³çœ‹è¯¦ç»†çš„æ‰“åŒ…åæ–‡ä»¶çš„ä¿¡æ¯ï¼Œå¯ä»¥åœ¨vue-config-jsä¸­åšå¦‚ä¸‹é…ç½®ï¼šç„¶åæ‰“å¼€åœ°å€http-127-0-0-1-8888å°±å¯ä»¥äº†ã€‚æ®æˆ‘ä¸ªäººæµ‹è¯•ï¼Œå®Œæ•´å¼•å…¥æ—¶ï¼Œæ‰“åŒ…åchunk-jsæ–‡ä»¶å¤§å°ä¸º400kå·¦å³ã€‚æŒ‰éœ€å¼•å…¥åï¼Œæ‰“åŒ…åchunk-jsæ–‡ä»¶å¤§å°ä¸º200kå·¦å³ã€‚-4-éä¸­ä½¿ç”¨ç»„ä»¶å¦‚æœåœ¨tsæ–‡ä»¶ä¸­ä½¿ç”¨ELMessageç­‰ç»„ä»¶ï¼Œä»éœ€è¦æ‰‹åŠ¨å¼•å…¥ï¼Œä»£ç å¦‚ä¸‹ã€‚"><a href="#å¦‚æœæƒ³çœ‹è¯¦ç»†çš„æ‰“åŒ…åæ–‡ä»¶çš„ä¿¡æ¯ï¼Œå¯ä»¥åœ¨vue-config-jsä¸­åšå¦‚ä¸‹é…ç½®ï¼šç„¶åæ‰“å¼€åœ°å€http-127-0-0-1-8888å°±å¯ä»¥äº†ã€‚æ®æˆ‘ä¸ªäººæµ‹è¯•ï¼Œå®Œæ•´å¼•å…¥æ—¶ï¼Œæ‰“åŒ…åchunk-jsæ–‡ä»¶å¤§å°ä¸º400kå·¦å³ã€‚æŒ‰éœ€å¼•å…¥åï¼Œæ‰“åŒ…åchunk-jsæ–‡ä»¶å¤§å°ä¸º200kå·¦å³ã€‚-4-éä¸­ä½¿ç”¨ç»„ä»¶å¦‚æœåœ¨tsæ–‡ä»¶ä¸­ä½¿ç”¨ELMessageç­‰ç»„ä»¶ï¼Œä»éœ€è¦æ‰‹åŠ¨å¼•å…¥ï¼Œä»£ç å¦‚ä¸‹ã€‚" class="headerlink" title="å¦‚æœæƒ³çœ‹è¯¦ç»†çš„æ‰“åŒ…åæ–‡ä»¶çš„ä¿¡æ¯ï¼Œå¯ä»¥åœ¨vue.config.jsä¸­åšå¦‚ä¸‹é…ç½®ï¼šç„¶åæ‰“å¼€åœ°å€http://127.0.0.1:8888å°±å¯ä»¥äº†ã€‚æ®æˆ‘ä¸ªäººæµ‹è¯•ï¼Œå®Œæ•´å¼•å…¥æ—¶ï¼Œæ‰“åŒ…åchunk.jsæ–‡ä»¶å¤§å°ä¸º400kå·¦å³ã€‚æŒ‰éœ€å¼•å…¥åï¼Œæ‰“åŒ…åchunk.jsæ–‡ä»¶å¤§å°ä¸º200kå·¦å³ã€‚## 4.é&lt;template&gt;ä¸­ä½¿ç”¨ç»„ä»¶å¦‚æœåœ¨tsæ–‡ä»¶ä¸­ä½¿ç”¨ELMessageç­‰ç»„ä»¶ï¼Œä»éœ€è¦æ‰‹åŠ¨å¼•å…¥ï¼Œä»£ç å¦‚ä¸‹ã€‚"></a>å¦‚æœæƒ³çœ‹è¯¦ç»†çš„æ‰“åŒ…åæ–‡ä»¶çš„ä¿¡æ¯ï¼Œå¯ä»¥åœ¨<code>vue.config.js</code>ä¸­åšå¦‚ä¸‹é…ç½®ï¼š<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">const BundleAnalyzerPlugin = require(&#x27;webpack-bundle-analyzer&#x27;).BundleAnalyzerPlugin;</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">configureWebpack: &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">new BundleAnalyzerPlugin()</span><br><span class="line">]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>ç„¶åæ‰“å¼€åœ°å€<code>http://127.0.0.1:8888</code>å°±å¯ä»¥äº†ã€‚<br>æ®æˆ‘ä¸ªäººæµ‹è¯•ï¼Œå®Œæ•´å¼•å…¥æ—¶ï¼Œæ‰“åŒ…å<code>chunk.js</code>æ–‡ä»¶å¤§å°ä¸º<code>400k</code>å·¦å³ã€‚æŒ‰éœ€å¼•å…¥åï¼Œæ‰“åŒ…å<code>chunk.js</code>æ–‡ä»¶å¤§å°ä¸º<code>200k</code>å·¦å³ã€‚<br>## 4.é<code>&lt;template&gt;</code>ä¸­ä½¿ç”¨ç»„ä»¶<br>å¦‚æœåœ¨tsæ–‡ä»¶ä¸­ä½¿ç”¨<code>ELMessage</code>ç­‰ç»„ä»¶ï¼Œä»éœ€è¦æ‰‹åŠ¨å¼•å…¥ï¼Œä»£ç å¦‚ä¸‹ã€‚<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import &#123; ElMessage &#125; from &#x27;element-plus&#x27;</span><br><span class="line">import &#x27;element-plus/theme-chalk/el-message.css&#x27;</span><br></pre></td></tr></table></figure></h2><p>å‚è€ƒæ–‡ç« ï¼š<br><a href="https://element-plus.gitee.io/zh-CN/guide/quickstart.html#%E6%8C%89%E9%9C%80%E5%AF%BC%E5%85%A5">element-plus</a><br><a href="https://github.com/antfu/unplugin-vue-components">unplugin-vue-components</a></p>]]></content>
      
      
      <categories>
          
          <category> æŒ‡å— </category>
          
      </categories>
      
      
        <tags>
            
            <tag> element-plus </tag>
            
            <tag> æŒ‰éœ€å¼•å…¥ </tag>
            
            <tag> è‡ªåŠ¨å¼•å…¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœåŠ¡ç«¯ä¸»åŠ¨æ¨é€æ¶ˆæ¯Server-client events(SSE)</title>
      <link href="/2023/09/13/sse/"/>
      <url>/2023/09/13/sse/</url>
      
        <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œç”¨httpå¯ä»¥å®ç°ä»å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯çš„æ¶ˆæ¯ï¼Œç”¨websocketå¯ä»¥å®ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨çš„åŒå‘é€šä¿¡ï¼Œä½†ç”¨SSEå®ç°æœåŠ¡ç«¯ä¸»åŠ¨æ¨é€çš„æ¯”è¾ƒå°‘ã€‚<br>SSEç›¸å½“äºhttpçš„ä¼˜ç‚¹æ˜¯å¯ä»¥ç”±æœåŠ¡ç«¯ä¸»åŠ¨æ¨é€æ¶ˆæ¯ã€‚SSEç›¸å½“äºwebsocketçš„ä¼˜ç‚¹æ˜¯æ–­å¼€è¿æ¥åå¯ä»¥è‡ªåŠ¨é‡è¿ã€‚</p><h1 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h1><ul><li>æ¶ˆæ¯ç»Ÿä¸€æ¨é€</li><li>æ•°æ®å®æ—¶æ›´æ–°</li><li>ä»£æ›¿è½®è¯¢</li></ul><h1 id="ä½¿ç”¨æ–¹æ³•"><a href="#ä½¿ç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨æ–¹æ³•"></a>ä½¿ç”¨æ–¹æ³•</h1><p>nodeçš„è¯ï¼Œå¯ä»¥ç”¨é˜®è€å¸ˆçš„ä¾‹å­<a href="https://www.ruanyifeng.com/blog/2017/05/server-sent_events.html">nodeå®ç°SSE</a></p><p>pythonå¯ä»¥å‚è€ƒä¸‹é¢çš„ä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">from flask import Flask, Response</span><br><span class="line">import time</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">def message_to_send():</span><br><span class="line">    time.sleep(5)</span><br><span class="line">    return json.dumps(&#123;&quot;message&quot;: &quot;hello&quot;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&quot;/stream&quot;)</span><br><span class="line">def stream():</span><br><span class="line">    def event_stream():</span><br><span class="line">        while True:</span><br><span class="line">            print(&quot;send&quot;)</span><br><span class="line">            yield &quot;data:  &#123;&#125;\n\n&quot;.format(message_to_send())</span><br><span class="line"></span><br><span class="line">    return Response(</span><br><span class="line">        event_stream(),</span><br><span class="line">        mimetype=&quot;text/event-stream&quot;,</span><br><span class="line">        headers=&#123;&quot;Access-Control-Allow-Origin&quot;: &quot;*&quot;&#125;,</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    app.run()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="ä¼ é€’postå‚æ•°"><a href="#ä¼ é€’postå‚æ•°" class="headerlink" title="ä¼ é€’postå‚æ•°"></a>ä¼ é€’postå‚æ•°</h1><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>sse</code>åªèƒ½è¿›è¡Œ<code>get</code>è¯·æ±‚ï¼Œå‚æ•°è·Ÿåœ¨urlåé¢ã€‚å€ŸåŠ©<code>@microsoft/fetch-event-source</code>å¯ä»¥ä¼ é€’postå‚æ•°ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">fetchEventSource</span>(<span class="string">&#x27;/api/sse&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">        <span class="attr">foo</span>: <span class="string">&#x27;bar&#x27;</span></span><br><span class="line">    &#125;),</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h1 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h1><ul><li>æƒ³è¦è·¨åŸŸéœ€è¦è®¾ç½®<code>withCredentials: true</code>æˆ–æœåŠ¡ç«¯è®¾ç½®å…è®¸è·¨åŸŸã€‚ï¼ˆ<code>@microsoft/fetch-event-source</code>å¯ä»¥ä¸ç”¨è®¾ç½®ï¼‰</li><li>æ¥å£å¿…é¡»è®¾ç½®<code>mimetype</code>ä¸º<code>text/event-stream</code></li><li>æ¥å£è¿”å›çš„æ¯æ¡æ¶ˆæ¯å¿…é¡»ä»¥<code>\n</code>ç»“å°¾ï¼Œæœ€åä¸€æ¡æ¶ˆæ¯ä»¥<code>\n\n</code>ç»“å°¾</li><li>æœ‰è¿æ¥ä¸ªæ•°é™åˆ¶ï¼Œæ¯ä¸ªåŸŸåä¸‹å¥½åƒæ˜¯é™åˆ¶6ä¸ª</li><li>å¦‚æœæƒ³æµ‹è¯•è‡ªåŠ¨é‡è¿ï¼Œå¯ä»¥å…ˆå…³é—­æœåŠ¡ç«¯çš„æœåŠ¡å†æ‰“å¼€</li></ul>]]></content>
      
      
      <categories>
          
          <category> è¯·æ±‚ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ®åˆ®ä¹æ•ˆæœåŸæ¥å¦‚æ­¤ç®€å•</title>
      <link href="/2023/09/07/guaguale/"/>
      <url>/2023/09/07/guaguale/</url>
      
        <content type="html"><![CDATA[<h2 id="1-åˆ®åˆ®ä¹ï¼ˆæ©¡çš®æ“¦ï¼‰æ•ˆæœçš„æ ¸å¿ƒapi"><a href="#1-åˆ®åˆ®ä¹ï¼ˆæ©¡çš®æ“¦ï¼‰æ•ˆæœçš„æ ¸å¿ƒapi" class="headerlink" title="1.åˆ®åˆ®ä¹ï¼ˆæ©¡çš®æ“¦ï¼‰æ•ˆæœçš„æ ¸å¿ƒapi"></a>1.åˆ®åˆ®ä¹ï¼ˆæ©¡çš®æ“¦ï¼‰æ•ˆæœçš„æ ¸å¿ƒapi</h2><pre><code>ctx.globalCompositeOperation = type;</code></pre><p>è®¾ç½®è¦åœ¨ç»˜åˆ¶æ–°å½¢çŠ¶æ—¶åº”ç”¨çš„åˆæˆæ“ä½œçš„ç±»å‹ã€‚<br>æˆ‘ä»¬è¿™é‡Œéœ€è¦ç”¨åˆ°çš„ç±»å‹æ˜¯ <code>destination-out</code><br><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/e5c12874897c4199aabb4fd83d4bec25~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="1206102951-61b0b351184c4_fix732.webp"><br>æ­¤å±æ€§çš„è¯¦ç»†ä¿¡æ¯ï¼š<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation">MDNæ–‡æ¡£</a></p><h2 id="2-åŸºç¡€ç‰ˆåˆ®åˆ®ä¹åŠŸèƒ½"><a href="#2-åŸºç¡€ç‰ˆåˆ®åˆ®ä¹åŠŸèƒ½" class="headerlink" title="2.åŸºç¡€ç‰ˆåˆ®åˆ®ä¹åŠŸèƒ½"></a>2.åŸºç¡€ç‰ˆåˆ®åˆ®ä¹åŠŸèƒ½</h2><p>canvs è¦†ç›–åœ¨å›¾ç‰‡ä¸Š</p><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/0c8a90facb104af6b99b2ca35dfd941e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="1658915698-61b0b4e96c7e7.webp"></p><pre><code>&lt;style&gt;Â Â Â Â bodyÂ &#123;Â Â Â Â Â Â margin:Â 0;Â Â Â Â &#125;Â Â Â Â imgÂ &#123;Â Â Â Â Â Â width:Â 400px;Â Â Â Â Â Â height:Â 300px;Â Â Â Â Â Â left:Â 200px;Â Â Â Â Â Â position:Â absolute;Â Â Â Â Â Â z-index:Â -1;Â Â Â Â &#125;Â Â Â Â canvasÂ &#123;Â Â Â Â Â Â margin-left:Â 200px;Â Â Â Â &#125;Â Â &lt;/style&gt;    &lt;imgÂ src=&quot;./test.jpg&quot;Â alt=&quot;pic&quot;/&gt;Â Â &lt;canvasÂ id=&quot;canvas&quot;Â width=&quot;400&quot;Â height=&quot;300&quot;&gt;&lt;/canvas&gt;</code></pre><!----><pre><code>&lt;script&gt;Â Â Â letÂ canvasÂ =Â document.querySelector(&#39;#canvas&#39;);Â Â Â letÂ contextÂ =Â canvas.getContext(&#39;2d&#39;);   // ç»˜åˆ¶æ¶‚å±‚Â Â Â context.beginPath();Â Â Â context.fillStyleÂ =Â &#39;grey&#39;;Â Â Â context.fillRect(0,Â 0,Â 400,Â 300);   // ç›‘å¬é¼ æ ‡ç§»åŠ¨äº‹ä»¶Â Â Â canvas.addEventListener(&#39;mousemove&#39;,Â (e)Â =&gt;Â &#123;    // å½“é¼ æ ‡å·¦é”®æŒ‰ä¸‹&amp;&amp;ç§»åŠ¨é¼ æ ‡æ—¶ï¼Œæ¸…é™¤é¼ æ ‡é™„è¿‘æ¶‚å±‚Â Â Â Â ifÂ (e.whichÂ ===Â 1Â &amp;&amp;Â e.buttonÂ ===Â 0)Â &#123;Â Â Â Â Â Â constÂ xÂ =Â e.clientX,Â yÂ =Â e.clientY;Â Â Â Â Â Â context.globalCompositeOperationÂ =Â &#39;destination-out&#39;;Â Â Â Â Â Â context.beginPath();      // æ¸…é™¤ä»¥é¼ æ ‡ä½ç½®ä¸ºåœ†å¿ƒï¼ŒåŠå¾„ä¸º10pxçš„åœ†çš„èŒƒå›´Â Â Â Â Â Â context.arc(xÂ -Â 200,Â y,Â 10,Â 0,Â Math.PIÂ *Â 2);Â Â Â Â Â Â context.fill();Â Â Â Â &#125;Â Â Â &#125;)Â Â &lt;/script&gt;</code></pre><h2 id="3-è¿›é˜¶ç‰ˆåˆ®åˆ®ä¹åŠŸèƒ½"><a href="#3-è¿›é˜¶ç‰ˆåˆ®åˆ®ä¹åŠŸèƒ½" class="headerlink" title="3.è¿›é˜¶ç‰ˆåˆ®åˆ®ä¹åŠŸèƒ½"></a>3.è¿›é˜¶ç‰ˆåˆ®åˆ®ä¹åŠŸèƒ½</h2><p>è¿›é˜¶åŠŸèƒ½ï¼š<br>ç‚¹å‡»æ—¶ï¼Œä»¥å½“å‰ä½ç½®ä¸ºåœ†å¿ƒåˆ®å¼€ä¸€éƒ¨åˆ†åŒºåŸŸï¼›<br>åˆ®å¼€xç™¾åˆ†æ¯”ï¼ˆå¯ä»¥è‡ªå®šä¹‰ï¼‰ååæ˜¾ç¤ºå…¨éƒ¨ï¼Œå¹¶ä¸”ä½¿ç”¨åŠ¨ç”»é€æ¸å˜æ·¡ï¼›<br>è°ƒç”¨ç¬¬ä¸€æ¬¡åˆ®çš„å›è°ƒæ–¹æ³•å’Œåˆ®å®Œçš„å›è°ƒæ–¹æ³•ï¼Œå¯ä»¥ä¼ å…¥æˆ–ä¸ä¼ ï¼›<br>æ¶‚å±‚ä¸Šé¢å¯ä»¥æ˜¾ç¤ºè‡ªå®šä¹‰æ–‡å­—ï¼›</p><p><img src="https://cdn.jsdelivr.net/gh/chendx97/CPics/img/338e11a92b3741d18d5378f3f5481b76~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp" alt="14236041-61b0b553e0efc.webp"></p><p>é¦–å…ˆæ”¹ä¸ºclasså½¢å¼ï¼Œæ–¹ä¾¿å¤šæ¬¡åˆ›å»ºåˆ®åˆ®ä¹ã€‚</p><pre><code>classÂ ScratchÂ &#123;Â Â Â Â Â Â constructor(id,Â &#123;Â maskColorÂ =Â &#39;grey&#39;,Â cursorRadiusÂ =Â 10Â &#125;Â =Â &#123;&#125;)Â &#123;Â Â Â Â Â Â Â Â this.canvasÂ =Â document.getElementById(&#39;canvas&#39;);Â Â Â Â Â Â Â Â this.contextÂ =Â this.canvas.getContext(&#39;2d&#39;);Â Â Â Â Â Â Â Â this.widthÂ =Â this.canvas.clientWidth;Â Â Â Â Â Â Â Â this.heightÂ =Â this.canvas.clientHeight;Â Â Â Â Â Â Â Â this.maskColorÂ =Â maskColor;Â //Â æ¶‚å±‚é¢œè‰²Â Â Â Â Â Â Â Â this.cursorRadiusÂ =Â cursorRadius;Â //Â å…‰æ ‡åŠå¾„Â Â Â Â Â Â Â Â this.init();Â Â Â Â Â Â &#125;Â Â Â Â Â Â init()Â &#123;Â Â Â Â Â Â Â Â //Â æ·»åŠ æ¶‚å±‚Â Â Â Â Â Â Â Â this.addCoat();Â Â Â Â Â Â Â Â letÂ bindEarseÂ =Â this.erase.bind(this);Â Â Â Â Â Â Â Â this.canvas.addEventListener(&#39;mousedown&#39;,Â (e)Â =&gt;Â &#123;Â Â Â Â Â Â Â Â Â Â //Â æŒ‰ä¸‹å·¦é”®Â Â Â Â Â Â Â Â Â Â ifÂ (e.whichÂ ===Â 1Â &amp;&amp;Â e.buttonÂ ===Â 0)Â &#123;Â Â Â Â Â Â Â Â Â Â Â Â //Â æ“¦æ‰æ¶‚å±‚Â Â Â Â Â Â Â Â Â Â Â Â this.canvas.addEventListener(&#39;mousemove&#39;,Â bindEarse);Â Â Â Â Â Â Â Â Â Â &#125;Â Â Â Â Â Â Â Â &#125;)Â Â Â Â Â Â Â Â document.addEventListener(&#39;mouseup&#39;,Â ()Â =&gt;Â &#123;Â Â Â Â Â Â Â Â Â Â this.canvas.removeEventListener(&#39;mousemove&#39;,Â bindEarse);Â Â Â Â Â Â Â Â &#125;)Â Â Â Â Â Â &#125;Â Â Â Â Â Â addCoat()Â &#123;Â Â Â Â Â Â Â Â this.context.beginPath();Â Â Â Â Â Â Â Â this.context.fillStyleÂ =Â this.maskColor;Â Â Â Â Â Â Â Â this.context.fillRect(0,Â 0,Â this.width,Â this.height);Â Â Â Â Â Â &#125;Â Â Â Â Â Â erase(e)Â &#123;Â Â Â Â Â Â Â Â constÂ xÂ =Â e.clientX,Â yÂ =Â e.clientY;Â Â Â Â Â Â Â Â this.context.globalCompositeOperationÂ =Â &#39;destination-out&#39;;Â Â Â Â Â Â Â Â this.context.beginPath();Â Â Â Â Â Â Â Â this.context.arc(xÂ -Â this.widthÂ /Â 2,Â y,Â this.cursorRadius,Â 0,Â Math.PIÂ *Â 2);Â Â Â Â Â Â Â Â this.context.fill();Â Â Â Â Â Â &#125;Â Â Â Â &#125;Â Â Â Â newÂ Scratch(&#39;canvas&#39;);</code></pre><p>ç„¶åï¼Œè®°å½•é¼ æ ‡ä½ç½®ï¼Œmouseupæ—¶åˆ¤æ–­æ˜¯ç‚¹å‡»è¿˜æ˜¯ç‚¹å‡»&amp;ç§»åŠ¨é¼ æ ‡ï¼Œå¦‚æœæ˜¯ç‚¹å‡»åˆ™ä»¥å½“å‰ä½ç½®ä¸ºåœ†å¿ƒåˆ®å¼€ä¸€éƒ¨åˆ†åŒºåŸŸï¼›</p><pre><code>this.canvas.addEventListener(&#39;mousedown&#39;,Â (e)Â =&gt;Â &#123;Â Â Â Â Â Â this.posXÂ =Â e.clientX;Â Â Â Â Â Â this.posYÂ =Â e.clientY;Â Â Â Â Â Â ...&#125;)Â document.addEventListener(&#39;mouseup&#39;,Â (e)Â =&gt;Â &#123;Â Â Â Â ifÂ (this.posXÂ ===Â e.clientXÂ &amp;&amp;Â this.posYÂ ===Â e.clientY)Â &#123;Â Â Â Â Â Â this.erase(e);    &#125;    Â ...&#125;)</code></pre><p>ç„¶åï¼Œåˆ¤æ–­åˆ®å¼€é¢ç§¯æ˜¯å¦è¶…è¿‡ä¸€åŠï¼Œå¦‚æœæ˜¯æ¸…ç©ºæ¶‚å±‚ï¼›</p><pre><code>ImageData ctx.getImageData(sx, sy, sw, sh);</code></pre><p>sxï¼šå°†è¦è¢«æå–çš„å›¾åƒæ•°æ®çŸ©å½¢åŒºåŸŸçš„å·¦ä¸Šè§’ x åæ ‡ã€‚<br>syï¼šå°†è¦è¢«æå–çš„å›¾åƒæ•°æ®çŸ©å½¢åŒºåŸŸçš„å·¦ä¸Šè§’ yÂ åæ ‡ã€‚<br>swï¼šå°†è¦è¢«æå–çš„å›¾åƒæ•°æ®çŸ©å½¢åŒºåŸŸçš„å®½åº¦ã€‚<br>shï¼šå°†è¦è¢«æå–çš„å›¾åƒæ•°æ®çŸ©å½¢åŒºåŸŸçš„é«˜åº¦ã€‚</p><p>ImageDataÂ å¯¹è±¡ï¼ŒåŒ…å«canvasç»™å®šçš„çŸ©å½¢å›¾åƒæ•°æ®ã€‚å¯ä»¥ç”¨æ¥åˆ¤æ–­æ˜¯å¦è¢«åˆ®å¼€ã€‚<br>æ¯4ä¸ªå…ƒç´ è¡¨ç¤ºä¸€ä¸ªåƒç´ ç‚¹çš„rgbaå€¼ï¼Œæ‰€ä»¥å¯ä»¥åˆ¤æ–­ç¬¬4ä¸ªçš„å€¼æ˜¯å¦å°äº256çš„ä¸€åŠå³128ï¼Œå¦‚æœå°äº128å³å¯è§†ä¸ºé€æ˜ï¼ˆè¢«åˆ®å¼€ï¼‰ã€‚</p><p>æ¸…ç©ºæŒ‡å®šåŒºåŸŸå†…å®¹ï¼š</p><pre><code>void ctx.clearRect(x, y, width, height);</code></pre><!----><pre><code>document.addEventListener(&#39;mouseup&#39;,Â (e)Â =&gt;Â &#123;   this.getScratchedPercentage();    ifÂ (this.currPerctÂ &gt;=Â this.maxEraseArea)Â &#123;        this.context.clearRect(0,Â 0,Â this.width,Â this.height);    &#125;&#125;)getScratchedPercentage()Â &#123;    constÂ pixelsÂ =Â this.context.getImageData(0,Â 0,Â this.width,Â this.height).data;    letÂ transparentPixelsÂ =Â 0;    forÂ (letÂ iÂ =Â 0;Â iÂ &lt;Â pixels.length;Â iÂ +=Â 4)Â &#123;Â         ifÂ (pixels[iÂ +Â 3]Â &lt;Â 128)Â &#123;Â Â Â Â Â Â Â Â Â Â Â Â transparentPixels++;Â Â Â Â Â Â Â Â Â Â &#125;    &#125;    this.currPerct =Â (transparentPixelsÂ /Â pixels.lengthÂ *Â 4Â *Â 100).toFixed(2);&#125;</code></pre><p>ç„¶åï¼Œè®¾ç½®ç¬¬ä¸€æ¬¡åˆ®çš„å›è°ƒæ–¹æ³•å’Œåˆ®å®Œçš„å›è°ƒæ–¹æ³•ï¼›</p><pre><code>constructor(id,Â &#123;Â maskColorÂ =Â &#39;grey&#39;,Â cursorRadiusÂ =Â 10,Â maxEraseAreaÂ =Â 50,    firstEraseCbkÂ =Â ()Â =&gt;Â &#123;Â &#125;,Â lastEraseCbkÂ =Â ()Â =&gt;Â &#123;Â &#125;Â &#125;Â =Â &#123;&#125;)Â &#123;    ...    this.firstEraseCbkÂ =Â firstEraseCbk;Â //Â ç¬¬ä¸€æ¬¡åˆ®çš„å›è°ƒå‡½æ•°    this.lastEraseCbkÂ =Â lastEraseCbk;Â //Â åˆ®å¼€çš„å›è°ƒå‡½æ•°&#125;this.canvas.addEventListener(&#39;mousedown&#39;,Â (e)Â =&gt;Â &#123;Â     ifÂ (this.currPerctÂ ===Â 0)Â &#123;        this.firstEraseCbk();    &#125;&#125;)document.addEventListener(&#39;mouseup&#39;,Â (e)Â =&gt;Â &#123;    ifÂ (this.currPerctÂ &gt;=Â this.maxEraseArea)Â &#123;        this.context.clearRect(0,Â 0,Â this.width,Â this.height);        this.lastEraseCbk();    &#125;&#125;)</code></pre><p>ç„¶åï¼Œåˆ®å¼€å…¨éƒ¨æ—¶æ…¢æ…¢æ¸…ç©ºæ¶‚å±‚ï¼Œè®¾ç½®èƒŒæ™¯è‰²æ¸å˜æ•ˆæœï¼›<br><code>requestAnimationFrame</code> åšå‡ºæ¥çš„åŠ¨ç”»æ›´æµç•…<br>å›è°ƒå‡½æ•°ç”¨é—­åŒ…å½¢å¼å¯ä»¥ç»™å›è°ƒå‡½æ•°ä¼ å‚</p><pre><code>document.addEventListener(&#39;mouseup&#39;,Â (e)Â =&gt;Â &#123;Â Â Â Â ifÂ (this.currPerctÂ &gt;=Â this.maxEraseArea)Â &#123;Â Â Â Â     this.doneÂ =Â true;Â Â Â Â     requestAnimationFrame(this.fadeOut(255));Â Â Â Â Â     this.lastEraseCbk();Â Â Â Â &#125;&#125;)fadeOut(alpha)Â &#123;Â Â Â Â returnÂ ()Â =&gt;Â &#123;Â Â Â Â Â Â Â Â Â Â this.context.save();Â Â Â Â Â Â Â Â Â Â this.context.globalCompositeOperationÂ =Â &#39;source-in&#39;;Â Â Â Â Â Â Â Â Â Â this.context.fillStyleÂ =Â this.context.fillStyleÂ +Â (alphaÂ -=Â 1).toString(16);Â Â Â Â Â Â Â Â Â Â this.context.fillRect(0,Â 0,Â this.width,Â this.height);Â Â Â Â Â Â Â Â Â Â this.context.restore();Â Â Â Â Â Â Â Â Â Â //Â åˆ°210å·²ç»çœ‹ä¸åˆ°æ¶‚å±‚äº†Â Â Â Â Â Â Â Â Â Â ifÂ (alphaÂ &gt;Â 210)Â &#123;Â Â Â Â Â Â Â Â Â Â Â Â requestAnimationFrame(this.fadeOut(alpha));Â Â Â Â Â Â Â Â Â Â &#125;Â Â Â Â Â &#125;&#125;</code></pre><p>ç„¶åï¼Œåˆå§‹åŒ–æ¶‚å±‚çš„æ—¶å€™ï¼Œå†æ¶‚å±‚ä¸Šæ˜¾ç¤ºè‡ªå®šä¹‰æ–‡å­—ï¼›</p><pre><code>addCoat()Â &#123;Â Â Â Â Â Â Â Â ...Â Â Â Â Â Â Â Â ifÂ (this.text)Â &#123;Â Â Â Â Â Â Â Â Â Â this.context.fontÂ =Â &#39;boldÂ 48pxÂ serif&#39;;Â Â Â Â Â Â Â Â Â Â this.context.fillStyleÂ =Â &#39;#fff&#39;;Â Â Â Â Â Â Â Â Â Â this.context.textAlignÂ =Â &#39;center&#39;;Â Â Â Â Â Â Â Â Â Â this.context.textBaselineÂ =Â &#39;middle&#39;;Â Â Â Â Â Â Â Â Â Â this.context.fillText(this.text,Â this.widthÂ /Â 2,Â this.heightÂ /Â 2);Â Â Â Â Â Â Â Â &#125;&#125;</code></pre><h2 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h2><pre><code>&lt;!DOCTYPEÂ html&gt;&lt;htmlÂ lang=&quot;en&quot;&gt;&lt;head&gt;Â Â &lt;metaÂ charset=&quot;UTF-8&quot;&gt;Â Â &lt;metaÂ http-equiv=&quot;X-UA-Compatible&quot;Â content=&quot;IE=edge&quot;&gt;Â Â &lt;metaÂ name=&quot;viewport&quot;Â content=&quot;width=device-width,Â initial-scale=1.0&quot;&gt;Â Â &lt;title&gt;Document&lt;/title&gt;Â Â &lt;style&gt;Â Â Â Â bodyÂ &#123;Â Â Â Â Â Â margin:Â 0;Â Â Â Â &#125;Â Â Â Â imgÂ &#123;Â Â Â Â Â Â width:Â 400px;Â Â Â Â Â Â height:Â 300px;Â Â Â Â Â Â left:Â 200px;Â Â Â Â Â Â position:Â absolute;Â Â Â Â Â Â z-index:Â -1;Â Â Â Â &#125;Â Â Â Â canvasÂ &#123;Â Â Â Â Â Â margin-left:Â 200px;Â Â Â Â &#125;Â Â &lt;/style&gt;&lt;/head&gt;&lt;body&gt;Â Â &lt;imgÂ src=&quot;./test.jpg&quot;Â alt=&quot;pic&quot;Â /&gt;Â Â &lt;canvasÂ id=&quot;canvas&quot;Â width=&quot;400&quot;Â height=&quot;300&quot;&gt;&lt;/canvas&gt;Â Â &lt;script&gt;Â Â Â Â classÂ ScratchÂ &#123;Â Â Â Â Â Â constructor(id,Â &#123;Â maskColorÂ =Â &#39;grey&#39;,Â cursorRadiusÂ =Â 10,Â maxEraseAreaÂ =Â 50,Â textÂ =Â &#39;&#39;,Â Â Â Â Â Â Â Â firstEraseCbkÂ =Â ()Â =&gt;Â &#123;Â &#125;,Â lastEraseCbkÂ =Â ()Â =&gt;Â &#123;Â &#125;Â &#125;Â =Â &#123;&#125;)Â &#123;Â Â Â Â Â Â Â Â this.canvasIdÂ =Â id;Â Â Â Â Â Â Â Â this.canvasÂ =Â document.getElementById(id);Â Â Â Â Â Â Â Â this.contextÂ =Â this.canvas.getContext(&#39;2d&#39;);Â Â Â Â Â Â Â Â this.widthÂ =Â this.canvas.clientWidth;Â Â Â Â Â Â Â Â this.heightÂ =Â this.canvas.clientHeight;Â Â Â Â Â Â Â Â this.maskColorÂ =Â maskColor;Â //Â æ¶‚å±‚é¢œè‰²Â Â Â Â Â Â Â Â this.cursorRadiusÂ =Â cursorRadius;Â //Â å…‰æ ‡åŠå¾„Â Â Â Â Â Â Â Â this.maxEraseAreaÂ =Â maxEraseArea;Â //Â åˆ®å¼€å¤šå°‘åè‡ªåŠ¨æ¸…ç©ºæ¶‚å±‚Â Â Â Â Â Â Â Â this.textÂ =Â text;Â Â Â Â Â Â Â Â this.firstEraseCbkÂ =Â firstEraseCbk;Â //Â ç¬¬ä¸€æ¬¡åˆ®çš„å›è°ƒå‡½æ•°Â Â Â Â Â Â Â Â this.lastEraseCbkÂ =Â lastEraseCbk;Â //Â åˆ®å¼€çš„å›è°ƒå‡½æ•°Â Â Â Â Â Â Â Â this.currPerctÂ =Â 0;Â //Â å½“å‰åˆ®å¼€å¤šå°‘ç™¾åˆ†æ¯”Â Â Â Â Â Â Â Â this.doneÂ =Â false;Â //Â æ˜¯å¦åˆ®å®ŒÂ Â Â Â Â Â Â Â this.init();Â Â Â Â Â Â &#125;Â Â Â Â Â Â init()Â &#123;Â Â Â Â Â Â Â Â //Â æ·»åŠ æ¶‚å±‚Â Â Â Â Â Â Â Â this.addCoat();Â Â Â Â Â Â Â Â letÂ bindEarseÂ =Â this.erase.bind(this);Â Â Â Â Â Â Â Â this.canvas.addEventListener(&#39;mousedown&#39;,Â eÂ =&gt;Â &#123;Â Â Â Â Â Â Â Â Â Â ifÂ (this.done)Â &#123;Â Â Â Â Â Â Â Â Â Â Â Â return;Â Â Â Â Â Â Â Â Â Â &#125;Â Â Â Â Â Â Â Â Â Â this.posXÂ =Â e.clientX;Â Â Â Â Â Â Â Â Â Â this.posYÂ =Â e.clientY;Â Â Â Â Â Â Â Â Â Â //Â æŒ‰ä¸‹å·¦é”®Â Â Â Â Â Â Â Â Â Â ifÂ (e.whichÂ ===Â 1Â &amp;&amp;Â e.buttonÂ ===Â 0)Â &#123;Â Â Â Â Â Â Â Â Â Â Â Â //Â æ“¦æ‰æ¶‚å±‚Â Â Â Â Â Â Â Â Â Â Â Â this.canvas.addEventListener(&#39;mousemove&#39;,Â bindEarse);Â Â Â Â Â Â Â Â Â Â &#125;Â Â Â Â Â Â Â Â Â Â ifÂ (this.currPerctÂ ===Â 0)Â &#123;Â Â Â Â Â Â Â Â Â Â Â Â this.firstEraseCbk();Â Â Â Â Â Â Â Â Â Â &#125;Â Â Â Â Â Â Â Â &#125;)Â Â Â Â Â Â Â Â document.addEventListener(&#39;mouseup&#39;,Â eÂ =&gt;Â &#123;Â Â Â Â Â Â Â Â Â Â ifÂ (this.done)Â &#123;Â Â Â Â Â Â Â Â Â Â Â Â return;Â Â Â Â Â Â Â Â Â Â &#125;Â Â Â Â Â Â Â Â Â Â ifÂ (e.target.idÂ !==Â this.canvasId)Â &#123;Â Â Â Â Â Â Â Â Â Â Â Â return;Â Â Â Â Â Â Â Â Â Â &#125;Â Â Â Â Â Â Â Â Â Â ifÂ (this.posXÂ ===Â e.clientXÂ &amp;&amp;Â this.posYÂ ===Â e.clientY)Â &#123;Â Â Â Â Â Â Â Â Â Â Â Â this.erase(e);Â Â Â Â Â Â Â Â Â Â &#125;Â Â Â Â Â Â Â Â Â Â this.canvas.removeEventListener(&#39;mousemove&#39;,Â bindEarse);Â Â Â Â Â Â Â Â Â Â this.getScratchedPercentage();Â Â Â Â Â Â Â Â Â Â ifÂ (this.currPerctÂ &gt;=Â this.maxEraseArea)Â &#123;Â Â Â Â Â Â Â Â Â Â Â Â this.doneÂ =Â true;Â Â Â Â Â Â Â Â Â Â Â Â requestAnimationFrame(this.fadeOut(255));Â Â Â Â Â Â Â Â Â Â Â Â this.lastEraseCbk();Â Â Â Â Â Â Â Â Â Â &#125;Â Â Â Â Â Â Â Â &#125;)Â Â Â Â Â Â &#125;Â Â Â Â Â Â //Â æ·»åŠ æ¶‚å±‚Â Â Â Â Â Â addCoat()Â &#123;Â Â Â Â Â Â Â Â this.context.beginPath();Â Â Â Â Â Â Â Â this.context.fillStyleÂ =Â this.maskColor;Â Â Â Â Â Â Â Â this.context.fillRect(0,Â 0,Â this.width,Â this.height);Â Â Â Â Â Â Â Â //Â ç»˜åˆ¶æ¶‚å±‚ä¸Šçš„æ–‡å­—Â Â Â Â Â Â Â Â ifÂ (this.text)Â &#123;Â Â Â Â Â Â Â Â Â Â this.context.fontÂ =Â &#39;boldÂ 48pxÂ serif&#39;;Â Â Â Â Â Â Â Â Â Â this.context.fillStyleÂ =Â &#39;#fff&#39;;Â Â Â Â Â Â Â Â Â Â this.context.textAlignÂ =Â &#39;center&#39;;Â Â Â Â Â Â Â Â Â Â this.context.textBaselineÂ =Â &#39;middle&#39;;Â Â Â Â Â Â Â Â Â Â this.context.fillText(this.text,Â this.widthÂ /Â 2,Â this.heightÂ /Â 2);Â Â Â Â Â Â Â Â &#125;Â Â Â Â Â Â &#125;Â Â Â Â Â Â //Â æ“¦é™¤æŸä½ç½®æ¶‚å±‚Â Â Â Â Â Â erase(e)Â &#123;Â Â Â Â Â Â Â Â constÂ xÂ =Â e.clientX,Â yÂ =Â e.clientY;Â Â Â Â Â Â Â Â this.context.globalCompositeOperationÂ =Â &#39;destination-out&#39;;Â Â Â Â Â Â Â Â this.context.beginPath();Â Â Â Â Â Â Â Â this.context.arc(xÂ -Â this.widthÂ /Â 2,Â y,Â this.cursorRadius,Â 0,Â Math.PIÂ *Â 2);Â Â Â Â Â Â Â Â this.context.fill();Â Â Â Â Â Â &#125;Â Â Â Â Â Â //Â è®¡ç®—è¢«æ“¦é™¤çš„éƒ¨åˆ†å å…¨éƒ¨çš„ç™¾åˆ†æ¯”Â Â Â Â Â Â getScratchedPercentage()Â &#123;Â Â Â Â Â Â Â Â constÂ pixelsÂ =Â this.context.getImageData(0,Â 0,Â this.width,Â this.height).data;Â Â Â Â Â Â Â Â letÂ transparentPixelsÂ =Â 0;Â Â Â Â Â Â Â Â forÂ (letÂ iÂ =Â 0;Â iÂ &lt;Â pixels.length;Â iÂ +=Â 4)Â &#123;Â Â Â Â Â Â Â Â Â Â ifÂ (pixels[iÂ +Â 3]Â &lt;Â 128)Â &#123;Â Â Â Â Â Â Â Â Â Â Â Â transparentPixels++;Â Â Â Â Â Â Â Â Â Â &#125;Â Â Â Â Â Â Â Â &#125;Â Â Â Â Â Â Â Â this.currPerctÂ =Â (transparentPixelsÂ /Â pixels.lengthÂ *Â 4Â *Â 100).toFixed(2);Â Â Â Â Â Â &#125;Â Â Â Â Â Â //Â æ¸…ç©ºæ¶‚å±‚æ—¶æ·¡å‡ºæ•ˆæœÂ Â Â Â Â Â fadeOut(alpha)Â &#123;Â Â Â Â Â Â Â Â returnÂ ()Â =&gt;Â &#123;Â Â Â Â Â Â Â Â Â Â this.context.save();Â Â Â Â Â Â Â Â Â Â this.context.globalCompositeOperationÂ =Â &#39;source-in&#39;;Â Â Â Â Â Â Â Â Â Â this.context.fillStyleÂ =Â this.context.fillStyleÂ +Â (alphaÂ -=Â 1).toString(16);Â Â Â Â Â Â Â Â Â Â this.context.fillRect(0,Â 0,Â this.width,Â this.height);Â Â Â Â Â Â Â Â Â Â this.context.restore();Â Â Â Â Â Â Â Â Â Â //Â åˆ°210å·²ç»çœ‹ä¸åˆ°æ¶‚å±‚äº†Â Â Â Â Â Â Â Â Â Â ifÂ (alphaÂ &gt;Â 210)Â &#123;Â Â Â Â Â Â Â Â Â Â Â Â requestAnimationFrame(this.fadeOut(alpha));Â Â Â Â Â Â Â Â Â Â &#125;Â Â Â Â Â Â Â Â &#125;Â Â Â Â Â Â &#125;Â Â Â Â &#125;Â Â Â Â newÂ Scratch(&#39;canvas&#39;,Â &#123;Â text:Â &#39;åˆ®ä¸€åˆ®&#39;,Â maxEraseArea:Â 10Â &#125;);Â Â &lt;/script&gt;&lt;/body&gt;&lt;/html&gt;</code></pre>]]></content>
      
      
      <categories>
          
          <category> HTML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> canvas </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
